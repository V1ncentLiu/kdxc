window["CtiAgentBar"]=function(r){var i={};function n(e){if(i[e]){return i[e].exports}var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=r;n.c=i;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(t,e){if(e&1)t=n(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=116)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i;(function(e){e[e["STATUS_EARLY"]=1]="STATUS_EARLY";e[e["STATUS_CONFIRMED"]=2]="STATUS_CONFIRMED"})(i=t.DialogStatus||(t.DialogStatus={}));var n;(function(e){e[e["STATUS_NULL"]=0]="STATUS_NULL";e[e["STATUS_INVITE_SENT"]=1]="STATUS_INVITE_SENT";e[e["STATUS_1XX_RECEIVED"]=2]="STATUS_1XX_RECEIVED";e[e["STATUS_INVITE_RECEIVED"]=3]="STATUS_INVITE_RECEIVED";e[e["STATUS_WAITING_FOR_ANSWER"]=4]="STATUS_WAITING_FOR_ANSWER";e[e["STATUS_ANSWERED"]=5]="STATUS_ANSWERED";e[e["STATUS_WAITING_FOR_PRACK"]=6]="STATUS_WAITING_FOR_PRACK";e[e["STATUS_WAITING_FOR_ACK"]=7]="STATUS_WAITING_FOR_ACK";e[e["STATUS_CANCELED"]=8]="STATUS_CANCELED";e[e["STATUS_TERMINATED"]=9]="STATUS_TERMINATED";e[e["STATUS_ANSWERED_WAITING_FOR_PRACK"]=10]="STATUS_ANSWERED_WAITING_FOR_PRACK";e[e["STATUS_EARLY_MEDIA"]=11]="STATUS_EARLY_MEDIA";e[e["STATUS_CONFIRMED"]=12]="STATUS_CONFIRMED"})(n=t.SessionStatus||(t.SessionStatus={}));var s;(function(e){e[e["ClientContext"]=0]="ClientContext";e[e["ConfigurationError"]=1]="ConfigurationError";e[e["Dialog"]=2]="Dialog";e[e["DigestAuthentication"]=3]="DigestAuthentication";e[e["DTMF"]=4]="DTMF";e[e["IncomingMessage"]=5]="IncomingMessage";e[e["IncomingRequest"]=6]="IncomingRequest";e[e["IncomingResponse"]=7]="IncomingResponse";e[e["InvalidStateError"]=8]="InvalidStateError";e[e["InviteClientContext"]=9]="InviteClientContext";e[e["InviteServerContext"]=10]="InviteServerContext";e[e["Logger"]=11]="Logger";e[e["LoggerFactory"]=12]="LoggerFactory";e[e["MethodParameterError"]=13]="MethodParameterError";e[e["NameAddrHeader"]=14]="NameAddrHeader";e[e["NotSupportedError"]=15]="NotSupportedError";e[e["OutgoingRequest"]=16]="OutgoingRequest";e[e["Parameters"]=17]="Parameters";e[e["PublishContext"]=18]="PublishContext";e[e["ReferClientContext"]=19]="ReferClientContext";e[e["ReferServerContext"]=20]="ReferServerContext";e[e["RegisterContext"]=21]="RegisterContext";e[e["RenegotiationError"]=22]="RenegotiationError";e[e["RequestSender"]=23]="RequestSender";e[e["ServerContext"]=24]="ServerContext";e[e["Session"]=25]="Session";e[e["SessionDescriptionHandler"]=26]="SessionDescriptionHandler";e[e["SessionDescriptionHandlerError"]=27]="SessionDescriptionHandlerError";e[e["SessionDescriptionHandlerObserver"]=28]="SessionDescriptionHandlerObserver";e[e["Subscription"]=29]="Subscription";e[e["Transport"]=30]="Transport";e[e["UA"]=31]="UA";e[e["URI"]=32]="URI"})(s=t.TypeStrings||(t.TypeStrings={}));var o;(function(e){e[e["STATUS_INIT"]=0]="STATUS_INIT";e[e["STATUS_STARTING"]=1]="STATUS_STARTING";e[e["STATUS_READY"]=2]="STATUS_READY";e[e["STATUS_USER_CLOSED"]=3]="STATUS_USER_CLOSED";e[e["STATUS_NOT_READY"]=4]="STATUS_NOT_READY"})(o=t.UAStatus||(t.UAStatus={}))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){if(typeof window==="object")r=window}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r(30);var i;(function(e){e.USER_AGENT=n.title+"/"+n.version;e.SIP="sip";e.SIPS="sips";var t;(function(e){e["CONNECTION_ERROR"]="Connection Error";e["INTERNAL_ERROR"]="Internal Error";e["REQUEST_TIMEOUT"]="Request Timeout";e["SIP_FAILURE_CODE"]="SIP Failure Code";e["ADDRESS_INCOMPLETE"]="Address Incomplete";e["AUTHENTICATION_ERROR"]="Authentication Error";e["BUSY"]="Busy";e["DIALOG_ERROR"]="Dialog Error";e["INCOMPATIBLE_SDP"]="Incompatible SDP";e["NOT_FOUND"]="Not Found";e["REDIRECTED"]="Redirected";e["REJECTED"]="Rejected";e["UNAVAILABLE"]="Unavailable";e["BAD_MEDIA_DESCRIPTION"]="Bad Media Description";e["CANCELED"]="Canceled";e["EXPIRES"]="Expires";e["NO_ACK"]="No ACK";e["NO_ANSWER"]="No Answer";e["NO_PRACK"]="No PRACK";e["RTP_TIMEOUT"]="RTP Timeout";e["USER_DENIED_MEDIA_ACCESS"]="User Denied Media Access";e["WEBRTC_ERROR"]="WebRTC Error";e["WEBRTC_NOT_SUPPORTED"]="WebRTC Not Supported"})(t=e.causes||(e.causes={}));var r;(function(e){e["REQUIRED"]="required";e["SUPPORTED"]="supported";e["UNSUPPORTED"]="none"})(r=e.supported||(e.supported={}));e.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]};e.ACK="ACK";e.BYE="BYE";e.CANCEL="CANCEL";e.INFO="INFO";e.INVITE="INVITE";e.MESSAGE="MESSAGE";e.NOTIFY="NOTIFY";e.OPTIONS="OPTIONS";e.REGISTER="REGISTER";e.UPDATE="UPDATE";e.SUBSCRIBE="SUBSCRIBE";e.PUBLISH="PUBLISH";e.REFER="REFER";e.PRACK="PRACK";e.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"};e.OPTION_TAGS={"100rel":true,199:true,answermode:true,"early-session":true,eventlist:true,explicitsub:true,"from-change":true,"geolocation-http":true,"geolocation-sip":true,gin:true,gruu:true,histinfo:true,ice:true,join:true,"multiple-refer":true,norefersub:true,nosub:true,outbound:true,path:true,policy:true,precondition:true,pref:true,privacy:true,"recipient-list-invite":true,"recipient-list-message":true,"recipient-list-subscribe":true,replaces:true,"resource-priority":true,"sdp-anat":true,"sec-agree":true,tdialog:true,timer:true,uui:true};var i;(function(e){e["INFO"]="info";e["RTP"]="rtp"})(i=e.dtmfType||(e.dtmfType={}))})(i=t.C||(t.C={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var m=r(2);var y=r(0);var T=r(8);var i;(function(s){function e(){var r={};r.promise=new Promise(function(e,t){r.resolve=e;r.reject=t});return r}s.defer=e;function t(e,t){return e.reduce(function(e,t){e=e.then(t);return e},Promise.resolve(t))}s.reducePromises=t;function r(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}s.str_utf8_length=r;function i(e){if(!e){return}var t=e.indexOf("o=");var r=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,r)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}s.generateFakeSDP=i;function n(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t}s.isDecimal=n;function o(e,t){if(t===void 0){t=32}var r="";for(var i=0;i<e;i++){var n=Math.floor(Math.random()*t);r+=n.toString(t)}return r}s.createRandomToken=o;function a(){return s.createRandomToken(10)}s.newTag=a;function f(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(Math.random()*16);var r=e==="x"?t:t%4+8;return r.toString(16)});return e}s.newUUID=f;function u(e,t){if(!e){return}else if(e.type===y.TypeStrings.URI){return e}else if(typeof e==="string"){var r=e.split("@");var i=void 0;var n=void 0;switch(r.length){case 1:if(!t){return}i=e;n=t;break;case 2:i=r[0];n=r[1];break;default:i=r.slice(0,r.length-1).join("@");n=r[r.length-1]}i=i.replace(/^(sips?|tel):/i,"");if(/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(i)){i=i.replace(/[\-\.\(\)]/g,"")}e=m.C.SIP+":"+s.escapeUser(i)+"@"+n;return T.Grammar.URIParse(e)}else{return}}s.normalizeTarget=u;function c(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}s.escapeUser=c;function l(e){var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"};var r=e.toLowerCase().replace(/_/g,"-").split("-");var i=r.length;var n="";for(var s=0;s<i;s++){if(s!==0){n+="-"}n+=r[s].charAt(0).toUpperCase()+r[s].substring(1)}if(t[n]){n=t[n]}return n}s.headerize=l;function h(e){for(var t in m.C.SIP_ERROR_CAUSES){if(m.C.SIP_ERROR_CAUSES[t].indexOf(e)!==-1){return m.C.causes[t]}}return m.C.causes.SIP_FAILURE_CODE}s.sipErrorCause=h;function d(e,t){return t||m.C.REASON_PHRASE[e]||""}s.getReasonPhrase=d;function p(e,t){t=s.getReasonPhrase(e,t);return"SIP;cause="+e+';text="'+t+'"'}s.getReasonHeaderValue=p;function v(e,t){if(e&&e<200||e>699){throw new TypeError("Invalid statusCode: "+e)}else if(e){return s.getReasonHeaderValue(e,t)}}s.getCancelReason=v;function g(e,t){if(!e||(e<100||e>699)){throw new TypeError("Invalid statusCode: "+e)}else if(t&&typeof t!=="string"&&!(t instanceof String)){throw new TypeError("Invalid reason: "+t)}t=s.getReasonPhrase(e,t);return"SIP/2.0 "+e+" "+t+"\r\n"}s.buildStatusLine=g})(i=t.Utils||(t.Utils={}))},function(e,t,r){e.exports=r(69)},function(e,t,r){"use strict";var s=r(43);var i=r(70);var n=Object.prototype.toString;function o(e){return n.call(e)==="[object Array]"}function a(e){return n.call(e)==="[object ArrayBuffer]"}function f(e){return typeof FormData!=="undefined"&&e instanceof FormData}function u(e){var t;if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView){t=ArrayBuffer.isView(e)}else{t=e&&e.buffer&&e.buffer instanceof ArrayBuffer}return t}function c(e){return typeof e==="string"}function l(e){return typeof e==="number"}function h(e){return typeof e==="undefined"}function d(e){return e!==null&&typeof e==="object"}function p(e){return n.call(e)==="[object Date]"}function v(e){return n.call(e)==="[object File]"}function g(e){return n.call(e)==="[object Blob]"}function m(e){return n.call(e)==="[object Function]"}function y(e){return d(e)&&m(e.pipe)}function T(e){return typeof URLSearchParams!=="undefined"&&e instanceof URLSearchParams}function C(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function S(){if(typeof navigator!=="undefined"&&navigator.product==="ReactNative"){return false}return typeof window!=="undefined"&&typeof document!=="undefined"}function A(e,t){if(e===null||typeof e==="undefined"){return}if(typeof e!=="object"&&!o(e)){e=[e]}if(o(e)){for(var r=0,i=e.length;r<i;r++){t.call(null,e[r],r,e)}}else{for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t.call(null,e[n],n,e)}}}}function b(){var r={};function e(e,t){if(typeof r[t]==="object"&&typeof e==="object"){r[t]=b(r[t],e)}else{r[t]=e}}for(var t=0,i=arguments.length;t<i;t++){A(arguments[t],e)}return r}function w(i,e,n){A(e,function e(t,r){if(n&&typeof t==="function"){i[r]=s(t,n)}else{i[r]=t}});return i}e.exports={isArray:o,isArrayBuffer:a,isBuffer:i,isFormData:f,isArrayBufferView:u,isString:c,isNumber:l,isObject:d,isUndefined:h,isDate:p,isFile:v,isBlob:g,isFunction:m,isStream:y,isURLSearchParams:T,isStandardBrowserEnv:S,forEach:A,merge:b,extend:w,trim:C}},function(e,t,r){"use strict";var i=typeof Reflect==="object"?Reflect:null;var l=i&&typeof i.apply==="function"?i.apply:function e(t,r,i){return Function.prototype.apply.call(t,r,i)};var n;if(i&&typeof i.ownKeys==="function"){n=i.ownKeys}else if(Object.getOwnPropertySymbols){n=function e(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}}else{n=function e(t){return Object.getOwnPropertyNames(t)}}function f(e){if(console&&console.warn)console.warn(e)}var s=Number.isNaN||function e(t){return t!==t};function o(){o.init.call(this)}e.exports=o;o.EventEmitter=o;o.prototype._events=undefined;o.prototype._eventsCount=0;o.prototype._maxListeners=undefined;var a=10;Object.defineProperty(o,"defaultMaxListeners",{enumerable:true,get:function(){return a},set:function(e){if(typeof e!=="number"||e<0||s(e)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".")}a=e}});o.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};o.prototype.setMaxListeners=function e(t){if(typeof t!=="number"||t<0||s(t)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".")}this._maxListeners=t;return this};function u(e){if(e._maxListeners===undefined)return o.defaultMaxListeners;return e._maxListeners}o.prototype.getMaxListeners=function e(){return u(this)};o.prototype.emit=function e(t){var r=[];for(var i=1;i<arguments.length;i++)r.push(arguments[i]);var n=t==="error";var s=this._events;if(s!==undefined)n=n&&s.error===undefined;else if(!n)return false;if(n){var o;if(r.length>0)o=r[0];if(o instanceof Error){throw o}var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));a.context=o;throw a}var f=s[t];if(f===undefined)return false;if(typeof f==="function"){l(f,this,r)}else{var u=f.length;var c=g(f,u);for(var i=0;i<u;++i)l(c[i],this,r)}return true};function c(e,t,r,i){var n;var s;var o;if(typeof r!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}s=e._events;if(s===undefined){s=e._events=Object.create(null);e._eventsCount=0}else{if(s.newListener!==undefined){e.emit("newListener",t,r.listener?r.listener:r);s=e._events}o=s[t]}if(o===undefined){o=s[t]=r;++e._eventsCount}else{if(typeof o==="function"){o=s[t]=i?[r,o]:[o,r]}else if(i){o.unshift(r)}else{o.push(r)}n=u(e);if(n>0&&o.length>n&&!o.warned){o.warned=true;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");a.name="MaxListenersExceededWarning";a.emitter=e;a.type=t;a.count=o.length;f(a)}}return e}o.prototype.addListener=function e(t,r){return c(this,t,r,false)};o.prototype.on=o.prototype.addListener;o.prototype.prependListener=function e(t,r){return c(this,t,r,true)};function h(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;l(this.listener,this.target,e)}}function d(e,t,r){var i={fired:false,wrapFn:undefined,target:e,type:t,listener:r};var n=h.bind(i);n.listener=r;i.wrapFn=n;return n}o.prototype.once=function e(t,r){if(typeof r!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}this.on(t,d(this,t,r));return this};o.prototype.prependOnceListener=function e(t,r){if(typeof r!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}this.prependListener(t,d(this,t,r));return this};o.prototype.removeListener=function e(t,r){var i,n,s,o,a;if(typeof r!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}n=this._events;if(n===undefined)return this;i=n[t];if(i===undefined)return this;if(i===r||i.listener===r){if(--this._eventsCount===0)this._events=Object.create(null);else{delete n[t];if(n.removeListener)this.emit("removeListener",t,i.listener||r)}}else if(typeof i!=="function"){s=-1;for(o=i.length-1;o>=0;o--){if(i[o]===r||i[o].listener===r){a=i[o].listener;s=o;break}}if(s<0)return this;if(s===0)i.shift();else{m(i,s)}if(i.length===1)n[t]=i[0];if(n.removeListener!==undefined)this.emit("removeListener",t,a||r)}return this};o.prototype.off=o.prototype.removeListener;o.prototype.removeAllListeners=function e(t){var r,i,n;i=this._events;if(i===undefined)return this;if(i.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(i[t]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete i[t]}return this}if(arguments.length===0){var s=Object.keys(i);var o;for(n=0;n<s.length;++n){o=s[n];if(o==="removeListener")continue;this.removeAllListeners(o)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}r=i[t];if(typeof r==="function"){this.removeListener(t,r)}else if(r!==undefined){for(n=r.length-1;n>=0;n--){this.removeListener(t,r[n])}}return this};function p(e,t,r){var i=e._events;if(i===undefined)return[];var n=i[t];if(n===undefined)return[];if(typeof n==="function")return r?[n.listener||n]:[n];return r?y(n):g(n,n.length)}o.prototype.listeners=function e(t){return p(this,t,true)};o.prototype.rawListeners=function e(t){return p(this,t,false)};o.listenerCount=function(e,t){if(typeof e.listenerCount==="function"){return e.listenerCount(t)}else{return v.call(e,t)}};o.prototype.listenerCount=v;function v(e){var t=this._events;if(t!==undefined){var r=t[e];if(typeof r==="function"){return 1}else if(r!==undefined){return r.length}}return 0}o.prototype.eventNames=function e(){return this._eventsCount>0?n(this._events):[]};function g(e,t){var r=new Array(t);for(var i=0;i<t;++i)r[i]=e[i];return r}function m(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){var t=new Array(e.length);for(var r=0;r<t.length;++r){t[r]=e[r].listener||e[r]}return t}},function(e,t,r){"use strict";var a=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var f=r(0);var i=function(i){a(e,i);function e(e){var t=this.constructor;var r=i.call(this,e)||this;Object.setPrototypeOf(r,t.prototype);return r}return e}(Error);t.Exception=i;var n;(function(e){var t=function(t){a(e,t);function e(e){return t.call(this,e?e:"Unspecified transport error.")||this}return e}(i);e.TransportError=t})(n=t.Exceptions||(t.Exceptions={}));var u=function(n){a(e,n);function e(e,t,r){var i=n.call(this,r)||this;i.code=e;i.name=t;i.message=r;return i}return e}(i);(function(e){var t=function(i){a(e,i);function e(e,t){var r=i.call(this,1,"CONFIGURATION_ERROR",!t?"Missing parameter: "+e:"Invalid value "+JSON.stringify(t)+" for parameter '"+e+"'")||this;r.type=f.TypeStrings.ConfigurationError;r.parameter=e;r.value=t;return r}return e}(u);e.ConfigurationError=t;var r=function(r){a(e,r);function e(e){var t=r.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+e)||this;t.type=f.TypeStrings.InvalidStateError;t.status=e;return t}return e}(u);e.InvalidStateError=r;var i=function(r){a(e,r);function e(e){var t=r.call(this,3,"NOT_SUPPORTED_ERROR",e)||this;t.type=f.TypeStrings.NotSupportedError;return t}return e}(u);e.NotSupportedError=i;var n=function(r){a(e,r);function e(e){var t=r.call(this,5,"RENEGOTIATION_ERROR",e)||this;t.type=f.TypeStrings.RenegotiationError;return t}return e}(u);e.RenegotiationError=n;var s=function(n){a(e,n);function e(e,t,r){var i=n.call(this,6,"METHOD_PARAMETER_ERROR",!r?"Missing parameter: "+t:"Invalid value "+JSON.stringify(r)+" for parameter '"+t+"'")||this;i.type=f.TypeStrings.MethodParameterError;i.method=e;i.parameter=t;i.value=r;return i}return e}(u);e.MethodParameterError=s;var o=function(n){a(e,n);function e(e,t,r){var i=n.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",r||"Error with Session Description Handler")||this;i.type=f.TypeStrings.SessionDescriptionHandlerError;i.method=e;i.error=t;return i}return e}(u);e.SessionDescriptionHandlerError=o})(n=t.Exceptions||(t.Exceptions={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r(62);var i;(function(r){function e(e,t){var r={startRule:t};try{n.parse(e,r)}catch(e){r.data=-1}return r.data}r.parse=e;function t(e){var t=r.parse(e,"Name_Addr_Header");return t!==-1?t:undefined}r.nameAddrHeaderParse=t;function i(e){var t=r.parse(e,"SIP_URI");return t!==-1?t:undefined}r.URIParse=i})(i=t.Grammar||(t.Grammar={}))},function(e,t,r){"use strict";var s=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var i=r(6);var o=r(2);var n=r(7);var a=r(16);var f;(function(e){e["Accepted"]="Accepted";e["Calling"]="Calling";e["Completed"]="Completed";e["Confirmed"]="Confirmed";e["Proceeding"]="Proceeding";e["Terminated"]="Terminated";e["Trying"]="Trying"})(f=t.TransactionState||(t.TransactionState={}));var u=function(o){s(e,o);function e(e,t,r,i,n){var s=o.call(this)||this;s._transport=e;s._user=t;s._id=r;s._state=i;s.logger=t.loggerFactory.getLogger(n,r);s.logger.debug("Constructing "+s.typeToString()+" with id "+s.id+".");return s}e.prototype.dispose=function(){this.logger.debug("Destroyed "+this.typeToString()+" with id "+this.id+".")};Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"kind",{get:function(){if(this instanceof l){return"ict"}else if(this instanceof h){return"nict"}else if(this instanceof p){return"ist"}else if(this instanceof v){return"nist"}throw new Error("Invalid kind.")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"transport",{get:function(){return this._transport},enumerable:true,configurable:true});e.prototype.on=function(e,t){return o.prototype.on.call(this,e,t)};e.prototype.logTransportError=function(e,t){this.logger.error(e.message);this.logger.error("Transport error occurred in "+this.typeToString()+" with id "+this.id+".");this.logger.error(t)};e.prototype.send=function(e){var r=this;return this.transport.send(e).catch(function(e){if(e instanceof n.Exceptions.TransportError){r.onTransportError(e);return}var t;if(e&&typeof e.message==="string"){t=new n.Exceptions.TransportError(e.message)}else{t=new n.Exceptions.TransportError}r.onTransportError(t);throw t})};e.prototype.setState=function(e){this.logger.debug('State change to "'+e+'" on '+this.typeToString()+" with id "+this.id+".");this._state=e;if(this._user.onStateChange){this._user.onStateChange(e)}this.emit("stateChanged")};e.prototype.typeToString=function(){var e="UnknownType";if(this instanceof l){e="INVITE client transaction"}else if(this instanceof h){e="non-INVITE client transaction"}else if(this instanceof p){e="INVITE server transaction"}else if(this instanceof v){e="non-INVITE server transaction"}return e};return e}(i.EventEmitter);t.Transaction=u;var c=function(o){s(a,o);function a(e,t,r,i,n){var s=o.call(this,t,r,a.makeId(e),i,n)||this;s._request=e;s.user=r;e.setViaHeader(s.id,t);e.transaction=s;return s}a.makeId=function(e){if(e.method==="CANCEL"){if(!e.branch){throw new Error("Outgoing CANCEL request without a branch.")}return e.branch}else{return"z9hG4bK"+Math.floor(Math.random()*1e7)}};Object.defineProperty(a.prototype,"request",{get:function(){return this._request},enumerable:true,configurable:true});a.prototype.onRequestTimeout=function(){if(this.user.onRequestTimeout){this.user.onRequestTimeout()}};return a}(u);t.ClientTransaction=c;var l=function(n){s(e,n);function e(e,t,r){var i=n.call(this,e,t,r,f.Calling,"sip.transaction.ict")||this;i.ackRetransmissionCache=new Map;i.B=setTimeout(function(){return i.timer_B()},a.Timers.TIMER_B);i.send(e.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")});return i}e.prototype.dispose=function(){if(this.B){clearTimeout(this.B);this.B=undefined}if(this.D){clearTimeout(this.D);this.D=undefined}if(this.M){clearTimeout(this.M);this.M=undefined}n.prototype.dispose.call(this)};e.prototype.ackResponse=function(e){var t=this;var r=e.toTag;if(!r){throw new Error("To tag undefined.")}var i="z9hG4bK"+Math.floor(Math.random()*1e7);e.setViaHeader(i,this.transport);this.ackRetransmissionCache.set(r,e);this.send(e.toString()).catch(function(e){t.logTransportError(e,"Failed to send ACK to 2xx response.")})};e.prototype.receiveResponse=function(e){var t=this;var r=e.statusCode;if(!r||r<100||r>699){throw new Error("Invalid status code "+r)}switch(this.state){case f.Calling:if(r>=100&&r<=199){this.stateTransition(f.Proceeding);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}if(r>=200&&r<=299){this.ackRetransmissionCache.set(e.toTag,undefined);this.stateTransition(f.Accepted);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}if(r>=300&&r<=699){this.stateTransition(f.Completed);this.ack(e);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}break;case f.Proceeding:if(r>=100&&r<=199){if(this.user.receiveResponse){this.user.receiveResponse(e)}return}if(r>=200&&r<=299){this.ackRetransmissionCache.set(e.toTag,undefined);this.stateTransition(f.Accepted);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}if(r>=300&&r<=699){this.stateTransition(f.Completed);this.ack(e);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}break;case f.Accepted:if(r>=200&&r<=299){if(!this.ackRetransmissionCache.has(e.toTag)){this.ackRetransmissionCache.set(e.toTag,undefined);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}var i=this.ackRetransmissionCache.get(e.toTag);if(i){this.send(i.toString()).catch(function(e){t.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")});return}return}break;case f.Completed:if(r>=300&&r<=699){this.ack(e);return}break;case f.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="Received unexpected "+r+" response while in state "+this.state+".";this.logger.warn(n);return};e.prototype.onTransportError=function(e){if(this.user.onTransportError){this.user.onTransportError(e)}this.stateTransition(f.Terminated,true)};e.prototype.ack=function(e){var t=this;var r=this.request.ruri;var i=this.request.callId;var n=this.request.cseq;var s=this.request.getHeader("from");var o=e.getHeader("to");var a=this.request.getHeader("via");var f=this.request.getHeader("route");if(!s){throw new Error("From undefined.")}if(!o){throw new Error("To undefined.")}if(!a){throw new Error("Via undefined.")}var u="ACK "+r+" SIP/2.0\r\n";if(f){u+="Route: "+f+"\r\n"}u+="Via: "+a+"\r\n";u+="To: "+o+"\r\n";u+="From: "+s+"\r\n";u+="Call-ID: "+i+"\r\n";u+="CSeq: "+n+" ACK\r\n";u+="Max-Forwards: 70\r\n";u+="Content-Length: 0\r\n\r\n";this.send(u).catch(function(e){t.logTransportError(e,"Failed to send ACK to non-2xx response.")});return};e.prototype.stateTransition=function(e,t){var r=this;if(t===void 0){t=false}var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case f.Calling:i();break;case f.Proceeding:if(this.state!==f.Calling){i()}break;case f.Accepted:case f.Completed:if(this.state!==f.Calling&&this.state!==f.Proceeding){i()}break;case f.Terminated:if(this.state!==f.Calling&&this.state!==f.Accepted&&this.state!==f.Completed){if(!t){i()}}break;default:i()}if(this.B){clearTimeout(this.B);this.B=undefined}if(e===f.Proceeding){}if(e===f.Completed){this.D=setTimeout(function(){return r.timer_D()},a.Timers.TIMER_D)}if(e===f.Accepted){this.M=setTimeout(function(){return r.timer_M()},a.Timers.TIMER_M)}if(e===f.Terminated){this.dispose()}this.setState(e)};e.prototype.timer_A=function(){};e.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id+".");if(this.state===f.Calling){this.onRequestTimeout();this.stateTransition(f.Terminated)}};e.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id+".");if(this.state===f.Completed){this.stateTransition(f.Terminated)}};e.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id+".");if(this.state===f.Accepted){this.stateTransition(f.Terminated)}};return e}(c);t.InviteClientTransaction=l;var h=function(n){s(e,n);function e(e,t,r){var i=n.call(this,e,t,r,f.Trying,"sip.transaction.nict")||this;i.F=setTimeout(function(){return i.timer_F()},a.Timers.TIMER_F);i.send(e.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")});return i}e.prototype.dispose=function(){if(this.F){clearTimeout(this.F);this.F=undefined}if(this.K){clearTimeout(this.K);this.K=undefined}n.prototype.dispose.call(this)};e.prototype.receiveResponse=function(e){var t=e.statusCode;if(!t||t<100||t>699){throw new Error("Invalid status code "+t)}switch(this.state){case f.Trying:if(t>=100&&t<=199){this.stateTransition(f.Proceeding);if(this.user.receiveResponse){this.user.receiveResponse(e)}return}if(t>=200&&t<=699){this.stateTransition(f.Completed);if(t===408){this.onRequestTimeout();return}if(this.user.receiveResponse){this.user.receiveResponse(e)}return}break;case f.Proceeding:if(t>=100&&t<=199){if(this.user.receiveResponse){return this.user.receiveResponse(e)}}if(t>=200&&t<=699){this.stateTransition(f.Completed);if(t===408){this.onRequestTimeout();return}if(this.user.receiveResponse){this.user.receiveResponse(e)}return}case f.Completed:return;case f.Terminated:return;default:throw new Error("Invalid state "+this.state)}var r="Non-INVITE client transaction received unexpected "+t+" response while in state "+this.state+".";this.logger.warn(r);return};e.prototype.onTransportError=function(e){if(this.user.onTransportError){this.user.onTransportError(e)}this.stateTransition(f.Terminated,true)};e.prototype.stateTransition=function(e,t){var r=this;if(t===void 0){t=false}var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case f.Trying:i();break;case f.Proceeding:if(this.state!==f.Trying){i()}break;case f.Completed:if(this.state!==f.Trying&&this.state!==f.Proceeding){i()}break;case f.Terminated:if(this.state!==f.Trying&&this.state!==f.Proceeding&&this.state!==f.Completed){if(!t){i()}}break;default:i()}if(e===f.Completed){if(this.F){clearTimeout(this.F);this.F=undefined}this.K=setTimeout(function(){return r.timer_K()},a.Timers.TIMER_K)}if(e===f.Terminated){this.dispose()}this.setState(e)};e.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id+".");if(this.state===f.Trying||this.state===f.Proceeding){this.onRequestTimeout();this.stateTransition(f.Terminated)}};e.prototype.timer_K=function(){if(this.state===f.Completed){this.stateTransition(f.Terminated)}};return e}(c);t.NonInviteClientTransaction=h;var d=function(o){s(e,o);function e(e,t,r,i,n){var s=o.call(this,t,r,e.viaBranch,i,n)||this;s._request=e;s.user=r;e.transaction=s;return s}Object.defineProperty(e.prototype,"request",{get:function(){return this._request},enumerable:true,configurable:true});return e}(u);t.ServerTransaction=d;var p=function(n){s(e,n);function e(e,t,r){var i=n.call(this,e,t,r,f.Proceeding,"sip.transaction.ist")||this;e.reply(100);return i}e.prototype.dispose=function(){this.stopProgressExtensionTimer();if(this.H){clearTimeout(this.H);this.H=undefined}if(this.I){clearTimeout(this.I);this.I=undefined}if(this.L){clearTimeout(this.L);this.L=undefined}n.prototype.dispose.call(this)};e.prototype.receiveRequest=function(e){var t=this;switch(this.state){case f.Proceeding:if(e.method===o.C.INVITE){if(this.lastProvisionalResponse){this.send(this.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")})}return}break;case f.Accepted:if(e.method===o.C.INVITE){return}break;case f.Completed:if(e.method===o.C.INVITE){if(!this.lastFinalResponse){throw new Error("Last final response undefined.")}this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});return}if(e.method===o.C.ACK){this.stateTransition(f.Confirmed);return}break;case f.Confirmed:if(e.method===o.C.INVITE||e.method===o.C.ACK){return}break;case f.Terminated:if(e.method===o.C.INVITE||e.method===o.C.ACK){return}break;default:throw new Error("Invalid state "+this.state)}var r="INVITE server transaction received unexpected "+e.method+" request while in state "+this.state+".";this.logger.warn(r);return};e.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699){throw new Error("Invalid status code "+e)}switch(this.state){case f.Proceeding:if(e>=100&&e<=199){this.lastProvisionalResponse=t;if(e>100){this.startProgressExtensionTimer()}this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 1xx response.")});return}if(e>=200&&e<=299){this.lastFinalResponse=t;this.stateTransition(f.Accepted);this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});return}if(e>=300&&e<=699){this.lastFinalResponse=t;this.stateTransition(f.Completed);this.send(t).catch(function(e){r.logTransportError(e,"Failed to send non-2xx final response.")});return}break;case f.Accepted:if(e>=200&&e<=299){this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});return}break;case f.Completed:break;case f.Confirmed:break;case f.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";this.logger.error(i);throw new Error(i)};e.prototype.onTransportError=function(e){if(this.user.onTransportError){this.user.onTransportError(e)}};e.prototype.stateTransition=function(e){var t=this;var r=function(){throw new Error("Invalid state transition from "+t.state+" to "+e)};switch(e){case f.Proceeding:r();break;case f.Accepted:case f.Completed:if(this.state!==f.Proceeding){r()}break;case f.Confirmed:if(this.state!==f.Completed){r()}break;case f.Terminated:if(this.state!==f.Accepted&&this.state!==f.Completed&&this.state!==f.Confirmed){r()}break;default:r()}this.stopProgressExtensionTimer();if(e===f.Accepted){this.L=setTimeout(function(){return t.timer_L()},a.Timers.TIMER_L)}if(e===f.Completed){this.H=setTimeout(function(){return t.timer_H()},a.Timers.TIMER_H)}if(e===f.Confirmed){this.I=setTimeout(function(){return t.timer_I()},a.Timers.TIMER_I)}if(e===f.Terminated){this.dispose()}this.setState(e)};e.prototype.startProgressExtensionTimer=function(){var t=this;if(this.progressExtensionTimer===undefined){this.progressExtensionTimer=setInterval(function(){t.logger.debug("Progress extension timer expired for INVITE server transaction "+t.id+".");if(!t.lastProvisionalResponse){throw new Error("Last provisional response undefined.")}t.send(t.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")})},a.Timers.PROVISIONAL_RESPONSE_INTERVAL)}};e.prototype.stopProgressExtensionTimer=function(){if(this.progressExtensionTimer!==undefined){clearInterval(this.progressExtensionTimer);this.progressExtensionTimer=undefined}};e.prototype.timer_G=function(){};e.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id+".");if(this.state===f.Completed){this.logger.warn("ACK to negative final response was never received, terminating transaction.");this.stateTransition(f.Terminated)}};e.prototype.timer_I=function(){this.logger.debug("Timer I expired for INVITE server transaction "+this.id+".");this.stateTransition(f.Terminated)};e.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id+".");if(this.state===f.Accepted){this.stateTransition(f.Terminated)}};return e}(d);t.InviteServerTransaction=p;var v=function(i){s(e,i);function e(e,t,r){return i.call(this,e,t,r,f.Trying,"sip.transaction.nist")||this}e.prototype.dispose=function(){if(this.J){clearTimeout(this.J);this.J=undefined}i.prototype.dispose.call(this)};e.prototype.receiveRequest=function(e){var t=this;switch(this.state){case f.Trying:break;case f.Proceeding:if(!this.lastResponse){throw new Error("Last response undefined.")}this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case f.Completed:if(!this.lastResponse){throw new Error("Last response undefined.")}this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});break;case f.Terminated:break;default:throw new Error("Invalid state "+this.state)}};e.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699){throw new Error("Invalid status code "+e)}if(e>100&&e<=199){throw new Error("Provisional response other than 100 not allowed.")}switch(this.state){case f.Trying:this.lastResponse=t;if(e>=100&&e<200){this.stateTransition(f.Proceeding);this.send(t).catch(function(e){r.logTransportError(e,"Failed to send provisional response.")});return}if(e>=200&&e<=699){this.stateTransition(f.Completed);this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});return}break;case f.Proceeding:this.lastResponse=t;if(e>=200&&e<=699){this.stateTransition(f.Completed);this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});return}break;case f.Completed:return;case f.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="Non-INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";this.logger.error(i);throw new Error(i)};e.prototype.onTransportError=function(e){if(this.user.onTransportError){this.user.onTransportError(e)}this.stateTransition(f.Terminated,true)};e.prototype.stateTransition=function(e,t){var r=this;if(t===void 0){t=false}var i=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case f.Trying:i();break;case f.Proceeding:if(this.state!==f.Trying){i()}break;case f.Completed:if(this.state!==f.Trying&&this.state!==f.Proceeding){i()}break;case f.Terminated:if(this.state!==f.Proceeding&&this.state!==f.Completed){if(!t){i()}}break;default:i()}if(e===f.Completed){this.J=setTimeout(function(){return r.timer_J()},a.Timers.TIMER_J)}if(e===f.Terminated){this.dispose()}this.setState(e)};e.prototype.timer_J=function(){this.logger.debug("Timer J expired for NON-INVITE server transaction "+this.id+".");if(this.state===f.Completed){this.stateTransition(f.Terminated)}};return e}(d);t.NonInviteServerTransaction=v},function(e,v,t){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(v,"__esModule",{value:true});var g=t(2);var c=t(0);var l=t(8);var h=t(9);var m=t(3);v.getSupportedHeader=function(e){var t=[];if(e.method===g.C.REGISTER){t.push("path","gruu")}else if(e.method===g.C.INVITE&&(e.ua.contact.pubGruu||e.ua.contact.tempGruu)){t.push("gruu")}if(e.ua.configuration.rel100===g.C.supported.SUPPORTED){t.push("100rel")}if(e.ua.configuration.replaces===g.C.supported.SUPPORTED){t.push("replaces")}t.push("outbound");t=t.concat(e.ua.configuration.extraSupported||[]);var i=e.ua.configuration.hackAllowUnregisteredOptionTags||false;var n={};t=t.filter(function(e){var t=g.C.OPTION_TAGS[e];var r=!n[e];n[e]=true;return(t||i)&&r});return"Supported: "+t.join(", ")+"\r\n"};var d=function(){function a(e,t,r,i,n,s){if(i===void 0){i={}}this.type=c.TypeStrings.OutgoingRequest;this.logger=r.getLogger("sip.sipmessage");this.ua=r;this.headers={};this.method=e;this.ruri=t;this.body=s;this.extraHeaders=(n||[]).slice();this.statusCode=i.statusCode;this.reasonPhrase=i.reasonPhrase;if(i.routeSet){this.setHeader("route",i.routeSet)}else if(r.configuration.usePreloadedRoute&&r.transport){this.setHeader("route",r.transport.server.sipUri)}this.setHeader("via","");this.setHeader("max-forwards","70");var o=i.toUri||t;this.toTag=i.toTag;var a=i.toDisplayName||i.toDisplayName===0?'"'+i.toDisplayName+'" ':"";a+="<"+(o.type===c.TypeStrings.URI?o.toRaw():o)+">";a+=this.toTag?";tag="+this.toTag:"";this.to=l.Grammar.nameAddrHeaderParse(a);this.setHeader("to",a);var f=i.fromUri||r.configuration.uri||"";this.fromTag=i.fromTag||m.Utils.newTag();var u;if(i.fromDisplayName||i.fromDisplayName===0){u='"'+i.fromDisplayName+'" '}else if(r.configuration.displayName){u='"'+r.configuration.displayName+'" '}else{u=""}u+="<"+(f.type===c.TypeStrings.URI?f.toRaw():f)+">;tag=";u+=this.fromTag;this.from=l.Grammar.nameAddrHeaderParse(u);this.setHeader("from",u);this.callId=i.callId||r.configuration.sipjsId+m.Utils.createRandomToken(15);this.setHeader("call-id",this.callId);this.cseq=i.cseq||Math.floor(Math.random()*1e4);this.setHeader("cseq",this.cseq+" "+e)}a.prototype.getHeader=function(e){var t=this.headers[m.Utils.headerize(e)];if(t){if(t[0]){return t[0]}}else{var r=new RegExp("^\\s*"+e+"\\s*:","i");for(var i=0,n=this.extraHeaders;i<n.length;i++){var s=n[i];if(r.test(s)){return s.substring(s.indexOf(":")+1).trim()}}}return};a.prototype.getHeaders=function(e){var t=[];var r=this.headers[m.Utils.headerize(e)];if(r){for(var i=0,n=r;i<n.length;i++){var s=n[i];t.push(s)}}else{var o=new RegExp("^\\s*"+e+"\\s*:","i");for(var a=0,f=this.extraHeaders;a<f.length;a++){var u=f[a];if(o.test(u)){t.push(u.substring(u.indexOf(":")+1).trim())}}}return t};a.prototype.hasHeader=function(e){if(this.headers[m.Utils.headerize(e)]){return true}else{var t=new RegExp("^\\s*"+e+"\\s*:","i");for(var r=0,i=this.extraHeaders;r<i.length;r++){var n=i[r];if(t.test(n)){return true}}}return false};a.prototype.setHeader=function(e,t){this.headers[m.Utils.headerize(e)]=t instanceof Array?t:[t]};a.prototype.setViaHeader=function(e,t){var r="WSS";if(t.server&&t.server.scheme){r=t.server.scheme}if(this.ua.configuration.hackViaTcp){r="TCP"}var i="SIP/2.0/"+r;i+=" "+this.ua.configuration.viaHost+";branch="+e;if(this.ua.configuration.forceRport){i+=";rport"}this.setHeader("via",i);this.branch=e};a.prototype.cancel=function(n,s){var o=this;if(!this.transaction){throw new Error("Transaction undefined.")}var e=function(){if(!o.transaction){throw new Error("Transaction undefined.")}if(!o.to){throw new Error("To undefined.")}if(!o.from){throw new Error("From undefined.")}var e=new a(g.C.CANCEL,o.ruri,o.ua,{toUri:o.to.uri,toTag:o.toTag,fromUri:o.from.uri,fromTag:o.fromTag,callId:o.callId,cseq:o.cseq},s);e.branch=o.branch;if(o.headers.Route){e.headers.Route=o.headers.Route}if(n){e.setHeader("Reason",n)}var t=o.transaction.transport;var r={loggerFactory:o.ua.getLoggerFactory(),onStateChange:function(e){if(e===h.TransactionState.Terminated){o.ua.destroyTransaction(i)}},receiveResponse:function(e){return}};var i=new h.NonInviteClientTransaction(e,t,r);o.ua.newTransaction(i)};if(!(this.transaction instanceof h.InviteClientTransaction)){return}if(this.transaction.state===h.TransactionState.Proceeding){e()}else{this.transaction.once("stateChanged",function(){if(o.transaction&&o.transaction.state===h.TransactionState.Proceeding){e()}})}};a.prototype.toString=function(){var e="";e+=this.method+" "+(this.ruri.type===c.TypeStrings.URI?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n";for(var t in this.headers){if(this.headers[t]){for(var r=0,i=this.headers[t];r<i.length;r++){var n=i[r];e+=t+": "+n+"\r\n"}}}for(var s=0,o=this.extraHeaders;s<o.length;s++){var t=o[s];e+=t.trim()+"\r\n"}e+=v.getSupportedHeader(this);e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";if(this.body){if(typeof this.body==="string"){e+="Content-Length: "+m.Utils.str_utf8_length(this.body)+"\r\n\r\n";e+=this.body}else{if(this.body.body&&this.body.contentType){e+="Content-Type: "+this.body.contentType+"\r\n";e+="Content-Length: "+m.Utils.str_utf8_length(this.body.body)+"\r\n\r\n";e+=this.body.body}else{e+="Content-Length: "+0+"\r\n\r\n"}}}else{e+="Content-Length: "+0+"\r\n\r\n"}return e};return a}();v.OutgoingRequest=d;var r=function(){function e(){this.type=c.TypeStrings.IncomingMessage;this.headers={}}e.prototype.addHeader=function(e,t){var r={raw:t};e=m.Utils.headerize(e);if(this.headers[e]){this.headers[e].push(r)}else{this.headers[e]=[r]}};e.prototype.getHeader=function(e){var t=this.headers[m.Utils.headerize(e)];if(t){if(t[0]){return t[0].raw}}else{return}};e.prototype.getHeaders=function(e){var t=this.headers[m.Utils.headerize(e)];var r=[];if(!t){return[]}for(var i=0,n=t;i<n.length;i++){var s=n[i];r.push(s.raw)}return r};e.prototype.hasHeader=function(e){return!!this.headers[m.Utils.headerize(e)]};e.prototype.parseHeader=function(e,t){if(t===void 0){t=0}e=m.Utils.headerize(e);if(!this.headers[e]){return}else if(t>=this.headers[e].length){return}var r=this.headers[e][t];var i=r.raw;if(r.parsed){return r.parsed}var n=l.Grammar.parse(i,e.replace(/-/g,"_"));if(n===-1){this.headers[e].splice(t,1);return}else{r.parsed=n;return n}};e.prototype.s=function(e,t){if(t===void 0){t=0}return this.parseHeader(e,t)};e.prototype.setHeader=function(e,t){this.headers[m.Utils.headerize(e)]=[{raw:t}]};e.prototype.toString=function(){return this.data};return e}();v.IncomingMessage=r;var n=function(r){i(e,r);function e(e){var t=r.call(this)||this;t.ua=e;t.type=c.TypeStrings.IncomingRequest;t.logger=e.getLogger("sip.sipmessage");return t}e.prototype.reply=function(e,t,r,i){if(!this.transaction){throw new Error("Transaction undefined.")}var n=m.Utils.buildStatusLine(e,t);r=(r||[]).slice();if(this.method===g.C.INVITE&&e>100&&e<=200){for(var s=0,o=this.getHeaders("record-route");s<o.length;s++){var a=o[s];n+="Record-Route: "+a+"\r\n"}}for(var f=0,u=this.getHeaders("via");f<u.length;f++){var c=u[f];n+="Via: "+c+"\r\n"}var l=this.getHeader("to")||"";if(!this.toTag&&e>100){l+=";tag="+m.Utils.newTag()}else if(this.toTag&&!this.s("to").hasParam("tag")){l+=";tag="+this.toTag}n+="To: "+l+"\r\n";n+="From: "+this.getHeader("From")+"\r\n";n+="Call-ID: "+this.callId+"\r\n";n+="CSeq: "+this.cseq+" "+this.method+"\r\n";for(var h=0,d=r;h<d.length;h++){var p=d[h];n+=p.trim()+"\r\n"}n+=v.getSupportedHeader(this);n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";if(i){if(typeof i==="string"){n+="Content-Type: application/sdp\r\n";n+="Content-Length: "+m.Utils.str_utf8_length(i)+"\r\n\r\n";n+=i}else{if(i.body&&i.contentType){n+="Content-Type: "+i.contentType+"\r\n";n+="Content-Length: "+m.Utils.str_utf8_length(i.body)+"\r\n\r\n";n+=i.body}else{n+="Content-Length: "+0+"\r\n\r\n"}}}else{n+="Content-Length: "+0+"\r\n\r\n"}this.transaction.receiveResponse(e,n);return n};e.prototype.reply_sl=function(e,t){if(!this.transport){throw new Error("Transport undefined.")}var r=m.Utils.buildStatusLine(e,t);for(var i=0,n=this.getHeaders("via");i<n.length;i++){var s=n[i];r+="Via: "+s+"\r\n"}var o=this.getHeader("To")||"";if(!this.toTag&&e>100){o+=";tag="+m.Utils.newTag()}else if(this.toTag&&!this.s("to").hasParam("tag")){o+=";tag="+this.toTag}r+="To: "+o+"\r\n";r+="From: "+this.getHeader("From")+"\r\n";r+="Call-ID: "+this.callId+"\r\n";r+="CSeq: "+this.cseq+" "+this.method+"\r\n";r+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n";r+="Content-Length: "+0+"\r\n\r\n";this.transport.send(r);return r};return e}(r);v.IncomingRequest=n;var s=function(r){i(e,r);function e(e){var t=r.call(this)||this;t.ua=e;t.type=c.TypeStrings.IncomingResponse;t.logger=e.getLogger("sip.sipmessage");t.headers={};return t}e.prototype.ack=function(e){if(!this.statusCode||this.statusCode<200||this.statusCode>299){throw new Error("Response status code must be 2xx to ACK.")}if(this.method!==g.C.INVITE){throw new Error("Response must to be for an INVITE to ACK.")}if(!this.transaction){throw new Error("Transaction undefined.")}if(!(this.transaction instanceof h.InviteClientTransaction)){throw new Error("Transaction not instance of InviteServerTrasaction.")}var t=this.ua.dialogs[this.callId+this.fromTag+this.toTag];if(!t){throw new Error("Dialog undefined.")}var r=this.callId;var i=this.cseq;var n=t.localUri;var s=this.fromTag;var o=t.remoteUri;var a=this.toTag;var f=t.remoteTarget;var u=t.routeSet;var c=new d(g.C.ACK,f,this.ua,{callId:r,cseq:i,fromUri:n,fromTag:s,toUri:o,toTag:a,routeSet:u},e?e.extraHeaders:undefined,e?e.body:undefined);this.transaction.ackResponse(c);return c};return e}(r);v.IncomingResponse=s},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var n=r(6);var a=r(2);var f=r(0);var u=r(15);var c=r(10);var l=r(3);var s=function(s){i(o,s);function o(e,t,r,i){var n=s.call(this)||this;n.data={};o.initializer(n,e,t,r,i);return n}o.initializer=function(e,t,r,i,n){e.type=f.TypeStrings.ClientContext;if(i===undefined){throw new TypeError("Not enough arguments")}e.ua=t;e.logger=t.getLogger("sip.clientcontext");e.method=r;var s=t.normalizeTarget(i);if(!s){throw new TypeError("Invalid target: "+i)}n=Object.create(n||Object.prototype);n.extraHeaders=(n.extraHeaders||[]).slice();e.request=new c.OutgoingRequest(e.method,s,e.ua,n.params,n.extraHeaders);if(n.body){e.body={};e.body.body=n.body;if(n.contentType){e.body.contentType=n.contentType}e.request.body=e.body}if(e.request.from){e.localIdentity=e.request.from}if(e.request.to){e.remoteIdentity=e.request.to}};o.prototype.send=function(){var e=new u.RequestSender(this,this.ua);e.send();return this};o.prototype.receiveResponse=function(e){var t=e.statusCode||0;var r=l.Utils.getReasonPhrase(t);switch(true){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,r);break;case/^2[0-9]{2}$/.test(t.toString()):if(this.ua.applicants[this.toString()]){delete this.ua.applicants[this.toString()]}this.emit("accepted",e,r);break;default:if(this.ua.applicants[this.toString()]){delete this.ua.applicants[this.toString()]}this.emit("rejected",e,r);this.emit("failed",e,r);break}};o.prototype.onRequestTimeout=function(){this.emit("failed",undefined,a.C.causes.REQUEST_TIMEOUT)};o.prototype.onTransportError=function(){this.emit("failed",undefined,a.C.causes.CONNECTION_ERROR)};return o}(n.EventEmitter);t.ClientContext=s},function(e,S,i){(function(u){var e=i(102);var o=i(55);var d=i(103);var a=i(104);var f=i(105);var n;if(u&&u.ArrayBuffer){n=i(106)}var t=typeof navigator!=="undefined"&&/Android/i.test(navigator.userAgent);var r=typeof navigator!=="undefined"&&/PhantomJS/i.test(navigator.userAgent);var c=t||r;S.protocol=3;var l=S.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var h=e(l);var p={type:"error",data:"parser error"};var v=i(107);S.encodePacket=function(e,t,r,i){if("function"==typeof t){i=t;t=false}if("function"==typeof r){i=r;r=null}var n=e.data===undefined?undefined:e.data.buffer||e.data;if(u.ArrayBuffer&&n instanceof ArrayBuffer){return m(e,t,i)}else if(v&&n instanceof u.Blob){return y(e,t,i)}if(n&&n.base64){return g(e,i)}var s=l[e.type];if(undefined!==e.data){s+=r?f.encode(String(e.data)):String(e.data)}return i(""+s)};function g(e,t){var r="b"+S.packets[e.type]+e.data.data;return t(r)}function m(e,t,r){if(!t){return S.encodeBase64Packet(e,r)}var i=e.data;var n=new Uint8Array(i);var s=new Uint8Array(1+i.byteLength);s[0]=l[e.type];for(var o=0;o<n.length;o++){s[o+1]=n[o]}return r(s.buffer)}function s(e,t,r){if(!t){return S.encodeBase64Packet(e,r)}var i=new FileReader;i.onload=function(){e.data=i.result;S.encodePacket(e,t,true,r)};return i.readAsArrayBuffer(e.data)}function y(e,t,r){if(!t){return S.encodeBase64Packet(e,r)}if(c){return s(e,t,r)}var i=new Uint8Array(1);i[0]=l[e.type];var n=new v([i.buffer,e.data]);return r(n)}S.encodeBase64Packet=function(t,r){var i="b"+S.packets[t.type];if(v&&t.data instanceof u.Blob){var n=new FileReader;n.onload=function(){var e=n.result.split(",")[1];r(i+e)};return n.readAsDataURL(t.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){var o=new Uint8Array(t.data);var a=new Array(o.length);for(var f=0;f<o.length;f++){a[f]=o[f]}s=String.fromCharCode.apply(null,a)}i+=u.btoa(s);return r(i)};S.decodePacket=function(e,t,r){if(e===undefined){return p}if(typeof e=="string"){if(e.charAt(0)=="b"){return S.decodeBase64Packet(e.substr(1),t)}if(r){e=T(e);if(e===false){return p}}var i=e.charAt(0);if(Number(i)!=i||!h[i]){return p}if(e.length>1){return{type:h[i],data:e.substring(1)}}else{return{type:h[i]}}}var n=new Uint8Array(e);var i=n[0];var s=d(e,1);if(v&&t==="blob"){s=new v([s])}return{type:h[i],data:s}};function T(e){try{e=f.decode(e)}catch(e){return false}return e}S.decodeBase64Packet=function(e,t){var r=h[e.charAt(0)];if(!n){return{type:r,data:{base64:true,data:e.substr(1)}}}var i=n.decode(e.substr(1));if(t==="blob"&&v){i=new v([i])}return{type:r,data:i}};S.encodePayload=function(e,r,i){if(typeof r=="function"){i=r;r=null}var n=o(e);if(r&&n){if(v&&!c){return S.encodePayloadAsBlob(e,i)}return S.encodePayloadAsArrayBuffer(e,i)}if(!e.length){return i("0:")}function s(e){return e.length+":"+e}function t(e,t){S.encodePacket(e,!n?false:r,true,function(e){t(null,s(e))})}C(e,t,function(e,t){return i(t.join(""))})};function C(e,t,r){var n=new Array(e.length);var i=a(e.length,r);var s=function(r,e,i){t(e,function(e,t){n[r]=t;i(e,n)})};for(var o=0;o<e.length;o++){s(o,e[o],i)}}S.decodePayload=function(e,t,r){if(typeof e!="string"){return S.decodePayloadAsBinary(e,t,r)}if(typeof t==="function"){r=t;t=null}var i;if(e==""){return r(p,0,1)}var n="",s,o;for(var a=0,f=e.length;a<f;a++){var u=e.charAt(a);if(":"!=u){n+=u}else{if(""==n||n!=(s=Number(n))){return r(p,0,1)}o=e.substr(a+1,s);if(n!=o.length){return r(p,0,1)}if(o.length){i=S.decodePacket(o,t,true);if(p.type==i.type&&p.data==i.data){return r(p,0,1)}var c=r(i,a+s,f);if(false===c)return}a+=s;n=""}}if(n!=""){return r(p,0,1)}};S.encodePayloadAsArrayBuffer=function(e,i){if(!e.length){return i(new ArrayBuffer(0))}function t(e,t){S.encodePacket(e,true,true,function(e){return t(null,e)})}C(e,t,function(e,t){var r=t.reduce(function(e,t){var r;if(typeof t==="string"){r=t.length}else{r=t.byteLength}return e+r.toString().length+r+2},0);var o=new Uint8Array(r);var a=0;t.forEach(function(e){var t=typeof e==="string";var r=e;if(t){var i=new Uint8Array(e.length);for(var n=0;n<e.length;n++){i[n]=e.charCodeAt(n)}r=i.buffer}if(t){o[a++]=0}else{o[a++]=1}var s=r.byteLength.toString();for(var n=0;n<s.length;n++){o[a++]=parseInt(s[n])}o[a++]=255;var i=new Uint8Array(r);for(var n=0;n<i.length;n++){o[a++]=i[n]}});return i(o.buffer)})};S.encodePayloadAsBlob=function(e,r){function t(e,f){S.encodePacket(e,true,true,function(e){var t=new Uint8Array(1);t[0]=1;if(typeof e==="string"){var r=new Uint8Array(e.length);for(var i=0;i<e.length;i++){r[i]=e.charCodeAt(i)}e=r.buffer;t[0]=0}var n=e instanceof ArrayBuffer?e.byteLength:e.size;var s=n.toString();var o=new Uint8Array(s.length+1);for(var i=0;i<s.length;i++){o[i]=parseInt(s[i])}o[s.length]=255;if(v){var a=new v([t.buffer,o.buffer,e]);f(null,a)}})}C(e,t,function(e,t){return r(new v(t))})};S.decodePayloadAsBinary=function(e,r,i){if(typeof r==="function"){i=r;r=null}var t=e;var n=[];var s=false;while(t.byteLength>0){var o=new Uint8Array(t);var a=o[0]===0;var f="";for(var u=1;;u++){if(o[u]==255)break;if(f.length>310){s=true;break}f+=o[u]}if(s)return i(p,0,1);t=d(t,2+f.length);f=parseInt(f);var c=d(t,0,f);if(a){try{c=String.fromCharCode.apply(null,new Uint8Array(c))}catch(e){var l=new Uint8Array(c);c="";for(var u=0;u<l.length;u++){c+=String.fromCharCode(l[u])}}}n.push(c);t=d(t,f)}var h=n.length;n.forEach(function(e,t){i(S.decodePacket(e,r,true),t,h)})}}).call(this,i(1))},function(e,t,r){if(true){e.exports=i}function i(e){if(e)return n(e)}function n(e){for(var t in i.prototype){e[t]=i.prototype[t]}return e}i.prototype.on=i.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};i.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var i;for(var n=0;n<r.length;n++){i=r[n];if(i===t||i.fn===t){r.splice(n,1);break}}return this};i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r){r=r.slice(0);for(var i=0,n=r.length;i<n;++i){r[i].apply(this,t)}}return this};i.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var i=r(6);var c=r(11);var h=r(2);var u=r(22);var d=r(0);var l=r(7);var p=r(8);var s=r(15);var f=r(23);var v=r(65);var o=r(10);var g=r(16);var m=r(9);var y=r(3);var T=function(r){n(i,r);function i(e){var t=r.call(this)||this;t.data={};t.type=d.TypeStrings.Session;if(!e){throw new l.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function")}t.status=i.C.STATUS_NULL;t.dialog=undefined;t.pendingReinvite=false;t.earlyDialogs={};t.sessionDescriptionHandlerFactory=e;t.hasOffer=false;t.hasAnswer=false;t.timers={ackTimer:undefined,expiresTimer:undefined,invite2xxTimer:undefined,userNoAnswerTimer:undefined,rel1xxTimer:undefined,prackTimer:undefined};t.startTime=undefined;t.endTime=undefined;t.tones=undefined;t.localHold=false;t.earlySdp=undefined;t.rel100=h.C.supported.UNSUPPORTED;t.originalReceiveRequest=t.receiveRequest;return t}i.prototype.dtmf=function(e,r){var i=this;if(r===void 0){r={}}if(this.status!==d.SessionStatus.STATUS_CONFIRMED&&this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK){throw new l.Exceptions.InvalidStateError(this.status)}if(!e||!e.toString().match(/^[0-9A-D#*,]+$/i)){throw new TypeError("Invalid tones: "+e)}var n=function(){if(i.status===d.SessionStatus.STATUS_TERMINATED||!i.tones||i.tones.length===0){i.tones=undefined;return}var e=i.tones.shift();var t;if(e.tone===","){t=2e3}else{e.on("failed",function(){i.tones=undefined});e.send(r);t=e.duration+e.interToneGap}setTimeout(n,t)};e=e.toString();var t=this.ua.configuration.dtmfType;if(this.sessionDescriptionHandler&&t===h.C.dtmfType.RTP){var s=this.sessionDescriptionHandler.sendDtmf(e,r);if(!s){this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method");t=h.C.dtmfType.INFO}}if(t===h.C.dtmfType.INFO){var o=[];var a=e.split("");while(a.length>0){o.push(new v.DTMF(this,a.shift(),r))}if(this.tones){this.tones=this.tones.concat(o);return this}this.tones=o;n()}return this};i.prototype.bye=function(e){if(e===void 0){e={}}if(this.status===d.SessionStatus.STATUS_TERMINATED){this.logger.error("Error: Attempted to send BYE in a terminated session.");return this}this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||t>=700)){throw new TypeError("Invalid statusCode: "+t)}e.receiveResponse=function(){};return this.sendRequest(h.C.BYE,e).terminated()};i.prototype.refer=function(e,t){if(t===void 0){t={}}if(this.status!==d.SessionStatus.STATUS_CONFIRMED){throw new l.Exceptions.InvalidStateError(this.status)}this.referContext=new S(this.ua,this,e,t);this.emit("referRequested",this.referContext);this.referContext.refer(t);return this.referContext};i.prototype.sendRequest=function(e,t){var r=this;if(t===void 0){t={}}t=t||{};if(!this.dialog){throw new Error("sending request without a dialog")}var i=new o.OutgoingRequest(e,this.dialog.remoteTarget,this.ua,{cseq:t.cseq||(this.dialog.localSeqnum+=1),callId:this.dialog.id.callId,fromUri:this.dialog.localUri,fromTag:this.dialog.id.localTag,ToUri:this.dialog.remoteUri,toTag:this.dialog.id.remoteTag,routeSet:this.dialog.routeSet,statusCode:t.statusCode,reasonPhrase:t.reasonPhrase},t.extraHeaders||[],t.body);new s.RequestSender({request:i,onRequestTimeout:function(){return r.onRequestTimeout()},onTransportError:function(){return r.onTransportError()},receiveResponse:function(e){return(t.receiveResponse||r.receiveNonInviteResponse.bind(r))(e)}},this.ua).send();this.emit(e.toLowerCase(),i);return this};i.prototype.close=function(){if(this.status===d.SessionStatus.STATUS_TERMINATED){return this}this.logger.log("closing INVITE session "+this.id);if(this.sessionDescriptionHandler){this.sessionDescriptionHandler.close()}for(var e in this.timers){if(this.timers[e]){clearTimeout(this.timers[e])}}if(this.dialog){this.dialog.terminate();delete this.dialog}for(var t in this.earlyDialogs){if(this.earlyDialogs.hasOwnProperty(t)){this.earlyDialogs[t].terminate();delete this.earlyDialogs[t]}}this.status=d.SessionStatus.STATUS_TERMINATED;if(this.ua.transport){this.ua.transport.removeListener("transportError",this.errorListener)}delete this.ua.sessions[this.id];return this};i.prototype.createDialog=function(e,t,r){if(r===void 0){r=false}var i=e[t==="UAS"?"toTag":"fromTag"];var n=e[t==="UAS"?"fromTag":"toTag"];var s=e.callId+i+n;if(r){if(this.earlyDialogs[s]){return true}else{var o=new u.Dialog(this,e,t,u.Dialog.C.STATUS_EARLY);if(o.error){this.logger.error(o.error);this.failed(e,h.C.causes.INTERNAL_ERROR);return false}else{this.earlyDialogs[s]=o;return true}}}else{var o=this.earlyDialogs[s];if(o){o.update(e,t);this.dialog=o;delete this.earlyDialogs[s];for(var a in this.earlyDialogs){if(this.earlyDialogs.hasOwnProperty(a)){this.earlyDialogs[a].terminate();delete this.earlyDialogs[a]}}return true}var f=new u.Dialog(this,e,t);if(f.error){this.logger.error(f.error);this.failed(e,h.C.causes.INTERNAL_ERROR);return false}else{this.toTag=e.toTag;this.dialog=f;return true}}};i.prototype.hold=function(e,t){if(e===void 0){e={}}if(t===void 0){t=[]}if(this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==d.SessionStatus.STATUS_CONFIRMED){throw new l.Exceptions.InvalidStateError(this.status)}if(this.localHold){this.logger.log("Session is already on hold, cannot put it on hold again");return}e.modifiers=t;if(this.sessionDescriptionHandler){e.modifiers.push(this.sessionDescriptionHandler.holdModifier)}this.localHold=true;this.sendReinvite(e)};i.prototype.unhold=function(e,t){if(e===void 0){e={}}if(t===void 0){t=[]}if(this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==d.SessionStatus.STATUS_CONFIRMED){throw new l.Exceptions.InvalidStateError(this.status)}if(!this.localHold){this.logger.log("Session is not on hold, cannot unhold it");return}e.modifiers=t;this.localHold=false;this.sendReinvite(e)};i.prototype.reinvite=function(e,t){if(e===void 0){e={}}if(t===void 0){t=[]}e.modifiers=t;return this.sendReinvite(e)};i.prototype.receiveRequest=function(e){switch(e.method){case h.C.BYE:e.reply(200);if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.emit("bye",e);this.terminated(e,h.C.BYE)}break;case h.C.INVITE:if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.logger.log("re-INVITE received");this.receiveReinvite(e)}break;case h.C.INFO:if(this.status===d.SessionStatus.STATUS_CONFIRMED||this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo){return this.onInfo(e)}var t=e.getHeader("content-type");if(t){if(t.match(/^application\/dtmf-relay/i)){if(e.body){var r=e.body.split("\r\n",2);if(r.length===2){var i=void 0;var n=void 0;var s=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;if(s.test(r[0])){i=r[0].replace(s,"$2")}var o=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(o.test(r[1])){n=parseInt(r[1].replace(o,"$2"),10)}if(i&&n){new v.DTMF(this,i,{duration:n}).init_incoming(e)}}}}else{e.reply(415,undefined,["Accept: application/dtmf-relay"])}}}break;case h.C.REFER:if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.logger.log("REFER received");this.referContext=new A(this.ua,e);if(this.listeners("referRequested").length){this.emit("referRequested",this.referContext)}else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var a={followRefer:true};if(this.passedOptions){a.inviteOptions=this.passedOptions}this.referContext.accept(a,this.modifiers)}}break;case h.C.NOTIFY:if(this.referContext&&this.referContext.type===d.TypeStrings.ReferClientContext&&e.hasHeader("event")&&/^refer(;.*)?$/.test(e.getHeader("event"))){this.referContext.receiveNotify(e);return}e.reply(200,"OK");this.emit("notify",e);break}};i.prototype.terminate=function(e){return this};i.prototype.onTransportError=function(){if(this.status!==d.SessionStatus.STATUS_CONFIRMED&&this.status!==d.SessionStatus.STATUS_TERMINATED){this.failed(undefined,h.C.causes.CONNECTION_ERROR)}};i.prototype.onRequestTimeout=function(){if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.terminated(undefined,h.C.causes.REQUEST_TIMEOUT)}else if(this.status!==d.SessionStatus.STATUS_TERMINATED){this.failed(undefined,h.C.causes.REQUEST_TIMEOUT);this.terminated(undefined,h.C.causes.REQUEST_TIMEOUT)}};i.prototype.onDialogError=function(e){if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.terminated(e,h.C.causes.DIALOG_ERROR)}else if(this.status!==d.SessionStatus.STATUS_TERMINATED){this.failed(e,h.C.causes.DIALOG_ERROR);this.terminated(e,h.C.causes.DIALOG_ERROR)}};i.prototype.on=function(e,t){return r.prototype.on.call(this,e,t)};i.prototype.receiveReinvite=function(r){var i=this;this.emit("reinvite",this,r);if(r.hasHeader("P-Asserted-Identity")){this.assertedIdentity=p.Grammar.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity"))}var e;if(!this.sessionDescriptionHandler){this.logger.warn("No SessionDescriptionHandler to reinvite");return}if(r.getHeader("Content-Length")==="0"&&!r.getHeader("Content-Type")){e=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers)}else if(this.sessionDescriptionHandler.hasDescription(r.getHeader("Content-Type")||"")){e=this.sessionDescriptionHandler.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else{r.reply(415);this.emit("reinviteFailed",this);return}this.receiveRequest=function(e){if(e.method===h.C.ACK&&i.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){if(i.sessionDescriptionHandler&&i.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){i.hasAnswer=true;i.sessionDescriptionHandler.setDescription(e.body,i.sessionDescriptionHandlerOptions,i.modifiers).then(function(){clearTimeout(i.timers.ackTimer);clearTimeout(i.timers.invite2xxTimer);i.status=d.SessionStatus.STATUS_CONFIRMED;i.emit("confirmed",e)})}else{clearTimeout(i.timers.ackTimer);clearTimeout(i.timers.invite2xxTimer);i.status=d.SessionStatus.STATUS_CONFIRMED;i.emit("confirmed",e)}}else{i.originalReceiveRequest(e)}};e.catch(function(e){var t;if(e.type===d.TypeStrings.SessionDescriptionHandlerError){t=500}else if(e.type===d.TypeStrings.RenegotiationError){i.emit("renegotiationError",e);i.logger.warn(e.toString());t=488}else{i.logger.error(e);t=488}r.reply(t);i.emit("reinviteFailed",i);throw e}).then(function(e){var t=["Contact: "+i.contact];r.reply(200,undefined,t,e);i.status=d.SessionStatus.STATUS_WAITING_FOR_ACK;i.setACKTimer();i.emit("reinviteAccepted",i)})};i.prototype.sendReinvite=function(e){var t=this;if(e===void 0){e={}}if(this.pendingReinvite){this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");return}if(!this.sessionDescriptionHandler){this.logger.warn("No SessionDescriptionHandler, can't reinvite..");return}this.pendingReinvite=true;e.modifiers=e.modifiers||[];var r=(e.extraHeaders||[]).slice();r.push("Contact: "+this.contact);r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){t.sendRequest(h.C.INVITE,{extraHeaders:r,body:e,receiveResponse:function(e){return t.receiveReinviteResponse(e)}})}).catch(function(e){if(e.type===d.TypeStrings.RenegotiationError){t.pendingReinvite=false;t.emit("renegotiationError",e);t.logger.warn("Renegotiation Error");t.logger.warn(e.toString());throw e}t.logger.error("sessionDescriptionHandler error");t.logger.error(e);throw e})};i.prototype.receiveReinviteResponse=function(e){var t=this;if(this.status===d.SessionStatus.STATUS_TERMINATED){this.logger.error("Received reinvite response, but in STATUS_TERMINATED");return}if(!this.pendingReinvite){this.logger.error("Received reinvite response, but have no pending reinvite");return}var r=e&&e.statusCode?e.statusCode.toString():"";switch(true){case/^1[0-9]{2}$/.test(r):break;case/^2[0-9]{2}$/.test(r):this.status=d.SessionStatus.STATUS_CONFIRMED;this.emit("ack",e.ack());this.pendingReinvite=false;clearTimeout(this.timers.invite2xxTimer);if(!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.logger.error("2XX response received to re-invite but did not have a description");this.emit("reinviteFailed",this);this.emit("renegotiationError",new l.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(e){t.logger.error("Could not set the description in 2XX response");t.logger.error(e);t.emit("reinviteFailed",t);t.emit("renegotiationError",e);t.sendRequest(h.C.BYE,{extraHeaders:["Reason: "+y.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]});t.terminated(undefined,h.C.causes.INCOMPATIBLE_SDP);throw e}).then(function(){t.emit("reinviteAccepted",t)});break;default:this.pendingReinvite=false;this.logger.log("Received a non 1XX or 2XX response to a re-invite");this.emit("reinviteFailed",this);this.emit("renegotiationError",new l.Exceptions.RenegotiationError("Invalid response to a re-invite"))}};i.prototype.acceptAndTerminate=function(e,t,r){var i=[];if(t){i.push("Reason: "+y.Utils.getReasonHeaderValue(t,r))}if(this.dialog||this.createDialog(e,"UAC")){this.emit("ack",e.ack());this.sendRequest(h.C.BYE,{extraHeaders:i})}return this};i.prototype.setInvite2xxTimer=function(t,r){var i=this;var n=g.Timers.T1;var s=function(){if(i.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK){return}i.logger.log("no ACK received, attempting to retransmit OK");var e=["Contact: "+i.contact];t.reply(200,undefined,e,r);n=Math.min(n*2,g.Timers.T2);i.timers.invite2xxTimer=setTimeout(s,n)};this.timers.invite2xxTimer=setTimeout(s,n)};i.prototype.setACKTimer=function(){var e=this;this.timers.ackTimer=setTimeout(function(){if(e.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){e.logger.log("no ACK received for an extended period of time, terminating the call");clearTimeout(e.timers.invite2xxTimer);e.sendRequest(h.C.BYE);e.terminated(undefined,h.C.causes.NO_ACK)}},g.Timers.TIMER_H)};i.prototype.failed=function(e,t){if(this.status===d.SessionStatus.STATUS_TERMINATED){return this}this.emit("failed",e,t);return this};i.prototype.rejected=function(e,t){this.emit("rejected",e,t);return this};i.prototype.canceled=function(){if(this.sessionDescriptionHandler){this.sessionDescriptionHandler.close()}this.emit("cancel");return this};i.prototype.accepted=function(e,t){if(!(e instanceof String)){t=y.Utils.getReasonPhrase(e&&e.statusCode||0,t)}this.startTime=new Date;if(this.replacee){this.replacee.emit("replaced",this);this.replacee.terminate()}this.emit("accepted",e,t);return this};i.prototype.terminated=function(e,t){if(this.status===d.SessionStatus.STATUS_TERMINATED){return this}this.endTime=new Date;this.close();this.emit("terminated",e,t);return this};i.prototype.connecting=function(e){this.emit("connecting",{request:e});return this};i.prototype.receiveNonInviteResponse=function(e){};i.C=d.SessionStatus;return i}(i.EventEmitter);t.Session=T;var a=function(a){n(e,a);function e(e,r){var i=this;if(!e.configuration.sessionDescriptionHandlerFactory){e.logger.warn("Can't build ISC without SDH Factory");throw new Error("ISC Constructor Failed")}i=a.call(this,e.configuration.sessionDescriptionHandlerFactory)||this;f.ServerContext.initializer(i,e,r);i.type=d.TypeStrings.InviteServerContext;var t=r.parseHeader("Content-Disposition");if(t&&t.type==="render"){i.renderbody=r.body;i.rendertype=r.getHeader("Content-Type")}i.status=d.SessionStatus.STATUS_INVITE_RECEIVED;i.fromTag=r.fromTag;i.id=r.callId+i.fromTag;i.request=r;i.contact=i.ua.contact.toString();i.receiveNonInviteResponse=function(){};i.logger=e.getLogger("sip.inviteservercontext",i.id);i.ua.sessions[i.id]=i;var n=function(e,t){if(r.hasHeader(e)&&r.getHeader(e).toLowerCase().indexOf("100rel")>=0){i.rel100=t}};n("require",h.C.supported.REQUIRED);n("supported",h.C.supported.SUPPORTED);r.toTag=y.Utils.newTag();if(!i.createDialog(r,"UAS",true)){r.reply(500,"Missing Contact header field");return}var s={extraHeaders:["Contact: "+i.contact]};if(i.rel100!==h.C.supported.REQUIRED){i.progress(s)}i.status=d.SessionStatus.STATUS_WAITING_FOR_ANSWER;i.timers.userNoAnswerTimer=setTimeout(function(){r.reply(408);i.failed(r,h.C.causes.NO_ANSWER);i.terminated(r,h.C.causes.NO_ANSWER)},i.ua.configuration.noAnswerTimeout||60);if(r.hasHeader("expires")){var o=Number(r.getHeader("expires")||0)*1e3;i.timers.expiresTimer=setTimeout(function(){if(i.status===d.SessionStatus.STATUS_WAITING_FOR_ANSWER){r.reply(487);i.failed(r,h.C.causes.EXPIRES);i.terminated(r,h.C.causes.EXPIRES)}},o)}i.errorListener=i.onTransportError.bind(i);if(e.transport){e.transport.on("transportError",i.errorListener)}return i}e.prototype.reject=function(e){var t=this;if(e===void 0){e={}}if(this.status===d.SessionStatus.STATUS_TERMINATED){throw new l.Exceptions.InvalidStateError(this.status)}this.logger.log("rejecting RTCSession");var r=e.statusCode||480;var i=y.Utils.getReasonPhrase(r,e.reasonPhrase);var n=e.extraHeaders||[];if(r<300||r>699){throw new TypeError("Invalid statusCode: "+r)}var s=this.request.reply(r,i,n,e.body);["rejected","failed"].forEach(function(e){t.emit(e,s,i)});return this.terminated()};e.prototype.reply=function(e){if(e===void 0){e={}}return this};e.prototype.terminate=function(e){var t=this;if(e===void 0){e={}}var r=(e.extraHeaders||[]).slice();if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK&&this.request.transaction&&this.request.transaction.state!==m.TransactionState.Terminated){var i=this.dialog;this.receiveRequest=function(e){if(e.method===h.C.ACK){t.sendRequest(h.C.BYE,{extraHeaders:r});if(t.dialog){t.dialog.terminate()}}};this.request.transaction.on("stateChanged",function(){if(t.request.transaction&&t.request.transaction.state===m.TransactionState.Terminated&&t.dialog){t.bye();t.dialog.terminate()}});this.emit("bye",this.request);this.terminated();this.dialog=i;if(this.dialog){this.ua.dialogs[this.dialog.id.toString()]=this.dialog}}else if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.bye(e)}else{this.reject(e)}return this};e.prototype.progress=function(s){var o=this;if(s===void 0){s={}}var t=s.statusCode||180;var a=(s.extraHeaders||[]).slice();if(t<100||t>199){throw new TypeError("Invalid statusCode: "+t)}if(this.status===d.SessionStatus.STATUS_TERMINATED){return this}var e=function(){var n=s.statusCode||183;o.status=d.SessionStatus.STATUS_WAITING_FOR_PRACK;a.push("Contact: "+o.contact);a.push("Require: 100rel");a.push("RSeq: "+Math.floor(Math.random()*1e4));if(!o.sessionDescriptionHandler){o.logger.warn("No SessionDescriptionHandler, can't do 100rel");return}o.sessionDescriptionHandler.getDescription(s.sessionDescriptionHandlerOptions,s.modifiers).then(function(e){if(o.status===d.SessionStatus.STATUS_TERMINATED){return}o.earlySdp=e.body;o[o.hasOffer?"hasAnswer":"hasOffer"]=true;var t=g.Timers.T1;var r=function(){o.request.reply(n,undefined,a,e);t*=2;o.timers.rel1xxTimer=setTimeout(r,t)};o.timers.rel1xxTimer=setTimeout(r,t);o.timers.prackTimer=setTimeout(function(){if(o.status!==d.SessionStatus.STATUS_WAITING_FOR_PRACK){return}o.logger.log("no PRACK received, rejecting the call");clearTimeout(o.timers.rel1xxTimer);o.request.reply(504);o.terminated(undefined,h.C.causes.NO_PRACK)},g.Timers.T1*64);var i=o.request.reply(n,s.reasonPhrase,a,e);o.emit("progress",i,s.reasonPhrase)},function(){o.request.reply(480);o.failed(undefined,h.C.causes.WEBRTC_ERROR);o.terminated(undefined,h.C.causes.WEBRTC_ERROR)})};var r=function(){var e=o.request.reply(t,s.reasonPhrase,a,s.body);o.emit("progress",e,s.reasonPhrase)};if(s.statusCode!==100&&(this.rel100===h.C.supported.REQUIRED||this.rel100===h.C.supported.SUPPORTED&&s.rel100||this.rel100===h.C.supported.SUPPORTED&&this.ua.configuration.rel100===h.C.supported.REQUIRED)){this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler);if(this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||"")){this.hasOffer=true;this.sessionDescriptionHandler.setDescription(this.request.body,s.sessionDescriptionHandlerOptions,s.modifiers).then(e).catch(function(e){o.logger.warn("invalid description");o.logger.warn(e);o.failed(undefined,h.C.causes.WEBRTC_ERROR);o.terminated(undefined,h.C.causes.WEBRTC_ERROR);throw e})}else{e()}}else{r()}return this};e.prototype.accept=function(e){var r=this;if(e===void 0){e={}}this.onInfo=e.onInfo;var i=(e.extraHeaders||[]).slice();var t=function(e){i.push("Contact: "+r.contact);i.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());if(!r.hasOffer){r.hasOffer=true}else{r.hasAnswer=true}var t=r.request.reply(200,undefined,i,e);r.status=d.SessionStatus.STATUS_WAITING_FOR_ACK;r.setInvite2xxTimer(r.request,e);r.setACKTimer();r.accepted(t,y.Utils.getReasonPhrase(200))};var n=function(e){if(e.type===d.TypeStrings.SessionDescriptionHandlerError){r.logger.log(e.message);if(e.error){r.logger.log(e.error)}}r.request.reply(480);r.failed(undefined,h.C.causes.WEBRTC_ERROR);r.terminated(undefined,h.C.causes.WEBRTC_ERROR);throw e};if(this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK){this.status=d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK;return this}else if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ANSWER){this.status=d.SessionStatus.STATUS_ANSWERED}else if(this.status!==d.SessionStatus.STATUS_EARLY_MEDIA){throw new l.Exceptions.InvalidStateError(this.status)}if(!this.createDialog(this.request,"UAS")){this.request.reply(500,"Missing Contact header field");return this}clearTimeout(this.timers.userNoAnswerTimer);if(this.status===d.SessionStatus.STATUS_EARLY_MEDIA){t({})}else{this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler);if(this.request.getHeader("Content-Length")==="0"&&!this.request.getHeader("Content-Type")){this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).catch(n).then(t)}else if(this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||"")){this.hasOffer=true;this.sessionDescriptionHandler.setDescription(this.request.body,e.sessionDescriptionHandlerOptions,e.modifiers).then(function(){if(!r.sessionDescriptionHandler){throw new Error("No SDH")}return r.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers)}).catch(n).then(t)}else{this.request.reply(415);return this}}return this};e.prototype.receiveRequest=function(t){var r=this;var e=function(){clearTimeout(r.timers.ackTimer);clearTimeout(r.timers.invite2xxTimer);r.status=d.SessionStatus.STATUS_CONFIRMED;var e=t.getHeader("Content-Disposition");if(e&&e.type==="render"){r.renderbody=t.body;r.rendertype=t.getHeader("Content-Type")}r.emit("confirmed",t)};switch(t.method){case h.C.CANCEL:if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ANSWER||this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK||this.status===d.SessionStatus.STATUS_EARLY_MEDIA||this.status===d.SessionStatus.STATUS_ANSWERED){this.status=d.SessionStatus.STATUS_CANCELED;this.request.reply(487);this.canceled();this.rejected(t,h.C.causes.CANCELED);this.failed(t,h.C.causes.CANCELED);this.terminated(t,h.C.causes.CANCELED)}break;case h.C.ACK:if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){this.status=d.SessionStatus.STATUS_CONFIRMED;if(this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")||"")){this.hasAnswer=true;this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(e){r.logger.warn(e);r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});r.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION);r.terminated(t,h.C.causes.BAD_MEDIA_DESCRIPTION);throw e}).then(function(){return e()})}else{e()}}break;case h.C.PRACK:if(this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK){if(!this.hasAnswer){this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler);if(this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")||"")){this.hasAnswer=true;this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){clearTimeout(r.timers.rel1xxTimer);clearTimeout(r.timers.prackTimer);t.reply(200);if(r.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK){r.status=d.SessionStatus.STATUS_EARLY_MEDIA;r.accept()}r.status=d.SessionStatus.STATUS_EARLY_MEDIA},function(e){r.logger.warn(e);r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});r.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION);r.terminated(t,h.C.causes.BAD_MEDIA_DESCRIPTION)})}else{this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"});this.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION);this.terminated(t,h.C.causes.BAD_MEDIA_DESCRIPTION)}}else{clearTimeout(this.timers.rel1xxTimer);clearTimeout(this.timers.prackTimer);t.reply(200);if(this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK){this.status=d.SessionStatus.STATUS_EARLY_MEDIA;this.accept()}this.status=d.SessionStatus.STATUS_EARLY_MEDIA}}else if(this.status===d.SessionStatus.STATUS_EARLY_MEDIA){t.reply(200)}break;default:T.prototype.receiveRequest.apply(this,[t]);break}};e.prototype.setupSessionDescriptionHandler=function(){if(this.sessionDescriptionHandler){return this.sessionDescriptionHandler}return this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)};return e}(T);t.InviteServerContext=a;var C=function(u){n(e,u);function e(e,t,r,i){if(r===void 0){r={}}if(i===void 0){i=[]}var n=this;if(!e.configuration.sessionDescriptionHandlerFactory){e.logger.warn("Can't build ISC without SDH Factory");throw new Error("ICC Constructor Failed")}r.params=r.params||{};var s=r.anonymous||false;var o=y.Utils.newTag();r.params.fromTag=o;var a=e.contact.toString({anonymous:s,outbound:s?!e.contact.tempGruu:!e.contact.pubGruu});var f=(r.extraHeaders||[]).slice();if(s&&e.configuration.uri){r.params.from_displayName="Anonymous";r.params.from_uri="sip:anonymous@anonymous.invalid";f.push("P-Preferred-Identity: "+e.configuration.uri.toString());f.push("Privacy: id")}f.push("Contact: "+a);f.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());if(e.configuration.rel100===h.C.supported.REQUIRED){f.push("Require: 100rel")}if(e.configuration.replaces===h.C.supported.REQUIRED){f.push("Require: replaces")}r.extraHeaders=f;n=u.call(this,e.configuration.sessionDescriptionHandlerFactory)||this;c.ClientContext.initializer(n,e,h.C.INVITE,t,r);n.type=d.TypeStrings.InviteClientContext;n.passedOptions=r;n.sessionDescriptionHandlerOptions=r.sessionDescriptionHandlerOptions||{};n.modifiers=i;n.inviteWithoutSdp=r.inviteWithoutSdp||false;n.anonymous=r.anonymous||false;n.renderbody=r.renderbody||undefined;n.rendertype=r.rendertype||"text/plain";n.fromTag=o;n.contact=a;if(n.status!==d.SessionStatus.STATUS_NULL){throw new l.Exceptions.InvalidStateError(n.status)}n.isCanceled=false;n.received100=false;n.method=h.C.INVITE;n.logger=e.getLogger("sip.inviteclientcontext");e.applicants[n.toString()]=n;n.id=n.request.callId+n.fromTag;n.onInfo=r.onInfo;n.errorListener=n.onTransportError.bind(n);if(e.transport){e.transport.on("transportError",n.errorListener)}return n}e.prototype.receiveNonInviteResponse=function(e){this.receiveInviteResponse(e)};e.prototype.receiveResponse=function(e){this.receiveInviteResponse(e)};e.prototype.send=function(){var e=new s.RequestSender(this,this.ua);e.send();return this};e.prototype.invite=function(){var t=this;this.ua.sessions[this.id]=this;Promise.resolve().then(function(){if(t.inviteWithoutSdp){t.request.body=t.renderbody;t.status=d.SessionStatus.STATUS_INVITE_SENT;t.send()}else{t.sessionDescriptionHandler=t.sessionDescriptionHandlerFactory(t,t.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});t.emit("SessionDescriptionHandler-created",t.sessionDescriptionHandler);t.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers).then(function(e){if(t.isCanceled||t.status===d.SessionStatus.STATUS_TERMINATED){return}t.hasOffer=true;t.request.body=e;t.status=d.SessionStatus.STATUS_INVITE_SENT;t.send()},function(e){if(e.type===d.TypeStrings.SessionDescriptionHandlerError){t.logger.log(e.message);if(e.error){t.logger.log(e.error)}}if(t.status===d.SessionStatus.STATUS_TERMINATED){return}t.failed(undefined,h.C.causes.WEBRTC_ERROR);t.terminated(undefined,h.C.causes.WEBRTC_ERROR)})}});return this};e.prototype.receiveInviteResponse=function(t){var r=this;if(this.status===d.SessionStatus.STATUS_TERMINATED||t.method!==h.C.INVITE){return}var e=t.callId+t.fromTag+t.toTag;var i=[];if(this.dialog&&(t.statusCode&&t.statusCode>=200&&t.statusCode<=299)){if(e!==this.dialog.id.toString()){if(!this.createDialog(t,"UAC",true)){return}this.emit("ack",t.ack({body:y.Utils.generateFakeSDP(t.body)}));this.earlyDialogs[e].sendRequest(this,h.C.BYE);if(this.status!==d.SessionStatus.STATUS_CONFIRMED){this.failed(t,h.C.causes.WEBRTC_ERROR);this.terminated(t,h.C.causes.WEBRTC_ERROR)}return}else if(this.status===d.SessionStatus.STATUS_CONFIRMED){this.emit("ack",t.ack(t));return}else if(!this.hasAnswer){return}}var n=t&&t.statusCode;if(this.dialog&&n&&n<200){var s=t.getHeader("rseq");if(s&&(this.dialog.pracked.indexOf(s)!==-1||Number(this.dialog.pracked[this.dialog.pracked.length-1])>=Number(s)&&this.dialog.pracked.length>0)){return}if(!this.earlyDialogs[e]&&!this.createDialog(t,"UAC",true)){return}if(this.earlyDialogs[e].pracked.indexOf(t.getHeader("rseq"))!==-1||this.earlyDialogs[e].pracked[this.earlyDialogs[e].pracked.length-1]>=Number(s)&&this.earlyDialogs[e].pracked.length>0){return}i.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq"));this.earlyDialogs[e].pracked.push(t.getHeader("rseq"));this.earlyDialogs[e].sendRequest(this,h.C.PRACK,{extraHeaders:i,body:y.Utils.generateFakeSDP(t.body)});return}if(this.isCanceled){if(n&&n>=100&&n<200){this.request.cancel(this.cancelReason,i);this.canceled()}else if(n&&n>=200&&n<299){this.acceptAndTerminate(t);this.emit("bye",this.request)}else if(n&&n>=300){var o=h.C.REASON_PHRASE[t.statusCode||0]||h.C.causes.CANCELED;this.rejected(t,o);this.failed(t,o);this.terminated(t,o)}return}var a=n?n.toString():"";switch(true){case/^100$/.test(a):this.received100=true;this.emit("progress",t);break;case/^1[0-9]{2}$/.test(a):if(!t.toTag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")){if(!this.createDialog(t,"UAC",true)){break}}this.status=d.SessionStatus.STATUS_1XX_RECEIVED;if(t.hasHeader("P-Asserted-Identity")){this.assertedIdentity=p.Grammar.nameAddrHeaderParse(t.getHeader("P-Asserted-Identity"))}if(t.hasHeader("require")&&t.getHeader("require").indexOf("100rel")!==-1){if(this.dialog||!this.earlyDialogs[e]){break}var f=t.getHeader("rseq");if(this.earlyDialogs[e].pracked.indexOf(f)!==-1||this.earlyDialogs[e].pracked[this.earlyDialogs[e].pracked.length-1]>=Number(f)&&this.earlyDialogs[e].pracked.length>0){return}this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler);if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")||"")){i.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq"));this.earlyDialogs[e].pracked.push(t.getHeader("rseq"));this.earlyDialogs[e].sendRequest(this,h.C.PRACK,{extraHeaders:i});this.emit("progress",t)}else if(this.hasOffer){if(!this.createDialog(t,"UAC")){break}this.hasAnswer=true;if(this.dialog!==undefined&&f){this.dialog.pracked.push(f)}this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){i.push("RAck: "+t.getHeader("rseq")+" "+t.getHeader("cseq"));r.sendRequest(h.C.PRACK,{extraHeaders:i,receiveResponse:function(){}});r.status=d.SessionStatus.STATUS_EARLY_MEDIA;r.emit("progress",t)},function(e){r.logger.warn(e);r.acceptAndTerminate(t,488,"Not Acceptable Here");r.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var u=this.earlyDialogs[e];u.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});this.emit("SessionDescriptionHandler-created",u.sessionDescriptionHandler);if(f){u.pracked.push(f)}if(u.sessionDescriptionHandler){u.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return u.sessionDescriptionHandler.getDescription(r.sessionDescriptionHandlerOptions,r.modifiers)}).then(function(e){i.push("RAck: "+f+" "+t.getHeader("cseq"));u.sendRequest(r,h.C.PRACK,{extraHeaders:i,body:e});r.status=d.SessionStatus.STATUS_EARLY_MEDIA;r.emit("progress",t)}).catch(function(e){if(f&&e.type===d.TypeStrings.SessionDescriptionHandlerError){u.pracked.push(f);if(r.status===d.SessionStatus.STATUS_TERMINATED){return}r.failed(undefined,h.C.causes.WEBRTC_ERROR);r.terminated(undefined,h.C.causes.WEBRTC_ERROR)}else{if(f){u.pracked.splice(u.pracked.indexOf(f),1)}r.logger.warn("invalid description");r.logger.warn(e)}})}}}else{this.emit("progress",t)}break;case/^2[0-9]{2}$/.test(a):var c=this.request.cseq+" "+this.request.method;if(c!==t.getHeader("cseq")){break}if(t.hasHeader("P-Asserted-Identity")){this.assertedIdentity=p.Grammar.nameAddrHeaderParse(t.getHeader("P-Asserted-Identity"))}if(this.status===d.SessionStatus.STATUS_EARLY_MEDIA&&this.dialog){this.status=d.SessionStatus.STATUS_CONFIRMED;var l={};if(this.renderbody){i.push("Content-Type: "+this.rendertype);l.extraHeaders=i;l.body=this.renderbody}this.emit("ack",t.ack(l));this.accepted(t);break}if(this.dialog){break}if(!this.hasOffer){if(this.earlyDialogs[e]&&this.earlyDialogs[e].sessionDescriptionHandler){this.hasOffer=true;this.hasAnswer=true;this.sessionDescriptionHandler=this.earlyDialogs[e].sessionDescriptionHandler;if(!this.createDialog(t,"UAC")){break}this.status=d.SessionStatus.STATUS_CONFIRMED;this.emit("ack",t.ack());this.accepted(t)}else{this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler);if(!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")||"")){this.acceptAndTerminate(t,400,"Missing session description");this.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC")){break}this.hasOffer=true;this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return r.sessionDescriptionHandler.getDescription(r.sessionDescriptionHandlerOptions,r.modifiers)}).then(function(e){if(r.isCanceled||r.status===d.SessionStatus.STATUS_TERMINATED){return}r.status=d.SessionStatus.STATUS_CONFIRMED;r.hasAnswer=true;r.emit("ack",t.ack({body:e}));r.accepted(t)}).catch(function(e){if(e.type===d.TypeStrings.SessionDescriptionHandlerError){r.logger.warn("invalid description");r.logger.warn(e.toString());r.acceptAndTerminate(t,488,"Invalid session description");r.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION)}else{throw e}})}}else if(this.hasAnswer){var l={};if(this.renderbody){i.push("Content-Type: "+this.rendertype);l.extraHeaders=i;l.body=this.renderbody}this.emit("ack",t.ack(l))}else{if(!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(t.getHeader("Content-Type")||"")){this.acceptAndTerminate(t,400,"Missing session description");this.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC")){break}this.hasAnswer=true;this.sessionDescriptionHandler.setDescription(t.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){var e={};r.status=d.SessionStatus.STATUS_CONFIRMED;if(r.renderbody){i.push("Content-Type: "+r.rendertype);e.extraHeaders=i;e.body=r.renderbody}r.emit("ack",t.ack(e));r.accepted(t)},function(e){r.logger.warn(e);r.acceptAndTerminate(t,488,"Not Acceptable Here");r.failed(t,h.C.causes.BAD_MEDIA_DESCRIPTION)})}break;default:var o=y.Utils.sipErrorCause(n||0);this.rejected(t,o);this.failed(t,o);this.terminated(t,o)}};e.prototype.cancel=function(e){if(e===void 0){e={}}e.extraHeaders=(e.extraHeaders||[]).slice();if(this.isCanceled){throw new l.Exceptions.InvalidStateError(d.SessionStatus.STATUS_CANCELED)}if(this.status===d.SessionStatus.STATUS_TERMINATED||this.status===d.SessionStatus.STATUS_CONFIRMED){throw new l.Exceptions.InvalidStateError(this.status)}this.logger.log("canceling RTCSession");this.isCanceled=true;var t=y.Utils.getCancelReason(e.statusCode,e.reasonPhrase);if(this.status===d.SessionStatus.STATUS_NULL||this.status===d.SessionStatus.STATUS_INVITE_SENT&&!this.received100){this.cancelReason=t}else if(this.status===d.SessionStatus.STATUS_INVITE_SENT||this.status===d.SessionStatus.STATUS_1XX_RECEIVED||this.status===d.SessionStatus.STATUS_EARLY_MEDIA){this.request.cancel(t,e.extraHeaders)}return this.canceled()};e.prototype.terminate=function(e){if(this.status===d.SessionStatus.STATUS_TERMINATED){return this}if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===d.SessionStatus.STATUS_CONFIRMED){this.bye(e)}else{this.cancel(e)}return this};e.prototype.receiveRequest=function(e){if(e.method===h.C.CANCEL){}if(e.method===h.C.ACK&&this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){clearTimeout(this.timers.ackTimer);clearTimeout(this.timers.invite2xxTimer);this.status=d.SessionStatus.STATUS_CONFIRMED;this.accepted()}return u.prototype.receiveRequest.call(this,e)};return e}(T);t.InviteClientContext=C;var S=function(f){n(e,f);function e(e,t,r,i){if(i===void 0){i={}}var n=this;if(e===undefined||t===undefined||r===undefined){throw new TypeError("Not enough arguments")}n=f.call(this,e,h.C.REFER,t.remoteIdentity.uri.toString(),i)||this;n.type=d.TypeStrings.ReferClientContext;n.options=i;n.extraHeaders=(n.options.extraHeaders||[]).slice();n.applicant=t;if(!(typeof r==="string")&&(r.type===d.TypeStrings.InviteServerContext||r.type===d.TypeStrings.InviteClientContext)){var s=r.dialog;if(s){n.target='"'+r.remoteIdentity.friendlyName+'" '+"<"+s.remoteTarget.toString()+"?Replaces="+encodeURIComponent(s.id.callId+";to-tag="+s.id.remoteTag+";from-tag="+s.id.localTag)+">"}else{throw new TypeError("Invalid target due to no dialog: "+r)}}else{var o=p.Grammar.parse(r,"Refer_To");n.target=o&&o.uri?o.uri:r;var a=n.ua.normalizeTarget(n.target);if(!a){throw new TypeError("Invalid target: "+r)}n.target=a}if(n.ua){n.extraHeaders.push("Referred-By: <"+n.ua.configuration.uri+">")}n.extraHeaders.push("Contact: "+t.contact);n.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());n.extraHeaders.push("Refer-To: "+n.target);n.errorListener=n.onTransportError.bind(n);if(e.transport){e.transport.on("transportError",n.errorListener)}return n}e.prototype.refer=function(r){var i=this;if(r===void 0){r={}}var e=(this.extraHeaders||[]).slice();if(r.extraHeaders){e.concat(r.extraHeaders)}this.applicant.sendRequest(h.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(e){var t=e&&e.statusCode?e.statusCode.toString():"";if(/^1[0-9]{2}$/.test(t)){i.emit("referRequestProgress",i)}else if(/^2[0-9]{2}$/.test(t)){i.emit("referRequestAccepted",i)}else if(/^[4-6][0-9]{2}$/.test(t)){i.emit("referRequestRejected",i)}if(r.receiveResponse){r.receiveResponse(e)}}});return this};e.prototype.receiveNotify=function(e){var t=e.hasHeader("Content-Type")?e.getHeader("Content-Type"):undefined;if(t&&t.search(/^message\/sipfrag/)!==-1){var r=p.Grammar.parse(e.body,"sipfrag");if(r===-1){e.reply(489,"Bad Event");return}switch(true){case/^1[0-9]{2}$/.test(r.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(r.status_code):this.emit("referAccepted",this);if(!this.options.activeAfterTransfer&&this.applicant.terminate){this.applicant.terminate()}break;default:this.emit("referRejected",this);break}e.reply(200);this.emit("notify",e);return}e.reply(489,"Bad Event")};return e}(c.ClientContext);t.ReferClientContext=S;var A=function(i){n(e,i);function e(e,t){var r=i.call(this,e,t)||this;r.type=d.TypeStrings.ReferServerContext;r.ua=e;r.status=d.SessionStatus.STATUS_INVITE_RECEIVED;r.fromTag=t.fromTag;r.id=t.callId+r.fromTag;r.request=t;r.contact=r.ua.contact.toString();r.logger=e.getLogger("sip.referservercontext",r.id);r.cseq=Math.floor(Math.random()*1e4);r.callId=r.request.callId;r.fromUri=r.request.to.uri;r.fromTag=r.request.to.parameters.tag;r.remoteTarget=r.request.headers.Contact[0].parsed.uri;r.toUri=r.request.from.uri;r.toTag=r.request.fromTag;r.routeSet=r.request.getHeaders("record-route");if(!r.request.hasHeader("refer-to")){r.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer.");r.reject();return r}r.referTo=r.request.parseHeader("refer-to");r.referredSession=r.ua.findSession(t);if(r.request.hasHeader("referred-by")){r.referredBy=r.request.getHeader("referred-by")}if(r.referTo.uri.hasHeader("replaces")){r.replaces=r.referTo.uri.getHeader("replaces")}r.errorListener=r.onTransportError.bind(r);if(e.transport){e.transport.on("transportError",r.errorListener)}r.status=d.SessionStatus.STATUS_WAITING_FOR_ANSWER;return r}e.prototype.receiveNonInviteResponse=function(e){};e.prototype.progress=function(){if(this.status!==d.SessionStatus.STATUS_WAITING_FOR_ANSWER){throw new l.Exceptions.InvalidStateError(this.status)}this.request.reply(100)};e.prototype.reject=function(e){if(e===void 0){e={}}if(this.status===d.SessionStatus.STATUS_TERMINATED){throw new l.Exceptions.InvalidStateError(this.status)}this.logger.log("Rejecting refer");this.status=d.SessionStatus.STATUS_TERMINATED;i.prototype.reject.call(this,e);this.emit("referRequestRejected",this)};e.prototype.accept=function(e,t){var i=this;if(e===void 0){e={}}if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ANSWER){this.status=d.SessionStatus.STATUS_ANSWERED}else{throw new l.Exceptions.InvalidStateError(this.status)}this.request.reply(202,"Accepted");this.emit("referRequestAccepted",this);if(e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var r=this.referTo.uri;if(!r.scheme||!r.scheme.match("^sips?$")){this.logger.error("SIP.js can only automatically follow SIP refer target");this.reject();return}var n=e.inviteOptions||{};var s=(n.extraHeaders||[]).slice();if(this.replaces){s.push("Replaces: "+decodeURIComponent(this.replaces))}if(this.referredBy){s.push("Referred-By: "+this.referredBy)}n.extraHeaders=s;r.clearHeaders();this.targetSession=this.ua.invite(r.toString(),n,t);this.emit("referInviteSent",this);if(this.targetSession){this.targetSession.once("progress",function(e){var t=e.statusCode||100;var r=e.reasonPhrase;i.sendNotify(("SIP/2.0 "+t+" "+r).trim());i.emit("referProgress",i);if(i.referredSession){i.referredSession.emit("referProgress",i)}});this.targetSession.once("accepted",function(){i.logger.log("Successfully followed the refer");i.sendNotify("SIP/2.0 200 OK");i.emit("referAccepted",i);if(i.referredSession){i.referredSession.emit("referAccepted",i)}});var o=function(e){if(i.status===d.SessionStatus.STATUS_TERMINATED){return}i.logger.log("Refer was not successful. Resuming session");if(e&&e.statusCode===429){i.logger.log("Alerting referrer that identity is required.");i.sendNotify("SIP/2.0 429 Provide Referrer Identity");return}i.sendNotify("SIP/2.0 603 Declined");i.status=d.SessionStatus.STATUS_TERMINATED;i.emit("referRejected",i);if(i.referredSession){i.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o);this.targetSession.once("failed",o)}}else{this.logger.log("Accepted refer, but did not automatically follow it");this.sendNotify("SIP/2.0 200 OK");this.emit("referAccepted",this);if(this.referredSession){this.referredSession.emit("referAccepted",this)}}};e.prototype.sendNotify=function(e){if(this.status!==d.SessionStatus.STATUS_ANSWERED){throw new l.Exceptions.InvalidStateError(this.status)}if(p.Grammar.parse(e,"sipfrag")===-1){throw new Error("sipfrag body is required to send notify for refer")}var t=new o.OutgoingRequest(h.C.NOTIFY,this.remoteTarget,this.ua,{cseq:this.cseq+=1,callId:this.callId,fromUri:this.fromUri,fromTag:this.fromTag,toUri:this.toUri,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],e);new s.RequestSender({request:t,onRequestTimeout:function(){return},onTransportError:function(){return},receiveResponse:function(){return}},this.ua).send()};e.prototype.on=function(e,t){return i.prototype.on.call(this,e,t)};return e}(f.ServerContext);t.ReferServerContext=A},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=r(2);var i=r(0);var n=r(9);var o=function(){function e(e,t){this.type=i.TypeStrings.RequestSender;this.logger=t.getLogger("sip.requestsender");this.loggerFactory=t.getLoggerFactory();this.ua=t;this.applicant=e;this.method=e.request.method;this.request=e.request;this.credentials=undefined;this.challenged=false;this.staled=false;if(t.status===i.UAStatus.STATUS_USER_CLOSED&&(this.method!==s.C.BYE&&this.method!==s.C.ACK)){this.onTransportError()}}e.prototype.send=function(){var t=this;var e=this.ua.transport;if(!e){throw new Error("Transport undefined.")}var r={loggerFactory:this.ua.getLoggerFactory(),onRequestTimeout:function(){return t.onRequestTimeout()},onStateChange:function(e){if(e===n.TransactionState.Terminated){t.ua.destroyTransaction(i)}},onTransportError:function(e){return t.onTransportError()},receiveResponse:function(e){return t.receiveResponse(e)}};var i;switch(this.method){case"INVITE":i=new n.InviteClientTransaction(this.request,e,r);break;case"ACK":throw new Error("Cannot make client transaction for ACK method.");default:i=new n.NonInviteClientTransaction(this.request,e,r)}this.clientTransaction=i;this.ua.newTransaction(i);return i};e.prototype.onRequestTimeout=function(){this.applicant.onRequestTimeout()};e.prototype.onTransportError=function(){this.applicant.onTransportError()};e.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;if(t===401||t===407){var r=void 0;var i=void 0;if(t===401){r=e.parseHeader("www-authenticate");i="authorization"}else{r=e.parseHeader("proxy-authenticate");i="proxy-authorization"}if(!r){this.logger.warn(t+" with wrong or missing challenge, cannot authenticate");this.applicant.receiveResponse(e);return}if(!this.challenged||!this.staled&&r.stale===true){if(!this.credentials&&this.ua.configuration.authenticationFactory){this.credentials=this.ua.configuration.authenticationFactory(this.ua)}if(!this.credentials.authenticate(this.request,r)){this.applicant.receiveResponse(e);return}this.challenged=true;if(r.stale){this.staled=true}var n=void 0;if(e.method===s.C.REGISTER){n=this.applicant.cseq+=1}else if(this.request.dialog){n=this.request.dialog.localSeqnum+=1}else{n=(this.request.cseq||0)+1;this.request.cseq=n}this.request.setHeader("cseq",n+" "+this.method);this.request.setHeader(i,this.credentials.toString());this.send()}else{this.applicant.receiveResponse(e)}}else{this.applicant.receiveResponse(e)}};return e}();t.RequestSender=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=500;var n=4e3;var s=5e3;t.Timers={T1:i,T2:n,T4:s,TIMER_B:64*i,TIMER_D:0*i,TIMER_F:64*i,TIMER_H:64*i,TIMER_I:0*s,TIMER_J:0*i,TIMER_K:0*s,TIMER_L:64*i,TIMER_M:64*i,TIMER_N:64*i,PROVISIONAL_RESPONSE_INTERVAL:6e4}},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var u=r(2);var c=r(0);var n=function(){function e(e){this.parameters={};this.type=c.TypeStrings.Parameters;for(var t in e){if(e.hasOwnProperty(t)){this.setParam(t,e[t])}}}e.prototype.setParam=function(e,t){if(e){this.parameters[e.toLowerCase()]=typeof t==="undefined"||t===null?null:t.toString()}};e.prototype.getParam=function(e){if(e){return this.parameters[e.toLowerCase()]}};e.prototype.hasParam=function(e){if(e){return!!this.parameters.hasOwnProperty(e.toLowerCase())}return false};e.prototype.deleteParam=function(e){e=e.toLowerCase();if(this.parameters.hasOwnProperty(e)){var t=this.parameters[e];delete this.parameters[e];return t}};e.prototype.clearParams=function(){this.parameters={}};return e}();t.Parameters=n;var s=function(f){i(e,f);function e(e,t,r,i,n,s){var o=f.call(this,n)||this;o.headers={};o.type=c.TypeStrings.URI;if(!r){throw new TypeError('missing or invalid "host" parameter')}e=e||u.C.SIP;for(var a in s){if(s.hasOwnProperty(a)){o.setHeader(a,s[a])}}o.raw={scheme:e,user:t,host:r,port:i};o.normal={scheme:e.toLowerCase(),user:t,host:r.toLowerCase(),port:i};return o}Object.defineProperty(e.prototype,"_normal",{get:function(){return this.normal},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"_raw",{get:function(){return this.raw},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e;this.normal.scheme=e.toLowerCase()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e;this.normal.host=e.toLowerCase()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e===0?e:e},enumerable:true,configurable:true});e.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]};e.prototype.getHeader=function(e){if(e){return this.headers[this.headerize(e)]}};e.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))};e.prototype.deleteHeader=function(e){e=this.headerize(e);if(this.headers.hasOwnProperty(e)){var t=this.headers[e];delete this.headers[e];return t}};e.prototype.clearHeaders=function(){this.headers={}};e.prototype.clone=function(){return new e(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))};e.prototype.toRaw=function(){return this._toString(this._raw)};e.prototype.toString=function(){return this._toString(this._normal)};e.prototype._toString=function(e){var t=e.scheme+":";if(!e.scheme.toLowerCase().match("^sips?$")){t+="//"}if(e.user){t+=this.escapeUser(e.user)+"@"}t+=e.host;if(e.port||e.port===0){t+=":"+e.port}for(var r in this.parameters){if(this.parameters.hasOwnProperty(r)){t+=";"+r;if(this.parameters[r]!==null){t+="="+this.parameters[r]}}}var i=[];for(var n in this.headers){if(this.headers.hasOwnProperty(n)){for(var s in this.headers[n]){if(this.headers[n].hasOwnProperty(s)){i.push(n+"="+this.headers[n][s])}}}}if(i.length>0){t+="?"+i.join("&")}return t};e.prototype.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};e.prototype.headerize=function(e){var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"};var r=e.toLowerCase().replace(/_/g,"-").split("-");var i=r.length;var n="";for(var s=0;s<i;s++){if(s!==0){n+="-"}n+=r[s].charAt(0).toUpperCase()+r[s].substring(1)}if(t[n]){n=t[n]}return n};return e}(n);t.URI=s},function(e,s,t){s=e.exports=t(88);s.log=n;s.formatArgs=i;s.save=o;s.load=a;s.useColors=r;s.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:f();s.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function r(){return typeof document!=="undefined"&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}s.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function i(){var e=arguments;var t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+s.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0;var n=0;e[0].replace(/%[a-z%]/g,function(e){if("%%"===e)return;i++;if("%c"===e){n=i}});e.splice(n,0,r);return e}function n(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{if(null==e){s.storage.removeItem("debug")}else{s.storage.debug=e}}catch(e){}}function a(){var e;try{return s.storage.debug}catch(e){}if(typeof process!=="undefined"&&"env"in process){return process.env.DEBUG}}s.enable(a());function f(){try{return window.localStorage}catch(e){}}},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}},function(e,s,t){s=e.exports=t(108);s.log=n;s.formatArgs=i;s.save=o;s.load=a;s.useColors=r;s.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:f();s.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function r(){return typeof document!=="undefined"&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}s.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function i(){var e=arguments;var t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+s.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0;var n=0;e[0].replace(/%[a-z%]/g,function(e){if("%%"===e)return;i++;if("%c"===e){n=i}});e.splice(n,0,r);return e}function n(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{if(null==e){s.storage.removeItem("debug")}else{s.storage.debug=e}}catch(e){}}function a(){var e;try{return s.storage.debug}catch(e){}if(typeof process!=="undefined"&&"env"in process){return process.env.DEBUG}}s.enable(a());function f(){try{return window.localStorage}catch(e){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(11);t.ClientContext=i.ClientContext;var n=r(2);t.C=n.C;var s=r(22);t.Dialog=s.Dialog;var o=r(32);t.DigestAuthentication=o.DigestAuthentication;var a=r(0);t.DialogStatus=a.DialogStatus;t.SessionStatus=a.SessionStatus;t.TypeStrings=a.TypeStrings;t.UAStatus=a.UAStatus;var f=r(7);t.Exceptions=f.Exceptions;var u=r(8);t.Grammar=u.Grammar;var c=r(33);t.LoggerFactory=c.LoggerFactory;var l=r(31);t.NameAddrHeader=l.NameAddrHeader;var h=r(34);t.Parser=h.Parser;var d=r(35);t.PublishContext=d.PublishContext;var p=r(36);t.RegisterContext=p.RegisterContext;var v=r(15);t.RequestSender=v.RequestSender;var g=r(37);var m=g.SanityCheck.sanityCheck;t.sanityCheck=m;var y=r(23);t.ServerContext=y.ServerContext;var T=r(14);t.InviteClientContext=T.InviteClientContext;t.InviteServerContext=T.InviteServerContext;t.ReferClientContext=T.ReferClientContext;t.ReferServerContext=T.ReferServerContext;t.Session=T.Session;var C=r(10);t.IncomingRequest=C.IncomingRequest;t.IncomingResponse=C.IncomingResponse;t.OutgoingRequest=C.OutgoingRequest;var S=r(38);t.Subscription=S.Subscription;var A=r(16);t.Timers=A.Timers;var b=r(9);var w={InviteClientTransaction:b.InviteClientTransaction,InviteServerTransaction:b.InviteServerTransaction,NonInviteClientTransaction:b.NonInviteClientTransaction,NonInviteServerTransaction:b.NonInviteServerTransaction};t.Transactions=w;var E=r(39);t.Transport=E.Transport;var R=r(40);t.UA=R.UA;var _=r(17);t.URI=_.URI;var I=r(3);t.Utils=I.Utils;var O=r(67);t.Web=O;var N=r(30);var D=N.title;t.name=D;var x=N.version;t.version=x},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var f=r(2);var u=r(0);var c=r(15);var s=r(10);var l=r(9);var i=function(){function e(e,t,r,i){this.pracked=[];this.uacPendingReply=false;this.uasPendingReply=false;this.type=u.TypeStrings.Dialog;if(!t.hasHeader("contact")){throw new Error("unable to create a Dialog without Contact header field")}if(t.type===u.TypeStrings.IncomingResponse){var n=t.statusCode;i=n&&n<200?u.DialogStatus.STATUS_EARLY:u.DialogStatus.STATUS_CONFIRMED}else{i=i||u.DialogStatus.STATUS_CONFIRMED}var s=t.parseHeader("contact");if(r==="UAS"&&t.type===u.TypeStrings.IncomingRequest){this.id={callId:t.callId,localTag:t.toTag,remoteTag:t.fromTag,toString:function(){return t.callId+t.toTag+t.fromTag}};this.state=i;this.remoteSeqnum=t.cseq;this.localUri=(t.parseHeader("to")||{}).uri;this.remoteUri=(t.parseHeader("from")||{}).uri;this.remoteTarget=s.uri;this.routeSet=t.getHeaders("record-route");this.inviteSeqnum=t.cseq;this.localSeqnum=t.cseq}else{this.id={callId:t.callId,localTag:t.fromTag,remoteTag:t.toTag,toString:function(){return t.callId+t.fromTag+t.toTag}};this.state=i;this.inviteSeqnum=t.cseq;this.localSeqnum=t.cseq;this.localUri=t.parseHeader("from").uri;this.pracked=[];this.remoteUri=t.parseHeader("to").uri;this.remoteTarget=s.uri;this.routeSet=t.getHeaders("record-route").reverse()}this.logger=e.ua.getLogger("sip.dialog",this.id.toString());this.owner=e;e.ua.dialogs[this.id.toString()]=this;this.logger.log("new "+r+" dialog created with status "+(this.state===u.DialogStatus.STATUS_EARLY?"EARLY":"CONFIRMED"));e.emit("dialog",this)}e.prototype.update=function(e,t){this.state=u.DialogStatus.STATUS_CONFIRMED;this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state");if(t==="UAC"){this.routeSet=e.getHeaders("record-route").reverse()}};e.prototype.terminate=function(){this.logger.log("dialog "+this.id.toString()+" deleted");if(this.sessionDescriptionHandler&&this.state!==u.DialogStatus.STATUS_CONFIRMED){this.sessionDescriptionHandler.close()}delete this.owner.ua.dialogs[this.id.toString()]};e.prototype.createRequest=function(e,t,r){if(t===void 0){t=[]}t=t.slice();if(!this.localSeqnum){this.localSeqnum=Math.floor(Math.random()*1e4)}var i=e===f.C.CANCEL||e===f.C.ACK?this.inviteSeqnum:this.localSeqnum+=1;var n=new s.OutgoingRequest(e,this.remoteTarget,this.owner.ua,{cseq:i,callId:this.id.callId,fromUri:this.localUri,fromTag:this.id.localTag,toIri:this.remoteUri,toTag:this.id.remoteTag,routeSet:this.routeSet},t,r);n.dialog=this;return n};e.prototype.checkInDialogRequest=function(e){var t=this;if(!this.remoteSeqnum){this.remoteSeqnum=e.cseq}else if(e.cseq<this.remoteSeqnum){if(e.method!==f.C.ACK){e.reply(500)}return e.cseq===this.inviteSeqnum}switch(e.method){case f.C.INVITE:if(this.uacPendingReply===true){e.reply(491)}else if(this.uasPendingReply===true&&e.cseq>this.remoteSeqnum){var r=Math.floor(Math.random()*10)+1;e.reply(500,undefined,["Retry-After:"+r]);this.remoteSeqnum=e.cseq;return false}else{this.uasPendingReply=true;var i=function(){if(e.transaction&&(e.transaction.state===l.TransactionState.Accepted||e.transaction.state===l.TransactionState.Completed||e.transaction.state===l.TransactionState.Terminated)){e.transaction.removeListener("stateChanged",i);t.uasPendingReply=false}};if(e.transaction){e.transaction.on("stateChanged",i)}}if(e.hasHeader("contact")&&e.transaction){e.transaction.on("stateChanged",function(){if(e.transaction&&e.transaction.state===l.TransactionState.Accepted){t.remoteTarget=e.parseHeader("contact").uri}})}break;case f.C.NOTIFY:if(e.hasHeader("contact")&&e.transaction){e.transaction.on("stateChanged",function(){if(e.transaction&&e.transaction.state===l.TransactionState.Completed){t.remoteTarget=e.parseHeader("contact").uri}})}break}if(e.cseq>this.remoteSeqnum){this.remoteSeqnum=e.cseq}return true};e.prototype.sendRequest=function(n,e,t){var s=this;if(t===void 0){t={}}var r=(t.extraHeaders||[]).slice();var i;if(t.body){if(t.body.body){i=t.body}else{i={};i.body=t.body;if(t.contentType){i.contentType=t.contentType}}}var o=this.createRequest(e,r,i);var a=function(t){var r=new c.RequestSender({request:o,onRequestTimeout:n.onRequestTimeout.bind(n),onTransportError:n.onTransportError.bind(n),receiveResponse:function(e){if(e.statusCode===408||e.statusCode===481){n.onDialogError(e)}else if(e.method===f.C.INVITE&&e.statusCode===491){if(t){n.receiveResponse(e)}else{o.cseq=s.localSeqnum+=1;setTimeout(function(){if(s.owner.status!==undefined&&s.owner.status!==u.SessionStatus.STATUS_TERMINATED){a(true)}},1e3)}}else{n.receiveResponse(e)}}},s.owner.ua);r.send();if(!r.clientTransaction){return}else if(o.method===f.C.INVITE&&r.clientTransaction&&r.clientTransaction.state!==l.TransactionState.Terminated){s.uacPendingReply=true;var i=function(){var e=r.clientTransaction.state;if(!r.clientTransaction){return}else if(r.clientTransaction&&(e===l.TransactionState.Accepted||e===l.TransactionState.Completed||e===l.TransactionState.Terminated)){r.clientTransaction.removeListener("stateChanged",i);s.uacPendingReply=false}};r.clientTransaction.on("stateChanged",i)}};a(false);return o};e.prototype.receiveRequest=function(e){if(!this.checkInDialogRequest(e)){return}this.owner.receiveRequest(e)};e.C=u.DialogStatus;return e}();t.Dialog=i},function(e,t,r){"use strict";var s=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var i=r(6);var a=r(2);var f=r(0);var u=r(8);var c=r(9);var l=r(3);var n=function(i){s(n,i);function n(e,t){var r=i.call(this)||this;r.data={};n.initializer(r,e,t);return r}n.initializer=function(t,r,e){t.type=f.TypeStrings.ServerContext;t.ua=r;t.logger=r.getLogger("sip.servercontext");t.request=e;var i=r.transport;if(!i){throw new Error("Transport undefined.")}var n={loggerFactory:r.getLoggerFactory(),onStateChange:function(e){if(e===c.TransactionState.Terminated){r.destroyTransaction(t.transaction)}},onTransportError:function(e){t.logger.error(e.message);t.onTransportError()}};if(e.method===a.C.INVITE){t.transaction=new c.InviteServerTransaction(e,i,n)}else{t.transaction=new c.NonInviteServerTransaction(e,i,n)}r.newTransaction(t.transaction);if(e.body){t.body=e.body}if(e.hasHeader("Content-Type")){t.contentType=e.getHeader("Content-Type")}t.method=e.method;t.localIdentity=e.to;t.remoteIdentity=e.from;var s=e.hasHeader("P-Asserted-Identity");if(s){var o=e.getHeader("P-Asserted-Identity");if(o){t.assertedIdentity=u.Grammar.nameAddrHeaderParse(o)}}};n.prototype.progress=function(e){if(e===void 0){e={}}e.statusCode=e.statusCode||180;e.minCode=100;e.maxCode=199;e.events=["progress"];return this.reply(e)};n.prototype.accept=function(e){if(e===void 0){e={}}e.statusCode=e.statusCode||200;e.minCode=200;e.maxCode=299;e.events=["accepted"];return this.reply(e)};n.prototype.reject=function(e){if(e===void 0){e={}}e.statusCode=e.statusCode||480;e.minCode=300;e.maxCode=699;e.events=["rejected","failed"];return this.reply(e)};n.prototype.reply=function(e){var t=this;if(e===void 0){e={}}var r=e.statusCode||100;var i=e.minCode||100;var n=e.maxCode||699;var s=l.Utils.getReasonPhrase(r,e.reasonPhrase);var o=e.extraHeaders||[];var a=e.body;var f=e.events||[];if(r<i||r>n){throw new TypeError("Invalid statusCode: "+r)}var u=this.request.reply(r,s,o,a);f.forEach(function(e){t.emit(e,u,s)});return this};n.prototype.onRequestTimeout=function(){this.emit("failed",undefined,a.C.causes.REQUEST_TIMEOUT)};n.prototype.onTransportError=function(){this.emit("failed",undefined,a.C.causes.CONNECTION_ERROR)};return n}(i.EventEmitter);t.ServerContext=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(e,t){var r=[];var i=e.split(/\r\n/);var n;for(var s=0;s<i.length;){var o=i[s];if(/^m=(?:audio|video)/.test(o)){n={index:s,stripped:[]};r.push(n)}else if(n){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){i.splice(s,1);n.stripped.push(a[1]);continue}}s++}for(var f=0,u=r;f<u.length;f++){var c=u[f];var l=i[c.index].split(" ");for(var h=3;h<l.length;){if(c.stripped.indexOf(l[h])!==-1){l.splice(h,1);continue}h++}i[c.index]=l.join(" ")}return i.join("\r\n")};var n=function(e,r){var t=new RegExp("m="+r+".*$","gm");var i=new RegExp("^a=group:.*$","gm");if(t.test(e)){var n;e=e.split(/^m=/gm).filter(function(e){if(e.substr(0,r.length)===r){n=e.match(/^a=mid:.*$/gm);if(n){var t=n[0].match(/:.+$/g);if(t){n=t[0].substr(1)}}return false}return true}).join("m=");var s=e.match(i);if(s&&s.length===1){var o=s[0];var a=new RegExp(" *"+n+"[^ ]*","g");o=o.replace(a,"");e=e.split(i).join(o)}}return e};function s(e){e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,"");return Promise.resolve(e)}t.stripTcpCandidates=s;function o(e){e.sdp=i(e.sdp||"","telephone-event");return Promise.resolve(e)}t.stripTelephoneEvent=o;function a(e){e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:");return Promise.resolve(e)}t.cleanJitsiSdpImageattr=a;function f(e){e.sdp=i(e.sdp||"","G722");return Promise.resolve(e)}t.stripG722=f;function u(t){return function(e){e.sdp=i(e.sdp||"",t);return Promise.resolve(e)}}t.stripRtpPayload=u;function c(e){e.sdp=n(e.sdp||"","video");return Promise.resolve(e)}t.stripVideo=c;function l(e){var t=e.sdp||"";if(t.search(/^a=mid.*$/gm)===-1){var r=t.match(/^m=.*$/gm);var i=t.split(/^m=.*$/gm);if(r){r.forEach(function(e,t){r[t]=e+"\na=mid:"+t})}i.forEach(function(e,t){if(r&&r[t]){i[t]=e+r[t]}});t=i.join("");e.sdp=t}return Promise.resolve(e)}t.addMidLines=l},function(e,t,r){"use strict";var i=r(5);var n=r(72);var s={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){if(!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])){e["Content-Type"]=t}}function a(){var e;if(typeof XMLHttpRequest!=="undefined"){e=r(44)}else if(typeof process!=="undefined"){e=r(44)}return e}var f={adapter:a(),transformRequest:[function e(t,r){n(r,"Content-Type");if(i.isFormData(t)||i.isArrayBuffer(t)||i.isBuffer(t)||i.isStream(t)||i.isFile(t)||i.isBlob(t)){return t}if(i.isArrayBufferView(t)){return t.buffer}if(i.isURLSearchParams(t)){o(r,"application/x-www-form-urlencoded;charset=utf-8");return t.toString()}if(i.isObject(t)){o(r,"application/json;charset=utf-8");return JSON.stringify(t)}return t}],transformResponse:[function e(t){if(typeof t==="string"){try{t=JSON.parse(t)}catch(e){}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function e(t){return t>=200&&t<300}};f.headers={common:{Accept:"application/json, text/plain, */*"}};i.forEach(["delete","get","head"],function e(t){f.headers[t]={}});i.forEach(["post","put","patch"],function e(t){f.headers[t]=i.merge(s)});e.exports=f},function(e,o,t){var a=t(90)("socket.io-parser");var i=t(93);var r=t(95);var s=t(96);var n=t(51);o.protocol=4;o.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];o.CONNECT=0;o.DISCONNECT=1;o.EVENT=2;o.ACK=3;o.ERROR=4;o.BINARY_EVENT=5;o.BINARY_ACK=6;o.Encoder=f;o.Decoder=l;function f(){}f.prototype.encode=function(e,t){a("encoding packet %j",e);if(o.BINARY_EVENT==e.type||o.BINARY_ACK==e.type){c(e,t)}else{var r=u(e);t([r])}};function u(e){var t="";var r=false;t+=e.type;if(o.BINARY_EVENT==e.type||o.BINARY_ACK==e.type){t+=e.attachments;t+="-"}if(e.nsp&&"/"!=e.nsp){r=true;t+=e.nsp}if(null!=e.id){if(r){t+=",";r=false}t+=e.id}if(null!=e.data){if(r)t+=",";t+=i.stringify(e.data)}a("encoded %j as %s",e,t);return t}function c(e,n){function t(e){var t=s.deconstructPacket(e);var r=u(t.packet);var i=t.buffers;i.unshift(r);n(i)}s.removeBlobs(e,t)}function l(){this.reconstructor=null}r(l.prototype);l.prototype.add=function(e){var t;if("string"==typeof e){t=h(e);if(o.BINARY_EVENT==t.type||o.BINARY_ACK==t.type){this.reconstructor=new p(t);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",t)}}else{this.emit("decoded",t)}}else if(n(e)||e.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{t=this.reconstructor.takeBinaryData(e);if(t){this.reconstructor=null;this.emit("decoded",t)}}}else{throw new Error("Unknown type: "+e)}};function h(e){var t={};var r=0;t.type=Number(e.charAt(0));if(null==o.types[t.type])return v();if(o.BINARY_EVENT==t.type||o.BINARY_ACK==t.type){var i="";while(e.charAt(++r)!="-"){i+=e.charAt(r);if(r==e.length)break}if(i!=Number(i)||e.charAt(r)!="-"){throw new Error("Illegal attachments")}t.attachments=Number(i)}if("/"==e.charAt(r+1)){t.nsp="";while(++r){var n=e.charAt(r);if(","==n)break;t.nsp+=n;if(r==e.length)break}}else{t.nsp="/"}var s=e.charAt(r+1);if(""!==s&&Number(s)==s){t.id="";while(++r){var n=e.charAt(r);if(null==n||Number(n)!=n){--r;break}t.id+=e.charAt(r);if(r==e.length)break}t.id=Number(t.id)}if(e.charAt(++r)){t=d(t,e.substr(r))}a("decoded %s as %j",e,t);return t}function d(e,t){try{e.data=i.parse(t)}catch(e){return v()}return e}l.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function p(e){this.reconPack=e;this.buffers=[]}p.prototype.takeBinaryData=function(e){this.buffers.push(e);if(this.buffers.length==this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null};p.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function v(e){return{type:o.ERROR,data:"parser error"}}},function(e,t,r){(function(n){var s=r(100);e.exports=function(e){var t=e.xdomain;var r=e.xscheme;var i=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!t||s)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!==typeof XDomainRequest&&!r&&i){return new XDomainRequest}}catch(e){}if(!t){try{return new(n[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}}).call(this,r(1))},function(e,t,r){var i=r(12);var n=r(13);e.exports=s;function s(e){this.path=e.path;this.hostname=e.hostname;this.port=e.port;this.secure=e.secure;this.query=e.query;this.timestampParam=e.timestampParam;this.timestampRequests=e.timestampRequests;this.readyState="";this.agent=e.agent||false;this.socket=e.socket;this.enablesXDR=e.enablesXDR;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized;this.forceNode=e.forceNode;this.extraHeaders=e.extraHeaders;this.localAddress=e.localAddress}n(s.prototype);s.prototype.onError=function(e,t){var r=new Error(e);r.type="TransportError";r.description=t;this.emit("error",r);return this};s.prototype.open=function(){if("closed"===this.readyState||""===this.readyState){this.readyState="opening";this.doOpen()}return this};s.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.doClose();this.onClose()}return this};s.prototype.send=function(e){if("open"===this.readyState){this.write(e)}else{throw new Error("Transport not open")}};s.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};s.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)};s.prototype.onPacket=function(e){this.emit("packet",e)};s.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},function(e,t){t.encode=function(e){var t="";for(var r in e){if(e.hasOwnProperty(r)){if(t.length)t+="&";t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r])}}return t};t.decode=function(e){var t={};var r=e.split("&");for(var i=0,n=r.length;i<n;i++){var s=r[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},function(e){e.exports={_args:[["sip.js@0.13.8","E:\\code\\kefu-2.0\\kefu\\client\\CC_v2.0"]],_from:"sip.js@0.13.8",_id:"sip.js@0.13.8",_inBundle:false,_integrity:"sha512-iYzNCnuaa6Rf8Vs2MtPGIyEGOwTszRwVbfFnBz8SAp7/U7/WXmPl4Ly4yHGA7ZiuLikrqlFFMY85/yZb8puqkw==",_location:"/sip.js",_phantomChildren:{},_requested:{type:"version",registry:true,raw:"sip.js@0.13.8",name:"sip.js",escapedName:"sip.js",rawSpec:"0.13.8",saveSpec:null,fetchSpec:"0.13.8"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/sip.js/-/sip.js-0.13.8.tgz",_spec:"0.13.8",_where:"E:\\code\\kefu-2.0\\kefu\\client\\CC_v2.0",author:{name:"OnSIP",email:"developer@onsip.com",url:"https://sipjs.com/aboutus/"},bugs:{url:"https://github.com/onsip/SIP.js/issues"},contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],dependencies:{"crypto-js":"^3.1.9-1"},description:"A simple, intuitive, and powerful JavaScript signaling library",devDependencies:{"@types/jasmine":"^3.3.11","@types/node":"^11.11.6","circular-dependency-plugin":"^5.0.2","jasmine-core":"^3.3.0",karma:"^4.0.1","karma-chrome-launcher":"^2.2.0","karma-cli":"^2.0.0","karma-jasmine":"^2.0.1","karma-jasmine-html-reporter":"^1.4.0","karma-mocha-reporter":"^2.2.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^3.0.5",pegjs:"^0.10.0","ts-loader":"^5.3.3","ts-pegjs":"0.2.2",tslint:"^5.14.0",typescript:"^3.3.4000",webpack:"^4.29.6","webpack-cli":"^3.3.0"},engines:{node:">=8.0"},homepage:"https://sipjs.com",keywords:["sip","webrtc","library","websocket","javascript","typescript"],license:"MIT",main:"./lib/index.js",name:"sip.js",repository:{type:"git",url:"git+https://github.com/onsip/SIP.js.git"},scripts:{browserTest:"npm run build-test && sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",build:"npm run generate-grammar && npm run build-lib && npm run build-reg-bundle && npm run build-min-bundle && npm run copy-dist-files","build-bundles":"npm run build-reg-bundle && npm run build-min-bundle","build-lib":"tsc -p src","build-min-bundle":"webpack --progress --config build/webpack.config.js --env.buildType min","build-reg-bundle":"webpack --progress --config build/webpack.config.js --env.buildType reg","build-test":"tsc -p test",buildAndBrowserTest:"npm run build && npm run browserTest",buildAndTest:"npm run build && npm run commandLineTest",commandLineTest:"npm run build-test && karma start --reporters mocha --browsers ChromeHeadless --single-run","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js dist/sip-$npm_package_version.min.js","generate-grammar":"node build/grammarGenerator.js",prebuild:"tslint -p tsconfig-base.json -c tslint.json"},title:"SIP.js",types:"./lib/index.d.ts",version:"0.13.8"}},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var s=r(0);var n=r(17);var o=function(n){i(e,n);function e(e,t,r){var i=n.call(this,r)||this;i.type=s.TypeStrings.NameAddrHeader;if(!e||!(e.type===s.TypeStrings.URI)){throw new TypeError('missing or invalid "uri" parameter')}i.uri=e;i._displayName=t;return i}Object.defineProperty(e.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:true,configurable:true});e.prototype.clone=function(){return new e(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))};e.prototype.toString=function(){var e=this.displayName||this.displayName==="0"?'"'+this.displayName+'" ':"";e+="<"+this.uri.toString()+">";for(var t in this.parameters){if(this.parameters.hasOwnProperty(t)){e+=";"+t;if(this.parameters[t]!==null){e+="="+this.parameters[t]}}}return e};return e}(n.Parameters);t.NameAddrHeader=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(63);var n=r(0);var s=r(3);var o=function(){function e(e){this.type=n.TypeStrings.DigestAuthentication;this.logger=e.getLogger("sipjs.digestauthentication");this.username=e.configuration.authorizationUser;this.password=e.configuration.password;this.nc=0;this.ncHex="00000000"}e.prototype.authenticate=function(e,t,r){this.algorithm=t.algorithm;this.realm=t.realm;this.nonce=t.nonce;this.opaque=t.opaque;this.stale=t.stale;if(this.algorithm){if(this.algorithm!=="MD5"){this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted");return false}}else{this.algorithm="MD5"}if(!this.realm){this.logger.warn("challenge without Digest realm, authentication aborted");return false}if(!this.nonce){this.logger.warn("challenge without Digest nonce, authentication aborted");return false}if(t.qop){if(t.qop.indexOf("auth")>-1){this.qop="auth"}else if(t.qop.indexOf("auth-int")>-1){this.qop="auth-int"}else{this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted");return false}}else{this.qop=undefined}this.method=e.method;this.uri=e.ruri;this.cnonce=s.Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();if(this.nc===4294967296){this.nc=1;this.ncHex="00000001"}this.calculateResponse(r);return true};e.prototype.toString=function(){var e=[];if(!this.response){throw new Error("response field does not exist, cannot generate Authorization header")}e.push("algorithm="+this.algorithm);e.push('username="'+this.username+'"');e.push('realm="'+this.realm+'"');e.push('nonce="'+this.nonce+'"');e.push('uri="'+this.uri+'"');e.push('response="'+this.response+'"');if(this.opaque){e.push('opaque="'+this.opaque+'"')}if(this.qop){e.push("qop="+this.qop);e.push('cnonce="'+this.cnonce+'"');e.push("nc="+this.ncHex)}return"Digest "+e.join(", ")};e.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e};e.prototype.calculateResponse=function(e){var t;var r=i(this.username+":"+this.realm+":"+this.password);if(this.qop==="auth"){t=i(this.method+":"+this.uri);this.response=i(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)}else if(this.qop==="auth-int"){t=i(this.method+":"+this.uri+":"+i(e?e:""));this.response=i(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)}else if(this.qop===undefined){t=i(this.method+":"+this.uri);this.response=i(r+":"+this.nonce+":"+t)}};return e}();t.DigestAuthentication=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(0);var n;(function(e){e[e["error"]=0]="error";e[e["warn"]=1]="warn";e[e["log"]=2]="log";e[e["debug"]=3]="debug"})(n=t.Levels||(t.Levels={}));var s=function(){function e(){this.builtinEnabled=true;this._level=n.log;this.loggers={};this.type=i.TypeStrings.LoggerFactory;this.logger=this.getLogger("sip:loggerfactory")}Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){if(e>=0&&e<=3){this._level=e}else if(e>3){this._level=3}else if(n.hasOwnProperty(e)){this._level=e}else{this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"connector",{get:function(){return this._connector},set:function(e){if(!e){this._connector=undefined}else if(typeof e==="function"){this._connector=e}else{this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e))}},enumerable:true,configurable:true});e.prototype.getLogger=function(e,t){if(t&&this.level===3){return new o(this,e,t)}else if(this.loggers[e]){return this.loggers[e]}else{var r=new o(this,e);this.loggers[e]=r;return r}};e.prototype.genericLog=function(e,t,r,i){if(this.level>=e){if(this.builtinEnabled){this.print(console[n[e]],t,r,i)}}if(this.connector){this.connector(n[e],t,r,i)}};e.prototype.print=function(e,t,r,i){if(typeof i==="string"){var n=[new Date,t];if(r){n.push(r)}i=n.concat(i).join(" | ")}e.call(console,i)};return e}();t.LoggerFactory=s;var o=function(){function e(e,t,r){this.type=i.TypeStrings.Logger;this.logger=e;this.category=t;this.label=r}e.prototype.error=function(e){this.genericLog(n.error,e)};e.prototype.warn=function(e){this.genericLog(n.warn,e)};e.prototype.log=function(e){this.genericLog(n.log,e)};e.prototype.debug=function(e){this.genericLog(n.debug,e)};e.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)};return e}();t.Logger=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=r(0);var h=r(8);var d=r(10);var i;(function(e){function c(e,t){var r=t;var i=0;var n=0;if(e.substring(r,r+2).match(/(^\r\n)/)){return-2}while(i===0){n=e.indexOf("\r\n",r);if(n===-1){return n}if(!e.substring(n+2,n+4).match(/(^\r\n)/)&&e.charAt(n+2).match(/(^\s+)/)){r=n+2}else{i=n}}return i}e.getHeader=c;function l(t,e,r,i){var n=e.indexOf(":",r);var s=e.substring(r,n).trim();var o=e.substring(n+1,i).trim();var a;switch(s.toLowerCase()){case"via":case"v":t.addHeader("via",o);if(t.getHeaders("via").length===1){a=t.parseHeader("Via");if(a){t.via=a;t.viaBranch=a.branch}}else{a=0}break;case"from":case"f":t.setHeader("from",o);a=t.parseHeader("from");if(a){t.from=a;t.fromTag=a.getParam("tag")}break;case"to":case"t":t.setHeader("to",o);a=t.parseHeader("to");if(a){t.to=a;t.toTag=a.getParam("tag")}break;case"record-route":a=h.Grammar.parse(o,"Record_Route");if(a===-1){a=undefined;break}for(var f in a){if(a[f]){t.addHeader("record-route",o.substring(a[f].position,a[f].offset));t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=a[f].parsed}}break;case"call-id":case"i":t.setHeader("call-id",o);a=t.parseHeader("call-id");if(a){t.callId=o}break;case"contact":case"m":a=h.Grammar.parse(o,"Contact");if(a===-1){a=undefined;break}if(!(a instanceof Array)){a=undefined;break}a.forEach(function(e){t.addHeader("contact",o.substring(e.position,e.offset));t.headers.Contact[t.getHeaders("contact").length-1].parsed=e.parsed});break;case"content-length":case"l":t.setHeader("content-length",o);a=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",o);a=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",o);a=t.parseHeader("cseq");if(a){t.cseq=a.value}if(t.type===u.TypeStrings.IncomingResponse){t.method=a.method}break;case"max-forwards":t.setHeader("max-forwards",o);a=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",o);a=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",o);a=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",o);a=t.parseHeader("refer-to");if(a){t.referTo=a}break;default:t.setHeader(s,o);a=0}if(a===undefined){return{error:"error parsing header '"+s+"'"}}else{return true}}e.parseHeader=l;function t(e,t){var r=0;var i=e.indexOf("\r\n");var n=t.getLogger("sip.parser");if(i===-1){n.warn("no CRLF found, not a SIP message, discarded");return}var s=e.substring(0,i);var o=h.Grammar.parse(s,"Request_Response");var a;if(o===-1){n.warn('error parsing first line of SIP message: "'+s+'"');return}else if(!o.status_code){a=new d.IncomingRequest(t);a.method=o.method;a.ruri=o.uri}else{a=new d.IncomingResponse(t);a.statusCode=o.status_code;a.reasonPhrase=o.reason_phrase}a.data=e;r=i+2;var f;while(true){i=c(e,r);if(i===-2){f=r+2;break}else if(i===-1){n.error("malformed message");return}var u=l(a,e,r,i);if(u!==true){n.error(o.error);return}r=i+2}if(a.hasHeader("content-length")){a.body=e.substr(f,Number(a.getHeader("content-length")))}else{a.body=e.substring(f)}return a}e.parseMessage=t})(i=t.Parser||(t.Parser={}))},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var n=r(11);var o=r(2);var a=r(0);var f=r(7);var u=r(10);var c=r(3);var s=function(s){i(e,s);function e(e,t,r,i){if(i===void 0){i={}}var n=this;i.extraHeaders=(i.extraHeaders||[]).slice();i.contentType=i.contentType||"text/plain";if(typeof i.expires!=="number"||i.expires%1!==0){i.expires=3600}else{i.expires=Number(i.expires)}if(typeof i.unpublishOnClose!=="boolean"){i.unpublishOnClose=true}if(t===undefined||t===null||t===""){throw new f.Exceptions.MethodParameterError("Publish","Target",t)}else{t=e.normalizeTarget(t);if(t===undefined){throw new f.Exceptions.MethodParameterError("Publish","Target",t)}}n=s.call(this,e,o.C.PUBLISH,t,i)||this;n.type=a.TypeStrings.PublishContext;n.options=i;n.target=t;if(r===undefined||r===null||r===""){throw new f.Exceptions.MethodParameterError("Publish","Event",r)}else{n.event=r}n.logger=e.getLogger("sip.publish");n.pubRequestExpires=n.options.expires;e.on("transportCreated",function(e){e.on("transportError",function(){return n.onTransportError()})});return n}e.prototype.publish=function(e){if(this.publishRefreshTimer){clearTimeout(this.publishRefreshTimer);this.publishRefreshTimer=undefined}this.options.body=e;this.pubRequestBody=this.options.body;if(this.pubRequestExpires===0){this.pubRequestExpires=this.options.expires;this.pubRequestEtag=undefined}if(!this.ua.publishers[this.target.toString()+":"+this.event]){this.ua.publishers[this.target.toString()+":"+this.event]=this}this.sendPublishRequest()};e.prototype.unpublish=function(){if(this.publishRefreshTimer){clearTimeout(this.publishRefreshTimer);this.publishRefreshTimer=undefined}this.pubRequestBody=undefined;this.pubRequestExpires=0;if(this.pubRequestEtag!==undefined){this.sendPublishRequest()}};e.prototype.close=function(){if(this.options.unpublishOnClose){this.unpublish()}else{if(this.publishRefreshTimer){clearTimeout(this.publishRefreshTimer);this.publishRefreshTimer=undefined}this.pubRequestBody=undefined;this.pubRequestExpires=0;this.pubRequestEtag=undefined}if(this.ua.publishers[this.target.toString()+":"+this.event]){delete this.ua.publishers[this.target.toString()+":"+this.event]}};e.prototype.onRequestTimeout=function(){s.prototype.onRequestTimeout.call(this);this.emit("unpublished",undefined,o.C.causes.REQUEST_TIMEOUT)};e.prototype.onTransportError=function(){s.prototype.onTransportError.call(this);this.emit("unpublished",undefined,o.C.causes.CONNECTION_ERROR)};e.prototype.receiveResponse=function(e){var t=this;var r=e.statusCode||0;var i=c.Utils.getReasonPhrase(r);switch(true){case/^1[0-9]{2}$/.test(r.toString()):this.emit("progress",e,i);break;case/^2[0-9]{2}$/.test(r.toString()):if(e.hasHeader("SIP-ETag")){this.pubRequestEtag=e.getHeader("SIP-ETag")}else{this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH")}if(e.hasHeader("Expires")){var n=Number(e.getHeader("Expires"));if(typeof n==="number"&&n>=0&&n<=this.pubRequestExpires){this.pubRequestExpires=n}else{this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}}else{this.logger.warn("Expires header missing in a 200-class response to PUBLISH")}if(this.pubRequestExpires!==0){this.publishRefreshTimer=setTimeout(function(){return t.refreshRequest()},this.pubRequestExpires*900);this.emit("published",e,i)}else{this.emit("unpublished",e,i)}break;case/^412$/.test(r.toString()):if(this.pubRequestEtag!==undefined&&this.pubRequestExpires!==0){this.logger.warn("412 response to PUBLISH, recovering");this.pubRequestEtag=undefined;this.emit("progress",e,i);this.publish(this.options.body)}else{this.logger.warn("412 response to PUBLISH, recovery failed");this.pubRequestExpires=0;this.emit("failed",e,i);this.emit("unpublished",e,i)}break;case/^423$/.test(r.toString()):if(this.pubRequestExpires!==0&&e.hasHeader("Min-Expires")){var s=Number(e.getHeader("Min-Expires"));if(typeof s==="number"||s>this.pubRequestExpires){this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover");this.pubRequestExpires=s;this.emit("progress",e,i);this.publish(this.options.body)}else{this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH");this.pubRequestExpires=0;this.emit("failed",e,i);this.emit("unpublished",e,i)}}else{this.logger.warn("423 response to PUBLISH, recovery failed");this.pubRequestExpires=0;this.emit("failed",e,i);this.emit("unpublished",e,i)}break;default:this.pubRequestExpires=0;this.emit("failed",e,i);this.emit("unpublished",e,i);break}if(this.pubRequestExpires===0){if(this.publishRefreshTimer){clearTimeout(this.publishRefreshTimer);this.publishRefreshTimer=undefined}this.pubRequestBody=undefined;this.pubRequestEtag=undefined}};e.prototype.refreshRequest=function(){if(this.publishRefreshTimer){clearTimeout(this.publishRefreshTimer);this.publishRefreshTimer=undefined}this.pubRequestBody=undefined;if(this.pubRequestEtag===undefined){throw new f.Exceptions.MethodParameterError("Publish","Body",undefined)}if(this.pubRequestExpires===0){throw new f.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires)}this.sendPublishRequest()};e.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice();e.extraHeaders.push("Event: "+this.event);e.extraHeaders.push("Expires: "+this.pubRequestExpires);if(this.pubRequestEtag!==undefined){e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag)}this.request=new u.OutgoingRequest(o.C.PUBLISH,this.target,this.ua,this.options.params,e.extraHeaders);if(this.pubRequestBody!==undefined){this.request.body={body:this.pubRequestBody,contentType:this.options.contentType}}this.send()};return e}(n.ClientContext);t.PublishContext=s},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var n=this&&this.__assign||function(){n=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))e[n]=t[n]}return e};return n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:true});var s=r(11);var a=r(2);var f=r(0);var o=r(7);var u=r(8);var c=r(3);function l(e){var t={expires:600,extraContactHeaderParams:[],instanceId:undefined,params:{},regId:undefined,registrar:undefined};var r=h();for(var i in r.mandatory){if(!e.hasOwnProperty(i)){throw new o.Exceptions.ConfigurationError(i)}else{var n=e[i];var s=r.mandatory[i](n);if(s!==undefined){t[i]=s}else{throw new o.Exceptions.ConfigurationError(i,n)}}}for(var i in r.optional){if(e.hasOwnProperty(i)){var n=e[i];if(n instanceof Array&&n.length===0){continue}if(n===null||n===""||n===undefined||typeof n==="number"&&isNaN(n)){continue}var s=r.optional[i](n);if(s!==undefined){t[i]=s}else{throw new o.Exceptions.ConfigurationError(i,n)}}}return t}function h(){return{mandatory:{},optional:{expires:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>=0){return t}}},extraContactHeaderParams:function(e){if(e instanceof Array){return e.filter(function(e){return typeof e==="string"})}},instanceId:function(e){if(typeof e!=="string"){return}if(/^uuid:/i.test(e)){e=e.substr(5)}if(u.Grammar.parse(e,"uuid")===-1){return}else{return e}},params:function(e){if(typeof e==="object"){return e}},regId:function(e){if(c.Utils.isDecimal(e)){var t=Number(e);if(t>=0){return t}}},registrar:function(e){if(typeof e!=="string"){return}if(!/^sip:/i.test(e)){e=a.C.SIP+":"+e}var t=u.Grammar.URIParse(e);if(!t){return}else if(t.user){return}else{return t}}}}}var d=function(o){i(e,o);function e(e,t){if(t===void 0){t={}}var r=this;var i=l(t);if(i.regId&&!i.instanceId){i.instanceId=c.Utils.newUUID()}else if(!i.regId&&i.instanceId){i.regId=1}i.params.toUri=i.params.toUri||e.configuration.uri;i.params.toDisplayName=i.params.toDisplayName||e.configuration.displayName;i.params.callId=i.params.callId||c.Utils.createRandomToken(22);i.params.cseq=i.params.cseq||Math.floor(Math.random()*1e4);if(!i.registrar){var n={};if(typeof e.configuration.uri==="object"){n=e.configuration.uri.clone();n.user=undefined}else{n=e.configuration.uri}i.registrar=n}r=o.call(this,e,a.C.REGISTER,i.registrar,i)||this;r.type=f.TypeStrings.RegisterContext;r.options=i;r.logger=e.getLogger("sip.registercontext");r.logger.log("configuration parameters for RegisterContext after validation:");for(var s in i){if(i.hasOwnProperty(s)){r.logger.log("· "+s+": "+JSON.stringify(i[s]))}}r.expires=i.expires;r.cseq=i.params.cseq;r.contact=e.contact.toString();r.registered=false;e.on("transportCreated",function(e){e.on("disconnected",function(){return r.onTransportDisconnected()})});return r}e.prototype.register=function(e){var s=this;if(e===void 0){e={}}this.options=n({},this.options,e);var t=(this.options.extraHeaders||[]).slice();t.push("Contact: "+this.generateContactHeader(this.expires));t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[];this.receiveResponse=function(e){if(e.cseq!==s.cseq){return}if(s.registrationTimer!==undefined){clearTimeout(s.registrationTimer);s.registrationTimer=undefined}var t=(e.statusCode||0).toString();switch(true){case/^1[0-9]{2}$/.test(t):s.emit("progress",e);break;case/^2[0-9]{2}$/.test(t):s.emit("accepted",e);var r=void 0;if(e.hasHeader("expires")){r=Number(e.getHeader("expires"))}if(s.registrationExpiredTimer!==undefined){clearTimeout(s.registrationExpiredTimer);s.registrationExpiredTimer=undefined}var i=e.getHeaders("contact").length;if(!i){s.logger.warn("no Contact header in response to REGISTER, response ignored");break}var n=void 0;while(i--){n=e.parseHeader("contact",i);if(n.uri.user===s.ua.contact.uri.user){r=n.getParam("expires");break}else{n=undefined}}if(!n){s.logger.warn("no Contact header pointing to us, response ignored");break}if(r===undefined){r=s.expires}s.registrationTimer=setTimeout(function(){s.registrationTimer=undefined;s.register(s.options)},r*1e3-3e3);s.registrationExpiredTimer=setTimeout(function(){s.logger.warn("registration expired");if(s.registered){s.unregistered(undefined,a.C.causes.EXPIRES)}},r*1e3);if(n.hasParam("temp-gruu")){s.ua.contact.tempGruu=u.Grammar.URIParse(n.getParam("temp-gruu").replace(/"/g,""))}if(n.hasParam("pub-gruu")){s.ua.contact.pubGruu=u.Grammar.URIParse(n.getParam("pub-gruu").replace(/"/g,""))}s.registered=true;s.emit("registered",e||undefined);break;case/^423$/.test(t):if(e.hasHeader("min-expires")){s.expires=Number(e.getHeader("min-expires"));s.register(s.options)}else{s.logger.warn("423 response received for REGISTER without Min-Expires");s.registrationFailure(e,a.C.causes.SIP_FAILURE_CODE)}break;default:s.registrationFailure(e,c.Utils.sipErrorCause(e.statusCode||0))}};this.onRequestTimeout=function(){s.registrationFailure(undefined,a.C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){s.registrationFailure(undefined,a.C.causes.CONNECTION_ERROR)};this.cseq++;if(this.request){this.request.cseq=this.cseq;this.request.setHeader("cseq",this.cseq+" REGISTER");this.request.extraHeaders=t}this.send()};e.prototype.close=function(){var e={all:false,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered;if(this.registered){this.unregister(e)}};e.prototype.unregister=function(e){var r=this;if(e===void 0){e={}}if(!this.registered&&!e.all){this.logger.warn("Already unregistered, but sending an unregister anyways.")}var t=(e.extraHeaders||[]).slice();this.registered=false;if(this.registrationTimer!==undefined){clearTimeout(this.registrationTimer);this.registrationTimer=undefined}if(e.all){t.push("Contact: *");t.push("Expires: 0")}else{t.push("Contact: "+this.generateContactHeader(0))}this.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode.toString():"";switch(true){case/^1[0-9]{2}$/.test(t):r.emit("progress",e);break;case/^2[0-9]{2}$/.test(t):r.emit("accepted",e);if(r.registrationExpiredTimer!==undefined){clearTimeout(r.registrationExpiredTimer);r.registrationExpiredTimer=undefined}r.unregistered(e);break;default:r.unregistered(e,c.Utils.sipErrorCause(e.statusCode||0))}};this.onRequestTimeout=function(){};this.cseq++;if(this.request){this.request.cseq=this.cseq;this.request.setHeader("cseq",this.cseq+" REGISTER");this.request.extraHeaders=t}this.send()};e.prototype.unregistered=function(e,t){this.registered=false;this.emit("unregistered",e||undefined,t||undefined)};e.prototype.registrationFailure=function(e,t){this.emit("failed",e||undefined,t||undefined)};e.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered;if(this.registrationTimer!==undefined){clearTimeout(this.registrationTimer);this.registrationTimer=undefined}if(this.registrationExpiredTimer!==undefined){clearTimeout(this.registrationExpiredTimer);this.registrationExpiredTimer=undefined}if(this.registered){this.unregistered(undefined,a.C.causes.CONNECTION_ERROR)}};e.prototype.generateContactHeader=function(e){if(e===void 0){e=0}var t=this.contact;if(this.options.regId&&this.options.instanceId){t+=";reg-id="+this.options.regId;t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'}if(this.options.extraContactHeaderParams){this.options.extraContactHeaderParams.forEach(function(e){t+=";"+e})}t+=";expires="+e;return t};return e}(s.ClientContext);t.RegisterContext=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=r(2);var S=r(0);var c=r(3);var i;(function(e){function f(e,t,r){var i=c.Utils.buildStatusLine(e);var n=t.getHeaders("via");for(var s=0,o=n;s<o.length;s++){var a=o[s];i+="Via: "+a+"\r\n"}var f=t.getHeader("To")||"";if(!t.toTag){f+=";tag="+c.Utils.newTag()}i+="To: "+f+"\r\n";i+="From: "+t.getHeader("From")+"\r\n";i+="Call-ID: "+t.callId+"\r\n";i+="CSeq: "+t.cseq+" "+t.method+"\r\n";i+="\r\n";r.send(i)}e.reply=f;function d(e,t,r){if(!e.ruri||e.ruri.scheme!=="sip"){f(416,e,r);return false}return true}e.rfc3261_8_2_2_1=d;function p(e,t,r){if(!e.toTag){if(e.callId.substr(0,5)===t.configuration.sipjsId){f(482,e,r);return false}}return true}e.rfc3261_16_3_4=p;function v(e,t,r){var i=c.Utils.str_utf8_length(e.body);var n=e.getHeader("content-length");if(n&&i<Number(n)){f(400,e,r);return false}return true}e.rfc3261_18_3_request=v;function g(e,t,r){var i=e.fromTag;var n=e.callId;var s=e.cseq;if(!e.toTag){if(e.method===u.C.INVITE){if(t.transactions.ist[e.viaBranch]){return true}else{for(var o in t.transactions.ist){if(t.transactions.ist.hasOwnProperty(o)){var a=t.transactions.ist[o];if(a&&a.request.fromTag===i&&a.request.callId===n&&a.request.cseq===s){f(482,e,r);return false}}}}}else{if(t.transactions.nist[e.viaBranch]){return true}else{for(var o in t.transactions.nist){if(t.transactions.nist.hasOwnProperty(o)){var a=t.transactions.nist[o];if(a&&a.request.fromTag===i&&a.request.callId===n&&a.request.cseq===s){f(482,e,r);return false}}}}}}return true}e.rfc3261_8_2_2_2=g;function m(e,t){if(e.getHeaders("via").length>1){t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response."+" Dropping the response");return false}return true}e.rfc3261_8_1_3_3=m;function y(e,t){if(e.via.host!==t.configuration.viaHost||e.via.port!==undefined){t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value."+" Dropping the response");return false}return true}e.rfc3261_18_1_2=y;function T(e,t){var r=c.Utils.str_utf8_length(e.body);var i=e.getHeader("content-length");if(i&&r<Number(i)){t.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in"+" Content-Length header field. Dropping the response");return false}return true}e.rfc3261_18_3_response=T;function C(e,t){var r=["from","to","call_id","cseq","via"];for(var i=0,n=r;i<n.length;i++){var s=n[i];if(!e.hasHeader(s)){t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+s+". Dropping the response");return false}}return true}e.minimumHeaders=C;function t(e,t,r){var i=[d,p,v,g];var n=[m,y,T];var s=[C];for(var o=0,a=s;o<a.length;o++){var f=a[o];if(!f(e,t,r)){return false}}if(e.type===S.TypeStrings.IncomingRequest){for(var u=0,c=i;u<c.length;u++){var f=c[u];if(!f(e,t,r)){return false}}}else if(e.type===S.TypeStrings.IncomingResponse){for(var l=0,h=n;l<h.length;l++){var f=h[l];if(!f(e,t,r)){return false}}}return true}e.sanityCheck=t})(i=t.SanityCheck||(t.SanityCheck={}))},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var n=r(11);var a=r(2);var s=r(22);var f=r(0);var u=r(16);var c=r(3);var o=function(o){i(e,o);function e(e,t,r,i){if(i===void 0){i={}}var n=this;if(!r){throw new TypeError("Event necessary to create a subscription.")}i.extraHeaders=(i.extraHeaders||[]).slice();var s;if(typeof i.expires!=="number"){e.logger.warn("expires must be a number. Using default of 3600.");s=3600}else{s=i.expires}i.extraHeaders.push("Event: "+r);i.extraHeaders.push("Expires: "+s);i.extraHeaders.push("Contact: "+e.contact.toString());i.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());n=o.call(this,e,a.C.SUBSCRIBE,t,i)||this;n.type=f.TypeStrings.Subscription;n.event=r;n.requestedExpires=s;n.state="init";n.contact=e.contact.toString();n.extraHeaders=i.extraHeaders;n.logger=e.getLogger("sip.subscription");n.expires=s;n.timers={N:undefined,subDuration:undefined};n.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604];return n}e.prototype.subscribe=function(){var e=this;if(this.state==="active"){this.refresh();return this}else if(this.state==="notify_wait"){return this}clearTimeout(this.timers.subDuration);clearTimeout(this.timers.N);this.timers.N=setTimeout(function(){return e.timer_fire()},u.Timers.TIMER_N);if(this.request&&this.request.from){this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event]=this}this.send();this.state="notify_wait";return this};e.prototype.refresh=function(){if(this.state==="terminated"||this.state==="pending"||this.state==="notify_wait"||!this.dialog){return}this.dialog.sendRequest(this,a.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})};e.prototype.receiveResponse=function(e){var t=this;var r=e.statusCode?e.statusCode:0;var i=c.Utils.getReasonPhrase(r);if(this.state==="notify_wait"&&r>=300||this.state!=="notify_wait"&&this.errorCodes.indexOf(r)!==-1){this.failed(e,undefined)}else if(/^2[0-9]{2}$/.test(r.toString())){this.emit("accepted",e,i);var n=e.getHeader("Expires");if(n&&Number(n)<=this.requestedExpires){this.expires=Number(n);this.timers.subDuration=setTimeout(function(){return t.refresh()},Number(n)*900)}else{if(!n){this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.failed(e,"Expires Header Missing")}else{this.logger.warn("Expires header in a 200-class response to"+" SUBSCRIBE with a higher value than the one in the request");this.failed(e,"Invalid Expires Header")}}}else if(r>300){this.emit("failed",e,i);this.emit("rejected",e,i)}};e.prototype.unsubscribe=function(){var e=this;var t=[];this.state="terminated";t.push("Event: "+this.event);t.push("Expires: 0");t.push("Contact: "+this.contact);t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString());this.receiveResponse=function(){};if(this.dialog){this.dialog.sendRequest(this,a.C.SUBSCRIBE,{extraHeaders:t,body:this.body})}clearTimeout(this.timers.subDuration);clearTimeout(this.timers.N);this.timers.N=setTimeout(function(){return e.timer_fire()},u.Timers.TIMER_N);this.emit("terminated")};e.prototype.receiveRequest=function(e){var t=this;var r;var i=function(){if(r.expires){clearTimeout(t.timers.subDuration);r.expires=Math.min(t.expires,Math.max(r.expires,0));t.timers.subDuration=setTimeout(function(){return t.refresh()},r.expires*900)}};if(!this.matchEvent(e)){e.reply(489);return}if(!this.dialog){if(this.createConfirmedDialog(e,"UAS")){if(this.dialog){this.id=this.dialog.id.toString();if(this.request&&this.request.from){delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event];this.ua.subscriptions[this.id||""]=this}}}}r=e.parseHeader("Subscription-State");e.reply(200);clearTimeout(this.timers.N);this.emit("notify",{request:e});if(this.state==="terminated"){if(r.state==="terminated"){this.terminateDialog();clearTimeout(this.timers.N);clearTimeout(this.timers.subDuration);delete this.ua.subscriptions[this.id||""]}return}switch(r.state){case"active":this.state="active";i();break;case"pending":if(this.state==="notify_wait"){i()}this.state="pending";break;case"terminated":clearTimeout(this.timers.subDuration);if(r.reason){this.logger.log("terminating subscription with reason "+r.reason);switch(r.reason){case"deactivated":case"timeout":this.subscribe();return;case"probation":case"giveup":if(r.params&&r.params["retry-after"]){this.timers.subDuration=setTimeout(function(){return t.subscribe()},r.params["retry-after"])}else{this.subscribe()}return;case"rejected":case"noresource":case"invariant":break}}this.close();break}};e.prototype.close=function(){if(this.state==="notify_wait"){this.state="terminated";clearTimeout(this.timers.N);clearTimeout(this.timers.subDuration);this.receiveResponse=function(){};if(this.request&&this.request.from){delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event]}this.emit("terminated")}else if(this.state!=="terminated"){this.unsubscribe()}};e.prototype.onDialogError=function(e){this.failed(e,a.C.causes.DIALOG_ERROR)};e.prototype.on=function(e,t){return o.prototype.on.call(this,e,t)};e.prototype.timer_fire=function(){if(this.state==="terminated"){this.terminateDialog();clearTimeout(this.timers.N);clearTimeout(this.timers.subDuration);delete this.ua.subscriptions[this.id||""]}else if(this.state==="notify_wait"||this.state==="pending"){this.close()}else{this.refresh()}};e.prototype.createConfirmedDialog=function(e,t){this.terminateDialog();var r=new s.Dialog(this,e,t);if(this.request){r.inviteSeqnum=this.request.cseq;r.localSeqnum=this.request.cseq}if(!r.error){this.dialog=r;return true}else{return false}};e.prototype.terminateDialog=function(){if(this.dialog){delete this.ua.subscriptions[this.id||""];this.dialog.terminate();delete this.dialog}};e.prototype.failed=function(e,t){this.close();this.emit("failed",e,t);this.emit("rejected",e,t);return this};e.prototype.matchEvent=function(e){if(!e.hasHeader("Event")){this.logger.warn("missing Event header");return false}if(!e.hasHeader("Subscription-State")){this.logger.warn("missing Subscription-State header");return false}var t=e.parseHeader("event").event;if(this.event!==t){this.logger.warn("event match failed");e.reply(481,"Event Match Failed");return false}else{return true}};return e}(n.ClientContext);t.Subscription=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var i=r(6);var s=r(0);var o=function(i){n(e,i);function e(e,t){var r=i.call(this)||this;r.type=s.TypeStrings.Transport;r.logger=e;return r}e.prototype.connect=function(e){var t=this;if(e===void 0){e={}}return this.connectPromise(e).then(function(e){if(!e.overrideEvent){t.emit("connected")}})};e.prototype.send=function(e,t){var r=this;if(t===void 0){t={}}return this.sendPromise(e).then(function(e){if(!e.overrideEvent){r.emit("messageSent",e.msg)}})};e.prototype.disconnect=function(e){var t=this;if(e===void 0){e={}}return this.disconnectPromise(e).then(function(e){if(!e.overrideEvent){t.emit("disconnected")}})};e.prototype.afterConnected=function(e){if(this.isConnected()){e()}else{this.once("connected",e)}};e.prototype.waitForConnected=function(){var t=this;console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead");return new Promise(function(e){t.afterConnected(e)})};return e}(i.EventEmitter);t.Transport=o},function(e,v,R){"use strict";(function(a){var e=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(v,"__esModule",{value:true});var t=R(6);var s=R(11);var g=R(2);var h=R(32);var m=R(0);var d=R(7);var r=R(8);var o=R(33);var i=R(34);var f=R(35);var u=R(36);var c=R(37);var y=R(23);var T=R(14);var l=R(10);var p=R(38);var C=R(9);var S=R(17);var A=R(3);var b=R(41);var w=R(42);var E=a.window||a;var n=function(n){e(v,n);function v(e){var t=n.call(this)||this;t.type=m.TypeStrings.UA;t.log=new o.LoggerFactory;t.logger=t.getLogger("sip.ua");t.cache={credentials:{}};t.configuration={};t.dialogs={};t.applicants={};t.data={};t.sessions={};t.subscriptions={};t.earlySubscriptions={};t.publishers={};t.status=m.UAStatus.STATUS_INIT;t.transactions={nist:{},nict:{},ist:{},ict:{}};if(e===undefined){e={}}else if(typeof e==="string"||e instanceof String){e={uri:e}}if(e.log){if(e.log.hasOwnProperty("builtinEnabled")){t.log.builtinEnabled=e.log.builtinEnabled}if(e.log.hasOwnProperty("connector")){t.log.connector=e.log.connector}if(e.log.hasOwnProperty("level")){var r=e.log.level;var i=typeof r==="string"?o.Levels[r]:r;if(!i){t.logger.error('Invalid "level" parameter value: '+JSON.stringify(r))}else{t.log.level=i}}}try{t.loadConfig(e)}catch(e){t.status=m.UAStatus.STATUS_NOT_READY;t.error=v.C.CONFIGURATION_ERROR;throw e}t.registerContext=new u.RegisterContext(t,e.registerOptions);t.registerContext.on("failed",t.emit.bind(t,"registrationFailed"));t.registerContext.on("registered",t.emit.bind(t,"registered"));t.registerContext.on("unregistered",t.emit.bind(t,"unregistered"));if(t.configuration.autostart){t.start()}return t}Object.defineProperty(v.prototype,"transactionsCount",{get:function(){var e=0;for(var t=0,r=["nist","nict","ist","ict"];t<r.length;t++){var i=r[t];e+=Object.keys(this.transactions[i]).length}return e},enumerable:true,configurable:true});Object.defineProperty(v.prototype,"nictTransactionsCount",{get:function(){return Object.keys(this.transactions.nict).length},enumerable:true,configurable:true});Object.defineProperty(v.prototype,"nistTransactionsCount",{get:function(){return Object.keys(this.transactions.nist).length},enumerable:true,configurable:true});Object.defineProperty(v.prototype,"ictTransactionsCount",{get:function(){return Object.keys(this.transactions.ict).length},enumerable:true,configurable:true});Object.defineProperty(v.prototype,"istTransactionsCount",{get:function(){return Object.keys(this.transactions.ist).length},enumerable:true,configurable:true});v.prototype.register=function(e){if(e===void 0){e={}}if(e.register){this.configuration.register=true}this.registerContext.register(e);return this};v.prototype.unregister=function(e){var t=this;this.configuration.register=false;if(this.transport){this.transport.afterConnected(function(){t.registerContext.unregister(e)})}return this};v.prototype.isRegistered=function(){return this.registerContext.registered};v.prototype.invite=function(e,t,r){var i=this;var n=new T.InviteClientContext(this,e,t,r);if(this.transport){this.transport.afterConnected(function(){n.invite();i.emit("inviteSent",n)})}return n};v.prototype.subscribe=function(e,t,r){var i=new p.Subscription(this,e,t,r);if(this.transport){this.transport.afterConnected(function(){return i.subscribe()})}return i};v.prototype.publish=function(e,t,r,i){var n=new f.PublishContext(this,e,t,i);if(this.transport){this.transport.afterConnected(function(){n.publish(r)})}return n};v.prototype.message=function(e,t,r){if(r===void 0){r={}}if(t===undefined){throw new TypeError("Not enough arguments")}r.contentType=r.contentType||"text/plain";r.body=t;return this.request(g.C.MESSAGE,e,r)};v.prototype.request=function(e,t,r){var i=new s.ClientContext(this,e,t,r);if(this.transport){this.transport.afterConnected(function(){return i.send()})}return i};v.prototype.stop=function(){var e=this;this.logger.log("user requested closure...");if(this.status===m.UAStatus.STATUS_USER_CLOSED){this.logger.warn("UA already closed");return this}this.logger.log("closing registerContext");this.registerContext.close();for(var t in this.sessions){if(this.sessions[t]){this.logger.log("closing session "+t);this.sessions[t].terminate()}}for(var r in this.subscriptions){if(this.subscriptions[r]){this.logger.log("unsubscribing from subscription "+r);this.subscriptions[r].close()}}for(var i in this.earlySubscriptions){if(this.earlySubscriptions[i]){this.logger.log("unsubscribing from early subscription "+i);this.earlySubscriptions[i].close()}}for(var n in this.publishers){if(this.publishers[n]){this.logger.log("unpublish "+n);this.publishers[n].close()}}for(var s in this.applicants){if(this.applicants[s]){this.applicants[s].close()}}this.status=m.UAStatus.STATUS_USER_CLOSED;if(this.nistTransactionsCount===0&&this.nictTransactionsCount===0&&this.transport){this.transport.disconnect()}else{var o=function(){if(e.nistTransactionsCount===0&&e.nictTransactionsCount===0){e.removeListener("transactionDestroyed",o);if(e.transport){e.transport.disconnect()}}};this.on("transactionDestroyed",o)}if(typeof E.removeEventListener==="function"){if(!(a.chrome&&a.chrome.app&&a.chrome.app.runtime)){E.removeEventListener("unload",this.environListener)}}return this};v.prototype.start=function(){var e=this;this.logger.log("user requested startup...");if(this.status===m.UAStatus.STATUS_INIT){this.status=m.UAStatus.STATUS_STARTING;if(!this.configuration.transportConstructor){throw new d.Exceptions.TransportError("Transport constructor not set")}this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions);this.setTransportListeners();this.emit("transportCreated",this.transport);this.transport.connect()}else if(this.status===m.UAStatus.STATUS_USER_CLOSED){this.logger.log("resuming");this.status=m.UAStatus.STATUS_READY;if(this.transport){this.transport.connect()}}else if(this.status===m.UAStatus.STATUS_STARTING){this.logger.log("UA is in STARTING status, not opening new connection")}else if(this.status===m.UAStatus.STATUS_READY){this.logger.log("UA is in READY status, not resuming")}else{this.logger.error("Connection is down. Auto-Recovery system is trying to connect")}if(this.configuration.autostop&&typeof E.addEventListener==="function"){if(!(a.chrome&&a.chrome.app&&a.chrome.app.runtime)){this.environListener=this.stop;E.addEventListener("unload",function(){return e.environListener()})}}return this};v.prototype.normalizeTarget=function(e){return A.Utils.normalizeTarget(e,this.configuration.hostportParams)};v.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)};v.prototype.getLoggerFactory=function(){return this.log};v.prototype.newTransaction=function(e){this.transactions[e.kind][e.id]=e;this.emit("newTransaction",{transaction:e})};v.prototype.destroyTransaction=function(e){delete this.transactions[e.kind][e.id];this.emit("transactionDestroyed",{transaction:e})};v.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||undefined};v.prototype.on=function(e,t){return n.prototype.on.call(this,e,t)};v.prototype.saveCredentials=function(e){this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{};this.cache.credentials[e.realm][e.uri]=e;return this};v.prototype.getCredentials=function(e){var t=e.ruri.type===m.TypeStrings.URI?e.ruri.host:"";if(t&&this.cache.credentials[t]&&this.cache.credentials[t][e.ruri.toString()]){var r=this.cache.credentials[t][e.ruri.toString()];r.method=e.method;return r}};v.prototype.onTransportError=function(){if(this.status===m.UAStatus.STATUS_USER_CLOSED){return}if(!this.error||this.error!==v.C.NETWORK_ERROR){this.status=m.UAStatus.STATUS_NOT_READY;this.error=v.C.NETWORK_ERROR}};v.prototype.setTransportListeners=function(){var t=this;if(this.transport){this.transport.on("connected",function(){return t.onTransportConnected()});this.transport.on("message",function(e){return t.onTransportReceiveMsg(e)});this.transport.on("transportError",function(){return t.onTransportError()})}};v.prototype.onTransportConnected=function(){var e=this;if(this.configuration.register){Promise.resolve().then(function(){return e.registerContext.register()})}};v.prototype.onTransportReceiveMsg=function(e){var t=i.Parser.parseMessage(e,this);if(!t){this.logger.warn("UA failed to parse incoming SIP message - discarding.");return}if(this.status===m.UAStatus.STATUS_USER_CLOSED&&t instanceof l.IncomingRequest){this.logger.warn("UA received message when status = USER_CLOSED - aborting");return}if(!this.transport){this.logger.warn("UA received message without transport - aborting");return}if(!c.SanityCheck.sanityCheck(t,this,this.transport)){return}if(t instanceof l.IncomingRequest){this.receiveRequestFromTransport(t);return}if(t instanceof l.IncomingResponse){this.receiveResponseFromTransport(t);return}throw new Error("Invalid message type.")};v.prototype.receiveRequestFromTransport=function(e){e.transport=this.transport;if(!(this.configuration.uri instanceof S.URI)){throw new Error("Configuration URI not instance of URI.")}if(!e.ruri){throw new Error("Request ruri undefined.")}if(e.ruri.scheme!==g.C.SIP){e.reply_sl(416);return}var t=e.ruri;var r=function(e){return!!e&&e.user===t.user};if(!r(this.configuration.uri)&&!(r(this.contact.uri)||r(this.contact.pubGruu)||r(this.contact.tempGruu))){this.logger.warn("Request-URI does not point to us");if(e.method!==g.C.ACK){e.reply_sl(404)}return}var i=this.transactions.ist[e.viaBranch];var n=this.transactions.nist[e.viaBranch];if(e.method===g.C.CANCEL){if(i||n){e.reply_sl(200);if(i&&i.state===C.TransactionState.Proceeding){this.receiveRequest(e)}}else{e.reply_sl(481)}return}if(e.method===g.C.ACK){if(i&&i.state===C.TransactionState.Accepted){this.receiveRequest(e);return}}if(i){i.receiveRequest(e);return}if(n){n.receiveRequest(e);return}this.receiveRequest(e)};v.prototype.receiveResponseFromTransport=function(e){var t;switch(e.method){case g.C.INVITE:t=this.transactions.ict[e.viaBranch];break;case g.C.ACK:break;default:t=this.transactions.nict[e.viaBranch];break}if(!t){var r="Discarding unmatched "+e.statusCode+" response to "+e.method+" "+e.viaBranch+".";this.logger.warn(r);return}e.transaction=t;t.receiveResponse(e)};v.prototype.receiveRequest=function(e){var t=this;var r=e.method;var i;if(r===g.C.OPTIONS){var n=this.transport;if(!n){throw new Error("Transport undefined.")}var s={loggerFactory:this.getLoggerFactory(),onStateChange:function(e){if(e===C.TransactionState.Terminated){t.destroyTransaction(o)}},onTransportError:function(e){t.logger.error(e.message)}};var o=new C.NonInviteServerTransaction(e,n,s);this.newTransaction(o);e.reply(200,undefined,["Allow: "+v.C.ALLOWED_METHODS.toString(),"Accept: "+v.C.ACCEPTED_BODY_TYPES.toString()])}else if(r===g.C.MESSAGE){i=new y.ServerContext(this,e);i.body=e.body;i.contentType=e.getHeader("Content-Type")||"text/plain";e.reply(200,undefined);this.emit("message",i)}else if(r!==g.C.INVITE&&r!==g.C.ACK){i=new y.ServerContext(this,e)}if(!e.toTag){switch(r){case g.C.INVITE:var a=this.configuration.replaces!==g.C.supported.UNSUPPORTED&&e.parseHeader("replaces");var f=void 0;if(a){f=this.dialogs[a.call_id+a.replaces_to_tag+a.replaces_from_tag];if(!f){e.reply_sl(481,undefined);return}else if(!(f.owner.type===m.TypeStrings.Subscription)&&f.owner.status===m.SessionStatus.STATUS_TERMINATED){e.reply_sl(603,undefined);return}else if(f.state===m.DialogStatus.STATUS_CONFIRMED&&a.earlyOnly){e.reply_sl(486,undefined);return}}var u=new T.InviteServerContext(this,e);if(f&&!(f.owner.type===m.TypeStrings.Subscription)){u.replacee=f&&f.owner}this.emit("invite",u);break;case g.C.BYE:e.reply(481);break;case g.C.CANCEL:var c=this.findSession(e);if(c){c.receiveRequest(e)}else{this.logger.warn("received CANCEL request for a non existent session")}break;case g.C.ACK:break;case g.C.NOTIFY:if(this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0){e.reply(200,undefined);this.emit("notify",{request:e})}else{e.reply(481,"Subscription does not exist")}break;case g.C.REFER:this.logger.log("Received an out of dialog refer");if(this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var l=new T.ReferServerContext(this,e);if(this.listeners("outOfDialogReferRequested").length){this.emit("outOfDialogReferRequested",l)}else{this.logger.log("No outOfDialogReferRequest listeners,"+" automatically accepting and following the out of dialog refer");l.accept({followRefer:true})}break}e.reply(405);break;default:e.reply(405);break}}else{var h=this.findDialog(e);if(h){if(r===g.C.INVITE){var n=this.transport;if(!n){throw new Error("Transport undefined.")}var s={loggerFactory:this.log,onStateChange:function(e){if(e===C.TransactionState.Terminated){t.destroyTransaction(d)}},onTransportError:function(e){t.logger.error(e.message);h.owner.onTransportError()}};var d=new C.InviteServerTransaction(e,n,s);this.newTransaction(d)}h.receiveRequest(e)}else if(r===g.C.NOTIFY){var c=this.findSession(e);var p=this.findEarlySubscription(e);if(c){c.receiveRequest(e)}else if(p){p.receiveRequest(e)}else{this.logger.warn("received NOTIFY request for a non existent session or subscription");e.reply(481,"Subscription does not exist")}}else{if(r!==g.C.ACK){e.reply(481)}}}};v.prototype.findDialog=function(e){return this.dialogs[e.callId+e.fromTag+e.toTag]||this.dialogs[e.callId+e.toTag+e.fromTag]||undefined};v.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.callId+e.toTag+e.getHeader("event")]||undefined};v.prototype.checkAuthenticationFactory=function(e){if(!(e instanceof Function)){return}if(!e.initialize){e.initialize=function(){return Promise.resolve()}}return e};v.prototype.loadConfig=function(e){var n=this;var s={viaHost:A.Utils.createRandomToken(12)+".invalid",uri:new S.URI("sip","anonymous."+A.Utils.createRandomToken(6),"anonymous.invalid",undefined,undefined),custom:{},displayName:"",password:undefined,register:true,registerOptions:{},transportConstructor:w.Transport,transportOptions:{},userAgentString:g.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:false,hackIpInContact:false,hackWssInTransport:false,hackAllowUnregisteredOptionTags:false,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:A.Utils.createRandomToken(8),contactTransport:"ws",forceRport:false,autostart:true,autostop:true,rel100:g.C.supported.UNSUPPORTED,dtmfType:g.C.dtmfType.INFO,replaces:g.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:b.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory(function(e){return new h.DigestAuthentication(e)}),allowLegacyNotifications:false,allowOutOfDialogRefers:false};var t=this.getConfigurationCheck();for(var r in t.mandatory){if(!e.hasOwnProperty(r)){throw new d.Exceptions.ConfigurationError(r)}else{var i=e[r];var o=t.mandatory[r](i);if(o!==undefined){s[r]=o}else{throw new d.Exceptions.ConfigurationError(r,i)}}}for(var r in t.optional){if(e.hasOwnProperty(r)){var i=e[r];if(i instanceof Array&&i.length===0||(i===null||i===""||i===undefined)||typeof i==="number"&&isNaN(i)){continue}var o=t.optional[r](i);if(o!==undefined){s[r]=o}else{throw new d.Exceptions.ConfigurationError(r,i)}}}if(s.displayName===0){s.displayName="0"}s.sipjsId=A.Utils.createRandomToken(5);var a=s.uri.clone();a.user=undefined;s.hostportParams=a.toRaw().replace(/^sip:/i,"");if(!s.authorizationUser){s.authorizationUser=s.uri.user}s.noAnswerTimeout=s.noAnswerTimeout*1e3;if(s.hackIpInContact){if(typeof s.hackIpInContact==="boolean"){var f=1;var u=254;var c=Math.floor(Math.random()*(u-f+1)+f);s.viaHost="192.0.2."+c}else if(typeof s.hackIpInContact==="string"){s.viaHost=s.hackIpInContact}}if(s.hackWssInTransport){s.contactTransport="wss"}this.contact={pubGruu:undefined,tempGruu:undefined,uri:new S.URI("sip",s.contactName,s.viaHost,undefined,{transport:s.contactTransport}),toString:function(e){if(e===void 0){e={}}var t=e.anonymous||false;var r=e.outbound||false;var i="<";if(t){i+=(n.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+s.contactTransport).toString()}else{i+=(n.contact.pubGruu||n.contact.uri).toString()}if(r){i+=";ob"}i+=">";return i}};var l={};for(var r in s){if(s.hasOwnProperty(r)){l[r]=s[r]}}Object.assign(this.configuration,l);this.logger.log("configuration parameters after validation:");for(var r in s){if(s.hasOwnProperty(r)){switch(r){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+r+": "+s[r]);break;case"password":this.logger.log("· "+r+": "+"NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+r+": "+s[r].name);break;default:this.logger.log("· "+r+": "+JSON.stringify(s[r]))}}}return};v.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){if(!/^sip:/i.test(e)){e=g.C.SIP+":"+e}var t=r.Grammar.URIParse(e);if(!t||!t.user){return}else{return t}},transportConstructor:function(e){if(e instanceof Function){return e}},transportOptions:function(e){if(typeof e==="object"){return e}},authorizationUser:function(e){if(r.Grammar.parse('"'+e+'"',"quoted_string")===-1){return}else{return e}},displayName:function(e){if(r.Grammar.parse('"'+e+'"',"displayName")===-1){return}else{return e}},dtmfType:function(e){switch(e){case g.C.dtmfType.RTP:return g.C.dtmfType.RTP;case g.C.dtmfType.INFO:default:return g.C.dtmfType.INFO}},hackViaTcp:function(e){if(typeof e==="boolean"){return e}},hackIpInContact:function(e){if(typeof e==="boolean"){return e}else if(typeof e==="string"&&r.Grammar.parse(e,"host")!==-1){return e}},hackWssInTransport:function(e){if(typeof e==="boolean"){return e}},hackAllowUnregisteredOptionTags:function(e){if(typeof e==="boolean"){return e}},contactTransport:function(e){if(typeof e==="string"){return e}},extraSupported:function(e){if(!(e instanceof Array)){return}for(var t=0,r=e;t<r.length;t++){var i=r[t];if(typeof i!=="string"){return}}return e},forceRport:function(e){if(typeof e==="boolean"){return e}},noAnswerTimeout:function(e){if(A.Utils.isDecimal(e)){var t=Number(e);if(t>0){return t}}},password:function(e){return String(e)},rel100:function(e){if(e===g.C.supported.REQUIRED){return g.C.supported.REQUIRED}else if(e===g.C.supported.SUPPORTED){return g.C.supported.SUPPORTED}else{return g.C.supported.UNSUPPORTED}},replaces:function(e){if(e===g.C.supported.REQUIRED){return g.C.supported.REQUIRED}else if(e===g.C.supported.SUPPORTED){return g.C.supported.SUPPORTED}else{return g.C.supported.UNSUPPORTED}},register:function(e){if(typeof e==="boolean"){return e}},registerOptions:function(e){if(typeof e==="object"){return e}},userAgentString:function(e){if(typeof e==="string"){return e}},autostart:function(e){if(typeof e==="boolean"){return e}},autostop:function(e){if(typeof e==="boolean"){return e}},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function){return e}},sessionDescriptionHandlerFactoryOptions:function(e){if(typeof e==="object"){return e}},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if(typeof e==="boolean"){return e}},custom:function(e){if(typeof e==="object"){return e}},contactName:function(e){if(typeof e==="string"){return e}}}}};v.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};return v}(t.EventEmitter);v.UA=n;(function(e){var t;(function(e){e["RTP"]="rtp";e["INFO"]="info"})(t=e.DtmfType||(e.DtmfType={}))})(n=v.UA||(v.UA={}));v.UA=n}).call(this,R(1))},function(e,i,n){"use strict";(function(o){var e=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:true});var t=n(6);var a=n(0);var f=n(7);var u=n(3);var c=n(24);var l=n(66);var r=function(s){e(n,s);function n(e,t,r){var i=s.call(this)||this;i.type=a.TypeStrings.SessionDescriptionHandler;i.options=r||{};i.logger=e;i.observer=t;i.dtmfSender=undefined;i.shouldAcquireMedia=true;i.CONTENT_TYPE="application/sdp";i.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}};i.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(i.options));i.direction=i.C.DIRECTION.NULL;i.modifiers=i.options.modifiers||[];if(!Array.isArray(i.modifiers)){i.modifiers=[i.modifiers]}var n=o.window||o;i.WebRTC={MediaStream:n.MediaStream,getUserMedia:n.navigator.mediaDevices.getUserMedia.bind(n.navigator.mediaDevices),RTCPeerConnection:n.RTCPeerConnection};i.iceGatheringTimeout=false;i.initPeerConnection(i.options.peerConnectionOptions);i.constraints=i.checkAndDefaultConstraints(i.options.constraints);return i}n.defaultFactory=function(e,t){var r=e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id);var i=new l.SessionDescriptionHandlerObserver(e,t);return new n(r,i,t)};n.prototype.close=function(){this.logger.log("closing PeerConnection");if(this.peerConnection&&this.peerConnection.signalingState!=="closed"){if(this.peerConnection.getSenders){this.peerConnection.getSenders().forEach(function(e){if(e.track){e.track.stop()}})}else{this.logger.warn("Using getLocalStreams which is deprecated");this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})}if(this.peerConnection.getReceivers){this.peerConnection.getReceivers().forEach(function(e){if(e.track){e.track.stop()}})}else{this.logger.warn("Using getRemoteStreams which is deprecated");this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})}this.resetIceGatheringComplete();this.peerConnection.close()}};n.prototype.getDescription=function(e,t){var r=this;if(e===void 0){e={}}if(t===void 0){t=[]}if(e.peerConnectionOptions){this.initPeerConnection(e.peerConnectionOptions)}var i=Object.assign({},this.constraints,e.constraints);i=this.checkAndDefaultConstraints(i);if(JSON.stringify(i)!==JSON.stringify(this.constraints)){this.constraints=i;this.shouldAcquireMedia=true}if(!Array.isArray(t)){t=[t]}t=t.concat(this.modifiers);return Promise.resolve().then(function(){if(r.shouldAcquireMedia){return r.acquire(r.constraints).then(function(){r.shouldAcquireMedia=false})}}).then(function(){return r.createOfferOrAnswer(e.RTCOfferOptions,t)}).then(function(e){if(e.sdp===undefined){throw new f.Exceptions.SessionDescriptionHandlerError("getDescription",undefined,"SDP undefined")}r.emit("getDescription",e);return{body:e.sdp,contentType:r.CONTENT_TYPE}})};n.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE};n.prototype.holdModifier=function(e){if(!e.sdp){return Promise.resolve(e)}if(!/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)){e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n")}else{e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n");e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")}return Promise.resolve(e)};n.prototype.setDescription=function(r,i,n){var s=this;if(i===void 0){i={}}if(n===void 0){n=[]}if(i.peerConnectionOptions){this.initPeerConnection(i.peerConnectionOptions)}if(!Array.isArray(n)){n=[n]}n=n.concat(this.modifiers);var e={type:this.hasOffer("local")?"answer":"offer",sdp:r};return Promise.resolve().then(function(){if(s.shouldAcquireMedia&&s.options.alwaysAcquireMediaFirst){return s.acquire(s.constraints).then(function(){s.shouldAcquireMedia=false})}}).then(function(){return u.Utils.reducePromises(n,e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");s.logger.error(t.message);s.emit("peerConnection-setRemoteDescriptionFailed",t);throw t}).then(function(e){s.emit("setDescription",e);return s.peerConnection.setRemoteDescription(e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}if(/^m=video.+$/gm.test(r)&&!i.disableAudioFallback){i.disableAudioFallback=true;return s.setDescription(r,i,[c.stripVideo].concat(n))}var t=new f.Exceptions.SessionDescriptionHandlerError("setDescription",e);if(t.error){s.logger.error(t.error)}s.emit("peerConnection-setRemoteDescriptionFailed",t);throw t}).then(function(){if(s.peerConnection.getReceivers){s.emit("setRemoteDescription",s.peerConnection.getReceivers())}else{s.emit("setRemoteDescription",s.peerConnection.getRemoteStreams())}s.emit("confirmed",s)})};n.prototype.sendDtmf=function(e,t){if(t===void 0){t={}}if(!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var r=this.peerConnection.getSenders();if(r.length>0){this.dtmfSender=r[0].dtmf}}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var i=this.peerConnection.getLocalStreams();if(i.length>0){var n=i[0].getAudioTracks();if(n.length>0){this.dtmfSender=this.peerConnection.createDTMFSender(n[0])}}}if(!this.dtmfSender){return false}try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if(e.type==="InvalidStateError"||e.type==="InvalidCharacterError"){this.logger.error(e);return false}else{throw e}}this.logger.log("DTMF sent via RTP: "+e.toString());return true};n.prototype.getDirection=function(){return this.direction};n.prototype.on=function(e,t){return s.prototype.on.call(this,e,t)};n.prototype.createOfferOrAnswer=function(e,t){var r=this;if(e===void 0){e={}}if(t===void 0){t=[]}var i=this.hasOffer("remote")?"createAnswer":"createOffer";var n=this.peerConnection;this.logger.log(i);return n[i](e).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+i+"Failed");r.emit("peerConnection-"+i+"Failed",t);throw t}).then(function(e){return u.Utils.reducePromises(t,r.createRTCSessionDescriptionInit(e))}).then(function(e){r.resetIceGatheringComplete();r.logger.log("Setting local sdp.");r.logger.log("sdp is "+e.sdp||false);return n.setLocalDescription(e)}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");r.emit("peerConnection-SetLocalDescriptionFailed",t);throw t}).then(function(){return r.waitForIceGatheringComplete()}).then(function(){var e=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return u.Utils.reducePromises(t,e)}).then(function(e){r.setDirection(e.sdp||"");return e}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);r.logger.error(t.toString());throw t})};n.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}};n.prototype.addDefaultIceCheckingTimeout=function(e){if(e.iceCheckingTimeout===undefined){e.iceCheckingTimeout=5e3}return e};n.prototype.addDefaultIceServers=function(e){if(!e.iceServers){e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]}return e};n.prototype.checkAndDefaultConstraints=function(e){var t={audio:true,video:!this.options.alwaysAcquireMediaFirst};e=e||t;if(Object.keys(e).length===0&&e.constructor===Object){return t}return e};n.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)};n.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)};n.prototype.initPeerConnection=function(e){var t=this;if(e===void 0){e={}}e=this.addDefaultIceCheckingTimeout(e);e.rtcConfiguration=e.rtcConfiguration||{};e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration);this.logger.log("initPeerConnection");if(this.peerConnection){this.logger.log("Already have a peer connection for this session. Tearing down.");this.resetIceGatheringComplete();this.peerConnection.close()}this.peerConnection=new this.WebRTC.RTCPeerConnection(e.rtcConfiguration);this.logger.log("New peer connection created");if("ontrack"in this.peerConnection){this.peerConnection.addEventListener("track",function(e){t.logger.log("track added");t.observer.trackAdded();t.emit("addTrack",e)})}else{this.logger.warn("Using onaddstream which is deprecated");this.peerConnection.onaddstream=function(e){t.logger.log("stream added");t.emit("addStream",e)}}this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e);if(e.candidate){t.logger.log("ICE candidate received: "+(e.candidate.candidate===null?null:e.candidate.candidate.trim()))}else if(e.candidate===null){t.logger.log("ICE candidate gathering complete");t.triggerIceGatheringComplete()}};this.peerConnection.onicegatheringstatechange=function(){t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState);switch(t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t);if(!t.iceGatheringTimer&&e.iceCheckingTimeout){t.iceGatheringTimeout=false;t.iceGatheringTimer=setTimeout(function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds");t.iceGatheringTimeout=true;t.triggerIceGatheringComplete()},e.iceCheckingTimeout)}break;case"complete":t.triggerIceGatheringComplete();break}};this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState);return}t.logger.log("ICE Connection State changed to "+e);t.emit(e,t)}};n.prototype.acquire=function(e){var i=this;e=this.checkAndDefaultConstraints(e);return new Promise(function(t,r){i.logger.log("acquiring local media");i.emit("userMediaRequest",e);if(e.audio||e.video){i.WebRTC.getUserMedia(e).then(function(e){i.observer.trackAdded();i.emit("userMedia",e);t(e)}).catch(function(e){i.emit("userMediaFailed",e);r(e)})}else{t([])}}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");i.logger.error(t.message);if(t.error){i.logger.error(t.error)}throw t}).then(function(e){i.logger.log("acquired local media streams");try{if(i.peerConnection.removeTrack){i.peerConnection.getSenders().forEach(function(e){i.peerConnection.removeTrack(e)})}return e}catch(e){return Promise.reject(e)}}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");i.logger.error(t.message);if(t.error){i.logger.error(t.error)}throw t}).then(function(e){try{e=[].concat(e);e.forEach(function(t){if(i.peerConnection.addTrack){t.getTracks().forEach(function(e){i.peerConnection.addTrack(e,t)})}else{i.peerConnection.addStream(t)}})}catch(e){return Promise.reject(e)}return Promise.resolve()}).catch(function(e){if(e.type===a.TypeStrings.SessionDescriptionHandlerError){throw e}var t=new f.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");i.logger.error(t.message);if(t.error){i.logger.error(t.error)}throw t})};n.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t};n.prototype.isIceGatheringComplete=function(){return this.peerConnection.iceGatheringState==="complete"||this.iceGatheringTimeout};n.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=false;this.logger.log("resetIceGatheringComplete");if(this.iceGatheringTimer){clearTimeout(this.iceGatheringTimer);this.iceGatheringTimer=undefined}if(this.iceGatheringDeferred){this.iceGatheringDeferred.reject();this.iceGatheringDeferred=undefined}};n.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(t===null){this.direction=this.C.DIRECTION.NULL;this.observer.directionChanged();return}var r=t[1];switch(r){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=r;break;default:this.direction=this.C.DIRECTION.NULL;break}this.observer.directionChanged()};n.prototype.triggerIceGatheringComplete=function(){if(this.isIceGatheringComplete()){this.emit("iceGatheringComplete",this);if(this.iceGatheringTimer){clearTimeout(this.iceGatheringTimer);this.iceGatheringTimer=undefined}if(this.iceGatheringDeferred){this.iceGatheringDeferred.resolve();this.iceGatheringDeferred=undefined}}};n.prototype.waitForIceGatheringComplete=function(){this.logger.log("waitForIceGatheringComplete");if(this.isIceGatheringComplete()){this.logger.log("ICE is already complete. Return resolved.");return Promise.resolve()}else if(!this.iceGatheringDeferred){this.iceGatheringDeferred=u.Utils.defer()}this.logger.log("ICE is not complete. Returning promise");return this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve()};return n}(t.EventEmitter);i.SessionDescriptionHandler=r}).call(this,n(1))},function(e,c,l){"use strict";(function(n){var t=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(c,"__esModule",{value:true});var s=l(0);var f=l(7);var o=l(8);var e=l(39);var r=l(3);var a;(function(e){e[e["STATUS_CONNECTING"]=0]="STATUS_CONNECTING";e[e["STATUS_OPEN"]=1]="STATUS_OPEN";e[e["STATUS_CLOSING"]=2]="STATUS_CLOSING";e[e["STATUS_CLOSED"]=3]="STATUS_CLOSED"})(a=c.TransportStatus||(c.TransportStatus={}));var u=function(e){var t=e*.8;return 1e3*(Math.random()*(e-t)+t)};var i=function(i){t(e,i);function e(e,t){if(t===void 0){t={}}var r=i.call(this,e,t)||this;r.WebSocket=(n.window||n).WebSocket;r.type=s.TypeStrings.Transport;r.reconnectionAttempts=0;r.status=a.STATUS_CONNECTING;r.configuration=r.loadConfig(t);r.server=r.configuration.wsServers[0];return r}e.prototype.isConnected=function(){return this.status===a.STATUS_OPEN};e.prototype.sendPromise=function(e,t){if(t===void 0){t={}}if(!this.statusAssert(a.STATUS_OPEN,t.force)){this.onError("unable to send message - WebSocket not open");return Promise.reject()}var r=e.toString();if(this.ws){if(this.configuration.traceSip===true){this.logger.log("sending WebSocket message:\n\n"+r+"\n")}this.ws.send(r);return Promise.resolve({msg:r})}else{this.onError("unable to send message - WebSocket does not exist");return Promise.reject()}};e.prototype.disconnectPromise=function(r){var i=this;if(r===void 0){r={}}if(this.disconnectionPromise){return this.disconnectionPromise}r.code=r.code||1e3;if(!this.statusTransition(a.STATUS_CLOSING,r.force)){if(this.status===a.STATUS_CLOSED){return Promise.resolve({overrideEvent:true})}else if(this.connectionPromise){return this.connectionPromise.then(function(){return Promise.reject("The websocket did not disconnect")}).catch(function(){return Promise.resolve({overrideEvent:true})})}else{return Promise.reject("The websocket did not disconnect")}}this.emit("disconnecting");this.disconnectionPromise=new Promise(function(e,t){i.disconnectDeferredResolve=e;if(i.reconnectTimer){clearTimeout(i.reconnectTimer);i.reconnectTimer=undefined}if(i.ws){i.stopSendingKeepAlives();i.logger.log("closing WebSocket "+i.server.wsUri);i.ws.close(r.code,r.reason)}else{t("Attempted to disconnect but the websocket doesn't exist")}});return this.disconnectionPromise};e.prototype.connectPromise=function(r){var i=this;if(r===void 0){r={}}if(this.status===a.STATUS_CLOSING&&!r.force){return Promise.reject("WebSocket "+this.server.wsUri+" is closing")}if(this.connectionPromise){return this.connectionPromise}this.server=this.server||this.getNextWsServer(r.force);this.connectionPromise=new Promise(function(e,t){if((i.status===a.STATUS_OPEN||i.status===a.STATUS_CLOSING)&&!r.force){i.logger.warn("WebSocket "+i.server.wsUri+" is already connected");t("Failed status check - attempted to open a connection but already open/closing");return}i.connectDeferredResolve=e;i.status=a.STATUS_CONNECTING;i.emit("connecting");i.logger.log("connecting to WebSocket "+i.server.wsUri);i.disposeWs();try{i.ws=new WebSocket(i.server.wsUri,"sip")}catch(e){i.ws=null;i.status=a.STATUS_CLOSED;i.onError("error connecting to WebSocket "+i.server.wsUri+":"+e);t("Failed to create a websocket");return}if(!i.ws){t("Unexpected instance websocket not set");return}i.connectionTimeout=setTimeout(function(){i.statusTransition(a.STATUS_CLOSED);i.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+i.configuration.connectionTimeout+"s");i.emit("disconnected",{code:1e3});i.connectionPromise=undefined;t("Connection timeout")},i.configuration.connectionTimeout*1e3);i.boundOnOpen=i.onOpen.bind(i);i.boundOnMessage=i.onMessage.bind(i);i.boundOnClose=i.onClose.bind(i);i.boundOnError=i.onWebsocketError.bind(i);i.ws.addEventListener("open",i.boundOnOpen);i.ws.addEventListener("message",i.boundOnMessage);i.ws.addEventListener("close",i.boundOnClose);i.ws.addEventListener("error",i.boundOnError)});return this.connectionPromise};e.prototype.onMessage=function(e){var t=e.data;var r;if(/^(\r\n)+$/.test(t)){this.clearKeepAliveTimeout();if(this.configuration.traceSip===true){this.logger.log("received WebSocket message with CRLF Keep Alive response")}return}else if(!t){this.logger.warn("received empty message, message discarded");return}else if(typeof t!=="string"){try{r=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded");return}if(this.configuration.traceSip===true){this.logger.log("received WebSocket binary message:\n\n"+t+"\n")}}else{if(this.configuration.traceSip===true){this.logger.log("received WebSocket text message:\n\n"+t+"\n")}r=t}this.emit("message",r)};e.prototype.onOpen=function(){if(this.status===a.STATUS_CLOSED){var e=this.ws;this.disposeWs();e.close(1e3);return}this.status=a.STATUS_OPEN;this.emit("connected");if(this.connectionTimeout){clearTimeout(this.connectionTimeout);this.connectionTimeout=undefined}this.logger.log("WebSocket "+this.server.wsUri+" connected");if(this.reconnectTimer!==undefined){clearTimeout(this.reconnectTimer);this.reconnectTimer=undefined}this.reconnectionAttempts=0;this.disconnectionPromise=undefined;this.disconnectDeferredResolve=undefined;this.startSendingKeepAlives();if(this.connectDeferredResolve){this.connectDeferredResolve({overrideEvent:true})}else{this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")}};e.prototype.onClose=function(e){this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")");if(this.status!==a.STATUS_CLOSING){this.logger.warn("WebSocket closed without SIP.js requesting it");this.emit("transportError")}this.stopSendingKeepAlives();if(this.connectionTimeout){clearTimeout(this.connectionTimeout)}this.connectionTimeout=undefined;this.connectionPromise=undefined;this.connectDeferredResolve=undefined;if(this.disconnectDeferredResolve){this.disconnectDeferredResolve({overrideEvent:true});this.statusTransition(a.STATUS_CLOSED);this.disconnectDeferredResolve=undefined;return}this.status=a.STATUS_CLOSED;this.emit("disconnected",{code:e.code,reason:e.reason});this.reconnect()};e.prototype.disposeWs=function(){if(this.ws){this.ws.removeEventListener("open",this.boundOnOpen);this.ws.removeEventListener("message",this.boundOnMessage);this.ws.removeEventListener("close",this.boundOnClose);this.ws.removeEventListener("error",this.boundOnError);this.ws=undefined}};e.prototype.onError=function(e){this.logger.warn("Transport error: "+e);this.emit("transportError")};e.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")};e.prototype.reconnect=function(){var e=this;if(this.reconnectionAttempts>0){this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed")}if(this.noAvailableServers()){this.logger.warn("attempted to get next ws server but there are no available ws servers left");this.logger.warn("no available ws servers left - going to closed state");this.status=a.STATUS_CLOSED;this.emit("closed");this.resetServerErrorStatus();return}if(this.isConnected()){this.logger.warn("attempted to reconnect while connected - forcing disconnect");this.disconnect({force:true})}this.reconnectionAttempts+=1;if(this.reconnectionAttempts>this.configuration.maxReconnectionAttempts){this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri);this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'");this.server.isError=true;this.emit("transportError");if(!this.noAvailableServers()){this.server=this.getNextWsServer()}this.reconnectionAttempts=0;this.reconnect()}else{this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")");this.reconnectTimer=setTimeout(function(){e.connect();e.reconnectTimer=undefined},this.reconnectionAttempts===1?0:this.configuration.reconnectionTimeout*1e3)}};e.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){var r=t[e];r.isError=false}};e.prototype.getNextWsServer=function(e){if(e===void 0){e=false}if(this.noAvailableServers()){this.logger.warn("attempted to get next ws server but there are no available ws servers left");throw new Error("Attempted to get next ws server, but there are no available ws servers left.")}var t=[];for(var r=0,i=this.configuration.wsServers;r<i.length;r++){var n=i[r];if(n.isError&&!e){continue}else if(t.length===0){t.push(n)}else if(n.weight>t[0].weight){t=[n]}else if(n.weight===t[0].weight){t.push(n)}}var s=Math.floor(Math.random()*t.length);return t[s]};e.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){var r=t[e];if(!r.isError){return false}}return true};e.prototype.sendKeepAlive=function(){var e=this;if(this.keepAliveDebounceTimeout){return}this.keepAliveDebounceTimeout=setTimeout(function(){e.emit("keepAliveDebounceTimeout");e.clearKeepAliveTimeout()},this.configuration.keepAliveDebounce*1e3);return this.send("\r\n\r\n")};e.prototype.clearKeepAliveTimeout=function(){if(this.keepAliveDebounceTimeout){clearTimeout(this.keepAliveDebounceTimeout)}this.keepAliveDebounceTimeout=undefined};e.prototype.startSendingKeepAlives=function(){var e=this;if(this.configuration.keepAliveInterval&&!this.keepAliveInterval){this.keepAliveInterval=setInterval(function(){e.sendKeepAlive();e.startSendingKeepAlives()},u(this.configuration.keepAliveInterval))}};e.prototype.stopSendingKeepAlives=function(){if(this.keepAliveInterval){clearInterval(this.keepAliveInterval)}if(this.keepAliveDebounceTimeout){clearTimeout(this.keepAliveDebounceTimeout)}this.keepAliveInterval=undefined;this.keepAliveDebounceTimeout=undefined};e.prototype.statusAssert=function(e,t){if(e===this.status){return true}else{if(t){this.logger.warn("Attempted to assert "+Object.keys(a)[this.status]+" as "+Object.keys(a)[e]+"- continuing with option: 'force'");return true}else{this.logger.warn("Tried to assert "+Object.keys(a)[e]+" but is currently "+Object.keys(a)[this.status]);return false}}};e.prototype.statusTransition=function(e,t){if(t===void 0){t=false}this.logger.log("Attempting to transition status from "+Object.keys(a)[this.status]+" to "+Object.keys(a)[e]);if(e===a.STATUS_CONNECTING&&this.statusAssert(a.STATUS_CLOSED,t)||e===a.STATUS_OPEN&&this.statusAssert(a.STATUS_CONNECTING,t)||e===a.STATUS_CLOSING&&this.statusAssert(a.STATUS_OPEN,t)||e===a.STATUS_CLOSED){this.status=e;return true}else{this.logger.warn("Status transition failed - result: no-op - reason:"+" either gave an nonexistent status or attempted illegal transition");return false}};e.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:false}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:false};var r=this.getConfigurationCheck();for(var i in r.mandatory){if(!e.hasOwnProperty(i)){throw new f.Exceptions.ConfigurationError(i)}else{var n=e[i];var s=r.mandatory[i](n);if(s!==undefined){t[i]=s}else{throw new f.Exceptions.ConfigurationError(i,n)}}}for(var i in r.optional){if(e.hasOwnProperty(i)){var n=e[i];if(n instanceof Array&&n.length===0||(n===null||n===""||n===undefined)||typeof n==="number"&&isNaN(n)){continue}var s=r.optional[i](n);if(s!==undefined){t[i]=s}else{throw new f.Exceptions.ConfigurationError(i,n)}}}var o={};for(var i in t){if(t.hasOwnProperty(i)){o[i]={value:t[i]}}}var a=Object.defineProperties({},o);this.logger.log("configuration parameters after validation:");for(var i in t){if(t.hasOwnProperty(i)){this.logger.log("· "+i+": "+JSON.stringify(t[i]))}}return a};e.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if(typeof e==="string"){e=[{wsUri:e}]}else if(e instanceof Array){for(var t=0;t<e.length;t++){if(typeof e[t]==="string"){e[t]={wsUri:e[t]}}}}else{return}if(e.length===0){return false}for(var r=0,i=e;r<i.length;r++){var n=i[r];if(!n.wsUri){return}if(n.weight&&!Number(n.weight)){return}var s=o.Grammar.parse(n.wsUri,"absoluteURI");if(s===-1){return}else if(["wss","ws","udp"].indexOf(s.scheme)<0){return}else{n.sipUri="<sip:"+s.host+(s.port?":"+s.port:"")+";transport="+s.scheme.replace(/^wss$/i,"ws")+";lr>";if(!n.weight){n.weight=0}n.isError=false;n.scheme=s.scheme.toUpperCase()}}return e},keepAliveInterval:function(e){if(r.Utils.isDecimal(e)){var t=Number(e);if(t>0){return t}}},keepAliveDebounce:function(e){if(r.Utils.isDecimal(e)){var t=Number(e);if(t>0){return t}}},traceSip:function(e){if(typeof e==="boolean"){return e}},connectionTimeout:function(e){if(r.Utils.isDecimal(e)){var t=Number(e);if(t>0){return t}}},maxReconnectionAttempts:function(e){if(r.Utils.isDecimal(e)){var t=Number(e);if(t>=0){return t}}},reconnectionTimeout:function(e){if(r.Utils.isDecimal(e)){var t=Number(e);if(t>0){return t}}}}}};e.C=a;return e}(e.Transport);c.Transport=i}).call(this,l(1))},function(e,t,r){"use strict";e.exports=function e(i,n){return function e(){var t=new Array(arguments.length);for(var r=0;r<t.length;r++){t[r]=arguments[r]}return i.apply(n,t)}}},function(e,t,d){"use strict";var p=d(5);var v=d(73);var g=d(75);var m=d(76);var y=d(77);var T=d(45);var C=typeof window!=="undefined"&&window.btoa&&window.btoa.bind(window)||d(78);e.exports=function e(h){return new Promise(function e(n,s){var i=h.data;var o=h.headers;if(p.isFormData(i)){delete o["Content-Type"]}var a=new XMLHttpRequest;var t="onreadystatechange";var f=false;if(true&&typeof window!=="undefined"&&window.XDomainRequest&&!("withCredentials"in a)&&!y(h.url)){a=new window.XDomainRequest;t="onload";f=true;a.onprogress=function e(){};a.ontimeout=function e(){}}if(h.auth){var r=h.auth.username||"";var u=h.auth.password||"";o.Authorization="Basic "+C(r+":"+u)}a.open(h.method.toUpperCase(),g(h.url,h.params,h.paramsSerializer),true);a.timeout=h.timeout;a[t]=function e(){if(!a||a.readyState!==4&&!f){return}if(a.status===0&&!(a.responseURL&&a.responseURL.indexOf("file:")===0)){return}var t="getAllResponseHeaders"in a?m(a.getAllResponseHeaders()):null;var r=!h.responseType||h.responseType==="text"?a.responseText:a.response;var i={data:r,status:a.status===1223?204:a.status,statusText:a.status===1223?"No Content":a.statusText,headers:t,config:h,request:a};v(n,s,i);a=null};a.onerror=function e(){s(T("Network Error",h,null,a));a=null};a.ontimeout=function e(){s(T("timeout of "+h.timeout+"ms exceeded",h,"ECONNABORTED",a));a=null};if(p.isStandardBrowserEnv()){var c=d(79);var l=(h.withCredentials||y(h.url))&&h.xsrfCookieName?c.read(h.xsrfCookieName):undefined;if(l){o[h.xsrfHeaderName]=l}}if("setRequestHeader"in a){p.forEach(o,function e(t,r){if(typeof i==="undefined"&&r.toLowerCase()==="content-type"){delete o[r]}else{a.setRequestHeader(r,t)}})}if(h.withCredentials){a.withCredentials=true}if(h.responseType){try{a.responseType=h.responseType}catch(e){if(h.responseType!=="json"){throw e}}}if(typeof h.onDownloadProgress==="function"){a.addEventListener("progress",h.onDownloadProgress)}if(typeof h.onUploadProgress==="function"&&a.upload){a.upload.addEventListener("progress",h.onUploadProgress)}if(h.cancelToken){h.cancelToken.promise.then(function e(t){if(!a){return}a.abort();s(t);a=null})}if(i===undefined){i=null}a.send(i)})}},function(e,t,r){"use strict";var a=r(74);e.exports=function e(t,r,i,n,s){var o=new Error(t);return a(o,r,i,n,s)}},function(e,t,r){"use strict";e.exports=function e(t){return!!(t&&t.__CANCEL__)}},function(e,t,r){"use strict";function i(e){this.message=e}i.prototype.toString=function e(){return"Cancel"+(this.message?": "+this.message:"")};i.prototype.__CANCEL__=true;e.exports=i},function(e,t){var f=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var u=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function e(t){var r=t,i=t.indexOf("["),n=t.indexOf("]");if(i!=-1&&n!=-1){t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length)}var s=f.exec(t||""),o={},a=14;while(a--){o[u[a]]=s[a]||""}if(i!=-1&&n!=-1){o.source=r;o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":");o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":");o.ipv6uri=true}return o}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){e.deprecate=function(){};e.paths=[];if(!e.children)e.children=[];Object.defineProperty(e,"loaded",{enumerable:true,get:function(){return e.l}});Object.defineProperty(e,"id",{enumerable:true,get:function(){return e.i}});e.webpackPolyfill=1}return e}},function(e,t){e.exports=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"}},function(r,e,t){(function(t){r.exports=e;function e(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,t(1))},function(e,t,r){var f=r(97);var s=r(58);var i=r(13);var n=r(26);var u=r(59);var o=r(60);var c=r(18)("socket.io-client:manager");var a=r(57);var l=r(115);var h=Object.prototype.hasOwnProperty;e.exports=d;function d(e,t){if(!(this instanceof d))return new d(e,t);if(e&&"object"===typeof e){t=e;e=undefined}t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==false);this.reconnectionAttempts(t.reconnectionAttempts||Infinity);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=e;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new n.Encoder;this.decoder=new n.Decoder;this.autoConnect=t.autoConnect!==false;if(this.autoConnect)this.open()}d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps){if(h.call(this.nsps,e)){this.nsps[e].emit.apply(this.nsps[e],arguments)}}};d.prototype.updateSocketIds=function(){for(var e in this.nsps){if(h.call(this.nsps,e)){this.nsps[e].id=this.engine.id}}};i(d.prototype);d.prototype.reconnection=function(e){if(!arguments.length)return this._reconnection;this._reconnection=!!e;return this};d.prototype.reconnectionAttempts=function(e){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=e;return this};d.prototype.reconnectionDelay=function(e){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=e;this.backoff&&this.backoff.setMin(e);return this};d.prototype.randomizationFactor=function(e){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=e;this.backoff&&this.backoff.setJitter(e);return this};d.prototype.reconnectionDelayMax=function(e){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=e;this.backoff&&this.backoff.setMax(e);return this};d.prototype.timeout=function(e){if(!arguments.length)return this._timeout;this._timeout=e;return this};d.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};d.prototype.open=d.prototype.connect=function(r,e){c("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;c("opening %s",this.uri);this.engine=f(this.uri,this.opts);var t=this.engine;var i=this;this.readyState="opening";this.skipReconnect=false;var n=u(t,"open",function(){i.onopen();r&&r()});var s=u(t,"error",function(e){c("connect_error");i.cleanup();i.readyState="closed";i.emitAll("connect_error",e);if(r){var t=new Error("Connection error");t.data=e;r(t)}else{i.maybeReconnectOnOpen()}});if(false!==this._timeout){var o=this._timeout;c("connect attempt will timeout after %d",o);var a=setTimeout(function(){c("connect attempt timed out after %d",o);n.destroy();t.close();t.emit("error","timeout");i.emitAll("connect_timeout",o)},o);this.subs.push({destroy:function(){clearTimeout(a)}})}this.subs.push(n);this.subs.push(s);return this};d.prototype.onopen=function(){c("open");this.cleanup();this.readyState="open";this.emit("open");var e=this.engine;this.subs.push(u(e,"data",o(this,"ondata")));this.subs.push(u(e,"ping",o(this,"onping")));this.subs.push(u(e,"pong",o(this,"onpong")));this.subs.push(u(e,"error",o(this,"onerror")));this.subs.push(u(e,"close",o(this,"onclose")));this.subs.push(u(this.decoder,"decoded",o(this,"ondecoded")))};d.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};d.prototype.ondata=function(e){this.decoder.add(e)};d.prototype.ondecoded=function(e){this.emit("packet",e)};d.prototype.onerror=function(e){c("error",e);this.emitAll("error",e)};d.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new s(this,e,t);this.nsps[e]=r;var i=this;r.on("connecting",n);r.on("connect",function(){r.id=i.engine.id});if(this.autoConnect){n()}}function n(){if(!~a(i.connecting,r)){i.connecting.push(r)}}return r};d.prototype.destroy=function(e){var t=a(this.connecting,e);if(~t)this.connecting.splice(t,1);if(this.connecting.length)return;this.close()};d.prototype.packet=function(r){c("writing packet %j",r);var i=this;if(r.query&&r.type===0)r.nsp+="?"+r.query;if(!i.encoding){i.encoding=true;this.encoder.encode(r,function(e){for(var t=0;t<e.length;t++){i.engine.write(e[t],r.options)}i.encoding=false;i.processPacketQueue()})}else{i.packetBuffer.push(r)}};d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}};d.prototype.cleanup=function(){c("cleanup");var e=this.subs.length;for(var t=0;t<e;t++){var r=this.subs.shift();r.destroy()}this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};d.prototype.close=d.prototype.disconnect=function(){c("disconnect");this.skipReconnect=true;this.reconnecting=false;if("opening"===this.readyState){this.cleanup()}this.backoff.reset();this.readyState="closed";if(this.engine)this.engine.close()};d.prototype.onclose=function(e){c("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",e);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts){c("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var e=this.backoff.duration();c("will wait %dms before reconnect attempt",e);this.reconnecting=true;var r=setTimeout(function(){if(t.skipReconnect)return;c("attempting reconnect");t.emitAll("reconnect_attempt",t.backoff.attempts);t.emitAll("reconnecting",t.backoff.attempts);if(t.skipReconnect)return;t.open(function(e){if(e){c("reconnect attempt error");t.reconnecting=false;t.reconnect();t.emitAll("reconnect_error",e.data)}else{c("reconnect success");t.onreconnect()}})},e);this.subs.push({destroy:function(){clearTimeout(r)}})}};d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",e)}},function(e,r,i){(function(a){var f=i(27);var u=i(101);var c=i(110);var e=i(111);r.polling=t;r.websocket=e;function t(e){var t;var r=false;var i=false;var n=false!==e.jsonp;if(a.location){var s="https:"===location.protocol;var o=location.port;if(!o){o=s?443:80}r=e.hostname!==location.hostname||o!==e.port;i=e.secure!==s}e.xdomain=r;e.xscheme=i;t=new f(e);if("open"in t&&!e.forceJSONP){return new u(e)}else{if(!n)throw new Error("JSONP disabled");return new c(e)}}}).call(this,i(1))},function(e,t,r){var i=r(28);var n=r(29);var s=r(12);var o=r(19);var a=r(56);var f=r(20)("engine.io-client:polling");e.exports=c;var u=function(){var e=r(27);var t=new e({xdomain:false});return null!=t.responseType}();function c(e){var t=e&&e.forceBase64;if(!u||t){this.supportsBinary=false}i.call(this,e)}o(c,i);c.prototype.name="polling";c.prototype.doOpen=function(){this.poll()};c.prototype.pause=function(e){var t=this;this.readyState="pausing";function r(){f("paused");t.readyState="paused";e()}if(this.polling||!this.writable){var i=0;if(this.polling){f("we are currently polling - waiting to pause");i++;this.once("pollComplete",function(){f("pre-pause polling complete");--i||r()})}if(!this.writable){f("we are currently writing - waiting to pause");i++;this.once("drain",function(){f("pre-pause writing complete");--i||r()})}}else{r()}};c.prototype.poll=function(){f("polling");this.polling=true;this.doPoll();this.emit("poll")};c.prototype.onData=function(e){var i=this;f("polling got data %s",e);var t=function(e,t,r){if("opening"===i.readyState){i.onOpen()}if("close"===e.type){i.onClose();return false}i.onPacket(e)};s.decodePayload(e,this.socket.binaryType,t);if("closed"!==this.readyState){this.polling=false;this.emit("pollComplete");if("open"===this.readyState){this.poll()}else{f('ignoring poll - transport state "%s"',this.readyState)}}};c.prototype.doClose=function(){var e=this;function t(){f("writing close packet");e.write([{type:"close"}])}if("open"===this.readyState){f("transport open - closing");t()}else{f("transport not open - deferring close");this.once("open",t)}};c.prototype.write=function(e){var t=this;this.writable=false;var r=function(){t.writable=true;t.emit("drain")};s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})};c.prototype.uri=function(){var e=this.query||{};var t=this.secure?"https":"http";var r="";if(false!==this.timestampRequests){e[this.timestampParam]=a()}if(!this.supportsBinary&&!e.sid){e.b64=1}e=n.encode(e);if(this.port&&("https"===t&&Number(this.port)!==443||"http"===t&&Number(this.port)!==80)){r=":"+this.port}if(e.length){e="?"+e}var i=this.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(t,e,r){(function(n){var s=r(50);t.exports=e;function e(e){function i(e){if(!e)return false;if(n.Buffer&&n.Buffer.isBuffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File){return true}if(s(e)){for(var t=0;t<e.length;t++){if(i(e[t])){return true}}}else if(e&&"object"==typeof e){if(e.toJSON&&"function"==typeof e.toJSON){e=e.toJSON()}for(var r in e){if(Object.prototype.hasOwnProperty.call(e,r)&&i(e[r])){return true}}}return false}return i(e)}}).call(this,r(1))},function(e,t,r){"use strict";var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),n=64,s={},o=0,a=0,f;function u(e){var t="";do{t=i[e%n]+t;e=Math.floor(e/n)}while(e>0);return t}function c(e){var t=0;for(a=0;a<e.length;a++){t=t*n+s[e.charAt(a)]}return t}function l(){var e=u(+new Date);if(e!==f)return o=0,f=e;return e+"."+u(o++)}for(;a<n;a++)s[i[a]]=a;l.encode=u;l.decode=c;e.exports=l},function(e,t){var i=[].indexOf;e.exports=function(e,t){if(i)return e.indexOf(t);for(var r=0;r<e.length;++r){if(e[r]===t)return r}return-1}},function(e,t,r){var s=r(26);var i=r(13);var o=r(114);var n=r(59);var a=r(60);var f=r(18)("socket.io-client:socket");var u=r(55);e.exports=t=h;var c={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var l=i.prototype.emit;function h(e,t,r){this.io=e;this.nsp=t;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(r&&r.query){this.query=r.query}if(this.io.autoConnect)this.open()}i(h.prototype);h.prototype.subEvents=function(){if(this.subs)return;var e=this.io;this.subs=[n(e,"open",a(this,"onopen")),n(e,"packet",a(this,"onpacket")),n(e,"close",a(this,"onclose"))]};h.prototype.open=h.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"===this.io.readyState)this.onopen();this.emit("connecting");return this};h.prototype.send=function(){var e=o(arguments);e.unshift("message");this.emit.apply(this,e);return this};h.prototype.emit=function(e){if(c.hasOwnProperty(e)){l.apply(this,arguments);return this}var t=o(arguments);var r=s.EVENT;if(u(t)){r=s.BINARY_EVENT}var i={type:r,data:t};i.options={};i.options.compress=!this.flags||false!==this.flags.compress;if("function"===typeof t[t.length-1]){f("emitting packet with ack id %d",this.ids);this.acks[this.ids]=t.pop();i.id=this.ids++}if(this.connected){this.packet(i)}else{this.sendBuffer.push(i)}delete this.flags;return this};h.prototype.packet=function(e){e.nsp=this.nsp;this.io.packet(e)};h.prototype.onopen=function(){f("transport is open - connecting");if("/"!==this.nsp){if(this.query){this.packet({type:s.CONNECT,query:this.query})}else{this.packet({type:s.CONNECT})}}};h.prototype.onclose=function(e){f("close (%s)",e);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",e)};h.prototype.onpacket=function(e){if(e.nsp!==this.nsp)return;switch(e.type){case s.CONNECT:this.onconnect();break;case s.EVENT:this.onevent(e);break;case s.BINARY_EVENT:this.onevent(e);break;case s.ACK:this.onack(e);break;case s.BINARY_ACK:this.onack(e);break;case s.DISCONNECT:this.ondisconnect();break;case s.ERROR:this.emit("error",e.data);break}};h.prototype.onevent=function(e){var t=e.data||[];f("emitting event %j",t);if(null!=e.id){f("attaching ack callback to event");t.push(this.ack(e.id))}if(this.connected){l.apply(this,t)}else{this.receiveBuffer.push(t)}};h.prototype.ack=function(r){var i=this;var n=false;return function(){if(n)return;n=true;var e=o(arguments);f("sending ack %j",e);var t=u(e)?s.BINARY_ACK:s.ACK;i.packet({type:t,id:r,data:e})}};h.prototype.onack=function(e){var t=this.acks[e.id];if("function"===typeof t){f("calling ack %s with %j",e.id,e.data);t.apply(this,e.data);delete this.acks[e.id]}else{f("bad ack %s",e.id)}};h.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};h.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++){l.apply(this,this.receiveBuffer[e])}this.receiveBuffer=[];for(e=0;e<this.sendBuffer.length;e++){this.packet(this.sendBuffer[e])}this.sendBuffer=[]};h.prototype.ondisconnect=function(){f("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};h.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++){this.subs[e].destroy()}this.subs=null}this.io.destroy(this)};h.prototype.close=h.prototype.disconnect=function(){if(this.connected){f("performing disconnect (%s)",this.nsp);this.packet({type:s.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this};h.prototype.compress=function(e){this.flags=this.flags||{};this.flags.compress=e;return this}},function(e,t){e.exports=r;function r(e,t,r){e.on(t,r);return{destroy:function(){e.removeListener(t,r)}}}},function(e,t){var i=[].slice;e.exports=function(e,t){if("string"==typeof t)t=e[t];if("function"!=typeof t)throw new Error("bind() requires a function");var r=i.call(arguments,2);return function(){return t.apply(e,r.concat(i.call(arguments)))}}},function(e,t,r){var u=r(87);var i=r(26);var c=r(52);var l=r(18)("socket.io-client");e.exports=t=n;var h=t.managers={};function n(e,t){if(typeof e==="object"){t=e;e=undefined}t=t||{};var r=u(e);var i=r.source;var n=r.id;var s=r.path;var o=h[n]&&s in h[n].nsps;var a=t.forceNew||t["force new connection"]||false===t.multiplex||o;var f;if(a){l("ignoring socket cache for %s",i);f=c(i,t)}else{if(!h[n]){l("new io instance for %s",i);h[n]=c(i,t)}f=h[n]}if(r.query&&!t.query){t.query=r.query}else if(t&&"object"===typeof t.query){t.query=d(t.query)}return f.socket(r.path,t)}function d(e){var t=[];for(var r in e){if(e.hasOwnProperty(r)){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]))}}return t.join("&")}t.protocol=i.protocol;t.connect=n;t.Manager=r(52);t.Socket=r(58)},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var yl=r(31);var Tl=r(17);var Cl=function(s){i(o,s);function o(e,t,r,i){var n=s.call(this)||this;n.message=e;n.expected=t;n.found=r;n.location=i;n.name="SyntaxError";if(typeof Error.captureStackTrace==="function"){Error.captureStackTrace(n,o)}return n}o.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function s(e){switch(e.type){case"literal":return'"'+i(e.text)+'"';case"class":var t=e.parts.map(function(e){return Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)});return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}function o(e){var t=e.map(s);var r;var i;t.sort();if(t.length>0){for(r=1,i=1;r<t.length;r++){if(t[r-1]!==t[r]){t[i]=t[r];i++}}t.length=i}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}function a(e){return e?'"'+i(e)+'"':"end of input"}return"Expected "+o(e)+" but "+a(t)+" found."};return o}(Error);t.SyntaxError=Cl;function n(v,r){r=r!==undefined?r:{};var g={};var e={Contact:uu,Name_Addr_Header:Vu,Record_Route:hc,Request_Response:Ef,SIP_URI:ja,Subscription_State:Ac,Supported:_c,Require:yc,Via:Nc,absoluteURI:If,Call_ID:fu,Content_Disposition:Cu,Content_Length:Eu,Content_Type:Ru,CSeq:Hu,displayName:hu,Event:Mu,From:Bu,host:$a,Max_Forwards:Wu,Min_SE:$c,Proxy_Authenticate:Yu,quoted_string:La,Refer_To:pc,Replaces:vc,Session_Expires:Vc,stun_URI:Zc,To:Ic,turn_URI:sl,uuid:fl,WWW_Authenticate:Kc,challenge:zu,sipfrag:hl,Referred_By:dl};var t=uu;var i="\r\n";var n=Bo("\r\n",false);var s=/^[0-9]/;var o=jo([["0","9"]],false,false);var a=/^[a-zA-Z]/;var f=jo([["a","z"],["A","Z"]],false,false);var u=/^[0-9a-fA-F]/;var c=jo([["0","9"],["a","f"],["A","F"]],false,false);var l=/^[\0-\xFF]/;var h=jo([["\0","ÿ"]],false,false);var d=/^["]/;var p=jo(['"'],false,false);var m=" ";var y=Bo(" ",false);var T="\t";var C=Bo("\t",false);var S=/^[a-zA-Z0-9]/;var A=jo([["a","z"],["A","Z"],["0","9"]],false,false);var b=";";var w=Bo(";",false);var E="/";var R=Bo("/",false);var _="?";var I=Bo("?",false);var O=":";var N=Bo(":",false);var D="@";var x=Bo("@",false);var k="&";var U=Bo("&",false);var P="=";var H=Bo("=",false);var L="+";var q=Bo("+",false);var M="$";var F=Bo("$",false);var B=",";var j=Bo(",",false);var G="-";var W=Bo("-",false);var K="_";var V=Bo("_",false);var Y=".";var z=Bo(".",false);var $="!";var J=Bo("!",false);var X="~";var Q=Bo("~",false);var Z="*";var ee=Bo("*",false);var te="'";var re=Bo("'",false);var ie="(";var ne=Bo("(",false);var se=")";var oe=Bo(")",false);var ae="%";var fe=Bo("%",false);var ue=function(){return" "};var ce=function(){return":"};var le=/^[!-~]/;var he=jo([["!","~"]],false,false);var de=/^[\x80-\uFFFF]/;var pe=jo([["","￿"]],false,false);var ve=/^[\x80-\xBF]/;var ge=jo([["","¿"]],false,false);var me=/^[a-f]/;var ye=jo([["a","f"]],false,false);var Te="`";var Ce=Bo("`",false);var Se="<";var Ae=Bo("<",false);var be=">";var we=Bo(">",false);var Ee="\\";var Re=Bo("\\",false);var _e="[";var Ie=Bo("[",false);var Oe="]";var Ne=Bo("]",false);var De="{";var xe=Bo("{",false);var ke="}";var Ue=Bo("}",false);var Pe=function(){return"*"};var He=function(){return"/"};var Le=function(){return"="};var qe=function(){return"("};var Me=function(){return")"};var Fe=function(){return">"};var Be=function(){return"<"};var je=function(){return","};var Ge=function(){return";"};var We=function(){return":"};var Ke=function(){return'"'};var Ve=/^[!-']/;var Ye=jo([["!","'"]],false,false);var ze=/^[*-[]/;var $e=jo([["*","["]],false,false);var Je=/^[\]-~]/;var Xe=jo([["]","~"]],false,false);var Qe=function(e){return e};var Ze=/^[#-[]/;var et=jo([["#","["]],false,false);var tt=/^[\0-\t]/;var rt=jo([["\0","\t"]],false,false);var it=/^[\x0B-\f]/;var nt=jo([["\v","\f"]],false,false);var st=/^[\x0E-\x7F]/;var ot=jo([["",""]],false,false);var at=function(){r=r||{data:{}};r.data.uri=new Tl.URI(r.data.scheme,r.data.user,r.data.host,r.data.port);delete r.data.scheme;delete r.data.user;delete r.data.host;delete r.data.host_type;delete r.data.port};var ft=function(){r=r||{data:{}};r.data.uri=new Tl.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers);delete r.data.scheme;delete r.data.user;delete r.data.host;delete r.data.host_type;delete r.data.port;delete r.data.uri_params;if(r.startRule==="SIP_URI"){r.data=r.data.uri}};var ut="sips";var ct=Bo("sips",true);var lt="sip";var ht=Bo("sip",true);var dt=function(e){r=r||{data:{}};r.data.scheme=e};var pt=function(){r=r||{data:{}};r.data.user=decodeURIComponent(Lo().slice(0,-1))};var vt=function(){r=r||{data:{}};r.data.password=Lo()};var gt=function(){r=r||{data:{}};r.data.host=Lo();return r.data.host};var mt=function(){r=r||{data:{}};r.data.host_type="domain";return Lo()};var yt=/^[a-zA-Z0-9_\-]/;var Tt=jo([["a","z"],["A","Z"],["0","9"],"_","-"],false,false);var Ct=/^[a-zA-Z0-9\-]/;var St=jo([["a","z"],["A","Z"],["0","9"],"-"],false,false);var At=function(){r=r||{data:{}};r.data.host_type="IPv6";return Lo()};var bt="::";var wt=Bo("::",false);var Et=function(){r=r||{data:{}};r.data.host_type="IPv6";return Lo()};var Rt=function(){r=r||{data:{}};r.data.host_type="IPv4";return Lo()};var _t="25";var It=Bo("25",false);var Ot=/^[0-5]/;var Nt=jo([["0","5"]],false,false);var Dt="2";var xt=Bo("2",false);var kt=/^[0-4]/;var Ut=jo([["0","4"]],false,false);var Pt="1";var Ht=Bo("1",false);var Lt=/^[1-9]/;var qt=jo([["1","9"]],false,false);var Mt=function(e){r=r||{data:{}};e=parseInt(e.join(""));r.data.port=e;return e};var Ft="transport=";var Bt=Bo("transport=",true);var jt="udp";var Gt=Bo("udp",true);var Wt="tcp";var Kt=Bo("tcp",true);var Vt="sctp";var Yt=Bo("sctp",true);var zt="tls";var $t=Bo("tls",true);var Jt=function(e){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};r.data.uri_params["transport"]=e.toLowerCase()};var Xt="user=";var Qt=Bo("user=",true);var Zt="phone";var er=Bo("phone",true);var tr="ip";var rr=Bo("ip",true);var ir=function(e){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};r.data.uri_params["user"]=e.toLowerCase()};var nr="method=";var sr=Bo("method=",true);var or=function(e){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};r.data.uri_params["method"]=e};var ar="ttl=";var fr=Bo("ttl=",true);var ur=function(e){r=r||{data:{}};if(!r.data.params)r.data.params={};r.data.params["ttl"]=e};var cr="maddr=";var lr=Bo("maddr=",true);var hr=function(e){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};r.data.uri_params["maddr"]=e};var dr="lr";var pr=Bo("lr",true);var vr=function(){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};r.data.uri_params["lr"]=undefined};var gr=function(e,t){r=r||{data:{}};if(!r.data.uri_params)r.data.uri_params={};if(t===null){t=undefined}else{t=t[1]}r.data.uri_params[e.toLowerCase()]=t};var mr=function(e,t){e=e.join("").toLowerCase();t=t.join("");r=r||{data:{}};if(!r.data.uri_headers)r.data.uri_headers={};if(!r.data.uri_headers[e]){r.data.uri_headers[e]=[t]}else{r.data.uri_headers[e].push(t)}};var yr=function(){r=r||{data:{}};if(r.startRule==="Refer_To"){r.data.uri=new Tl.URI(r.data.scheme,r.data.user,r.data.host,r.data.port,r.data.uri_params,r.data.uri_headers);delete r.data.scheme;delete r.data.user;delete r.data.host;delete r.data.host_type;delete r.data.port;delete r.data.uri_params}};var Tr="//";var Cr=Bo("//",false);var Sr=function(){r=r||{data:{}};r.data.scheme=Lo()};var Ar=Bo("SIP",true);var br=function(){r=r||{data:{}};r.data.sip_version=Lo()};var wr="INVITE";var Er=Bo("INVITE",false);var Rr="ACK";var _r=Bo("ACK",false);var Ir="VXACH";var Or=Bo("VXACH",false);var Nr="OPTIONS";var Dr=Bo("OPTIONS",false);var xr="BYE";var kr=Bo("BYE",false);var Ur="CANCEL";var Pr=Bo("CANCEL",false);var Hr="REGISTER";var Lr=Bo("REGISTER",false);var qr="SUBSCRIBE";var Mr=Bo("SUBSCRIBE",false);var Fr="NOTIFY";var Br=Bo("NOTIFY",false);var jr="REFER";var Gr=Bo("REFER",false);var Wr="PUBLISH";var Kr=Bo("PUBLISH",false);var Vr=function(){r=r||{data:{}};r.data.method=Lo();return r.data.method};var Yr=function(e){r=r||{data:{}};r.data.status_code=parseInt(e.join(""))};var zr=function(){r=r||{data:{}};r.data.reason_phrase=Lo()};var $r=function(){r=r||{data:{}};r.data=Lo()};var Jr=function(){var e,t;r=r||{data:{}};t=r.data.multi_header.length;for(e=0;e<t;e++){if(r.data.multi_header[e].parsed===null){r.data=null;break}}if(r.data!==null){r.data=r.data.multi_header}else{r.data=-1}};var Xr=function(){var t;r=r||{data:{}};if(!r.data.multi_header)r.data.multi_header=[];try{t=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params);delete r.data.uri;delete r.data.displayName;delete r.data.params}catch(e){t=null}r.data.multi_header.push({position:No,offset:qo().start.offset,parsed:t})};var Qr=function(e){e=Lo().trim();if(e[0]==='"'){e=e.substring(1,e.length-1)}r=r||{data:{}};r.data.displayName=e};var Zr="q";var ei=Bo("q",true);var ti=function(e){r=r||{data:{}};if(!r.data.params)r.data.params={};r.data.params["q"]=e};var ri="expires";var ii=Bo("expires",true);var ni=function(e){r=r||{data:{}};if(!r.data.params)r.data.params={};r.data.params["expires"]=e};var si=function(e){return parseInt(e.join(""))};var oi="0";var ai=Bo("0",false);var fi=function(){return parseFloat(Lo())};var ui=function(e,t){r=r||{data:{}};if(!r.data.params)r.data.params={};if(t===null){t=undefined}else{t=t[1]}r.data.params[e.toLowerCase()]=t};var ci="render";var li=Bo("render",true);var hi="session";var di=Bo("session",true);var pi="icon";var vi=Bo("icon",true);var gi="alert";var mi=Bo("alert",true);var yi=function(){r=r||{data:{}};if(r.startRule==="Content_Disposition"){r.data.type=Lo().toLowerCase()}};var Ti="handling";var Ci=Bo("handling",true);var Si="optional";var Ai=Bo("optional",true);var bi="required";var wi=Bo("required",true);var Ei=function(e){r=r||{data:{}};r.data=parseInt(e.join(""))};var Ri=function(){r=r||{data:{}};r.data=Lo()};var _i="text";var Ii=Bo("text",true);var Oi="image";var Ni=Bo("image",true);var Di="audio";var xi=Bo("audio",true);var ki="video";var Ui=Bo("video",true);var Pi="application";var Hi=Bo("application",true);var Li="message";var qi=Bo("message",true);var Mi="multipart";var Fi=Bo("multipart",true);var Bi="x-";var ji=Bo("x-",true);var Gi=function(e){r=r||{data:{}};r.data.value=parseInt(e.join(""))};var Wi=function(e){r=r||{data:{}};r.data=e};var Ki=function(e){r=r||{data:{}};r.data.event=e.toLowerCase()};var Vi=function(){r=r||{data:{}};var e=r.data.tag;r.data=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params);if(e){r.data.setParam("tag",e)}};var Yi="tag";var zi=Bo("tag",true);var $i=function(e){r=r||{data:{}};r.data.tag=e};var Ji=function(e){r=r||{data:{}};r.data=parseInt(e.join(""))};var Xi=function(e){r=r||{data:{}};r.data=e};var Qi=function(){r=r||{data:{}};r.data=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)};var Zi="digest";var en=Bo("Digest",true);var tn="realm";var rn=Bo("realm",true);var nn=function(e){r=r||{data:{}};r.data.realm=e};var sn="domain";var on=Bo("domain",true);var an="nonce";var fn=Bo("nonce",true);var un=function(e){r=r||{data:{}};r.data.nonce=e};var cn="opaque";var ln=Bo("opaque",true);var hn=function(e){r=r||{data:{}};r.data.opaque=e};var dn="stale";var pn=Bo("stale",true);var vn="true";var gn=Bo("true",true);var mn=function(){r=r||{data:{}};r.data.stale=true};var yn="false";var Tn=Bo("false",true);var Cn=function(){r=r||{data:{}};r.data.stale=false};var Sn="algorithm";var An=Bo("algorithm",true);var bn="md5";var wn=Bo("MD5",true);var En="md5-sess";var Rn=Bo("MD5-sess",true);var _n=function(e){r=r||{data:{}};r.data.algorithm=e.toUpperCase()};var In="qop";var On=Bo("qop",true);var Nn="auth-int";var Dn=Bo("auth-int",true);var xn="auth";var kn=Bo("auth",true);var Un=function(e){r=r||{data:{}};r.data.qop||(r.data.qop=[]);r.data.qop.push(e.toLowerCase())};var Pn=function(e){r=r||{data:{}};r.data.value=parseInt(e.join(""))};var Hn=function(){var e,t;r=r||{data:{}};t=r.data.multi_header.length;for(e=0;e<t;e++){if(r.data.multi_header[e].parsed===null){r.data=null;break}}if(r.data!==null){r.data=r.data.multi_header}else{r.data=-1}};var Ln=function(){var t;r=r||{data:{}};if(!r.data.multi_header)r.data.multi_header=[];try{t=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params);delete r.data.uri;delete r.data.displayName;delete r.data.params}catch(e){t=null}r.data.multi_header.push({position:No,offset:qo().start.offset,parsed:t})};var qn=function(){r=r||{data:{}};r.data=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params)};var Mn=function(){r=r||{data:{}};if(!(r.data.replaces_from_tag&&r.data.replaces_to_tag)){r.data=-1}};var Fn=function(){r=r||{data:{}};r.data={call_id:r.data}};var Bn="from-tag";var jn=Bo("from-tag",true);var Gn=function(e){r=r||{data:{}};r.data.replaces_from_tag=e};var Wn="to-tag";var Kn=Bo("to-tag",true);var Vn=function(e){r=r||{data:{}};r.data.replaces_to_tag=e};var Yn="early-only";var zn=Bo("early-only",true);var $n=function(){r=r||{data:{}};r.data.early_only=true};var Jn=function(e,t){return t};var Xn=function(e,t){return ml(e,t)};var Qn=function(e){r=r||{data:{}};if(r.startRule==="Require"){r.data=e||[]}};var Zn=function(e){r=r||{data:{}};r.data.value=parseInt(e.join(""))};var es="active";var ts=Bo("active",true);var rs="pending";var is=Bo("pending",true);var ns="terminated";var ss=Bo("terminated",true);var os=function(){r=r||{data:{}};r.data.state=Lo()};var as="reason";var fs=Bo("reason",true);var us=function(e){r=r||{data:{}};if(typeof e!=="undefined")r.data.reason=e};var cs=function(e){r=r||{data:{}};if(typeof e!=="undefined")r.data.expires=e};var ls="retry_after";var hs=Bo("retry_after",true);var ds=function(e){r=r||{data:{}};if(typeof e!=="undefined")r.data.retry_after=e};var ps="deactivated";var vs=Bo("deactivated",true);var gs="probation";var ms=Bo("probation",true);var ys="rejected";var Ts=Bo("rejected",true);var Cs="timeout";var Ss=Bo("timeout",true);var As="giveup";var bs=Bo("giveup",true);var ws="noresource";var Es=Bo("noresource",true);var Rs="invariant";var _s=Bo("invariant",true);var Is=function(e){r=r||{data:{}};if(r.startRule==="Supported"){r.data=e||[]}};var Os=function(){r=r||{data:{}};var e=r.data.tag;r.data=new yl.NameAddrHeader(r.data.uri,r.data.displayName,r.data.params);if(e){r.data.setParam("tag",e)}};var Ns="ttl";var Ds=Bo("ttl",true);var xs=function(e){r=r||{data:{}};r.data.ttl=e};var ks="maddr";var Us=Bo("maddr",true);var Ps=function(e){r=r||{data:{}};r.data.maddr=e};var Hs="received";var Ls=Bo("received",true);var qs=function(e){r=r||{data:{}};r.data.received=e};var Ms="branch";var Fs=Bo("branch",true);var Bs=function(e){r=r||{data:{}};r.data.branch=e};var js="rport";var Gs=Bo("rport",true);var Ws=function(e){r=r||{data:{}};if(typeof e!=="undefined")r.data.rport=e.join("")};var Ks=function(e){r=r||{data:{}};r.data.protocol=e};var Vs=Bo("UDP",true);var Ys=Bo("TCP",true);var zs=Bo("TLS",true);var $s=Bo("SCTP",true);var Js=function(e){r=r||{data:{}};r.data.transport=e};var Xs=function(){r=r||{data:{}};r.data.host=Lo()};var Qs=function(e){r=r||{data:{}};r.data.port=parseInt(e.join(""))};var Zs=function(e){return parseInt(e.join(""))};var eo=function(e){r=r||{data:{}};if(r.startRule==="Session_Expires"){r.data.deltaSeconds=e}};var to="refresher";var ro=Bo("refresher",false);var io="uas";var no=Bo("uas",false);var so="uac";var oo=Bo("uac",false);var ao=function(e){r=r||{data:{}};if(r.startRule==="Session_Expires"){r.data.refresher=e}};var fo=function(e){r=r||{data:{}};if(r.startRule==="Min_SE"){r.data=e}};var uo="stuns";var co=Bo("stuns",true);var lo="stun";var ho=Bo("stun",true);var po=function(e){r=r||{data:{}};r.data.scheme=e};var vo=function(e){r=r||{data:{}};r.data.host=e};var go="?transport=";var mo=Bo("?transport=",false);var yo="turns";var To=Bo("turns",true);var Co="turn";var So=Bo("turn",true);var Ao=function(e){r=r||{data:{}};r.data.transport=e};var bo=function(){r=r||{data:{}};r.data=Lo()};var wo="Referred-By";var Eo=Bo("Referred-By",false);var Ro="b";var _o=Bo("b",false);var Io="cid";var Oo=Bo("cid",false);var No=0;var Do=0;var xo=[{line:1,column:1}];var ko=0;var Uo=[];var Po=0;var Ho;if(r.startRule!==undefined){if(!(r.startRule in e)){throw new Error("Can't start parsing from rule \""+r.startRule+'".')}t=e[r.startRule]}function Lo(){return v.substring(Do,No)}function qo(){return Yo(Do,No)}function Mo(e,t){t=t!==undefined?t:Yo(Do,No);throw Jo([Ko(e)],v.substring(Do,No),t)}function Fo(e,t){t=t!==undefined?t:Yo(Do,No);throw $o(e,t)}function Bo(e,t){return{type:"literal",text:e,ignoreCase:t}}function jo(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Go(){return{type:"any"}}function Wo(){return{type:"end"}}function Ko(e){return{type:"other",description:e}}function Vo(e){var t=xo[e];var r;if(t){return t}else{r=e-1;while(!xo[r]){r--}t=xo[r];t={line:t.line,column:t.column};while(r<e){if(v.charCodeAt(r)===10){t.line++;t.column=1}else{t.column++}r++}xo[e]=t;return t}}function Yo(e,t){var r=Vo(e);var i=Vo(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function zo(e){if(No<ko){return}if(No>ko){ko=No;Uo=[]}Uo.push(e)}function $o(e,t){return new Cl(e,[],"",t)}function Jo(e,t,r){return new Cl(Cl.buildMessage(e,t),e,t,r)}function Xo(){var e;if(v.substr(No,2)===i){e=i;No+=2}else{e=g;if(Po===0){zo(n)}}return e}function Qo(){var e;if(s.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(o)}}return e}function Zo(){var e;if(a.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(f)}}return e}function ea(){var e;if(u.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(c)}}return e}function ta(){var e;e=na();if(e===g){e=sa()}return e}function ra(){var e;if(l.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(h)}}return e}function ia(){var e;if(d.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(p)}}return e}function na(){var e;if(v.charCodeAt(No)===32){e=m;No++}else{e=g;if(Po===0){zo(y)}}return e}function sa(){var e;if(v.charCodeAt(No)===9){e=T;No++}else{e=g;if(Po===0){zo(C)}}return e}function oa(){var e;if(S.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(A)}}return e}function aa(){var e;if(v.charCodeAt(No)===59){e=b;No++}else{e=g;if(Po===0){zo(w)}}if(e===g){if(v.charCodeAt(No)===47){e=E;No++}else{e=g;if(Po===0){zo(R)}}if(e===g){if(v.charCodeAt(No)===63){e=_;No++}else{e=g;if(Po===0){zo(I)}}if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===64){e=D;No++}else{e=g;if(Po===0){zo(x)}}if(e===g){if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}}}}}}}}}}return e}function fa(){var e;e=oa();if(e===g){e=ua()}return e}function ua(){var e;if(v.charCodeAt(No)===45){e=G;No++}else{e=g;if(Po===0){zo(W)}}if(e===g){if(v.charCodeAt(No)===95){e=K;No++}else{e=g;if(Po===0){zo(V)}}if(e===g){if(v.charCodeAt(No)===46){e=Y;No++}else{e=g;if(Po===0){zo(z)}}if(e===g){if(v.charCodeAt(No)===33){e=$;No++}else{e=g;if(Po===0){zo(J)}}if(e===g){if(v.charCodeAt(No)===126){e=X;No++}else{e=g;if(Po===0){zo(Q)}}if(e===g){if(v.charCodeAt(No)===42){e=Z;No++}else{e=g;if(Po===0){zo(ee)}}if(e===g){if(v.charCodeAt(No)===39){e=te;No++}else{e=g;if(Po===0){zo(re)}}if(e===g){if(v.charCodeAt(No)===40){e=ie;No++}else{e=g;if(Po===0){zo(ne)}}if(e===g){if(v.charCodeAt(No)===41){e=se;No++}else{e=g;if(Po===0){zo(oe)}}}}}}}}}}return e}function ca(){var e,t,r,i,n;e=No;t=No;if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r!==g){i=ea();if(i!==g){n=ea();if(n!==g){r=[r,i,n];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function la(){var e,t,r,i;e=No;t=No;r=[];i=ta();while(i!==g){r.push(i);i=ta()}if(r!==g){i=Xo();if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=null}if(t!==g){r=[];i=ta();if(i!==g){while(i!==g){r.push(i);i=ta()}}else{r=g}if(r!==g){Do=e;t=ue();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function ha(){var e;e=la();if(e===g){e=null}return e}function da(){var e,t,r,i;e=No;t=[];r=na();if(r===g){r=sa()}while(r!==g){t.push(r);r=na();if(r===g){r=sa()}}if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=ha();if(i!==g){Do=e;t=ce();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function pa(){var e,t,r,i,n,s,o;e=No;t=No;r=[];i=va();if(i!==g){while(i!==g){r.push(i);i=va()}}else{r=g}if(r!==g){i=[];n=No;s=[];o=la();while(o!==g){s.push(o);o=la()}if(s!==g){o=va();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;s=[];o=la();while(o!==g){s.push(o);o=la()}if(s!==g){o=va();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function va(){var e;if(le.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(he)}}if(e===g){e=ga()}return e}function ga(){var e;if(de.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(pe)}}return e}function ma(){var e;if(ve.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(ge)}}return e}function ya(){var e;e=Qo();if(e===g){if(me.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(ye)}}}return e}function Ta(){var e,t,r;e=No;t=[];r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===46){r=Y;No++}else{r=g;if(Po===0){zo(z)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}}}}}}}}}}}if(r!==g){while(r!==g){t.push(r);r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===46){r=Y;No++}else{r=g;if(Po===0){zo(z)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}}}}}}}}}}}}}else{t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function Ca(){var e,t,r;e=No;t=[];r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}}}}}}}}}}if(r!==g){while(r!==g){t.push(r);r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}}}}}}}}}}}}else{t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function Sa(){var e;if(v.charCodeAt(No)===40){e=ie;No++}else{e=g;if(Po===0){zo(ne)}}if(e===g){if(v.charCodeAt(No)===41){e=se;No++}else{e=g;if(Po===0){zo(oe)}}if(e===g){if(v.charCodeAt(No)===60){e=Se;No++}else{e=g;if(Po===0){zo(Ae)}}if(e===g){if(v.charCodeAt(No)===62){e=be;No++}else{e=g;if(Po===0){zo(we)}}if(e===g){if(v.charCodeAt(No)===64){e=D;No++}else{e=g;if(Po===0){zo(x)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}if(e===g){if(v.charCodeAt(No)===59){e=b;No++}else{e=g;if(Po===0){zo(w)}}if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===92){e=Ee;No++}else{e=g;if(Po===0){zo(Re)}}if(e===g){e=ia();if(e===g){if(v.charCodeAt(No)===47){e=E;No++}else{e=g;if(Po===0){zo(R)}}if(e===g){if(v.charCodeAt(No)===91){e=_e;No++}else{e=g;if(Po===0){zo(Ie)}}if(e===g){if(v.charCodeAt(No)===93){e=Oe;No++}else{e=g;if(Po===0){zo(Ne)}}if(e===g){if(v.charCodeAt(No)===63){e=_;No++}else{e=g;if(Po===0){zo(I)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}if(e===g){if(v.charCodeAt(No)===123){e=De;No++}else{e=g;if(Po===0){zo(xe)}}if(e===g){if(v.charCodeAt(No)===125){e=ke;No++}else{e=g;if(Po===0){zo(Ue)}}if(e===g){e=na();if(e===g){e=sa()}}}}}}}}}}}}}}}}}}return e}function Aa(){var e,t,r;e=No;t=[];r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===46){r=Y;No++}else{r=g;if(Po===0){zo(z)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}if(r===g){if(v.charCodeAt(No)===40){r=ie;No++}else{r=g;if(Po===0){zo(ne)}}if(r===g){if(v.charCodeAt(No)===41){r=se;No++}else{r=g;if(Po===0){zo(oe)}}if(r===g){if(v.charCodeAt(No)===60){r=Se;No++}else{r=g;if(Po===0){zo(Ae)}}if(r===g){if(v.charCodeAt(No)===62){r=be;No++}else{r=g;if(Po===0){zo(we)}}if(r===g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r===g){if(v.charCodeAt(No)===92){r=Ee;No++}else{r=g;if(Po===0){zo(Re)}}if(r===g){r=ia();if(r===g){if(v.charCodeAt(No)===47){r=E;No++}else{r=g;if(Po===0){zo(R)}}if(r===g){if(v.charCodeAt(No)===91){r=_e;No++}else{r=g;if(Po===0){zo(Ie)}}if(r===g){if(v.charCodeAt(No)===93){r=Oe;No++}else{r=g;if(Po===0){zo(Ne)}}if(r===g){if(v.charCodeAt(No)===63){r=_;No++}else{r=g;if(Po===0){zo(I)}}if(r===g){if(v.charCodeAt(No)===123){r=De;No++}else{r=g;if(Po===0){zo(xe)}}if(r===g){if(v.charCodeAt(No)===125){r=ke;No++}else{r=g;if(Po===0){zo(Ue)}}}}}}}}}}}}}}}}}}}}}}}}}if(r!==g){while(r!==g){t.push(r);r=oa();if(r===g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r===g){if(v.charCodeAt(No)===46){r=Y;No++}else{r=g;if(Po===0){zo(z)}}if(r===g){if(v.charCodeAt(No)===33){r=$;No++}else{r=g;if(Po===0){zo(J)}}if(r===g){if(v.charCodeAt(No)===37){r=ae;No++}else{r=g;if(Po===0){zo(fe)}}if(r===g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r===g){if(v.charCodeAt(No)===95){r=K;No++}else{r=g;if(Po===0){zo(V)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===96){r=Te;No++}else{r=g;if(Po===0){zo(Ce)}}if(r===g){if(v.charCodeAt(No)===39){r=te;No++}else{r=g;if(Po===0){zo(re)}}if(r===g){if(v.charCodeAt(No)===126){r=X;No++}else{r=g;if(Po===0){zo(Q)}}if(r===g){if(v.charCodeAt(No)===40){r=ie;No++}else{r=g;if(Po===0){zo(ne)}}if(r===g){if(v.charCodeAt(No)===41){r=se;No++}else{r=g;if(Po===0){zo(oe)}}if(r===g){if(v.charCodeAt(No)===60){r=Se;No++}else{r=g;if(Po===0){zo(Ae)}}if(r===g){if(v.charCodeAt(No)===62){r=be;No++}else{r=g;if(Po===0){zo(we)}}if(r===g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r===g){if(v.charCodeAt(No)===92){r=Ee;No++}else{r=g;if(Po===0){zo(Re)}}if(r===g){r=ia();if(r===g){if(v.charCodeAt(No)===47){r=E;No++}else{r=g;if(Po===0){zo(R)}}if(r===g){if(v.charCodeAt(No)===91){r=_e;No++}else{r=g;if(Po===0){zo(Ie)}}if(r===g){if(v.charCodeAt(No)===93){r=Oe;No++}else{r=g;if(Po===0){zo(Ne)}}if(r===g){if(v.charCodeAt(No)===63){r=_;No++}else{r=g;if(Po===0){zo(I)}}if(r===g){if(v.charCodeAt(No)===123){r=De;No++}else{r=g;if(Po===0){zo(xe)}}if(r===g){if(v.charCodeAt(No)===125){r=ke;No++}else{r=g;if(Po===0){zo(Ue)}}}}}}}}}}}}}}}}}}}}}}}}}}}else{t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function ba(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===42){r=Z;No++}else{r=g;if(Po===0){zo(ee)}}if(r!==g){i=ha();if(i!==g){Do=e;t=Pe();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function wa(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===47){r=E;No++}else{r=g;if(Po===0){zo(R)}}if(r!==g){i=ha();if(i!==g){Do=e;t=He();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ea(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===61){r=P;No++}else{r=g;if(Po===0){zo(H)}}if(r!==g){i=ha();if(i!==g){Do=e;t=Le();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ra(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===40){r=ie;No++}else{r=g;if(Po===0){zo(ne)}}if(r!==g){i=ha();if(i!==g){Do=e;t=qe();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function _a(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===41){r=se;No++}else{r=g;if(Po===0){zo(oe)}}if(r!==g){i=ha();if(i!==g){Do=e;t=Me();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ia(){var e,t,r;e=No;if(v.charCodeAt(No)===62){t=be;No++}else{t=g;if(Po===0){zo(we)}}if(t!==g){r=ha();if(r!==g){Do=e;t=Fe();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Oa(){var e,t,r;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===60){r=Se;No++}else{r=g;if(Po===0){zo(Ae)}}if(r!==g){Do=e;t=Be();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Na(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===44){r=B;No++}else{r=g;if(Po===0){zo(j)}}if(r!==g){i=ha();if(i!==g){Do=e;t=je();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Da(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===59){r=b;No++}else{r=g;if(Po===0){zo(w)}}if(r!==g){i=ha();if(i!==g){Do=e;t=Ge();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function xa(){var e,t,r,i;e=No;t=ha();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=ha();if(i!==g){Do=e;t=We();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ka(){var e,t,r;e=No;t=ha();if(t!==g){r=ia();if(r!==g){Do=e;t=Ke();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Ua(){var e,t,r;e=No;t=ia();if(t!==g){r=ha();if(r!==g){Do=e;t=Ke();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Pa(){var e,t,r,i;e=No;t=Ra();if(t!==g){r=[];i=Ha();if(i===g){i=Fa();if(i===g){i=Pa()}}while(i!==g){r.push(i);i=Ha();if(i===g){i=Fa();if(i===g){i=Pa()}}}if(r!==g){i=_a();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ha(){var e;if(Ve.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(Ye)}}if(e===g){if(ze.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo($e)}}if(e===g){if(Je.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(Xe)}}if(e===g){e=ga();if(e===g){e=la()}}}}return e}function La(){var e,t,r,i,n,s;e=No;t=No;r=ha();if(r!==g){i=ia();if(i!==g){n=[];s=Ma();if(s===g){s=Fa()}while(s!==g){n.push(s);s=Ma();if(s===g){s=Fa()}}if(n!==g){s=ia();if(s!==g){r=[r,i,n,s];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function qa(){var e,t,r,i,n,s;e=No;t=ha();if(t!==g){r=ia();if(r!==g){i=No;n=[];s=Ma();if(s===g){s=Fa()}while(s!==g){n.push(s);s=Ma();if(s===g){s=Fa()}}if(n!==g){i=v.substring(i,No)}else{i=n}if(i!==g){n=ia();if(n!==g){Do=e;t=Qe(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ma(){var e;e=la();if(e===g){if(v.charCodeAt(No)===33){e=$;No++}else{e=g;if(Po===0){zo(J)}}if(e===g){if(Ze.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(et)}}if(e===g){if(Je.test(v.charAt(No))){e=v.charAt(No);No++}else{e=g;if(Po===0){zo(Xe)}}if(e===g){e=ga()}}}}return e}function Fa(){var e,t,r;e=No;if(v.charCodeAt(No)===92){t=Ee;No++}else{t=g;if(Po===0){zo(Re)}}if(t!==g){if(tt.test(v.charAt(No))){r=v.charAt(No);No++}else{r=g;if(Po===0){zo(rt)}}if(r===g){if(it.test(v.charAt(No))){r=v.charAt(No);No++}else{r=g;if(Po===0){zo(nt)}}if(r===g){if(st.test(v.charAt(No))){r=v.charAt(No);No++}else{r=g;if(Po===0){zo(ot)}}}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Ba(){var e,t,r,i,n;e=No;t=Ga();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=Wa();if(i===g){i=null}if(i!==g){n=za();if(n!==g){Do=e;t=at();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ja(){var e,t,r,i,n,s,o;e=No;t=Ga();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=Wa();if(i===g){i=null}if(i!==g){n=za();if(n!==g){s=af();if(s!==g){o=Cf();if(o===g){o=null}if(o!==g){Do=e;t=ft();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ga(){var e,t;e=No;if(v.substr(No,4).toLowerCase()===ut){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(ct)}}if(t===g){if(v.substr(No,3).toLowerCase()===lt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(ht)}}}if(t!==g){Do=e;t=dt(t)}e=t;return e}function Wa(){var e,t,r,i,n;e=No;t=Ka();if(t!==g){r=No;if(v.charCodeAt(No)===58){i=O;No++}else{i=g;if(Po===0){zo(N)}}if(i!==g){n=Ya();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){if(v.charCodeAt(No)===64){i=D;No++}else{i=g;if(Po===0){zo(x)}}if(i!==g){Do=e;t=pt();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ka(){var e,t;e=[];t=fa();if(t===g){t=ca();if(t===g){t=Va()}}if(t!==g){while(t!==g){e.push(t);t=fa();if(t===g){t=ca();if(t===g){t=Va()}}}}else{e=g}return e}function Va(){var e;if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}if(e===g){if(v.charCodeAt(No)===59){e=b;No++}else{e=g;if(Po===0){zo(w)}}if(e===g){if(v.charCodeAt(No)===63){e=_;No++}else{e=g;if(Po===0){zo(I)}}if(e===g){if(v.charCodeAt(No)===47){e=E;No++}else{e=g;if(Po===0){zo(R)}}}}}}}}}return e}function Ya(){var e,t,r;e=No;t=[];r=fa();if(r===g){r=ca();if(r===g){if(v.charCodeAt(No)===38){r=k;No++}else{r=g;if(Po===0){zo(U)}}if(r===g){if(v.charCodeAt(No)===61){r=P;No++}else{r=g;if(Po===0){zo(H)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===36){r=M;No++}else{r=g;if(Po===0){zo(F)}}if(r===g){if(v.charCodeAt(No)===44){r=B;No++}else{r=g;if(Po===0){zo(j)}}}}}}}}while(r!==g){t.push(r);r=fa();if(r===g){r=ca();if(r===g){if(v.charCodeAt(No)===38){r=k;No++}else{r=g;if(Po===0){zo(U)}}if(r===g){if(v.charCodeAt(No)===61){r=P;No++}else{r=g;if(Po===0){zo(H)}}if(r===g){if(v.charCodeAt(No)===43){r=L;No++}else{r=g;if(Po===0){zo(q)}}if(r===g){if(v.charCodeAt(No)===36){r=M;No++}else{r=g;if(Po===0){zo(F)}}if(r===g){if(v.charCodeAt(No)===44){r=B;No++}else{r=g;if(Po===0){zo(j)}}}}}}}}}if(t!==g){Do=e;t=vt()}e=t;return e}function za(){var e,t,r,i,n;e=No;t=$a();if(t!==g){r=No;if(v.charCodeAt(No)===58){i=O;No++}else{i=g;if(Po===0){zo(N)}}if(i!==g){n=of();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function $a(){var e,t;e=No;t=Ja();if(t===g){t=nf();if(t===g){t=Za()}}if(t!==g){Do=e;t=gt()}e=t;return e}function Ja(){var e,t,r,i,n;e=No;t=[];r=No;i=Xa();if(i!==g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}while(r!==g){t.push(r);r=No;i=Xa();if(i!==g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}}if(t!==g){r=Qa();if(r!==g){if(v.charCodeAt(No)===46){i=Y;No++}else{i=g;if(Po===0){zo(z)}}if(i===g){i=null}if(i!==g){Do=e;t=mt();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Xa(){var e,t;e=[];if(yt.test(v.charAt(No))){t=v.charAt(No);No++}else{t=g;if(Po===0){zo(Tt)}}if(t!==g){while(t!==g){e.push(t);if(yt.test(v.charAt(No))){t=v.charAt(No);No++}else{t=g;if(Po===0){zo(Tt)}}}}else{e=g}return e}function Qa(){var e,t,r,i;e=No;if(a.test(v.charAt(No))){t=v.charAt(No);No++}else{t=g;if(Po===0){zo(f)}}if(t!==g){r=[];if(Ct.test(v.charAt(No))){i=v.charAt(No);No++}else{i=g;if(Po===0){zo(St)}}while(i!==g){r.push(i);if(Ct.test(v.charAt(No))){i=v.charAt(No);No++}else{i=g;if(Po===0){zo(St)}}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Za(){var e,t,r,i;e=No;if(v.charCodeAt(No)===91){t=_e;No++}else{t=g;if(Po===0){zo(Ie)}}if(t!==g){r=ef();if(r!==g){if(v.charCodeAt(No)===93){i=Oe;No++}else{i=g;if(Po===0){zo(Ne)}}if(i!==g){Do=e;t=At();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ef(){var e,t,r,i,n,s,o,a,f,u,c,l,h,d,p;e=No;t=No;r=tf();if(r!==g){if(v.charCodeAt(No)===58){i=O;No++}else{i=g;if(Po===0){zo(N)}}if(i!==g){n=tf();if(n!==g){if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){if(v.charCodeAt(No)===58){u=O;No++}else{u=g;if(Po===0){zo(N)}}if(u!==g){c=tf();if(c!==g){if(v.charCodeAt(No)===58){l=O;No++}else{l=g;if(Po===0){zo(N)}}if(l!==g){h=tf();if(h!==g){if(v.charCodeAt(No)===58){d=O;No++}else{d=g;if(Po===0){zo(N)}}if(d!==g){p=rf();if(p!==g){r=[r,i,n,s,o,a,f,u,c,l,h,d,p];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=tf();if(u!==g){if(v.charCodeAt(No)===58){c=O;No++}else{c=g;if(Po===0){zo(N)}}if(c!==g){l=tf();if(l!==g){if(v.charCodeAt(No)===58){h=O;No++}else{h=g;if(Po===0){zo(N)}}if(h!==g){d=rf();if(d!==g){r=[r,i,n,s,o,a,f,u,c,l,h,d];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=tf();if(u!==g){if(v.charCodeAt(No)===58){c=O;No++}else{c=g;if(Po===0){zo(N)}}if(c!==g){l=rf();if(l!==g){r=[r,i,n,s,o,a,f,u,c,l];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=rf();if(u!==g){r=[r,i,n,s,o,a,f,u];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=rf();if(a!==g){r=[r,i,n,s,o,a];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=rf();if(s!==g){r=[r,i,n,s];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=rf();if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;if(v.substr(No,2)===bt){r=bt;No+=2}else{r=g;if(Po===0){zo(wt)}}if(r!==g){i=tf();if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){if(v.substr(No,2)===bt){i=bt;No+=2}else{i=g;if(Po===0){zo(wt)}}if(i!==g){n=tf();if(n!==g){if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){if(v.charCodeAt(No)===58){u=O;No++}else{u=g;if(Po===0){zo(N)}}if(u!==g){c=tf();if(c!==g){if(v.charCodeAt(No)===58){l=O;No++}else{l=g;if(Po===0){zo(N)}}if(l!==g){h=rf();if(h!==g){r=[r,i,n,s,o,a,f,u,c,l,h];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){if(v.substr(No,2)===bt){n=bt;No+=2}else{n=g;if(Po===0){zo(wt)}}if(n!==g){s=tf();if(s!==g){if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=tf();if(u!==g){if(v.charCodeAt(No)===58){c=O;No++}else{c=g;if(Po===0){zo(N)}}if(c!==g){l=rf();if(l!==g){r=[r,i,n,s,o,a,f,u,c,l];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){n=No;if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){if(v.substr(No,2)===bt){s=bt;No+=2}else{s=g;if(Po===0){zo(wt)}}if(s!==g){o=tf();if(o!==g){if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){if(v.charCodeAt(No)===58){u=O;No++}else{u=g;if(Po===0){zo(N)}}if(u!==g){c=rf();if(c!==g){r=[r,i,n,s,o,a,f,u,c];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){n=No;if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){s=No;if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}if(s===g){s=null}if(s!==g){if(v.substr(No,2)===bt){o=bt;No+=2}else{o=g;if(Po===0){zo(wt)}}if(o!==g){a=tf();if(a!==g){if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=rf();if(u!==g){r=[r,i,n,s,o,a,f,u];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){n=No;if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){s=No;if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}if(s===g){s=null}if(s!==g){o=No;if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}if(o===g){o=null}if(o!==g){if(v.substr(No,2)===bt){a=bt;No+=2}else{a=g;if(Po===0){zo(wt)}}if(a!==g){f=rf();if(f!==g){r=[r,i,n,s,o,a,f];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){n=No;if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){s=No;if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}if(s===g){s=null}if(s!==g){o=No;if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}if(o===g){o=null}if(o!==g){a=No;if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=tf();if(u!==g){f=[f,u];a=f}else{No=a;a=g}}else{No=a;a=g}if(a===g){a=null}if(a!==g){if(v.substr(No,2)===bt){f=bt;No+=2}else{f=g;if(Po===0){zo(wt)}}if(f!==g){u=tf();if(u!==g){r=[r,i,n,s,o,a,f,u];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=No;r=tf();if(r!==g){i=No;if(v.charCodeAt(No)===58){n=O;No++}else{n=g;if(Po===0){zo(N)}}if(n!==g){s=tf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){n=No;if(v.charCodeAt(No)===58){s=O;No++}else{s=g;if(Po===0){zo(N)}}if(s!==g){o=tf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){s=No;if(v.charCodeAt(No)===58){o=O;No++}else{o=g;if(Po===0){zo(N)}}if(o!==g){a=tf();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}if(s===g){s=null}if(s!==g){o=No;if(v.charCodeAt(No)===58){a=O;No++}else{a=g;if(Po===0){zo(N)}}if(a!==g){f=tf();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}if(o===g){o=null}if(o!==g){a=No;if(v.charCodeAt(No)===58){f=O;No++}else{f=g;if(Po===0){zo(N)}}if(f!==g){u=tf();if(u!==g){f=[f,u];a=f}else{No=a;a=g}}else{No=a;a=g}if(a===g){a=null}if(a!==g){f=No;if(v.charCodeAt(No)===58){u=O;No++}else{u=g;if(Po===0){zo(N)}}if(u!==g){c=tf();if(c!==g){u=[u,c];f=u}else{No=f;f=g}}else{No=f;f=g}if(f===g){f=null}if(f!==g){if(v.substr(No,2)===bt){u=bt;No+=2}else{u=g;if(Po===0){zo(wt)}}if(u!==g){r=[r,i,n,s,o,a,f,u];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}}}}}}}}}}}}}}if(t!==g){Do=e;t=Et()}e=t;return e}function tf(){var e,t,r,i,n;e=No;t=ea();if(t!==g){r=ea();if(r===g){r=null}if(r!==g){i=ea();if(i===g){i=null}if(i!==g){n=ea();if(n===g){n=null}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function rf(){var e,t,r,i;e=No;t=tf();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=tf();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=nf()}return e}function nf(){var e,t,r,i,n,s,o,a;e=No;t=sf();if(t!==g){if(v.charCodeAt(No)===46){r=Y;No++}else{r=g;if(Po===0){zo(z)}}if(r!==g){i=sf();if(i!==g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}if(n!==g){s=sf();if(s!==g){if(v.charCodeAt(No)===46){o=Y;No++}else{o=g;if(Po===0){zo(z)}}if(o!==g){a=sf();if(a!==g){Do=e;t=Rt();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function sf(){var e,t,r,i;e=No;if(v.substr(No,2)===_t){t=_t;No+=2}else{t=g;if(Po===0){zo(It)}}if(t!==g){if(Ot.test(v.charAt(No))){r=v.charAt(No);No++}else{r=g;if(Po===0){zo(Nt)}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.charCodeAt(No)===50){t=Dt;No++}else{t=g;if(Po===0){zo(xt)}}if(t!==g){if(kt.test(v.charAt(No))){r=v.charAt(No);No++}else{r=g;if(Po===0){zo(Ut)}}if(r!==g){i=Qo();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.charCodeAt(No)===49){t=Pt;No++}else{t=g;if(Po===0){zo(Ht)}}if(t!==g){r=Qo();if(r!==g){i=Qo();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(Lt.test(v.charAt(No))){t=v.charAt(No);No++}else{t=g;if(Po===0){zo(qt)}}if(t!==g){r=Qo();if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=Qo()}}}}return e}function of(){var e,t,r,i,n,s,o;e=No;t=No;r=Qo();if(r===g){r=null}if(r!==g){i=Qo();if(i===g){i=null}if(i!==g){n=Qo();if(n===g){n=null}if(n!==g){s=Qo();if(s===g){s=null}if(s!==g){o=Qo();if(o===g){o=null}if(o!==g){r=[r,i,n,s,o];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t!==g){Do=e;t=Mt(t)}e=t;return e}function af(){var e,t,r,i;e=[];t=No;if(v.charCodeAt(No)===59){r=b;No++}else{r=g;if(Po===0){zo(w)}}if(r!==g){i=ff();if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}while(t!==g){e.push(t);t=No;if(v.charCodeAt(No)===59){r=b;No++}else{r=g;if(Po===0){zo(w)}}if(r!==g){i=ff();if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}}return e}function ff(){var e;e=uf();if(e===g){e=cf();if(e===g){e=lf();if(e===g){e=hf();if(e===g){e=df();if(e===g){e=pf();if(e===g){e=vf()}}}}}}return e}function uf(){var e,t,r;e=No;if(v.substr(No,10).toLowerCase()===Ft){t=v.substr(No,10);No+=10}else{t=g;if(Po===0){zo(Bt)}}if(t!==g){if(v.substr(No,3).toLowerCase()===jt){r=v.substr(No,3);No+=3}else{r=g;if(Po===0){zo(Gt)}}if(r===g){if(v.substr(No,3).toLowerCase()===Wt){r=v.substr(No,3);No+=3}else{r=g;if(Po===0){zo(Kt)}}if(r===g){if(v.substr(No,4).toLowerCase()===Vt){r=v.substr(No,4);No+=4}else{r=g;if(Po===0){zo(Yt)}}if(r===g){if(v.substr(No,3).toLowerCase()===zt){r=v.substr(No,3);No+=3}else{r=g;if(Po===0){zo($t)}}if(r===g){r=Ta()}}}}if(r!==g){Do=e;t=Jt(r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function cf(){var e,t,r;e=No;if(v.substr(No,5).toLowerCase()===Xt){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(Qt)}}if(t!==g){if(v.substr(No,5).toLowerCase()===Zt){r=v.substr(No,5);No+=5}else{r=g;if(Po===0){zo(er)}}if(r===g){if(v.substr(No,2).toLowerCase()===tr){r=v.substr(No,2);No+=2}else{r=g;if(Po===0){zo(rr)}}if(r===g){r=Ta()}}if(r!==g){Do=e;t=ir(r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function lf(){var e,t,r;e=No;if(v.substr(No,7).toLowerCase()===nr){t=v.substr(No,7);No+=7}else{t=g;if(Po===0){zo(sr)}}if(t!==g){r=ru();if(r!==g){Do=e;t=or(r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function hf(){var e,t,r;e=No;if(v.substr(No,4).toLowerCase()===ar){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(fr)}}if(t!==g){r=Wc();if(r!==g){Do=e;t=ur(r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function df(){var e,t,r;e=No;if(v.substr(No,6).toLowerCase()===cr){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(lr)}}if(t!==g){r=$a();if(r!==g){Do=e;t=hr(r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function pf(){var e,t,r,i,n;e=No;if(v.substr(No,2).toLowerCase()===dr){t=v.substr(No,2);No+=2}else{t=g;if(Po===0){zo(pr)}}if(t!==g){r=No;if(v.charCodeAt(No)===61){i=P;No++}else{i=g;if(Po===0){zo(H)}}if(i!==g){n=Ta();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){Do=e;t=vr();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function vf(){var e,t,r,i,n;e=No;t=gf();if(t!==g){r=No;if(v.charCodeAt(No)===61){i=P;No++}else{i=g;if(Po===0){zo(H)}}if(i!==g){n=mf();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){Do=e;t=gr(t,r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function gf(){var e,t,r;e=No;t=[];r=yf();if(r!==g){while(r!==g){t.push(r);r=yf()}}else{t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function mf(){var e,t,r;e=No;t=[];r=yf();if(r!==g){while(r!==g){t.push(r);r=yf()}}else{t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function yf(){var e;e=Tf();if(e===g){e=fa();if(e===g){e=ca()}}return e}function Tf(){var e;if(v.charCodeAt(No)===91){e=_e;No++}else{e=g;if(Po===0){zo(Ie)}}if(e===g){if(v.charCodeAt(No)===93){e=Oe;No++}else{e=g;if(Po===0){zo(Ne)}}if(e===g){if(v.charCodeAt(No)===47){e=E;No++}else{e=g;if(Po===0){zo(R)}}if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}}}}}}}return e}function Cf(){var e,t,r,i,n,s,o;e=No;if(v.charCodeAt(No)===63){t=_;No++}else{t=g;if(Po===0){zo(I)}}if(t!==g){r=Sf();if(r!==g){i=[];n=No;if(v.charCodeAt(No)===38){s=k;No++}else{s=g;if(Po===0){zo(U)}}if(s!==g){o=Sf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;if(v.charCodeAt(No)===38){s=k;No++}else{s=g;if(Po===0){zo(U)}}if(s!==g){o=Sf();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Sf(){var e,t,r,i;e=No;t=Af();if(t!==g){if(v.charCodeAt(No)===61){r=P;No++}else{r=g;if(Po===0){zo(H)}}if(r!==g){i=bf();if(i!==g){Do=e;t=mr(t,i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Af(){var e,t;e=[];t=wf();if(t===g){t=fa();if(t===g){t=ca()}}if(t!==g){while(t!==g){e.push(t);t=wf();if(t===g){t=fa();if(t===g){t=ca()}}}}else{e=g}return e}function bf(){var e,t;e=[];t=wf();if(t===g){t=fa();if(t===g){t=ca()}}while(t!==g){e.push(t);t=wf();if(t===g){t=fa();if(t===g){t=ca()}}}return e}function wf(){var e;if(v.charCodeAt(No)===91){e=_e;No++}else{e=g;if(Po===0){zo(Ie)}}if(e===g){if(v.charCodeAt(No)===93){e=Oe;No++}else{e=g;if(Po===0){zo(Ne)}}if(e===g){if(v.charCodeAt(No)===47){e=E;No++}else{e=g;if(Po===0){zo(R)}}if(e===g){if(v.charCodeAt(No)===63){e=_;No++}else{e=g;if(Po===0){zo(I)}}if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}}}}}}}return e}function Ef(){var e;e=iu();if(e===g){e=Rf()}return e}function Rf(){var e,t,r,i,n,s;e=No;t=ru();if(t!==g){r=na();if(r!==g){i=_f();if(i!==g){n=na();if(n!==g){s=Wf();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function _f(){var e;e=ja();if(e===g){e=If()}return e}function If(){var e,t,r,i;e=No;t=Mf();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=Of();if(i===g){i=xf()}if(i!==g){Do=e;t=yr();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Of(){var e,t,r,i,n;e=No;t=Nf();if(t===g){t=Df()}if(t!==g){r=No;if(v.charCodeAt(No)===63){i=_;No++}else{i=g;if(Po===0){zo(I)}}if(i!==g){n=Gf();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Nf(){var e,t,r,i;e=No;if(v.substr(No,2)===Tr){t=Tr;No+=2}else{t=g;if(Po===0){zo(Cr)}}if(t!==g){r=Ff();if(r!==g){i=Df();if(i===g){i=null}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Df(){var e,t,r;e=No;if(v.charCodeAt(No)===47){t=E;No++}else{t=g;if(Po===0){zo(R)}}if(t!==g){r=Pf();if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function xf(){var e,t,r,i;e=No;t=Uf();if(t!==g){r=[];i=kf();while(i!==g){r.push(i);i=kf()}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function kf(){var e;e=aa();if(e===g){e=fa();if(e===g){e=ca()}}return e}function Uf(){var e;e=fa();if(e===g){e=ca();if(e===g){if(v.charCodeAt(No)===59){e=b;No++}else{e=g;if(Po===0){zo(w)}}if(e===g){if(v.charCodeAt(No)===63){e=_;No++}else{e=g;if(Po===0){zo(I)}}if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===64){e=D;No++}else{e=g;if(Po===0){zo(x)}}if(e===g){if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}}}}}}}}}}}return e}function Pf(){var e,t,r,i,n,s;e=No;t=Hf();if(t!==g){r=[];i=No;if(v.charCodeAt(No)===47){n=E;No++}else{n=g;if(Po===0){zo(R)}}if(n!==g){s=Hf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;if(v.charCodeAt(No)===47){n=E;No++}else{n=g;if(Po===0){zo(R)}}if(n!==g){s=Hf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Hf(){var e,t,r,i,n,s;e=No;t=[];r=qf();while(r!==g){t.push(r);r=qf()}if(t!==g){r=[];i=No;if(v.charCodeAt(No)===59){n=b;No++}else{n=g;if(Po===0){zo(w)}}if(n!==g){s=Lf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;if(v.charCodeAt(No)===59){n=b;No++}else{n=g;if(Po===0){zo(w)}}if(n!==g){s=Lf();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Lf(){var e,t;e=[];t=qf();while(t!==g){e.push(t);t=qf()}return e}function qf(){var e;e=fa();if(e===g){e=ca();if(e===g){if(v.charCodeAt(No)===58){e=O;No++}else{e=g;if(Po===0){zo(N)}}if(e===g){if(v.charCodeAt(No)===64){e=D;No++}else{e=g;if(Po===0){zo(x)}}if(e===g){if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}}}}}}}}}return e}function Mf(){var e,t,r,i,n;e=No;t=No;r=Zo();if(r!==g){i=[];n=Zo();if(n===g){n=Qo();if(n===g){if(v.charCodeAt(No)===43){n=L;No++}else{n=g;if(Po===0){zo(q)}}if(n===g){if(v.charCodeAt(No)===45){n=G;No++}else{n=g;if(Po===0){zo(W)}}if(n===g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}}}}}while(n!==g){i.push(n);n=Zo();if(n===g){n=Qo();if(n===g){if(v.charCodeAt(No)===43){n=L;No++}else{n=g;if(Po===0){zo(q)}}if(n===g){if(v.charCodeAt(No)===45){n=G;No++}else{n=g;if(Po===0){zo(W)}}if(n===g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}}}}}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t!==g){Do=e;t=Sr()}e=t;return e}function Ff(){var e;e=Bf();if(e===g){e=jf()}return e}function Bf(){var e,t,r,i;e=No;t=No;r=Wa();if(r!==g){if(v.charCodeAt(No)===64){i=D;No++}else{i=g;if(Po===0){zo(x)}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=null}if(t!==g){r=za();if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=null}return e}function jf(){var e,t;e=[];t=fa();if(t===g){t=ca();if(t===g){if(v.charCodeAt(No)===36){t=M;No++}else{t=g;if(Po===0){zo(F)}}if(t===g){if(v.charCodeAt(No)===44){t=B;No++}else{t=g;if(Po===0){zo(j)}}if(t===g){if(v.charCodeAt(No)===59){t=b;No++}else{t=g;if(Po===0){zo(w)}}if(t===g){if(v.charCodeAt(No)===58){t=O;No++}else{t=g;if(Po===0){zo(N)}}if(t===g){if(v.charCodeAt(No)===64){t=D;No++}else{t=g;if(Po===0){zo(x)}}if(t===g){if(v.charCodeAt(No)===38){t=k;No++}else{t=g;if(Po===0){zo(U)}}if(t===g){if(v.charCodeAt(No)===61){t=P;No++}else{t=g;if(Po===0){zo(H)}}if(t===g){if(v.charCodeAt(No)===43){t=L;No++}else{t=g;if(Po===0){zo(q)}}}}}}}}}}}if(t!==g){while(t!==g){e.push(t);t=fa();if(t===g){t=ca();if(t===g){if(v.charCodeAt(No)===36){t=M;No++}else{t=g;if(Po===0){zo(F)}}if(t===g){if(v.charCodeAt(No)===44){t=B;No++}else{t=g;if(Po===0){zo(j)}}if(t===g){if(v.charCodeAt(No)===59){t=b;No++}else{t=g;if(Po===0){zo(w)}}if(t===g){if(v.charCodeAt(No)===58){t=O;No++}else{t=g;if(Po===0){zo(N)}}if(t===g){if(v.charCodeAt(No)===64){t=D;No++}else{t=g;if(Po===0){zo(x)}}if(t===g){if(v.charCodeAt(No)===38){t=k;No++}else{t=g;if(Po===0){zo(U)}}if(t===g){if(v.charCodeAt(No)===61){t=P;No++}else{t=g;if(Po===0){zo(H)}}if(t===g){if(v.charCodeAt(No)===43){t=L;No++}else{t=g;if(Po===0){zo(q)}}}}}}}}}}}}}else{e=g}return e}function Gf(){var e,t;e=[];t=kf();while(t!==g){e.push(t);t=kf()}return e}function Wf(){var e,t,r,i,n,s,o;e=No;if(v.substr(No,3).toLowerCase()===lt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Ar)}}if(t!==g){if(v.charCodeAt(No)===47){r=E;No++}else{r=g;if(Po===0){zo(R)}}if(r!==g){i=[];n=Qo();if(n!==g){while(n!==g){i.push(n);n=Qo()}}else{i=g}if(i!==g){if(v.charCodeAt(No)===46){n=Y;No++}else{n=g;if(Po===0){zo(z)}}if(n!==g){s=[];o=Qo();if(o!==g){while(o!==g){s.push(o);o=Qo()}}else{s=g}if(s!==g){Do=e;t=br();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Kf(){var e;if(v.substr(No,6)===wr){e=wr;No+=6}else{e=g;if(Po===0){zo(Er)}}return e}function Vf(){var e;if(v.substr(No,3)===Rr){e=Rr;No+=3}else{e=g;if(Po===0){zo(_r)}}return e}function Yf(){var e;if(v.substr(No,5)===Ir){e=Ir;No+=5}else{e=g;if(Po===0){zo(Or)}}return e}function zf(){var e;if(v.substr(No,7)===Nr){e=Nr;No+=7}else{e=g;if(Po===0){zo(Dr)}}return e}function $f(){var e;if(v.substr(No,3)===xr){e=xr;No+=3}else{e=g;if(Po===0){zo(kr)}}return e}function Jf(){var e;if(v.substr(No,6)===Ur){e=Ur;No+=6}else{e=g;if(Po===0){zo(Pr)}}return e}function Xf(){var e;if(v.substr(No,8)===Hr){e=Hr;No+=8}else{e=g;if(Po===0){zo(Lr)}}return e}function Qf(){var e;if(v.substr(No,9)===qr){e=qr;No+=9}else{e=g;if(Po===0){zo(Mr)}}return e}function Zf(){var e;if(v.substr(No,6)===Fr){e=Fr;No+=6}else{e=g;if(Po===0){zo(Br)}}return e}function eu(){var e;if(v.substr(No,5)===jr){e=jr;No+=5}else{e=g;if(Po===0){zo(Gr)}}return e}function tu(){var e;if(v.substr(No,7)===Wr){e=Wr;No+=7}else{e=g;if(Po===0){zo(Kr)}}return e}function ru(){var e,t;e=No;t=Kf();if(t===g){t=Vf();if(t===g){t=zf();if(t===g){t=$f();if(t===g){t=Jf();if(t===g){t=Xf();if(t===g){t=Qf();if(t===g){t=tu();if(t===g){t=Zf();if(t===g){t=eu();if(t===g){t=Ta()}}}}}}}}}}if(t!==g){Do=e;t=Vr()}e=t;return e}function iu(){var e,t,r,i,n,s;e=No;t=Wf();if(t!==g){r=na();if(r!==g){i=nu();if(i!==g){n=na();if(n!==g){s=ou();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function nu(){var e,t;e=No;t=su();if(t!==g){Do=e;t=Yr(t)}e=t;return e}function su(){var e,t,r,i;e=No;t=Qo();if(t!==g){r=Qo();if(r!==g){i=Qo();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ou(){var e,t,r;e=No;t=[];r=aa();if(r===g){r=fa();if(r===g){r=ca();if(r===g){r=ga();if(r===g){r=ma();if(r===g){r=na();if(r===g){r=sa()}}}}}}while(r!==g){t.push(r);r=aa();if(r===g){r=fa();if(r===g){r=ca();if(r===g){r=ga();if(r===g){r=ma();if(r===g){r=na();if(r===g){r=sa()}}}}}}}if(t!==g){Do=e;t=zr()}e=t;return e}function au(){var e,t,r,i,n,s;e=No;t=Fu();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=Fu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=Fu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function fu(){var e,t,r,i,n;e=No;t=Aa();if(t!==g){r=No;if(v.charCodeAt(No)===64){i=D;No++}else{i=g;if(Po===0){zo(x)}}if(i!==g){n=Aa();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){Do=e;t=$r();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function uu(){var e,t,r,i,n,s,o;e=No;t=ba();if(t===g){t=No;r=cu();if(r!==g){i=[];n=No;s=Na();if(s!==g){o=cu();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;s=Na();if(s!==g){o=cu();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}}if(t!==g){Do=e;t=Jr()}e=t;return e}function cu(){var e,t,r,i,n,s;e=No;t=Ba();if(t===g){t=lu()}if(t!==g){r=[];i=No;n=Da();if(n!==g){s=du();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=du();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Xr();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function lu(){var e,t,r,i,n;e=No;t=hu();if(t===g){t=null}if(t!==g){r=Oa();if(r!==g){i=ja();if(i!==g){n=Ia();if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function hu(){var e,t,r,i,n,s,o;e=No;t=No;r=Ta();if(r!==g){i=[];n=No;s=la();if(s!==g){o=Ta();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;s=la();if(s!==g){o=Ta();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=La()}if(t!==g){Do=e;t=Qr(t)}e=t;return e}function du(){var e;e=pu();if(e===g){e=vu();if(e===g){e=yu()}}return e}function pu(){var e,t,r,i;e=No;if(v.substr(No,1).toLowerCase()===Zr){t=v.charAt(No);No++}else{t=g;if(Po===0){zo(ei)}}if(t!==g){r=Ea();if(r!==g){i=mu();if(i!==g){Do=e;t=ti(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function vu(){var e,t,r,i;e=No;if(v.substr(No,7).toLowerCase()===ri){t=v.substr(No,7);No+=7}else{t=g;if(Po===0){zo(ii)}}if(t!==g){r=Ea();if(r!==g){i=gu();if(i!==g){Do=e;t=ni(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function gu(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=si(t)}e=t;return e}function mu(){var e,t,r,i,n,s,o;e=No;if(v.charCodeAt(No)===48){t=oi;No++}else{t=g;if(Po===0){zo(ai)}}if(t!==g){r=No;if(v.charCodeAt(No)===46){i=Y;No++}else{i=g;if(Po===0){zo(z)}}if(i!==g){n=Qo();if(n===g){n=null}if(n!==g){s=Qo();if(s===g){s=null}if(s!==g){o=Qo();if(o===g){o=null}if(o!==g){i=[i,n,s,o];r=i}else{No=r;r=g}}else{No=r;r=g}}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){Do=e;t=fi();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function yu(){var e,t,r,i,n;e=No;t=Ta();if(t!==g){r=No;i=Ea();if(i!==g){n=Tu();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){Do=e;t=ui(t,r);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Tu(){var e;e=Ta();if(e===g){e=$a();if(e===g){e=La()}}return e}function Cu(){var e,t,r,i,n,s;e=No;t=Su();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=Au();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=Au();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Su(){var e,t;e=No;if(v.substr(No,6).toLowerCase()===ci){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(li)}}if(t===g){if(v.substr(No,7).toLowerCase()===hi){t=v.substr(No,7);No+=7}else{t=g;if(Po===0){zo(di)}}if(t===g){if(v.substr(No,4).toLowerCase()===pi){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(vi)}}if(t===g){if(v.substr(No,5).toLowerCase()===gi){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(mi)}}if(t===g){t=Ta()}}}}if(t!==g){Do=e;t=yi()}e=t;return e}function Au(){var e;e=bu();if(e===g){e=yu()}return e}function bu(){var e,t,r,i;e=No;if(v.substr(No,8).toLowerCase()===Ti){t=v.substr(No,8);No+=8}else{t=g;if(Po===0){zo(Ci)}}if(t!==g){r=Ea();if(r!==g){if(v.substr(No,8).toLowerCase()===Si){i=v.substr(No,8);No+=8}else{i=g;if(Po===0){zo(Ai)}}if(i===g){if(v.substr(No,8).toLowerCase()===bi){i=v.substr(No,8);No+=8}else{i=g;if(Po===0){zo(wi)}}if(i===g){i=Ta()}}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function wu(){var e,t,r,i,n,s;e=No;t=Ta();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=Ta();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=Ta();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Eu(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=Ei(t)}e=t;return e}function Ru(){var e,t;e=No;t=_u();if(t!==g){Do=e;t=Ri()}e=t;return e}function _u(){var e,t,r,i,n,s,o,a;e=No;t=Iu();if(t!==g){r=wa();if(r!==g){i=ku();if(i!==g){n=[];s=No;o=Da();if(o!==g){a=Uu();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}while(s!==g){n.push(s);s=No;o=Da();if(o!==g){a=Uu();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Iu(){var e;e=Ou();if(e===g){e=Nu()}return e}function Ou(){var e;if(v.substr(No,4).toLowerCase()===_i){e=v.substr(No,4);No+=4}else{e=g;if(Po===0){zo(Ii)}}if(e===g){if(v.substr(No,5).toLowerCase()===Oi){e=v.substr(No,5);No+=5}else{e=g;if(Po===0){zo(Ni)}}if(e===g){if(v.substr(No,5).toLowerCase()===Di){e=v.substr(No,5);No+=5}else{e=g;if(Po===0){zo(xi)}}if(e===g){if(v.substr(No,5).toLowerCase()===ki){e=v.substr(No,5);No+=5}else{e=g;if(Po===0){zo(Ui)}}if(e===g){if(v.substr(No,11).toLowerCase()===Pi){e=v.substr(No,11);No+=11}else{e=g;if(Po===0){zo(Hi)}}if(e===g){e=Du()}}}}}return e}function Nu(){var e;if(v.substr(No,7).toLowerCase()===Li){e=v.substr(No,7);No+=7}else{e=g;if(Po===0){zo(qi)}}if(e===g){if(v.substr(No,9).toLowerCase()===Mi){e=v.substr(No,9);No+=9}else{e=g;if(Po===0){zo(Fi)}}if(e===g){e=Du()}}return e}function Du(){var e;e=Ta();if(e===g){e=xu()}return e}function xu(){var e,t,r;e=No;if(v.substr(No,2).toLowerCase()===Bi){t=v.substr(No,2);No+=2}else{t=g;if(Po===0){zo(ji)}}if(t!==g){r=Ta();if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function ku(){var e;e=Du();if(e===g){e=Ta()}return e}function Uu(){var e,t,r,i;e=No;t=Ta();if(t!==g){r=Ea();if(r!==g){i=Pu();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Pu(){var e;e=Ta();if(e===g){e=La()}return e}function Hu(){var e,t,r,i;e=No;t=Lu();if(t!==g){r=la();if(r!==g){i=ru();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Lu(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=Gi(t)}e=t;return e}function qu(){var e,t;e=No;t=gu();if(t!==g){Do=e;t=Wi(t)}e=t;return e}function Mu(){var e,t,r,i,n,s;e=No;t=Fu();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Ki(t);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Fu(){var e,t,r,i,n,s,o;e=No;t=No;r=Ca();if(r!==g){i=[];n=No;if(v.charCodeAt(No)===46){s=Y;No++}else{s=g;if(Po===0){zo(z)}}if(s!==g){o=Ca();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;if(v.charCodeAt(No)===46){s=Y;No++}else{s=g;if(Po===0){zo(z)}}if(s!==g){o=Ca();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){r=[r,i];t=r}else{No=t;t=g}}else{No=t;t=g}if(t!==g){e=v.substring(e,No)}else{e=t}return e}function Bu(){var e,t,r,i,n,s;e=No;t=Ba();if(t===g){t=lu()}if(t!==g){r=[];i=No;n=Da();if(n!==g){s=ju();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=ju();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Vi();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function ju(){var e;e=Gu();if(e===g){e=yu()}return e}function Gu(){var e,t,r,i;e=No;if(v.substr(No,3).toLowerCase()===Yi){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(zi)}}if(t!==g){r=Ea();if(r!==g){i=Ta();if(i!==g){Do=e;t=$i(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Wu(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=Ji(t)}e=t;return e}function Ku(){var e,t;e=No;t=gu();if(t!==g){Do=e;t=Xi(t)}e=t;return e}function Vu(){var e,t,r,i,n,s,o,a,f;e=No;t=[];r=hu();while(r!==g){t.push(r);r=hu()}if(t!==g){r=Oa();if(r!==g){i=ja();if(i!==g){n=Ia();if(n!==g){s=[];o=No;a=Da();if(a!==g){f=yu();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}while(o!==g){s.push(o);o=No;a=Da();if(a!==g){f=yu();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}}if(s!==g){Do=e;t=Qi();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Yu(){var e;e=zu();return e}function zu(){var e,t,r,i,n,s,o,a;e=No;if(v.substr(No,6).toLowerCase()===Zi){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(en)}}if(t!==g){r=la();if(r!==g){i=Xu();if(i!==g){n=[];s=No;o=Na();if(o!==g){a=Xu();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}while(s!==g){n.push(s);s=No;o=Na();if(o!==g){a=Xu();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=$u()}return e}function $u(){var e,t,r,i,n,s,o,a;e=No;t=Ta();if(t!==g){r=la();if(r!==g){i=Ju();if(i!==g){n=[];s=No;o=Na();if(o!==g){a=Ju();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}while(s!==g){n.push(s);s=No;o=Na();if(o!==g){a=Ju();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Ju(){var e,t,r,i;e=No;t=Ta();if(t!==g){r=Ea();if(r!==g){i=Ta();if(i===g){i=La()}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Xu(){var e;e=Qu();if(e===g){e=ec();if(e===g){e=rc();if(e===g){e=nc();if(e===g){e=sc();if(e===g){e=oc();if(e===g){e=ac();if(e===g){e=Ju()}}}}}}}return e}function Qu(){var e,t,r,i;e=No;if(v.substr(No,5).toLowerCase()===tn){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(rn)}}if(t!==g){r=Ea();if(r!==g){i=Zu();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Zu(){var e,t;e=No;t=qa();if(t!==g){Do=e;t=nn(t)}e=t;return e}function ec(){var e,t,r,i,n,s,o,a,f;e=No;if(v.substr(No,6).toLowerCase()===sn){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(on)}}if(t!==g){r=Ea();if(r!==g){i=ka();if(i!==g){n=tc();if(n!==g){s=[];o=No;a=[];f=na();if(f!==g){while(f!==g){a.push(f);f=na()}}else{a=g}if(a!==g){f=tc();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}while(o!==g){s.push(o);o=No;a=[];f=na();if(f!==g){while(f!==g){a.push(f);f=na()}}else{a=g}if(a!==g){f=tc();if(f!==g){a=[a,f];o=a}else{No=o;o=g}}else{No=o;o=g}}if(s!==g){o=Ua();if(o!==g){t=[t,r,i,n,s,o];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function tc(){var e;e=If();if(e===g){e=Df()}return e}function rc(){var e,t,r,i;e=No;if(v.substr(No,5).toLowerCase()===an){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(fn)}}if(t!==g){r=Ea();if(r!==g){i=ic();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ic(){var e,t;e=No;t=qa();if(t!==g){Do=e;t=un(t)}e=t;return e}function nc(){var e,t,r,i;e=No;if(v.substr(No,6).toLowerCase()===cn){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(ln)}}if(t!==g){r=Ea();if(r!==g){i=qa();if(i!==g){Do=e;t=hn(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function sc(){var e,t,r,i,n;e=No;if(v.substr(No,5).toLowerCase()===dn){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(pn)}}if(t!==g){r=Ea();if(r!==g){i=No;if(v.substr(No,4).toLowerCase()===vn){n=v.substr(No,4);No+=4}else{n=g;if(Po===0){zo(gn)}}if(n!==g){Do=i;n=mn()}i=n;if(i===g){i=No;if(v.substr(No,5).toLowerCase()===yn){n=v.substr(No,5);No+=5}else{n=g;if(Po===0){zo(Tn)}}if(n!==g){Do=i;n=Cn()}i=n}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function oc(){var e,t,r,i;e=No;if(v.substr(No,9).toLowerCase()===Sn){t=v.substr(No,9);No+=9}else{t=g;if(Po===0){zo(An)}}if(t!==g){r=Ea();if(r!==g){if(v.substr(No,3).toLowerCase()===bn){i=v.substr(No,3);No+=3}else{i=g;if(Po===0){zo(wn)}}if(i===g){if(v.substr(No,8).toLowerCase()===En){i=v.substr(No,8);No+=8}else{i=g;if(Po===0){zo(Rn)}}if(i===g){i=Ta()}}if(i!==g){Do=e;t=_n(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ac(){var e,t,r,i,n,s,o,a,f,u;e=No;if(v.substr(No,3).toLowerCase()===In){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(On)}}if(t!==g){r=Ea();if(r!==g){i=ka();if(i!==g){n=No;s=fc();if(s!==g){o=[];a=No;if(v.charCodeAt(No)===44){f=B;No++}else{f=g;if(Po===0){zo(j)}}if(f!==g){u=fc();if(u!==g){f=[f,u];a=f}else{No=a;a=g}}else{No=a;a=g}while(a!==g){o.push(a);a=No;if(v.charCodeAt(No)===44){f=B;No++}else{f=g;if(Po===0){zo(j)}}if(f!==g){u=fc();if(u!==g){f=[f,u];a=f}else{No=a;a=g}}else{No=a;a=g}}if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n!==g){s=Ua();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function fc(){var e,t;e=No;if(v.substr(No,8).toLowerCase()===Nn){t=v.substr(No,8);No+=8}else{t=g;if(Po===0){zo(Dn)}}if(t===g){if(v.substr(No,4).toLowerCase()===xn){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(kn)}}if(t===g){t=Ta()}}if(t!==g){Do=e;t=Un(t)}e=t;return e}function uc(){var e,t,r,i,n,s;e=No;t=Ta();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=Ta();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=Ta();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function cc(){var e,t,r,i,n,s;e=No;t=lc();if(t!==g){r=la();if(r!==g){i=lc();if(i!==g){n=la();if(n!==g){s=ru();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function lc(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=Pn(t)}e=t;return e}function hc(){var e,t,r,i,n,s;e=No;t=dc();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=dc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=dc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Hn();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function dc(){var e,t,r,i,n,s;e=No;t=lu();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Ln();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function pc(){var e,t,r,i,n,s;e=No;t=Ba();if(t===g){t=lu();if(t===g){t=No;r=Oa();if(r===g){r=null}if(r!==g){i=If();if(i!==g){n=Ia();if(n===g){n=null}if(n!==g){r=[r,i,n];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}}if(t!==g){r=[];i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=qn();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function vc(){var e,t,r,i,n,s;e=No;t=gc();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=mc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=mc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Mn();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function gc(){var e,t;e=No;t=fu();if(t!==g){Do=e;t=Fn()}e=t;return e}function mc(){var e,t,r,i;e=No;if(v.substr(No,8).toLowerCase()===Bn){t=v.substr(No,8);No+=8}else{t=g;if(Po===0){zo(jn)}}if(t!==g){r=Ea();if(r!==g){i=Ta();if(i!==g){Do=e;t=Gn(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.substr(No,6).toLowerCase()===Wn){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(Kn)}}if(t!==g){r=Ea();if(r!==g){i=Ta();if(i!==g){Do=e;t=Vn(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.substr(No,10).toLowerCase()===Yn){t=v.substr(No,10);No+=10}else{t=g;if(Po===0){zo(zn)}}if(t!==g){Do=e;t=$n()}e=t;if(e===g){e=yu()}}}return e}function yc(){var e,t,r,i,n,s,o;e=No;t=No;r=Ta();if(r!==g){i=[];n=No;s=Na();if(s!==g){o=Ta();if(o!==g){Do=n;s=Jn(r,o);n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;s=Na();if(s!==g){o=Ta();if(o!==g){Do=n;s=Jn(r,o);n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){Do=t;r=Xn(r,i);t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=null}if(t!==g){Do=e;t=Qn(t)}e=t;return e}function Tc(){var e,t,r,i,n,s;e=No;t=Cc();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=Cc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=Cc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Cc(){var e,t,r,i,n,s;e=No;t=lu();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Sc(){var e,t,r;e=No;t=[];r=Qo();if(r!==g){while(r!==g){t.push(r);r=Qo()}}else{t=g}if(t!==g){Do=e;t=Zn(t)}e=t;return e}function Ac(){var e,t,r,i,n,s;e=No;t=bc();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=wc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=wc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function bc(){var e,t;e=No;if(v.substr(No,6).toLowerCase()===es){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(ts)}}if(t===g){if(v.substr(No,7).toLowerCase()===rs){t=v.substr(No,7);No+=7}else{t=g;if(Po===0){zo(is)}}if(t===g){if(v.substr(No,10).toLowerCase()===ns){t=v.substr(No,10);No+=10}else{t=g;if(Po===0){zo(ss)}}if(t===g){t=Ta()}}}if(t!==g){Do=e;t=os()}e=t;return e}function wc(){var e,t,r,i;e=No;if(v.substr(No,6).toLowerCase()===as){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(fs)}}if(t!==g){r=Ea();if(r!==g){i=Ec();if(i!==g){Do=e;t=us(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.substr(No,7).toLowerCase()===ri){t=v.substr(No,7);No+=7}else{t=g;if(Po===0){zo(ii)}}if(t!==g){r=Ea();if(r!==g){i=gu();if(i!==g){Do=e;t=cs(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=No;if(v.substr(No,11).toLowerCase()===ls){t=v.substr(No,11);No+=11}else{t=g;if(Po===0){zo(hs)}}if(t!==g){r=Ea();if(r!==g){i=gu();if(i!==g){Do=e;t=ds(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}if(e===g){e=yu()}}}return e}function Ec(){var e;if(v.substr(No,11).toLowerCase()===ps){e=v.substr(No,11);No+=11}else{e=g;if(Po===0){zo(vs)}}if(e===g){if(v.substr(No,9).toLowerCase()===gs){e=v.substr(No,9);No+=9}else{e=g;if(Po===0){zo(ms)}}if(e===g){if(v.substr(No,8).toLowerCase()===ys){e=v.substr(No,8);No+=8}else{e=g;if(Po===0){zo(Ts)}}if(e===g){if(v.substr(No,7).toLowerCase()===Cs){e=v.substr(No,7);No+=7}else{e=g;if(Po===0){zo(Ss)}}if(e===g){if(v.substr(No,6).toLowerCase()===As){e=v.substr(No,6);No+=6}else{e=g;if(Po===0){zo(bs)}}if(e===g){if(v.substr(No,10).toLowerCase()===ws){e=v.substr(No,10);No+=10}else{e=g;if(Po===0){zo(Es)}}if(e===g){if(v.substr(No,9).toLowerCase()===Rs){e=v.substr(No,9);No+=9}else{e=g;if(Po===0){zo(_s)}}if(e===g){e=Ta()}}}}}}}return e}function Rc(){var e;e=pa();if(e===g){e=null}return e}function _c(){var e,t,r,i,n,s,o;e=No;t=No;r=Ta();if(r!==g){i=[];n=No;s=Na();if(s!==g){o=Ta();if(o!==g){Do=n;s=Jn(r,o);n=s}else{No=n;n=g}}else{No=n;n=g}while(n!==g){i.push(n);n=No;s=Na();if(s!==g){o=Ta();if(o!==g){Do=n;s=Jn(r,o);n=s}else{No=n;n=g}}else{No=n;n=g}}if(i!==g){Do=t;r=Xn(r,i);t=r}else{No=t;t=g}}else{No=t;t=g}if(t===g){t=null}if(t!==g){Do=e;t=Is(t)}e=t;return e}function Ic(){var e,t,r,i,n,s;e=No;t=Ba();if(t===g){t=lu()}if(t!==g){r=[];i=No;n=Da();if(n!==g){s=Oc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=Oc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=Os();e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Oc(){var e;e=Gu();if(e===g){e=yu()}return e}function Nc(){var e,t,r,i,n,s;e=No;t=Dc();if(t!==g){r=[];i=No;n=Na();if(n!==g){s=Dc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Na();if(n!==g){s=Dc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Dc(){var e,t,r,i,n,s,o,a;e=No;t=qc();if(t!==g){r=la();if(r!==g){i=Bc();if(i!==g){n=[];s=No;o=Da();if(o!==g){a=xc();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}while(s!==g){n.push(s);s=No;o=Da();if(o!==g){a=xc();if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function xc(){var e;e=kc();if(e===g){e=Uc();if(e===g){e=Pc();if(e===g){e=Hc();if(e===g){e=Lc();if(e===g){e=yu()}}}}}return e}function kc(){var e,t,r,i;e=No;if(v.substr(No,3).toLowerCase()===Ns){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Ds)}}if(t!==g){r=Ea();if(r!==g){i=Wc();if(i!==g){Do=e;t=xs(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Uc(){var e,t,r,i;e=No;if(v.substr(No,5).toLowerCase()===ks){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(Us)}}if(t!==g){r=Ea();if(r!==g){i=$a();if(i!==g){Do=e;t=Ps(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Pc(){var e,t,r,i;e=No;if(v.substr(No,8).toLowerCase()===Hs){t=v.substr(No,8);No+=8}else{t=g;if(Po===0){zo(Ls)}}if(t!==g){r=Ea();if(r!==g){i=nf();if(i===g){i=ef();if(i===g){i=Za()}}if(i!==g){Do=e;t=qs(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Hc(){var e,t,r,i;e=No;if(v.substr(No,6).toLowerCase()===Ms){t=v.substr(No,6);No+=6}else{t=g;if(Po===0){zo(Fs)}}if(t!==g){r=Ea();if(r!==g){i=Ta();if(i!==g){Do=e;t=Bs(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Lc(){var e,t,r,i,n;e=No;if(v.substr(No,5).toLowerCase()===js){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(Gs)}}if(t!==g){r=Ea();if(r!==g){i=[];n=Qo();while(n!==g){i.push(n);n=Qo()}if(i!==g){Do=e;t=Ws(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function qc(){var e,t,r,i,n,s;e=No;t=Mc();if(t!==g){r=wa();if(r!==g){i=Ta();if(i!==g){n=wa();if(n!==g){s=Fc();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Mc(){var e,t;e=No;if(v.substr(No,3).toLowerCase()===lt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Ar)}}if(t===g){t=Ta()}if(t!==g){Do=e;t=Ks(t)}e=t;return e}function Fc(){var e,t;e=No;if(v.substr(No,3).toLowerCase()===jt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Vs)}}if(t===g){if(v.substr(No,3).toLowerCase()===Wt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Ys)}}if(t===g){if(v.substr(No,3).toLowerCase()===zt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(zs)}}if(t===g){if(v.substr(No,4).toLowerCase()===Vt){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo($s)}}if(t===g){t=Ta()}}}}if(t!==g){Do=e;t=Js(t)}e=t;return e}function Bc(){var e,t,r,i,n;e=No;t=jc();if(t!==g){r=No;i=xa();if(i!==g){n=Gc();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function jc(){var e,t;e=No;t=Ja();if(t===g){t=nf();if(t===g){t=Za()}}if(t!==g){Do=e;t=Xs()}e=t;return e}function Gc(){var e,t,r,i,n,s,o;e=No;t=No;r=Qo();if(r===g){r=null}if(r!==g){i=Qo();if(i===g){i=null}if(i!==g){n=Qo();if(n===g){n=null}if(n!==g){s=Qo();if(s===g){s=null}if(s!==g){o=Qo();if(o===g){o=null}if(o!==g){r=[r,i,n,s,o];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t!==g){Do=e;t=Qs(t)}e=t;return e}function Wc(){var e,t,r,i,n;e=No;t=No;r=Qo();if(r!==g){i=Qo();if(i===g){i=null}if(i!==g){n=Qo();if(n===g){n=null}if(n!==g){r=[r,i,n];t=r}else{No=t;t=g}}else{No=t;t=g}}else{No=t;t=g}if(t!==g){Do=e;t=Zs(t)}e=t;return e}function Kc(){var e;e=zu();return e}function Vc(){var e,t,r,i,n,s;e=No;t=gu();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=Yc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=Yc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=eo(t);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Yc(){var e;e=zc();if(e===g){e=yu()}return e}function zc(){var e,t,r,i;e=No;if(v.substr(No,9)===to){t=to;No+=9}else{t=g;if(Po===0){zo(ro)}}if(t!==g){r=Ea();if(r!==g){if(v.substr(No,3)===io){i=io;No+=3}else{i=g;if(Po===0){zo(no)}}if(i===g){if(v.substr(No,3)===so){i=so;No+=3}else{i=g;if(Po===0){zo(oo)}}}if(i!==g){Do=e;t=ao(i);e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function $c(){var e,t,r,i,n,s;e=No;t=gu();if(t!==g){r=[];i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}while(i!==g){r.push(i);i=No;n=Da();if(n!==g){s=yu();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}}if(r!==g){Do=e;t=fo(t);e=t}else{No=e;e=g}}else{No=e;e=g}return e}function Jc(){var e,t,r,i;e=No;t=Ta();if(t!==g){r=da();if(r!==g){i=Xc();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function Xc(){var e,t;e=[];t=va();if(t===g){t=ma();if(t===g){t=la()}}while(t!==g){e.push(t);t=va();if(t===g){t=ma();if(t===g){t=la()}}}return e}function Qc(){var e,t;e=[];t=ra();while(t!==g){e.push(t);t=ra()}return e}function Zc(){var e,t,r,i;e=No;t=el();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=tl();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function el(){var e,t;e=No;if(v.substr(No,5).toLowerCase()===uo){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(co)}}if(t===g){if(v.substr(No,4).toLowerCase()===lo){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(ho)}}}if(t!==g){Do=e;t=po(t)}e=t;return e}function tl(){var e,t,r,i,n;e=No;t=rl();if(t!==g){r=No;if(v.charCodeAt(No)===58){i=O;No++}else{i=g;if(Po===0){zo(N)}}if(i!==g){n=of();if(n!==g){i=[i,n];r=i}else{No=r;r=g}}else{No=r;r=g}if(r===g){r=null}if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function rl(){var e,t;e=No;t=nf();if(t===g){t=Za();if(t===g){t=jf()}}if(t!==g){Do=e;t=vo(t)}e=t;return e}function il(){var e;e=Zo();if(e===g){e=Qo();if(e===g){if(v.charCodeAt(No)===45){e=G;No++}else{e=g;if(Po===0){zo(W)}}if(e===g){if(v.charCodeAt(No)===46){e=Y;No++}else{e=g;if(Po===0){zo(z)}}if(e===g){if(v.charCodeAt(No)===95){e=K;No++}else{e=g;if(Po===0){zo(V)}}if(e===g){if(v.charCodeAt(No)===126){e=X;No++}else{e=g;if(Po===0){zo(Q)}}}}}}}return e}function nl(){var e;if(v.charCodeAt(No)===33){e=$;No++}else{e=g;if(Po===0){zo(J)}}if(e===g){if(v.charCodeAt(No)===36){e=M;No++}else{e=g;if(Po===0){zo(F)}}if(e===g){if(v.charCodeAt(No)===38){e=k;No++}else{e=g;if(Po===0){zo(U)}}if(e===g){if(v.charCodeAt(No)===39){e=te;No++}else{e=g;if(Po===0){zo(re)}}if(e===g){if(v.charCodeAt(No)===40){e=ie;No++}else{e=g;if(Po===0){zo(ne)}}if(e===g){if(v.charCodeAt(No)===41){e=se;No++}else{e=g;if(Po===0){zo(oe)}}if(e===g){if(v.charCodeAt(No)===42){e=Z;No++}else{e=g;if(Po===0){zo(ee)}}if(e===g){if(v.charCodeAt(No)===43){e=L;No++}else{e=g;if(Po===0){zo(q)}}if(e===g){if(v.charCodeAt(No)===44){e=B;No++}else{e=g;if(Po===0){zo(j)}}if(e===g){if(v.charCodeAt(No)===59){e=b;No++}else{e=g;if(Po===0){zo(w)}}if(e===g){if(v.charCodeAt(No)===61){e=P;No++}else{e=g;if(Po===0){zo(H)}}}}}}}}}}}}return e}function sl(){var e,t,r,i,n,s,o;e=No;t=ol();if(t!==g){if(v.charCodeAt(No)===58){r=O;No++}else{r=g;if(Po===0){zo(N)}}if(r!==g){i=tl();if(i!==g){n=No;if(v.substr(No,11)===go){s=go;No+=11}else{s=g;if(Po===0){zo(mo)}}if(s!==g){o=Fc();if(o!==g){s=[s,o];n=s}else{No=n;n=g}}else{No=n;n=g}if(n===g){n=null}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ol(){var e,t;e=No;if(v.substr(No,5).toLowerCase()===yo){t=v.substr(No,5);No+=5}else{t=g;if(Po===0){zo(To)}}if(t===g){if(v.substr(No,4).toLowerCase()===Co){t=v.substr(No,4);No+=4}else{t=g;if(Po===0){zo(So)}}}if(t!==g){Do=e;t=po(t)}e=t;return e}function al(){var e,t,r;e=No;if(v.substr(No,3).toLowerCase()===jt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Gt)}}if(t===g){if(v.substr(No,3).toLowerCase()===Wt){t=v.substr(No,3);No+=3}else{t=g;if(Po===0){zo(Kt)}}if(t===g){t=[];r=fa();while(r!==g){t.push(r);r=fa()}}}if(t!==g){Do=e;t=Ao(t)}e=t;return e}function fl(){var e,t,r,i,n,s,o,a,f,u;e=No;t=cl();if(t!==g){if(v.charCodeAt(No)===45){r=G;No++}else{r=g;if(Po===0){zo(W)}}if(r!==g){i=ul();if(i!==g){if(v.charCodeAt(No)===45){n=G;No++}else{n=g;if(Po===0){zo(W)}}if(n!==g){s=ul();if(s!==g){if(v.charCodeAt(No)===45){o=G;No++}else{o=g;if(Po===0){zo(W)}}if(o!==g){a=ul();if(a!==g){if(v.charCodeAt(No)===45){f=G;No++}else{f=g;if(Po===0){zo(W)}}if(f!==g){u=ll();if(u!==g){Do=e;t=bo();e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function ul(){var e,t,r,i,n;e=No;t=ea();if(t!==g){r=ea();if(r!==g){i=ea();if(i!==g){n=ea();if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function cl(){var e,t,r;e=No;t=ul();if(t!==g){r=ul();if(r!==g){t=[t,r];e=t}else{No=e;e=g}}else{No=e;e=g}return e}function ll(){var e,t,r,i;e=No;t=ul();if(t!==g){r=ul();if(r!==g){i=ul();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function hl(){var e,t,r,i,n,s;e=No;t=Ef();if(t!==g){r=[];i=Sf();while(i!==g){r.push(i);i=Sf()}if(r!==g){i=No;n=Xo();if(n!==g){s=Qc();if(s!==g){n=[n,s];i=n}else{No=i;i=g}}else{No=i;i=g}if(i===g){i=null}if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function dl(){var e,t,r,i,n,s,o,a;e=No;if(v.substr(No,11)===wo){t=wo;No+=11}else{t=g;if(Po===0){zo(Eo)}}if(t===g){if(v.charCodeAt(No)===98){t=Ro;No++}else{t=g;if(Po===0){zo(_o)}}}if(t!==g){r=da();if(r!==g){i=pl();if(i!==g){n=[];s=No;o=Da();if(o!==g){a=vl();if(a===g){a=yu()}if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}while(s!==g){n.push(s);s=No;o=Da();if(o!==g){a=vl();if(a===g){a=yu()}if(a!==g){o=[o,a];s=o}else{No=s;s=g}}else{No=s;s=g}}if(n!==g){t=[t,r,i,n];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function pl(){var e;e=lu();if(e===g){e=Ba()}return e}function vl(){var e,t,r,i;e=No;if(v.substr(No,3)===Io){t=Io;No+=3}else{t=g;if(Po===0){zo(Oo)}}if(t!==g){r=Ea();if(r!==g){i=gl();if(i!==g){t=[t,r,i];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}function gl(){var e,t,r,i,n,s;e=No;t=ka();if(t!==g){r=ua();if(r!==g){if(v.charCodeAt(No)===64){i=D;No++}else{i=g;if(Po===0){zo(x)}}if(i!==g){n=ua();if(n===g){n=$a()}if(n!==g){s=Ua();if(s!==g){t=[t,r,i,n,s];e=t}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}}else{No=e;e=g}return e}r.data={};function ml(e,t){return[e].concat(t)}Ho=t();if(Ho!==g&&No===v.length){return Ho}else{if(Ho!==g&&No<v.length){zo(Wo())}throw Jo(Uo,ko<v.length?v.charAt(ko):null,ko<v.length?Yo(ko,ko+1):Yo(ko,ko))}}t.parse=n},function(r,i,n){(function(e,t){if(true){r.exports=i=t(n(64))}else{}})(this,function(o){(function(c){var e=o;var t=e.lib;var r=t.WordArray;var i=t.Hasher;var n=e.algo;var R=[];(function(){for(var e=0;e<64;e++){R[e]=c.abs(c.sin(e+1))*4294967296|0}})();var s=n.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var i=t+r;var n=e[i];e[i]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}var s=this._hash.words;var o=e[t+0];var a=e[t+1];var f=e[t+2];var u=e[t+3];var c=e[t+4];var l=e[t+5];var h=e[t+6];var d=e[t+7];var p=e[t+8];var v=e[t+9];var g=e[t+10];var m=e[t+11];var y=e[t+12];var T=e[t+13];var C=e[t+14];var S=e[t+15];var A=s[0];var b=s[1];var w=s[2];var E=s[3];A=_(A,b,w,E,o,7,R[0]);E=_(E,A,b,w,a,12,R[1]);w=_(w,E,A,b,f,17,R[2]);b=_(b,w,E,A,u,22,R[3]);A=_(A,b,w,E,c,7,R[4]);E=_(E,A,b,w,l,12,R[5]);w=_(w,E,A,b,h,17,R[6]);b=_(b,w,E,A,d,22,R[7]);A=_(A,b,w,E,p,7,R[8]);E=_(E,A,b,w,v,12,R[9]);w=_(w,E,A,b,g,17,R[10]);b=_(b,w,E,A,m,22,R[11]);A=_(A,b,w,E,y,7,R[12]);E=_(E,A,b,w,T,12,R[13]);w=_(w,E,A,b,C,17,R[14]);b=_(b,w,E,A,S,22,R[15]);A=I(A,b,w,E,a,5,R[16]);E=I(E,A,b,w,h,9,R[17]);w=I(w,E,A,b,m,14,R[18]);b=I(b,w,E,A,o,20,R[19]);A=I(A,b,w,E,l,5,R[20]);E=I(E,A,b,w,g,9,R[21]);w=I(w,E,A,b,S,14,R[22]);b=I(b,w,E,A,c,20,R[23]);A=I(A,b,w,E,v,5,R[24]);E=I(E,A,b,w,C,9,R[25]);w=I(w,E,A,b,u,14,R[26]);b=I(b,w,E,A,p,20,R[27]);A=I(A,b,w,E,T,5,R[28]);E=I(E,A,b,w,f,9,R[29]);w=I(w,E,A,b,d,14,R[30]);b=I(b,w,E,A,y,20,R[31]);A=O(A,b,w,E,l,4,R[32]);E=O(E,A,b,w,p,11,R[33]);w=O(w,E,A,b,m,16,R[34]);b=O(b,w,E,A,C,23,R[35]);A=O(A,b,w,E,a,4,R[36]);E=O(E,A,b,w,c,11,R[37]);w=O(w,E,A,b,d,16,R[38]);b=O(b,w,E,A,g,23,R[39]);A=O(A,b,w,E,T,4,R[40]);E=O(E,A,b,w,o,11,R[41]);w=O(w,E,A,b,u,16,R[42]);b=O(b,w,E,A,h,23,R[43]);A=O(A,b,w,E,v,4,R[44]);E=O(E,A,b,w,y,11,R[45]);w=O(w,E,A,b,S,16,R[46]);b=O(b,w,E,A,f,23,R[47]);A=N(A,b,w,E,o,6,R[48]);E=N(E,A,b,w,d,10,R[49]);w=N(w,E,A,b,C,15,R[50]);b=N(b,w,E,A,l,21,R[51]);A=N(A,b,w,E,y,6,R[52]);E=N(E,A,b,w,u,10,R[53]);w=N(w,E,A,b,g,15,R[54]);b=N(b,w,E,A,a,21,R[55]);A=N(A,b,w,E,p,6,R[56]);E=N(E,A,b,w,S,10,R[57]);w=N(w,E,A,b,h,15,R[58]);b=N(b,w,E,A,T,21,R[59]);A=N(A,b,w,E,c,6,R[60]);E=N(E,A,b,w,m,10,R[61]);w=N(w,E,A,b,f,15,R[62]);b=N(b,w,E,A,v,21,R[63]);s[0]=s[0]+A|0;s[1]=s[1]+b|0;s[2]=s[2]+w|0;s[3]=s[3]+E|0},_doFinalize:function(){var e=this._data;var t=e.words;var r=this._nDataBytes*8;var i=e.sigBytes*8;t[i>>>5]|=128<<24-i%32;var n=c.floor(r/4294967296);var s=r;t[(i+64>>>9<<4)+15]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360;t[(i+64>>>9<<4)+14]=(s<<8|s>>>24)&16711935|(s<<24|s>>>8)&4278255360;e.sigBytes=(t.length+1)*4;this._process();var o=this._hash;var a=o.words;for(var f=0;f<4;f++){var u=a[f];a[f]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360}return o},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});function _(e,t,r,i,n,s,o){var a=e+(t&r|~t&i)+n+o;return(a<<s|a>>>32-s)+t}function I(e,t,r,i,n,s,o){var a=e+(t&i|r&~i)+n+o;return(a<<s|a>>>32-s)+t}function O(e,t,r,i,n,s,o){var a=e+(t^r^i)+n+o;return(a<<s|a>>>32-s)+t}function N(e,t,r,i,n,s,o){var a=e+(r^(t|~i))+n+o;return(a<<s|a>>>32-s)+t}e.MD5=i._createHelper(s);e.HmacMD5=i._createHmacHelper(s)})(Math);return o.MD5})},function(r,i,e){(function(e,t){if(true){r.exports=i=t()}else{}})(this,function(){var e=e||function(l,r){var i=Object.create||function(){function r(){}return function(e){var t;r.prototype=e;t=new r;r.prototype=null;return t}}();var e={};var t=e.lib={};var n=t.Base=function(){return{extend:function(e){var t=i(this);if(e){t.mixIn(e)}if(!t.hasOwnProperty("init")||this.init===t.init){t.init=function(){t.$super.init.apply(this,arguments)}}t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}if(e.hasOwnProperty("toString")){this.toString=e.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var h=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[];if(t!=r){this.sigBytes=t}else{this.sigBytes=e.length*4}},toString:function(e){return(e||o).stringify(this)},concat:function(e){var t=this.words;var r=e.words;var i=this.sigBytes;var n=e.sigBytes;this.clamp();if(i%4){for(var s=0;s<n;s++){var o=r[s>>>2]>>>24-s%4*8&255;t[i+s>>>2]|=o<<24-(i+s)%4*8}}else{for(var s=0;s<n;s+=4){t[i+s>>>2]=r[s>>>2]}}this.sigBytes+=n;return this},clamp:function(){var e=this.words;var t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8;e.length=l.ceil(t/4)},clone:function(){var e=n.clone.call(this);e.words=this.words.slice(0);return e},random:function(e){var t=[];var r=function(t){var t=t;var r=987654321;var i=4294967295;return function(){r=36969*(r&65535)+(r>>16)&i;t=18e3*(t&65535)+(t>>16)&i;var e=(r<<16)+t&i;e/=4294967296;e+=.5;return e*(l.random()>.5?1:-1)}};for(var i=0,n;i<e;i+=4){var s=r((n||l.random())*4294967296);n=s()*987654071;t.push(s()*4294967296|0)}return new h.init(t,e)}});var s=e.enc={};var o=s.Hex={stringify:function(e){var t=e.words;var r=e.sigBytes;var i=[];for(var n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push((s>>>4).toString(16));i.push((s&15).toString(16))}return i.join("")},parse:function(e){var t=e.length;var r=[];for(var i=0;i<t;i+=2){r[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4}return new h.init(r,t/2)}};var a=s.Latin1={stringify:function(e){var t=e.words;var r=e.sigBytes;var i=[];for(var n=0;n<r;n++){var s=t[n>>>2]>>>24-n%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse:function(e){var t=e.length;var r=[];for(var i=0;i<t;i++){r[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8}return new h.init(r,t)}};var f=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}};var u=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new h.init;this._nDataBytes=0},_append:function(e){if(typeof e=="string"){e=f.parse(e)}this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data;var r=t.words;var i=t.sigBytes;var n=this.blockSize;var s=n*4;var o=i/s;if(e){o=l.ceil(o)}else{o=l.max((o|0)-this._minBufferSize,0)}var a=o*n;var f=l.min(a*4,i);if(a){for(var u=0;u<a;u+=n){this._doProcessBlock(r,u)}var c=r.splice(0,a);t.sigBytes-=f}return new h.init(c,f)},clone:function(){var e=n.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});var c=t.Hasher=u.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){u.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){if(e){this._append(e)}var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new d.HMAC.init(r,t).finalize(e)}}});var d=e.algo={};return e}(Math);return e})},function(e,t,r){"use strict";var i=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:true});var n=r(6);var s=r(2);var a=r(0);var f=r(7);var u=r(3);var o=function(o){i(e,o);function e(e,t,r){if(r===void 0){r={}}var i=o.call(this)||this;i.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};i.type=a.TypeStrings.DTMF;if(t===undefined){throw new TypeError("Not enough arguments")}i.logger=e.ua.getLogger("sip.invitecontext.dtmf",e.id);i.owner=e;if(typeof t==="string"){t=t.toUpperCase()}else if(typeof t==="number"){t=t.toString()}else{throw new TypeError("Invalid tone: "+t)}if(!t.match(/^[0-9A-D#*]$/)){throw new TypeError("Invalid tone: "+t)}else{i.tone=t}var n=r.duration;var s=r.interToneGap;if(n&&!u.Utils.isDecimal(n)){throw new TypeError("Invalid tone duration: "+n)}else if(!n){n=i.C.DEFAULT_DURATION}else if(n<i.C.MIN_DURATION){i.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+i.C.MIN_DURATION+" milliseconds");n=i.C.MIN_DURATION}else if(n>i.C.MAX_DURATION){i.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+i.C.MAX_DURATION+" milliseconds");n=i.C.MAX_DURATION}else{n=Math.abs(n)}i.duration=n;if(s&&!u.Utils.isDecimal(s)){throw new TypeError("Invalid interToneGap: "+s)}else if(!s){s=i.C.DEFAULT_INTER_TONE_GAP}else if(s<i.C.MIN_INTER_TONE_GAP){i.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+i.C.MIN_INTER_TONE_GAP+" milliseconds");s=i.C.MIN_INTER_TONE_GAP}else{s=Math.abs(s)}i.interToneGap=s;return i}e.prototype.send=function(e){if(e===void 0){e={}}if(this.owner.status!==a.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==a.SessionStatus.STATUS_WAITING_FOR_ACK){throw new f.Exceptions.InvalidStateError(this.owner.status)}var t=e.extraHeaders?e.extraHeaders.slice():[];var r={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.dialog){var i=this.owner.dialog.sendRequest(this,s.C.INFO,{extraHeaders:t,body:r});this.owner.emit("dtmf",i,this)}};e.prototype.init_incoming=function(e){e.reply(200);if(!this.tone||!this.duration){this.logger.warn("invalid INFO DTMF received, discarded")}else{this.owner.emit("dtmf",e,this)}};e.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(true){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var r=u.Utils.sipErrorCause(t);this.emit("failed",e,r);break}};e.prototype.onRequestTimeout=function(){this.emit("failed",undefined,s.C.causes.REQUEST_TIMEOUT);this.owner.onRequestTimeout()};e.prototype.onTransportError=function(){this.emit("failed",undefined,s.C.causes.CONNECTION_ERROR);this.owner.onTransportError()};e.prototype.onDialogError=function(e){this.emit("failed",e,s.C.causes.DIALOG_ERROR);this.owner.onDialogError(e)};return e}(n.EventEmitter);t.DTMF=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(0);var n=function(){function e(e,t){this.type=i.TypeStrings.SessionDescriptionHandlerObserver;this.session=e;this.options=t}e.prototype.trackAdded=function(){this.session.emit("trackAdded")};e.prototype.directionChanged=function(){this.session.emit("directionChanged")};return e}();t.SessionDescriptionHandlerObserver=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=r(24);t.Modifiers=i;var n=r(68);t.Simple=n.Simple;var s=r(41);t.SessionDescriptionHandler=s.SessionDescriptionHandler;var o=r(42);t.Transport=o.Transport},function(e,i,n){"use strict";(function(a){var t=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:true});var e=n(6);var f=n(40);var u=n(24);var c;(function(e){e[e["STATUS_NULL"]=0]="STATUS_NULL";e[e["STATUS_NEW"]=1]="STATUS_NEW";e[e["STATUS_CONNECTING"]=2]="STATUS_CONNECTING";e[e["STATUS_CONNECTED"]=3]="STATUS_CONNECTED";e[e["STATUS_COMPLETED"]=4]="STATUS_COMPLETED"})(c=i.SimpleStatus||(i.SimpleStatus={}));var r=function(o){t(e,o);function e(e){var t=o.call(this)||this;if(e.media.remote.video){t.video=true}else{t.video=false}if(e.media.remote.audio){t.audio=true}else{t.audio=false}if(!t.audio&&!t.video){throw new Error("At least one remote audio or video element is required for Simple.")}t.options=e;var r=a.navigator.userAgent.toLowerCase();var i=false;var n=false;if(r.indexOf("safari")>-1&&r.indexOf("chrome")<0){i=true}else if(r.indexOf("firefox")>-1&&r.indexOf("chrome")<0){n=true}var s={};if(i){s.modifiers=[u.stripG722]}if(n){s.alwaysAcquireMediaFirst=true}if(!t.options.ua.uri){t.anonymous=true}else{t.anonymous=false}t.ua=new f.UA({uri:t.options.ua.uri,authorizationUser:t.options.ua.authorizationUser,password:t.options.ua.password,displayName:t.options.ua.displayName,userAgentString:t.options.ua.userAgentString,register:true,sessionDescriptionHandlerFactoryOptions:s,transportOptions:{traceSip:t.options.ua.traceSip,wsServers:t.options.ua.wsServers}});t.state=c.STATUS_NULL;t.logger=t.ua.getLogger("sip.simple");t.ua.on("registered",function(){t.emit("registered",t.ua)});t.ua.on("unregistered",function(){t.emit("unregistered",t.ua)});t.ua.on("registrationFailed",function(){t.emit("unregistered",t.ua)});t.ua.on("invite",function(e){if(t.state!==c.STATUS_NULL&&t.state!==c.STATUS_COMPLETED){t.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time");e.reject();return}t.session=e;t.setupSession();t.emit("ringing",t.session)});t.ua.on("message",function(e){t.emit("message",e)});return t}e.prototype.call=function(e){if(!this.ua||!this.checkRegistration()){this.logger.warn("A registered UA is required for calling");return}if(this.state!==c.STATUS_NULL&&this.state!==c.STATUS_COMPLETED){this.logger.warn("Cannot make more than a single call with Simple");return}if(this.options.media.remote.audio){this.options.media.remote.audio.autoplay=true}if(this.options.media.remote.video){this.options.media.remote.video.autoplay=true}if(this.options.media.local&&this.options.media.local.video){this.options.media.local.video.autoplay=true;this.options.media.local.video.volume=0}this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.setupSession();return this.session};e.prototype.answer=function(){if(this.state!==c.STATUS_NEW&&this.state!==c.STATUS_CONNECTING){this.logger.warn("No call to answer");return}if(this.options.media.remote.audio){this.options.media.remote.audio.autoplay=true}if(this.options.media.remote.video){this.options.media.remote.video.autoplay=true}return this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}})};e.prototype.reject=function(){if(this.state!==c.STATUS_NEW&&this.state!==c.STATUS_CONNECTING){this.logger.warn("Call is already answered");return}return this.session.reject()};e.prototype.hangup=function(){if(this.state!==c.STATUS_CONNECTED&&this.state!==c.STATUS_CONNECTING&&this.state!==c.STATUS_NEW){this.logger.warn("No active call to hang up on");return}if(this.state!==c.STATUS_CONNECTED){return this.session.cancel()}else if(this.session){return this.session.bye()}};e.prototype.hold=function(){if(this.state!==c.STATUS_CONNECTED||!this.session||this.session.localHold){this.logger.warn("Cannot put call on hold");return}this.mute();this.logger.log("Placing session on hold");return this.session.hold()};e.prototype.unhold=function(){if(this.state!==c.STATUS_CONNECTED||!this.session||!this.session.localHold){this.logger.warn("Cannot unhold a call that is not on hold");return}this.unmute();this.logger.log("Placing call off hold");return this.session.unhold()};e.prototype.mute=function(){if(this.state!==c.STATUS_CONNECTED){this.logger.warn("An acitve call is required to mute audio");return}this.logger.log("Muting Audio");this.toggleMute(true);this.emit("mute",this)};e.prototype.unmute=function(){if(this.state!==c.STATUS_CONNECTED){this.logger.warn("An active call is required to unmute audio");return}this.logger.log("Unmuting Audio");this.toggleMute(false);this.emit("unmute",this)};e.prototype.sendDTMF=function(e){if(this.state!==c.STATUS_CONNECTED||!this.session){this.logger.warn("An active call is required to send a DTMF tone");return}this.logger.log("Sending DTMF tone: "+e);this.session.dtmf(e)};e.prototype.message=function(e,t){if(!this.ua||!this.checkRegistration()){this.logger.warn("A registered UA is required to send a message");return}if(!e||!t){this.logger.warn("A destination and message are required to send a message");return}this.ua.message(e,t)};e.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()};e.prototype.setupRemoteMedia=function(){var e=this;if(!this.session){this.logger.warn("No session to set remote media on");return}var t=this.session.sessionDescriptionHandler.peerConnection;var r;if(t.getReceivers){r=new a.window.MediaStream;t.getReceivers().forEach(function(e){var t=e.track;if(t){r.addTrack(t)}})}else{r=t.getRemoteStreams()[0]}if(this.video){this.options.media.remote.video.srcObject=r;this.options.media.remote.video.play().catch(function(){e.logger.log("play was rejected")})}else if(this.audio){this.options.media.remote.audio.srcObject=r;this.options.media.remote.audio.play().catch(function(){e.logger.log("play was rejected")})}};e.prototype.setupLocalMedia=function(){if(!this.session){this.logger.warn("No session to set local media on");return}if(this.video&&this.options.media.local&&this.options.media.local.video){var e=this.session.sessionDescriptionHandler.peerConnection;var r;if(e.getSenders){r=new a.window.MediaStream;e.getSenders().forEach(function(e){var t=e.track;if(t&&t.kind==="video"){r.addTrack(t)}})}else{r=e.getLocalStreams()[0]}this.options.media.local.video.srcObject=r;this.options.media.local.video.volume=0;this.options.media.local.video.play()}};e.prototype.cleanupMedia=function(){if(this.video){this.options.media.remote.video.srcObject=null;this.options.media.remote.video.pause();if(this.options.media.local&&this.options.media.local.video){this.options.media.local.video.srcObject=null;this.options.media.local.video.pause()}}if(this.audio){this.options.media.remote.audio.srcObject=null;this.options.media.remote.audio.pause()}};e.prototype.setupSession=function(){var e=this;if(!this.session){this.logger.warn("No session to set up");return}this.state=c.STATUS_NEW;this.emit("new",this.session);this.session.on("progress",function(){return e.onProgress()});this.session.on("accepted",function(){return e.onAccepted()});this.session.on("rejected",function(){return e.onEnded()});this.session.on("failed",function(){return e.onFailed()});this.session.on("terminated",function(){return e.onEnded()})};e.prototype.destroyMedia=function(){if(this.session&&this.session.sessionDescriptionHandler){this.session.sessionDescriptionHandler.close()}};e.prototype.toggleMute=function(t){if(!this.session){this.logger.warn("No session to toggle mute");return}var e=this.session.sessionDescriptionHandler.peerConnection;if(e.getSenders){e.getSenders().forEach(function(e){if(e.track){e.track.enabled=!t}})}else{e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){e.enabled=!t});e.getVideoTracks().forEach(function(e){e.enabled=!t})})}};e.prototype.onAccepted=function(){var r=this;if(!this.session){this.logger.warn("No session for accepting");return}this.state=c.STATUS_CONNECTED;this.emit("connected",this.session);this.setupLocalMedia();this.setupRemoteMedia();if(this.session.sessionDescriptionHandler){this.session.sessionDescriptionHandler.on("addTrack",function(){r.logger.log("A track has been added, triggering new remoteMedia setup");r.setupRemoteMedia()});this.session.sessionDescriptionHandler.on("addStream",function(){r.logger.log("A stream has been added, trigger new remoteMedia setup");r.setupRemoteMedia()})}this.session.on("dtmf",function(e,t){r.emit("dtmf",t.tone)});this.session.on("bye",function(){return r.onEnded()})};e.prototype.onProgress=function(){this.state=c.STATUS_CONNECTING;this.emit("connecting",this.session)};e.prototype.onFailed=function(){this.onEnded()};e.prototype.onEnded=function(){this.state=c.STATUS_COMPLETED;this.emit("ended",this.session);this.cleanupMedia()};e.C=c;return e}(e.EventEmitter);i.Simple=r}).call(this,n(1))},function(e,t,r){"use strict";var i=r(5);var n=r(43);var s=r(71);var o=r(25);function a(e){var t=new s(e);var r=n(s.prototype.request,t);i.extend(r,s.prototype,t);i.extend(r,t);return r}var f=a(o);f.Axios=s;f.create=function e(t){return a(i.merge(o,t))};f.Cancel=r(47);f.CancelToken=r(85);f.isCancel=r(46);f.all=function e(t){return Promise.all(t)};f.spread=r(86);e.exports=f;e.exports.default=f},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return e!=null&&(r(e)||i(e)||!!e._isBuffer)};function r(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function i(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&r(e.slice(0,0))}},function(e,t,r){"use strict";var n=r(25);var s=r(5);var i=r(80);var o=r(81);var a=r(83);var f=r(84);function u(e){this.defaults=e;this.interceptors={request:new i,response:new i}}u.prototype.request=function e(t){if(typeof t==="string"){t=s.merge({url:arguments[0]},arguments[1])}t=s.merge(n,this.defaults,{method:"get"},t);t.method=t.method.toLowerCase();if(t.baseURL&&!a(t.url)){t.url=f(t.baseURL,t.url)}var r=[o,undefined];var i=Promise.resolve(t);this.interceptors.request.forEach(function e(t){r.unshift(t.fulfilled,t.rejected)});this.interceptors.response.forEach(function e(t){r.push(t.fulfilled,t.rejected)});while(r.length){i=i.then(r.shift(),r.shift())}return i};s.forEach(["delete","get","head","options"],function e(r){u.prototype[r]=function(e,t){return this.request(s.merge(t||{},{method:r,url:e}))}});s.forEach(["post","put","patch"],function e(i){u.prototype[i]=function(e,t,r){return this.request(s.merge(r||{},{method:i,url:e,data:t}))}});e.exports=u},function(e,t,r){"use strict";var s=r(5);e.exports=function e(i,n){s.forEach(i,function e(t,r){if(r!==n&&r.toUpperCase()===n.toUpperCase()){i[n]=t;delete i[r]}})}},function(e,t,r){"use strict";var s=r(45);e.exports=function e(t,r,i){var n=i.config.validateStatus;if(!i.status||!n||n(i.status)){t(i)}else{r(s("Request failed with status code "+i.status,i.config,null,i.request,i))}}},function(e,t,r){"use strict";e.exports=function e(t,r,i,n,s){t.config=r;if(i){t.code=i}t.request=n;t.response=s;return t}},function(e,t,r){"use strict";var o=r(5);function a(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function e(t,r,i){if(!r){return t}var n;if(i){n=i(r)}else if(o.isURLSearchParams(r)){n=r.toString()}else{var s=[];o.forEach(r,function e(t,r){if(t===null||typeof t==="undefined"){return}if(o.isArray(t)){r=r+"[]"}if(!o.isArray(t)){t=[t]}o.forEach(t,function e(t){if(o.isDate(t)){t=t.toISOString()}else if(o.isObject(t)){t=JSON.stringify(t)}s.push(a(r)+"="+a(t))})});n=s.join("&")}if(n){t+=(t.indexOf("?")===-1?"?":"&")+n}return t}},function(e,t,r){"use strict";var o=r(5);e.exports=function e(t){var r={};var i;var n;var s;if(!t){return r}o.forEach(t.split("\n"),function e(t){s=t.indexOf(":");i=o.trim(t.substr(0,s)).toLowerCase();n=o.trim(t.substr(s+1));if(i){r[i]=r[i]?r[i]+", "+n:n}});return r}},function(e,t,r){"use strict";var o=r(5);e.exports=o.isStandardBrowserEnv()?function e(){var r=/(msie|trident)/i.test(navigator.userAgent);var i=document.createElement("a");var n;function s(e){var t=e;if(r){i.setAttribute("href",t);t=i.href}i.setAttribute("href",t);return{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}n=s(window.location.href);return function e(t){var r=o.isString(t)?s(t):t;return r.protocol===n.protocol&&r.host===n.host}}():function e(){return function e(){return true}}()},function(e,t,r){"use strict";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function f(){this.message="String contains an invalid character"}f.prototype=new Error;f.prototype.code=5;f.prototype.name="InvalidCharacterError";function i(e){var t=String(e);var r="";for(var i,n,s=0,o=a;t.charAt(s|0)||(o="=",s%1);r+=o.charAt(63&i>>8-s%1*8)){n=t.charCodeAt(s+=3/4);if(n>255){throw new f}i=i<<8|n}return r}e.exports=i},function(e,t,r){"use strict";var f=r(5);e.exports=f.isStandardBrowserEnv()?function e(){return{write:function e(t,r,i,n,s,o){var a=[];a.push(t+"="+encodeURIComponent(r));if(f.isNumber(i)){a.push("expires="+new Date(i).toGMTString())}if(f.isString(n)){a.push("path="+n)}if(f.isString(s)){a.push("domain="+s)}if(o===true){a.push("secure")}document.cookie=a.join("; ")},read:function e(t){var r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function e(t){this.write(t,"",Date.now()-864e5)}}}():function e(){return{write:function e(){},read:function e(){return null},remove:function e(){}}}()},function(e,t,r){"use strict";var i=r(5);function n(){this.handlers=[]}n.prototype.use=function e(t,r){this.handlers.push({fulfilled:t,rejected:r});return this.handlers.length-1};n.prototype.eject=function e(t){if(this.handlers[t]){this.handlers[t]=null}};n.prototype.forEach=function e(r){i.forEach(this.handlers,function e(t){if(t!==null){r(t)}})};e.exports=n},function(e,t,r){"use strict";var i=r(5);var n=r(82);var s=r(46);var o=r(25);function a(e){if(e.cancelToken){e.cancelToken.throwIfRequested()}}e.exports=function e(r){a(r);r.headers=r.headers||{};r.data=n(r.data,r.headers,r.transformRequest);r.headers=i.merge(r.headers.common||{},r.headers[r.method]||{},r.headers||{});i.forEach(["delete","get","head","post","put","patch","common"],function e(t){delete r.headers[t]});var t=r.adapter||o.adapter;return t(r).then(function e(t){a(r);t.data=n(t.data,t.headers,r.transformResponse);return t},function e(t){if(!s(t)){a(r);if(t&&t.response){t.response.data=n(t.response.data,t.response.headers,r.transformResponse)}}return Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(5);e.exports=function e(r,i,t){n.forEach(t,function e(t){r=t(r,i)});return r}},function(e,t,r){"use strict";e.exports=function e(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(e,t,r){"use strict";e.exports=function e(t,r){return r?t.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):t}},function(e,t,r){"use strict";var n=r(47);function i(e){if(typeof e!=="function"){throw new TypeError("executor must be a function.")}var r;this.promise=new Promise(function e(t){r=t});var i=this;e(function e(t){if(i.reason){return}i.reason=new n(t);r(i.reason)})}i.prototype.throwIfRequested=function e(){if(this.reason){throw this.reason}};i.source=function e(){var r;var t=new i(function e(t){r=t});return{token:t,cancel:r}};e.exports=i},function(e,t,r){"use strict";e.exports=function e(r){return function e(t){return r.apply(null,t)}}},function(t,e,r){(function(s){var o=r(48);var a=r(18)("socket.io-client:url");t.exports=e;function e(e,t){var r=e;t=t||s.location;if(null==e)e=t.protocol+"//"+t.host;if("string"===typeof e){if("/"===e.charAt(0)){if("/"===e.charAt(1)){e=t.protocol+e}else{e=t.host+e}}if(!/^(https?|wss?):\/\//.test(e)){a("protocol-less url %s",e);if("undefined"!==typeof t){e=t.protocol+"//"+e}else{e="https://"+e}}a("parse %s",e);r=o(e)}if(!r.port){if(/^(http|ws)$/.test(r.protocol)){r.port="80"}else if(/^(http|ws)s$/.test(r.protocol)){r.port="443"}}r.path=r.path||"/";var i=r.host.indexOf(":")!==-1;var n=i?"["+r.host+"]":r.host;r.id=r.protocol+"://"+n+":"+r.port;r.href=r.protocol+"://"+n+(t&&t.port===r.port?"":":"+r.port);return r}}).call(this,r(1))},function(e,f,t){f=e.exports=i.debug=i;f.coerce=a;f.disable=s;f.enable=n;f.enabled=o;f.humanize=t(89);f.names=[];f.skips=[];f.formatters={};var r=0;var u;function c(){return f.colors[r++%f.colors.length]}function i(e){function t(){}t.enabled=false;function a(){var n=a;var e=+new Date;var t=e-(u||e);n.diff=t;n.prev=u;n.curr=e;u=e;if(null==n.useColors)n.useColors=f.useColors();if(null==n.color&&n.useColors)n.color=c();var s=new Array(arguments.length);for(var r=0;r<s.length;r++){s[r]=arguments[r]}s[0]=f.coerce(s[0]);if("string"!==typeof s[0]){s=["%o"].concat(s)}var o=0;s[0]=s[0].replace(/%([a-z%])/g,function(e,t){if(e==="%%")return e;o++;var r=f.formatters[t];if("function"===typeof r){var i=s[o];e=r.call(n,i);s.splice(o,1);o--}return e});s=f.formatArgs.apply(n,s);var i=a.log||f.log||console.log.bind(console);i.apply(n,s)}a.enabled=true;var r=f.enabled(e)?a:t;r.namespace=e;return r}function n(e){f.save(e);var t=(e||"").split(/[\s,]+/);var r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?");if(e[0]==="-"){f.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{f.names.push(new RegExp("^"+e+"$"))}}}function s(){f.enable("")}function o(e){var t,r;for(t=0,r=f.skips.length;t<r;t++){if(f.skips[t].test(e)){return false}}for(t=0,r=f.names.length;t<r;t++){if(f.names[t].test(e)){return true}}return false}function a(e){if(e instanceof Error)return e.stack||e.message;return e}},function(e,t){var n=1e3;var s=n*60;var o=s*60;var a=o*24;var f=a*365.25;e.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0){return i(e)}else if(r==="number"&&isNaN(e)===false){return t.long?c(e):u(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function i(e){e=String(e);if(e.length>1e4){return}var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t){return}var r=parseFloat(t[1]);var i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return undefined}}function u(e){if(e>=a){return Math.round(e/a)+"d"}if(e>=o){return Math.round(e/o)+"h"}if(e>=s){return Math.round(e/s)+"m"}if(e>=n){return Math.round(e/n)+"s"}return e+"ms"}function c(e){return r(e,a,"day")||r(e,o,"hour")||r(e,s,"minute")||r(e,n,"second")||e+" ms"}function r(e,t,r){if(e<t){return}if(e<t*1.5){return Math.floor(e/t)+" "+r}return Math.ceil(e/t)+" "+r+"s"}},function(e,s,t){s=e.exports=t(91);s.log=n;s.formatArgs=i;s.save=o;s.load=a;s.useColors=r;s.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:f();s.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}s.formatters.j=function(e){return JSON.stringify(e)};function i(){var e=arguments;var t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+s.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0;var n=0;e[0].replace(/%[a-z%]/g,function(e){if("%%"===e)return;i++;if("%c"===e){n=i}});e.splice(n,0,r);return e}function n(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{if(null==e){s.storage.removeItem("debug")}else{s.storage.debug=e}}catch(e){}}function a(){var e;try{e=s.storage.debug}catch(e){}return e}s.enable(a());function f(){try{return window.localStorage}catch(e){}}},function(e,a,t){a=e.exports=i;a.coerce=c;a.disable=s;a.enable=n;a.enabled=o;a.humanize=t(92);a.names=[];a.skips=[];a.formatters={};var r=0;var f;function u(){return a.colors[r++%a.colors.length]}function i(e){function t(){}t.enabled=false;function i(){var n=i;var e=+new Date;var t=e-(f||e);n.diff=t;n.prev=f;n.curr=e;f=e;if(null==n.useColors)n.useColors=a.useColors();if(null==n.color&&n.useColors)n.color=u();var s=Array.prototype.slice.call(arguments);s[0]=a.coerce(s[0]);if("string"!==typeof s[0]){s=["%o"].concat(s)}var o=0;s[0]=s[0].replace(/%([a-z%])/g,function(e,t){if(e==="%%")return e;o++;var r=a.formatters[t];if("function"===typeof r){var i=s[o];e=r.call(n,i);s.splice(o,1);o--}return e});if("function"===typeof a.formatArgs){s=a.formatArgs.apply(n,s)}var r=i.log||a.log||console.log.bind(console);r.apply(n,s)}i.enabled=true;var r=a.enabled(e)?i:t;r.namespace=e;return r}function n(e){a.save(e);var t=(e||"").split(/[\s,]+/);var r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/\*/g,".*?");if(e[0]==="-"){a.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{a.names.push(new RegExp("^"+e+"$"))}}}function s(){a.enable("")}function o(e){var t,r;for(t=0,r=a.skips.length;t<r;t++){if(a.skips[t].test(e)){return false}}for(t=0,r=a.names.length;t<r;t++){if(a.names[t].test(e)){return true}}return false}function c(e){if(e instanceof Error)return e.stack||e.message;return e}},function(e,t){var n=1e3;var s=n*60;var o=s*60;var a=o*24;var f=a*365.25;e.exports=function(e,t){t=t||{};if("string"==typeof e)return r(e);return t.long?u(e):i(e)};function r(e){e=""+e;if(e.length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);var i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}function i(e){if(e>=a)return Math.round(e/a)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=s)return Math.round(e/s)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}function u(e){return c(e,a,"day")||c(e,o,"hour")||c(e,s,"minute")||c(e,n,"second")||e+" ms"}function c(e,t,r){if(e<t)return;if(e<t*1.5)return Math.floor(e/t)+" "+r;return Math.ceil(e/t)+" "+r+"s"}},function(e,c,l){(function(a,f){var u;/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */(function(){var e=true&&l(94);var j={function:true,object:true};var t=j[typeof c]&&c&&!c.nodeType&&c;var G=j[typeof window]&&window||this,r=t&&j[typeof a]&&a&&!a.nodeType&&typeof f=="object"&&f;if(r&&(r["global"]===r||r["window"]===r||r["self"]===r)){G=r}function W(e,f){e||(e=G["Object"]());f||(f=G["Object"]());var u=e["Number"]||G["Number"],c=e["String"]||G["String"],t=e["Object"]||G["Object"],l=e["Date"]||G["Date"],r=e["SyntaxError"]||G["SyntaxError"],b=e["TypeError"]||G["TypeError"],i=e["Math"]||G["Math"],n=e["JSON"]||G["JSON"];if(typeof n=="object"&&n){f.stringify=n.stringify;f.parse=n.parse}var s=t.prototype,w=s.toString,E,R,_;var h=new l(-0xc782b5b800cec);try{h=h.getUTCFullYear()==-109252&&h.getUTCMonth()===0&&h.getUTCDate()===1&&h.getUTCHours()==10&&h.getUTCMinutes()==37&&h.getUTCSeconds()==6&&h.getUTCMilliseconds()==708}catch(e){}function d(e){if(d[e]!==_){return d[e]}var t;if(e=="bug-string-char-index"){t="a"[0]!="a"}else if(e=="json"){t=d("json-stringify")&&d("json-parse")}else{var r,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(e=="json-stringify"){var n=f.stringify,s=typeof n=="function"&&h;if(s){(r=function(){return 1}).toJSON=r;try{s=n(0)==="0"&&n(new u)==="0"&&n(new c)=='""'&&n(w)===_&&n(_)===_&&n()===_&&n(r)==="1"&&n([r])=="[1]"&&n([_])=="[null]"&&n(null)=="null"&&n([_,w,null])=="[null,null,null]"&&n({a:[r,true,false,null,"\0\b\n\f\r\t"]})==i&&n(null,r)==="1"&&n([1,2],null,1)=="[\n 1,\n 2\n]"&&n(new l(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&n(new l(864e13))=='"+275760-09-13T00:00:00.000Z"'&&n(new l(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&n(new l(-1))=='"1969-12-31T23:59:59.999Z"'}catch(e){s=false}}t=s}if(e=="json-parse"){var o=f.parse;if(typeof o=="function"){try{if(o("0")===0&&!o(false)){r=o(i);var a=r["a"].length==5&&r["a"][0]===1;if(a){try{a=!o('"\t"')}catch(e){}if(a){try{a=o("01")!==1}catch(e){}}if(a){try{a=o("1.")!==1}catch(e){}}}}}catch(e){a=false}}t=a}}return d[e]=!!t}if(!d("json")){var p="[object Function]",I="[object Date]",O="[object Number]",N="[object String]",D="[object Array]",x="[object Boolean]";var a=d("bug-string-char-index");if(!h){var k=i.floor;var o=[0,31,59,90,120,151,181,212,243,273,304,334];var U=function(e,t){return o[t]+365*(e-1970)+k((e-1969+(t=+(t>1)))/4)-k((e-1901+t)/100)+k((e-1601+t)/400)}}if(!(E=s.hasOwnProperty)){E=function(e){var t={},r;if((t.__proto__=null,t.__proto__={toString:1},t).toString!=w){E=function(e){var t=this.__proto__,r=e in(this.__proto__=null,this);this.__proto__=t;return r}}else{r=t.constructor;E=function(e){var t=(this.constructor||r).prototype;return e in this&&!(e in t&&this[e]===t[e])}}t=null;return E.call(this,e)}}R=function(e,t){var r=0,i,o,n;(i=function(){this.valueOf=0}).prototype.valueOf=0;o=new i;for(n in o){if(E.call(o,n)){r++}}i=o=null;if(!r){o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];R=function(e,t){var r=w.call(e)==p,i,n;var s=!r&&typeof e.constructor!="function"&&j[typeof e.hasOwnProperty]&&e.hasOwnProperty||E;for(i in e){if(!(r&&i=="prototype")&&s.call(e,i)){t(i)}}for(n=o.length;i=o[--n];s.call(e,i)&&t(i));}}else if(r==2){R=function(e,t){var r={},i=w.call(e)==p,n;for(n in e){if(!(i&&n=="prototype")&&!E.call(r,n)&&(r[n]=1)&&E.call(e,n)){t(n)}}}}else{R=function(e,t){var r=w.call(e)==p,i,n;for(i in e){if(!(r&&i=="prototype")&&E.call(e,i)&&!(n=i==="constructor")){t(i)}}if(n||E.call(e,i="constructor")){t(i)}}}return R(e,t)};if(!d("json-stringify")){var v={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var g="000000";var P=function(e,t){return(g+(t||0)).slice(-e)};var m="\\u00";var H=function(e){var t='"',r=0,i=e.length,n=!a||i>10;var s=n&&(a?e.split(""):e);for(;r<i;r++){var o=e.charCodeAt(r);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=v[o];break;default:if(o<32){t+=m+P(2,o.toString(16));break}t+=n?s[r]:e.charAt(r)}}return t+'"'};var L=function(e,t,r,i,n,s,o){var a,f,u,c,l,h,d,p,v,g,m,y,T,C,S,A;try{a=t[e]}catch(e){}if(typeof a=="object"&&a){f=w.call(a);if(f==I&&!E.call(a,"toJSON")){if(a>-1/0&&a<1/0){if(U){l=k(a/864e5);for(u=k(l/365.2425)+1970-1;U(u+1,0)<=l;u++);for(c=k((l-U(u,0))/30.42);U(u,c+1)<=l;c++);l=1+l-U(u,c);h=(a%864e5+864e5)%864e5;d=k(h/36e5)%24;p=k(h/6e4)%60;v=k(h/1e3)%60;g=h%1e3}else{u=a.getUTCFullYear();c=a.getUTCMonth();l=a.getUTCDate();d=a.getUTCHours();p=a.getUTCMinutes();v=a.getUTCSeconds();g=a.getUTCMilliseconds()}a=(u<=0||u>=1e4?(u<0?"-":"+")+P(6,u<0?-u:u):P(4,u))+"-"+P(2,c+1)+"-"+P(2,l)+"T"+P(2,d)+":"+P(2,p)+":"+P(2,v)+"."+P(3,g)+"Z"}else{a=null}}else if(typeof a.toJSON=="function"&&(f!=O&&f!=N&&f!=D||E.call(a,"toJSON"))){a=a.toJSON(e)}}if(r){a=r.call(t,e,a)}if(a===null){return"null"}f=w.call(a);if(f==x){return""+a}else if(f==O){return a>-1/0&&a<1/0?""+a:"null"}else if(f==N){return H(""+a)}if(typeof a=="object"){for(C=o.length;C--;){if(o[C]===a){throw b()}}o.push(a);m=[];S=s;s+=n;if(f==D){for(T=0,C=a.length;T<C;T++){y=L(T,a,r,i,n,s,o);m.push(y===_?"null":y)}A=m.length?n?"[\n"+s+m.join(",\n"+s)+"\n"+S+"]":"["+m.join(",")+"]":"[]"}else{R(i||a,function(e){var t=L(e,a,r,i,n,s,o);if(t!==_){m.push(H(e)+":"+(n?" ":"")+t)}});A=m.length?n?"{\n"+s+m.join(",\n"+s)+"\n"+S+"}":"{"+m.join(",")+"}":"{}"}o.pop();return A}};f.stringify=function(e,t,r){var i,n,s,o;if(j[typeof t]&&t){if((o=w.call(t))==p){n=t}else if(o==D){s={};for(var a=0,f=t.length,u;a<f;u=t[a++],(o=w.call(u),o==N||o==O)&&(s[u]=1));}}if(r){if((o=w.call(r))==O){if((r-=r%1)>0){for(i="",r>10&&(r=10);i.length<r;i+=" ");}}else if(o==N){i=r.length<=10?r:r.slice(0,10)}}return L("",(u={},u[""]=e,u),n,s,i,"",[])}}if(!d("json-parse")){var y=c.fromCharCode;var T={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var C,S;var A=function(){C=S=null;throw r()};var q=function(){var e=S,t=e.length,r,i,n,s,o;while(C<t){o=e.charCodeAt(C);switch(o){case 9:case 10:case 13:case 32:C++;break;case 123:case 125:case 91:case 93:case 58:case 44:r=a?e.charAt(C):e[C];C++;return r;case 34:for(r="@",C++;C<t;){o=e.charCodeAt(C);if(o<32){A()}else if(o==92){o=e.charCodeAt(++C);switch(o){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:r+=T[o];C++;break;case 117:i=++C;for(n=C+4;C<n;C++){o=e.charCodeAt(C);if(!(o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70)){A()}}r+=y("0x"+e.slice(i,C));break;default:A()}}else{if(o==34){break}o=e.charCodeAt(C);i=C;while(o>=32&&o!=92&&o!=34){o=e.charCodeAt(++C)}r+=e.slice(i,C)}}if(e.charCodeAt(C)==34){C++;return r}A();default:i=C;if(o==45){s=true;o=e.charCodeAt(++C)}if(o>=48&&o<=57){if(o==48&&(o=e.charCodeAt(C+1),o>=48&&o<=57)){A()}s=false;for(;C<t&&(o=e.charCodeAt(C),o>=48&&o<=57);C++);if(e.charCodeAt(C)==46){n=++C;for(;n<t&&(o=e.charCodeAt(n),o>=48&&o<=57);n++);if(n==C){A()}C=n}o=e.charCodeAt(C);if(o==101||o==69){o=e.charCodeAt(++C);if(o==43||o==45){C++}for(n=C;n<t&&(o=e.charCodeAt(n),o>=48&&o<=57);n++);if(n==C){A()}C=n}return+e.slice(i,C)}if(s){A()}if(e.slice(C,C+4)=="true"){C+=4;return true}else if(e.slice(C,C+5)=="false"){C+=5;return false}else if(e.slice(C,C+4)=="null"){C+=4;return null}A()}}return"$"};var M=function(e){var t,r;if(e=="$"){A()}if(typeof e=="string"){if((a?e.charAt(0):e[0])=="@"){return e.slice(1)}if(e=="["){t=[];for(;;r||(r=true)){e=q();if(e=="]"){break}if(r){if(e==","){e=q();if(e=="]"){A()}}else{A()}}if(e==","){A()}t.push(M(e))}return t}else if(e=="{"){t={};for(;;r||(r=true)){e=q();if(e=="}"){break}if(r){if(e==","){e=q();if(e=="}"){A()}}else{A()}}if(e==","||typeof e!="string"||(a?e.charAt(0):e[0])!="@"||q()!=":"){A()}t[e.slice(1)]=M(q())}return t}A()}return e};var F=function(e,t,r){var i=B(e,t,r);if(i===_){delete e[t]}else{e[t]=i}};var B=function(e,t,r){var i=e[t],n;if(typeof i=="object"&&i){if(w.call(i)==D){for(n=i.length;n--;){F(i,n,r)}}else{R(i,function(e){F(i,e,r)})}}return r.call(e,t,i)};f.parse=function(e,t){var r,i;C=0;S=""+e;r=M(q());if(q()!="$"){A()}C=S=null;return t&&w.call(t)==p?B((i={},i[""]=r,i),"",t):r}}}f["runInContext"]=W;return f}if(t&&!e){W(G,t)}else{var i=G.JSON,n=G["JSON3"],s=false;var o=W(G,G["JSON3"]={noConflict:function(){if(!s){s=true;G.JSON=i;G["JSON3"]=n;i=n=null}return o}});G.JSON={parse:o.parse,stringify:o.stringify}}if(e){!(u=function(){return o}.call(c,l,c,a),u!==undefined&&(a.exports=u))}}).call(this)}).call(this,l(49)(e),l(1))},function(t,e){(function(e){t.exports=e}).call(this,{})},function(e,t){e.exports=r;function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype){e[t]=r.prototype[t]}return e}r.prototype.on=r.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks[e]=this._callbacks[e]||[]).push(t);return this};r.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function i(){r.off(e,i);t.apply(this,arguments)}i.fn=t;this.on(e,i);return this};r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks[e];if(!r)return this;if(1==arguments.length){delete this._callbacks[e];return this}var i;for(var n=0;n<r.length;n++){i=r[n];if(i===t||i.fn===t){r.splice(n,1);break}}return this};r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var i=0,n=r.length;i<n;++i){r[i].apply(this,t)}}return this};r.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks[e]||[]};r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){(function(c){var l=r(50);var h=r(51);t.deconstructPacket=function(e){var s=[];var t=e.data;function o(e){if(!e)return e;if(h(e)){var t={_placeholder:true,num:s.length};s.push(e);return t}else if(l(e)){var r=new Array(e.length);for(var i=0;i<e.length;i++){r[i]=o(e[i])}return r}else if("object"==typeof e&&!(e instanceof Date)){var r={};for(var n in e){r[n]=o(e[n])}return r}return e}var r=e;r.data=o(t);r.attachments=s.length;return{packet:r,buffers:s}};t.reconstructPacket=function(e,n){var t=0;function s(e){if(e&&e._placeholder){var t=n[e.num];return t}else if(l(e)){for(var r=0;r<e.length;r++){e[r]=s(e[r])}return e}else if(e&&"object"==typeof e){for(var i in e){e[i]=s(e[i])}return e}return e}e.data=s(e.data);e.attachments=undefined;return e};t.removeBlobs=function(e,o){function a(e,t,r){if(!e)return e;if(c.Blob&&e instanceof Blob||c.File&&e instanceof File){f++;var i=new FileReader;i.onload=function(){if(r){r[t]=this.result}else{u=this.result}if(!--f){o(u)}};i.readAsArrayBuffer(e)}else if(l(e)){for(var n=0;n<e.length;n++){a(e[n],n,e)}}else if(e&&"object"==typeof e&&!h(e)){for(var s in e){a(e[s],s,e)}}}var f=0;var u=e;a(u);if(!f){o(u)}}}).call(this,r(1))},function(e,t,r){e.exports=r(98)},function(e,t,r){e.exports=r(99);e.exports.parser=r(12)},function(t,e,c){(function(i){var n=c(53);var e=c(13);var l=c(20)("engine.io-client:socket");var s=c(57);var o=c(12);var a=c(48);var r=c(113);var f=c(29);t.exports=h;function h(e,t){if(!(this instanceof h))return new h(e,t);t=t||{};if(e&&"object"===typeof e){t=e;e=null}if(e){e=a(e);t.hostname=e.host;t.secure=e.protocol==="https"||e.protocol==="wss";t.port=e.port;if(e.query)t.query=e.query}else if(t.host){t.hostname=a(t.host).host}this.secure=null!=t.secure?t.secure:i.location&&"https:"===location.protocol;if(t.hostname&&!t.port){t.port=this.secure?"443":"80"}this.agent=t.agent||false;this.hostname=t.hostname||(i.location?location.hostname:"localhost");this.port=t.port||(i.location&&location.port?location.port:this.secure?443:80);this.query=t.query||{};if("string"===typeof this.query)this.query=f.decode(this.query);this.upgrade=false!==t.upgrade;this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!t.forceJSONP;this.jsonp=false!==t.jsonp;this.forceBase64=!!t.forceBase64;this.enablesXDR=!!t.enablesXDR;this.timestampParam=t.timestampParam||"t";this.timestampRequests=t.timestampRequests;this.transports=t.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=t.policyPort||843;this.rememberUpgrade=t.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=t.onlyBinaryUpgrades;this.perMessageDeflate=false!==t.perMessageDeflate?t.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=t.pfx||null;this.key=t.key||null;this.passphrase=t.passphrase||null;this.cert=t.cert||null;this.ca=t.ca||null;this.ciphers=t.ciphers||null;this.rejectUnauthorized=t.rejectUnauthorized===undefined?null:t.rejectUnauthorized;this.forceNode=!!t.forceNode;var r=typeof i==="object"&&i;if(r.global===r){if(t.extraHeaders&&Object.keys(t.extraHeaders).length>0){this.extraHeaders=t.extraHeaders}if(t.localAddress){this.localAddress=t.localAddress}}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingIntervalTimer=null;this.pingTimeoutTimer=null;this.open()}h.priorWebsocketSuccess=false;e(h.prototype);h.protocol=o.protocol;h.Socket=h;h.Transport=c(28);h.transports=c(53);h.parser=c(12);h.prototype.createTransport=function(e){l('creating transport "%s"',e);var t=u(this.query);t.EIO=o.protocol;t.transport=e;if(this.id)t.sid=this.id;var r=new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress});return r};function u(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){e="websocket"}else if(0===this.transports.length){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}else{e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){this.transports.shift();this.open();return}e.open();this.setTransport(e)};h.prototype.setTransport=function(e){l("setting transport %s",e.name);var t=this;if(this.transport){l("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=e;e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})};h.prototype.probe=function(r){l('probing transport "%s"',r);var i=this.createTransport(r,{probe:1});var n=false;var s=this;h.priorWebsocketSuccess=false;function e(){if(s.onlyBinaryUpgrades){var e=!this.supportsBinary&&s.transport.supportsBinary;n=n||e}if(n)return;l('probe transport "%s" opened',r);i.send([{type:"ping",data:"probe"}]);i.once("packet",function(e){if(n)return;if("pong"===e.type&&"probe"===e.data){l('probe transport "%s" pong',r);s.upgrading=true;s.emit("upgrading",i);if(!i)return;h.priorWebsocketSuccess="websocket"===i.name;l('pausing current transport "%s"',s.transport.name);s.transport.pause(function(){if(n)return;if("closed"===s.readyState)return;l("changing transport and sending upgrade packet");c();s.setTransport(i);i.send([{type:"upgrade"}]);s.emit("upgrade",i);i=null;s.upgrading=false;s.flush()})}else{l('probe transport "%s" failed',r);var t=new Error("probe error");t.transport=i.name;s.emit("upgradeError",t)}})}function o(){if(n)return;n=true;c();i.close();i=null}function t(e){var t=new Error("probe error: "+e);t.transport=i.name;o();l('probe transport "%s" failed because of error: %s',r,e);s.emit("upgradeError",t)}function a(){t("transport closed")}function f(){t("socket closed")}function u(e){if(i&&e.name!==i.name){l('"%s" works - aborting "%s"',e.name,i.name);o()}}function c(){i.removeListener("open",e);i.removeListener("error",t);i.removeListener("close",a);s.removeListener("close",f);s.removeListener("upgrading",u)}i.once("open",e);i.once("error",t);i.once("close",a);this.once("close",f);this.once("upgrading",u);i.open()};h.prototype.onOpen=function(){l("socket open");this.readyState="open";h.priorWebsocketSuccess="websocket"===this.transport.name;this.emit("open");this.flush();if("open"===this.readyState&&this.upgrade&&this.transport.pause){l("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++){this.probe(this.upgrades[e])}}};h.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){l('socket receive: type "%s", data "%s"',e.type,e.data);this.emit("packet",e);this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(r(e.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data;this.onError(t);break;case"message":this.emit("data",e.data);this.emit("message",e.data);break}}else{l('packet received with socket readyState "%s"',this.readyState)}};h.prototype.onHandshake=function(e){this.emit("handshake",e);this.id=e.sid;this.transport.query.sid=e.sid;this.upgrades=this.filterUpgrades(e.upgrades);this.pingInterval=e.pingInterval;this.pingTimeout=e.pingTimeout;this.onOpen();if("closed"===this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if("closed"===t.readyState)return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)};h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer);e.pingIntervalTimer=setTimeout(function(){l("writing ping packet - expecting pong within %sms",e.pingTimeout);e.ping();e.onHeartbeat(e.pingTimeout)},e.pingInterval)};h.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})};h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit("drain")}else{this.flush()}};h.prototype.flush=function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){l("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};h.prototype.write=h.prototype.send=function(e,t,r){this.sendPacket("message",e,t,r);return this};h.prototype.sendPacket=function(e,t,r,i){if("function"===typeof t){i=t;t=undefined}if("function"===typeof r){i=r;r=null}if("closing"===this.readyState||"closed"===this.readyState){return}r=r||{};r.compress=false!==r.compress;var n={type:e,data:t,options:r};this.emit("packetCreate",n);this.writeBuffer.push(n);if(i)this.once("flush",i);this.flush()};h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){i()}else{t()}})}else if(this.upgrading){i()}else{t()}}function t(){e.onClose("forced close");l("socket closing - telling transport to close");e.transport.close()}function r(){e.removeListener("upgrade",r);e.removeListener("upgradeError",r);t()}function i(){e.once("upgrade",r);e.once("upgradeError",r)}return this};h.prototype.onError=function(e){l("socket error %j",e);h.priorWebsocketSuccess=false;this.emit("error",e);this.onClose("transport error",e)};h.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){l('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",e,t);r.writeBuffer=[];r.prevBufferLen=0}};h.prototype.filterUpgrades=function(e){var t=[];for(var r=0,i=e.length;r<i;r++){if(~s(this.transports,e[r]))t.push(e[r])}return t}}).call(this,c(1))},function(t,e){try{t.exports=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=false}},function(c,e,l){(function(n){var s=l(27);var i=l(54);var e=l(13);var t=l(19);var o=l(20)("engine.io-client:polling-xhr");c.exports=a;c.exports.Request=f;function r(){}function a(e){i.call(this,e);this.requestTimeout=e.requestTimeout;if(n.location){var t="https:"===location.protocol;var r=location.port;if(!r){r=t?443:80}this.xd=e.hostname!==n.location.hostname||r!==e.port;this.xs=e.secure!==t}else{this.extraHeaders=e.extraHeaders}}t(a,i);a.prototype.supportsBinary=true;a.prototype.request=function(e){e=e||{};e.uri=this.uri();e.xd=this.xd;e.xs=this.xs;e.agent=this.agent||false;e.supportsBinary=this.supportsBinary;e.enablesXDR=this.enablesXDR;e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;e.requestTimeout=this.requestTimeout;e.extraHeaders=this.extraHeaders;return new f(e)};a.prototype.doWrite=function(e,t){var r=typeof e!=="string"&&e!==undefined;var i=this.request({method:"POST",data:e,isBinary:r});var n=this;i.on("success",t);i.on("error",function(e){n.onError("xhr post error",e)});this.sendXhr=i};a.prototype.doPoll=function(){o("xhr poll");var e=this.request();var t=this;e.on("data",function(e){t.onData(e)});e.on("error",function(e){t.onError("xhr poll error",e)});this.pollXhr=e};function f(e){this.method=e.method||"GET";this.uri=e.uri;this.xd=!!e.xd;this.xs=!!e.xs;this.async=false!==e.async;this.data=undefined!==e.data?e.data:null;this.agent=e.agent;this.isBinary=e.isBinary;this.supportsBinary=e.supportsBinary;this.enablesXDR=e.enablesXDR;this.requestTimeout=e.requestTimeout;this.pfx=e.pfx;this.key=e.key;this.passphrase=e.passphrase;this.cert=e.cert;this.ca=e.ca;this.ciphers=e.ciphers;this.rejectUnauthorized=e.rejectUnauthorized;this.extraHeaders=e.extraHeaders;this.create()}e(f.prototype);f.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx;e.key=this.key;e.passphrase=this.passphrase;e.cert=this.cert;e.ca=this.ca;e.ciphers=this.ciphers;e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new s(e);var r=this;try{o("xhr open %s: %s",this.method,this.uri);t.open(this.method,this.uri,this.async);try{if(this.extraHeaders){t.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){t.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){t.responseType="arraybuffer"}if("POST"===this.method){try{if(this.isBinary){t.setRequestHeader("Content-type","application/octet-stream")}else{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}try{t.setRequestHeader("Accept","*/*")}catch(e){}if("withCredentials"in t){t.withCredentials=true}if(this.requestTimeout){t.timeout=this.requestTimeout}if(this.hasXDR()){t.onload=function(){r.onLoad()};t.onerror=function(){r.onError(t.responseText)}}else{t.onreadystatechange=function(){if(4!==t.readyState)return;if(200===t.status||1223===t.status){r.onLoad()}else{setTimeout(function(){r.onError(t.status)},0)}}}o("xhr data %s",this.data);t.send(this.data)}catch(e){setTimeout(function(){r.onError(e)},0);return}if(n.document){this.index=f.requestsCount++;f.requests[this.index]=this}};f.prototype.onSuccess=function(){this.emit("success");this.cleanup()};f.prototype.onData=function(e){this.emit("data",e);this.onSuccess()};f.prototype.onError=function(e){this.emit("error",e);this.cleanup(true)};f.prototype.cleanup=function(e){if("undefined"===typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=r}else{this.xhr.onreadystatechange=r}if(e){try{this.xhr.abort()}catch(e){}}if(n.document){delete f.requests[this.index]}this.xhr=null};f.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(e==="application/octet-stream"){t=this.xhr.response||this.xhr.responseText}else{if(!this.supportsBinary){t=this.xhr.responseText}else{try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var r=new Uint8Array(this.xhr.response);var i=[];for(var n=0,s=r.length;n<s;n++){i.push(r[n])}t=String.fromCharCode.apply(null,i)}}}}catch(e){this.onError(e)}if(null!=t){this.onData(t)}};f.prototype.hasXDR=function(){return"undefined"!==typeof n.XDomainRequest&&!this.xs&&this.enablesXDR};f.prototype.abort=function(){this.cleanup()};f.requestsCount=0;f.requests={};if(n.document){if(n.attachEvent){n.attachEvent("onunload",u)}else if(n.addEventListener){n.addEventListener("beforeunload",u,false)}}function u(){for(var e in f.requests){if(f.requests.hasOwnProperty(e)){f.requests[e].abort()}}}}).call(this,l(1))},function(e,t){e.exports=Object.keys||function e(t){var r=[];var i=Object.prototype.hasOwnProperty;for(var n in t){if(i.call(t,n)){r.push(n)}}return r}},function(e,t){e.exports=function(e,t,r){var i=e.byteLength;t=t||0;r=r||i;if(e.slice){return e.slice(t,r)}if(t<0){t+=i}if(r<0){r+=i}if(r>i){r=i}if(t>=i||t>=r||i===0){return new ArrayBuffer(0)}var n=new Uint8Array(e);var s=new Uint8Array(r-t);for(var o=t,a=0;o<r;o++,a++){s[a]=n[o]}return s.buffer}},function(e,t){e.exports=r;function r(e,r,i){var n=false;i=i||o;s.count=e;return e===0?r():s;function s(e,t){if(s.count<=0){throw new Error("after called too many times")}--s.count;if(e){n=true;r(e);r=i}else if(s.count===0&&!n){r(null,t)}}}function o(){}},function(e,b,w){(function(C,S){var A;/*! https://mths.be/wtf8 v1.0.0 by @mathias */(function(e){var t=true&&b;var r=true&&C&&C.exports==t&&C;var i=typeof S=="object"&&S;if(i.global===i||i.window===i){e=i}var s=String.fromCharCode;function o(e){var t=[];var r=0;var i=e.length;var n;var s;while(r<i){n=e.charCodeAt(r++);if(n>=55296&&n<=56319&&r<i){s=e.charCodeAt(r++);if((s&64512)==56320){t.push(((n&1023)<<10)+(s&1023)+65536)}else{t.push(n);r--}}else{t.push(n)}}return t}function n(e){var t=e.length;var r=-1;var i;var n="";while(++r<t){i=e[r];if(i>65535){i-=65536;n+=s(i>>>10&1023|55296);i=56320|i&1023}n+=s(i)}return n}function a(e,t){return s(e>>t&63|128)}function f(e){if((e&4294967168)==0){return s(e)}var t="";if((e&4294965248)==0){t=s(e>>6&31|192)}else if((e&4294901760)==0){t=s(e>>12&15|224);t+=a(e,6)}else if((e&4292870144)==0){t=s(e>>18&7|240);t+=a(e,12);t+=a(e,6)}t+=s(e&63|128);return t}function u(e){var t=o(e);var r=t.length;var i=-1;var n;var s="";while(++i<r){n=t[i];s+=f(n)}return s}function c(){if(p>=d){throw Error("Invalid byte index")}var e=h[p]&255;p++;if((e&192)==128){return e&63}throw Error("Invalid continuation byte")}function l(){var e;var t;var r;var i;var n;if(p>d){throw Error("Invalid byte index")}if(p==d){return false}e=h[p]&255;p++;if((e&128)==0){return e}if((e&224)==192){var t=c();n=(e&31)<<6|t;if(n>=128){return n}else{throw Error("Invalid continuation byte")}}if((e&240)==224){t=c();r=c();n=(e&15)<<12|t<<6|r;if(n>=2048){return n}else{throw Error("Invalid continuation byte")}}if((e&248)==240){t=c();r=c();i=c();n=(e&15)<<18|t<<12|r<<6|i;if(n>=65536&&n<=1114111){return n}}throw Error("Invalid WTF-8 detected")}var h;var d;var p;function v(e){h=o(e);d=h.length;p=0;var t=[];var r;while((r=l())!==false){t.push(r)}return n(t)}var g={version:"1.0.0",encode:u,decode:v};if(true){!(A=function(){return g}.call(b,w,b,C),A!==undefined&&(C.exports=A))}else{var m,y,T}})(this)}).call(this,w(49)(e),w(1))},function(e,t){(function(){"use strict";var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var l=new Uint8Array(256);for(var e=0;e<s.length;e++){l[s.charCodeAt(e)]=e}t.encode=function(e){var t=new Uint8Array(e),r,i=t.length,n="";for(r=0;r<i;r+=3){n+=s[t[r]>>2];n+=s[(t[r]&3)<<4|t[r+1]>>4];n+=s[(t[r+1]&15)<<2|t[r+2]>>6];n+=s[t[r+2]&63]}if(i%3===2){n=n.substring(0,n.length-1)+"="}else if(i%3===1){n=n.substring(0,n.length-2)+"=="}return n};t.decode=function(e){var t=e.length*.75,r=e.length,i,n=0,s,o,a,f;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="="){t--}}var u=new ArrayBuffer(t),c=new Uint8Array(u);for(i=0;i<r;i+=4){s=l[e.charCodeAt(i)];o=l[e.charCodeAt(i+1)];a=l[e.charCodeAt(i+2)];f=l[e.charCodeAt(i+3)];c[n++]=s<<2|o>>4;c[n++]=(o&15)<<4|a>>2;c[n++]=(a&3)<<6|f&63}return u}})()},function(f,e,t){(function(e){var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder;var t=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(e){return false}}();var r=t&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(e){return false}}();var i=n&&n.prototype.append&&n.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var i=r.buffer;if(r.byteLength!==i.byteLength){var n=new Uint8Array(r.byteLength);n.set(new Uint8Array(i,r.byteOffset,r.byteLength));i=n.buffer}e[t]=i}}}function o(e,t){t=t||{};var r=new n;s(e);for(var i=0;i<e.length;i++){r.append(e[i])}return t.type?r.getBlob(t.type):r.getBlob()}function a(e,t){s(e);return new Blob(e,t||{})}f.exports=function(){if(t){return r?e.Blob:a}else if(i){return o}else{return undefined}}()}).call(this,t(1))},function(e,f,t){f=e.exports=i.debug=i;f.coerce=a;f.disable=s;f.enable=n;f.enabled=o;f.humanize=t(109);f.names=[];f.skips=[];f.formatters={};var r=0;var u;function c(){return f.colors[r++%f.colors.length]}function i(e){function t(){}t.enabled=false;function a(){var n=a;var e=+new Date;var t=e-(u||e);n.diff=t;n.prev=u;n.curr=e;u=e;if(null==n.useColors)n.useColors=f.useColors();if(null==n.color&&n.useColors)n.color=c();var s=new Array(arguments.length);for(var r=0;r<s.length;r++){s[r]=arguments[r]}s[0]=f.coerce(s[0]);if("string"!==typeof s[0]){s=["%o"].concat(s)}var o=0;s[0]=s[0].replace(/%([a-z%])/g,function(e,t){if(e==="%%")return e;o++;var r=f.formatters[t];if("function"===typeof r){var i=s[o];e=r.call(n,i);s.splice(o,1);o--}return e});s=f.formatArgs.apply(n,s);var i=a.log||f.log||console.log.bind(console);i.apply(n,s)}a.enabled=true;var r=f.enabled(e)?a:t;r.namespace=e;return r}function n(e){f.save(e);var t=(e||"").split(/[\s,]+/);var r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?");if(e[0]==="-"){f.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{f.names.push(new RegExp("^"+e+"$"))}}}function s(){f.enable("")}function o(e){var t,r;for(t=0,r=f.skips.length;t<r;t++){if(f.skips[t].test(e)){return false}}for(t=0,r=f.names.length;t<r;t++){if(f.names[t].test(e)){return true}}return false}function a(e){if(e instanceof Error)return e.stack||e.message;return e}},function(e,t){var n=1e3;var s=n*60;var o=s*60;var a=o*24;var f=a*365.25;e.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0){return i(e)}else if(r==="number"&&isNaN(e)===false){return t.long?c(e):u(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function i(e){e=String(e);if(e.length>1e4){return}var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t){return}var r=parseFloat(t[1]);var i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*f;case"days":case"day":case"d":return r*a;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return undefined}}function u(e){if(e>=a){return Math.round(e/a)+"d"}if(e>=o){return Math.round(e/o)+"h"}if(e>=s){return Math.round(e/s)+"m"}if(e>=n){return Math.round(e/n)+"s"}return e+"ms"}function c(e){return r(e,a,"day")||r(e,o,"hour")||r(e,s,"minute")||r(e,n,"second")||e+" ms"}function r(e,t,r){if(e<t){return}if(e<t*1.5){return Math.floor(e/t)+" "+r}return Math.ceil(e/t)+" "+r+"s"}},function(o,e,a){(function(r){var i=a(54);var e=a(19);o.exports=t;var u=/\n/g;var c=/\\n/g;var n;function s(){}function t(e){i.call(this,e);this.query=this.query||{};if(!n){if(!r.___eio)r.___eio=[];n=r.___eio}this.index=n.length;var t=this;n.push(function(e){t.onData(e)});this.query.j=this.index;if(r.document&&r.addEventListener){r.addEventListener("beforeunload",function(){if(t.script)t.script.onerror=s},false)}}e(t,i);t.prototype.supportsBinary=false;t.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}i.prototype.doClose.call(this)};t.prototype.doPoll=function(){var t=this;var e=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}e.async=true;e.src=this.uri();e.onerror=function(e){t.onError("jsonp poll error",e)};var r=document.getElementsByTagName("script")[0];if(r){r.parentNode.insertBefore(e,r)}else{(document.head||document.body).appendChild(e)}this.script=e;var i="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);if(i){setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e);document.body.removeChild(e)},100)}};t.prototype.doWrite=function(e,t){var r=this;if(!this.form){var i=document.createElement("form");var n=document.createElement("textarea");var s=this.iframeId="eio_iframe_"+this.index;var o;i.className="socketio";i.style.position="absolute";i.style.top="-1000px";i.style.left="-1000px";i.target=s;i.method="POST";i.setAttribute("accept-charset","utf-8");n.name="d";i.appendChild(n);document.body.appendChild(i);this.form=i;this.area=n}this.form.action=this.uri();function a(){f();t()}function f(){if(r.iframe){try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';o=document.createElement(e)}catch(e){o=document.createElement("iframe");o.name=r.iframeId;o.src="javascript:0"}o.id=r.iframeId;r.form.appendChild(o);r.iframe=o}f();e=e.replace(c,"\\\n");this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(r.iframe.readyState==="complete"){a()}}}else{this.iframe.onload=a}}}).call(this,a(1))},function(l,e,h){(function(a){var r=h(28);var f=h(12);var n=h(29);var e=h(19);var s=h(56);var u=h(20)("engine.io-client:websocket");var i=a.WebSocket||a.MozWebSocket;var o;if(typeof window==="undefined"){try{o=h(112)}catch(e){}}var c=i;if(!c&&typeof window==="undefined"){c=o}l.exports=t;function t(e){var t=e&&e.forceBase64;if(t){this.supportsBinary=false}this.perMessageDeflate=e.perMessageDeflate;this.usingBrowserWebSocket=i&&!e.forceNode;if(!this.usingBrowserWebSocket){c=o}r.call(this,e)}e(t,r);t.prototype.name="websocket";t.prototype.supportsBinary=true;t.prototype.doOpen=function(){if(!this.check()){return}var e=this.uri();var t=void 0;var r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx;r.key=this.key;r.passphrase=this.passphrase;r.cert=this.cert;r.ca=this.ca;r.ciphers=this.ciphers;r.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){r.headers=this.extraHeaders}if(this.localAddress){r.localAddress=this.localAddress}try{this.ws=this.usingBrowserWebSocket?new c(e):new c(e,t,r)}catch(e){return this.emit("error",e)}if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType="nodebuffer"}else{this.ws.binaryType="arraybuffer"}this.addEventListeners()};t.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()};this.ws.onclose=function(){t.onClose()};this.ws.onmessage=function(e){t.onData(e.data)};this.ws.onerror=function(e){t.onError("websocket error",e)}};t.prototype.write=function(e){var n=this;this.writable=false;var s=e.length;for(var t=0,r=s;t<r;t++){(function(i){f.encodePacket(i,n.supportsBinary,function(e){if(!n.usingBrowserWebSocket){var t={};if(i.options){t.compress=i.options.compress}if(n.perMessageDeflate){var r="string"===typeof e?a.Buffer.byteLength(e):e.length;if(r<n.perMessageDeflate.threshold){t.compress=false}}}try{if(n.usingBrowserWebSocket){n.ws.send(e)}else{n.ws.send(e,t)}}catch(e){u("websocket closed before onclose event")}--s||o()})})(e[t])}function o(){n.emit("flush");setTimeout(function(){n.writable=true;n.emit("drain")},0)}};t.prototype.onClose=function(){r.prototype.onClose.call(this)};t.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};t.prototype.uri=function(){var e=this.query||{};var t=this.secure?"wss":"ws";var r="";if(this.port&&("wss"===t&&Number(this.port)!==443||"ws"===t&&Number(this.port)!==80)){r=":"+this.port}if(this.timestampRequests){e[this.timestampParam]=s()}if(!this.supportsBinary){e.b64=1}e=n.encode(e);if(e.length){e="?"+e}var i=this.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.hostname+"]":this.hostname)+r+this.path+e};t.prototype.check=function(){return!!c&&!("__initialize"in c&&this.name===t.prototype.name)}}).call(this,h(1))},function(e,t){},function(e,t,r){(function(r){var i=/^[\],:{}\s]*$/;var n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var s=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var o=/(?:^|:|,)(?:\s*\[)+/g;var a=/^\s+/;var f=/\s+$/;e.exports=function e(t){if("string"!=typeof t||!t){return null}t=t.replace(a,"").replace(f,"");if(r.JSON&&JSON.parse){return JSON.parse(t)}if(i.test(t.replace(n,"@").replace(s,"]").replace(o,""))){return new Function("return "+t)()}}}).call(this,r(1))},function(e,t){e.exports=r;function r(e,t){var r=[];t=t||0;for(var i=t||0;i<e.length;i++){r[i-t]=e[i]}return r}},function(e,t){e.exports=r;function r(e){e=e||{};this.ms=e.min||100;this.max=e.max||1e4;this.factor=e.factor||2;this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0;this.attempts=0}r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random();var r=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-r:e+r}return Math.min(e,this.max)|0};r.prototype.reset=function(){this.attempts=0};r.prototype.setMin=function(e){this.ms=e};r.prototype.setMax=function(e){this.max=e};r.prototype.setJitter=function(e){this.jitter=e}},function(e,t,r){"use strict";r.r(t);var i=r(21);var n=r(14);var s;(function(e){e["progress"]="progress";e["terminated"]="terminated";e["accepted"]="accepted"})(s||(s={}));var o;(function(e){e["registered"]="registered";e["unregistered"]="unregistered";e["registrationFailed"]="registrationFailed";e["invite"]="invite";e["inviteSent"]="inviteSent"})(o||(o={}));var a=function(){function e(e){this.ID_AUDIO="remoteAudio";this.sip_ua=null;this.sip_sessions_in=[];this.sip_sessions_out=[];this.sip_callbacks=[];this.autoAnswerOnceFlag=false;this.sip_debug=e.debug;this.sip_account=e.sip_account;this.sip_domain=e.sip_domain;this.sip_password=e.sip_password;this.sip_autoAnswer=e.sip_autoAnswer;this.wss_proto=e.wss_proto;this.wss_address=e.wss_address;this.wss_port=e.wss_port;this.ice_checkTimeout=e.ice_checkTimeout;this.sip_callbacks=[].concat(e.sip_callbacks);this.initGui();this.start()}e.prototype.initGui=function(){var e=this;var t=document.createElement("audio");t.id=e.ID_AUDIO;t.hidden=true;document.body.appendChild(t)};e.prototype.destroyGui=function(){var e=this;var t=document.getElementById(e.ID_AUDIO);if(t){document.body.removeChild(t)}};e.prototype.writeLog=function(e){var t=this;if(t.sip_debug){console.log("SIP DEBUG[ "+e+" ]")}};e.prototype.fireCallBack=function(r,i){var e=this;if(o.invite===r&&(e.sip_autoAnswer||e.autoAnswerOnceFlag)){if(e.autoAnswerOnceFlag){e.writeLog("autoAnswerOnceFlag exec complete , set false");e.autoAnswerOnceFlag=false}else{e.writeLog("autoAnswer enable, answer now!!!")}e.answer()}e.sip_callbacks.map(function(e,t){e.handle(r,i)})};e.prototype.handleUA=function(e){var r=this;r.writeLog("ua add listener");e.on(o.registered,function(e){r.writeLog(o.registered);r.fireCallBack(o.registered,null)});e.on(o.unregistered,function(e,t){r.writeLog(o.unregistered);r.fireCallBack(o.unregistered,null)});e.on(o.registrationFailed,function(e,t){r.writeLog(o.registrationFailed);r.fireCallBack(o.registrationFailed,null)});e.on(o.invite,function(e){r.writeLog(o.invite);r.sip_sessions_in.push(e);r.handleSession(e);r.fireCallBack(o.invite,null)});e.on(o.inviteSent,function(e){r.writeLog(o.inviteSent);r.sip_sessions_out.push(e);r.handleSession(e);r.fireCallBack(o.inviteSent,null)})};e.prototype.handleSession=function(r){var i=this;i.writeLog("session add listener");if(r instanceof n["InviteServerContext"]){r.on(s.progress,function(e,t){i.writeLog("session in "+s.progress+" "+i.sip_sessions_in.length);i.handleAudio(r);i.fireCallBack(s.progress,null)});r.on(s.accepted,function(e,t){i.writeLog("session in "+s.accepted+" "+i.sip_sessions_in.length);i.handleAudio(r);i.fireCallBack(s.accepted,null)});r.on(s.terminated,function(e,t){i.sip_sessions_in=i.sip_sessions_in.filter(function(e){return r!=e});i.writeLog("session in "+s.terminated+" "+i.sip_sessions_in.length);i.fireCallBack(s.terminated,null)})}else if(r instanceof n["InviteClientContext"]){r.on(s.progress,function(e,t){i.writeLog("session out "+s.progress+" "+i.sip_sessions_out.length);i.handleAudio(r);i.fireCallBack(s.progress,null)});r.on(s.terminated,function(e,t){i.sip_sessions_out=i.sip_sessions_out.filter(function(e){return r!=e});i.writeLog("session out "+s.terminated+" "+i.sip_sessions_out.length);i.fireCallBack(s.terminated,null)})}};e.prototype.handleAudio=function(e){var t=this;var r=e.sessionDescriptionHandler.peerConnection;var i=new MediaStream;r.getReceivers().forEach(function(e){i.addTrack(e.track)});if(i.active){t.writeLog("remoteStream active attach audio");var n=document.getElementById(t.ID_AUDIO);n.srcObject=i;n.play().catch(function(e){t.writeLog(e)})}else{t.writeLog("remoteStream not active ignore")}};e.prototype.start=function(){var e=this;var t={uri:e.sip_account+"@"+e.sip_domain,password:e.sip_password,transportOptions:{wsServers:[e.wss_proto+"://"+e.wss_address+":"+e.wss_port],traceSip:e.sip_debug},register:true,autostart:true,allowLegacyNotifications:true,rel100:i["C"].supported.SUPPORTED,sessionDescriptionHandlerFactoryOptions:{peerConnectionOptions:{iceCheckingTimeout:e.ice_checkTimeout,rtcConfiguration:{iceServers:[{urls:["stun:webcs.agora.io:3478","stun:72.251.224.27:3478","stun:turnserver.ketianyun.com"]}]}}}};e.sip_ua=new i["UA"](t);e.handleUA(e.sip_ua)};e.prototype.invite=function(e){var t=this;if(t.count()>0){t.writeLog("only 1 call is allowed");return false}var r=t.sip_ua;if(null!=r){var i=e+"@"+t.sip_domain;r.invite(i,{sessionDescriptionHandlerOptions:{constraints:{audio:true,video:false}}});return true}else{return false}};e.prototype.answer=function(){this.sip_sessions_in.map(function(e,t){e.accept({sessionDescriptionHandlerOptions:{constraints:{audio:true,video:false}}})})};e.prototype.hangup=function(){this.sip_sessions_out.map(function(e,t){e.terminate()});this.sip_sessions_in.map(function(e,t){e.terminate()})};e.prototype.stop=function(){var e=this;var t=e.sip_ua;if(t){t.unregister();t.stop();e.destroyGui();e.sip_callbacks=[];e.sip_ua=null}};e.prototype.count=function(){return this.sip_sessions_out.length+this.sip_sessions_in.length};e.prototype.autoAnswerOnce=function(){this.autoAnswerOnceFlag=true};e.prototype.setAutoAnswer=function(e){this.sip_autoAnswer=e};e.prototype.getAutoAnswerState=function(){return this.sip_autoAnswer};return e}();var f=null;function u(e){if(!p()){f=new a(e)}}function c(e){if(p()){f.invite(e)}}function l(){if(p()){f.answer()}}function h(){if(p()){f.hangup()}}function d(){if(p()){f.stop();f=null}}function p(){return null!=f}function v(){if(p()){f.autoAnswerOnce()}}function g(e){if(p()){f.setAutoAnswer(e)}}function m(){if(p()){return f.getAutoAnswerState()}}var y=r(4);var T=r.n(y);var C=r(61);var S=r.n(C);function A(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function b(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function w(e,t,r){if(t)b(e.prototype,t);if(r)b(e,r);return e}function E(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var R;var _="LOGIN";var I="LOGOUT";var O="READY";var N="BUSY";var D="REST";var x="MAKECALL";var k="HOLD";var U="DTMF";var P="UNHOLD";var H="KILLCALL";var L="SATISFY";var q="TRANSFER";var M="THREEWAY";var F="PROGRESS";var B="LISTENCALL";var j="BARGEINCALL";var G="WHISPERCALL";var W="THREEWAYCALL";var K="RESTORECALL";var V="CONSULT";var Y="CONSULTCOMPLETE";var z="CONSULTCANCEL";var $="CONSULTCONF";var J="CB_CONNECT";var X="CB_LOGIN";var Q="CB_LOGOUT";var Z="CB_READY";var ee="CB_BUSY";var te="CB_REST";var re="CB_PROGRESS";var ie="CB_MAKECALL";var ne="CB_HOLD";var se="CB_DTMF";var oe="CB_UNHOLD";var ae="CB_RINGING";var fe="CB_ANSWERING";var ue="CB_REALTIME";var ce="CB_HANGUP";var le="CB_THREEWAY";var he="CB_LISTENCALL";var de="CB_KICKOUT";var pe="CB_CONSULT";var ve="CB_CONSULTCOMPLETE";var ge="CB_CONSULTCANCEL";var me=window.sessionStorage;me["state"]="";var ye,Te,Ce,Se;var Ae;var be;var we=function(){function i(e,t,r){A(this,i);E(this,"SipEvent",o);E(this,"SessionEvent",s);E(this,"agentNo",void 0);E(this,"token",void 0);E(this,"baseUrl","");E(this,"orgId","");E(this,"stateListener",[]);E(this,"initListener",[]);E(this,"popScreen",[]);E(this,"socketAgent",void 0);E(this,"discountCallback",void 0);this.baseUrl=e.baseUrl;this.agentNo=e.agentNo;this.path="/agentbar";if(r){this.discountCallback=r}if(t){this.initListener.push(t)}if(e.popScreen){this.popScreen.push(e.popScreen)}if(e.stateEventListener){console.log("stateEventListener is not null");this.addStateListener(e.stateEventListener)}this.socketAgent=S()(this.baseUrl,{path:this.path,autoConnect:true,forceNew:false});this.socketEvent(this.socketAgent)}w(i,[{key:"addStateListener",value:function e(t){this.stateListener.push(t)}},{key:"onChangeState",value:function e(t,r){this.stateListener.map(function(e){e({event:t,data:r})})}},{key:"login",value:function e(t,r){var i={};i.username="";i.password="";i.token=t;i.agentNo=r;this.socketAgent.emit(_,i)}},{key:"logout",value:function e(t){var r={};r.agentNo=Te;r.userId=Ce;r.workNo=ye;r.orgId=this.orgId;r.type=t;this.socketAgent.emit(I,r)}},{key:"ready",value:function e(){var t={};t.workNo=ye;t.userId=Ce;t.orgId=this.orgId;this.socketAgent.emit(O,t)}},{key:"busy",value:function e(){var t={};t.workNo=ye;t.userId=Ce;t.orgId=this.orgId;this.socketAgent.emit(N,t)}},{key:"rest",value:function e(t){var r={};r.workNo=ye;r.userId=Ce;r.orgId=this.orgId;r.detail=t;this.socketAgent.emit(D,r)}},{key:"progress",value:function e(){var t={};t.workNo=ye;t.userId=Ce;t.orgId=this.orgId;this.socketAgent.emit(F,t)}},{key:"makecall",value:function e(t){var r={};r.workNo=ye;r.orgId=this.orgId;r.agentNo=Te;r.domain=Se;r.callOut=t;this.socketAgent.emit(x,r);v()}},{key:"hold",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(k,t)}},{key:"unhold",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(P,t)}},{key:"dtmf",value:function e(t){var r={};r.uuid=Ae;r.dtmf=t;this.socketAgent.emit(U,r)}},{key:"hangup",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(H,t)}},{key:"satisfy",value:function e(){var t={};t.uuid=Ae;t.orgId=this.orgId;this.socketAgent.emit(L,t)}},{key:"transfer",value:function e(t,r,i,n,s){var o={};o.type=t;o.uuid=Ae;o.orgId=this.orgId;o.domain=Se;o.transferNo=r;o.transferQueue=i;o.transfeeNo=n;o.transferUserId=s;this.socketAgent.emit(q,o)}},{key:"threeWay",value:function e(t,r){var i={};i.type=t;i.uuid=Ae;i.orgId=this.orgId;i.domain=Se;i.userId=Ce;i.threewayNo=r;this.socketAgent.emit(M,i)}},{key:"listenCall",value:function e(t,r){var i={};i.orgId=this.orgId;i.userId=Ce;i.domain=Se;i.uuid=t;i.listenCaller=Te;i.listenCallee=r;this.socketAgent.emit(B,i)}},{key:"bargeinCall",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(j,t)}},{key:"whisperCall",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(G,t)}},{key:"threewayCall",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(W,t)}},{key:"restoreCall",value:function e(){var t={};t.uuid=Ae;this.socketAgent.emit(K,t)}},{key:"destroy",value:function e(){this.socketAgent.close()}},{key:"consult",value:function e(t,r){var i={};i.callId=Ae;i.consultNum=t;i.domain=Se;i.orgId=this.orgId;i.consultUserId=r;R.emit(V,i)}},{key:"consultComplete",value:function e(){var t={};t.callId=Ae;R.emit(Y,t)}},{key:"consultCancel",value:function e(){var t={};t.callId=Ae;t.consultUuid=be;R.emit(z,t)}},{key:"consultConf",value:function e(){var t={};t.callId=Ae;R.emit($,t)}},{key:"writeToScreen",value:function e(t){console.log(t)}},{key:"socketEvent",value:function e(t){var r=this;t.on("connect",function(){r.writeToScreen("websocket连接成功");if(r.initListener){r.initListener.map(function(e){e({code:200,msg:"初始化连接成功."})})}});t.on("disconnect",function(e){r.writeToScreen("websocket断开连接");if(r.initListener){r.initListener.map(function(e){e({code:500,msg:"初始化连接失败."});r.discountCallback()})}});t.on("reconnect_failed",function(e){r.writeToScreen("websocket重连失败");if(r.initListener){r.initListener.map(function(e){e({code:500,msg:"websocket重连失败."})})}});t.on("reconnect",function(e){r.writeToScreen("websocket reconnect "+e)});t.on(J,function(e){r.onChangeState(J,e)});t.on(X,function(e){if(e.code===200){r.writeToScreen(e.message);r.orgId=e.data.orgId;ye=e.data.workNo;Te=e.data.agentNo;Ce=e.data.userId;Se=e.data.domain}else{r.writeToScreen(e.message);r.orgId="";ye="";Te="";Ce="";Se=""}r.onChangeState(X,e)});t.on(Q,function(e){r.onChangeState(Q,e);if(e.code===200){r.writeToScreen(e.message);r.orgId="";ye="";Te="";Ce="";Se="";Ae=""}});t.on(ie,function(e){r.onChangeState(ie,e)});t.on(Z,function(e){r.onChangeState(Z,e)});t.on(ee,function(e){r.onChangeState(ee,e)});t.on(te,function(e){r.onChangeState(te,e)});t.on(re,function(e){r.onChangeState(re,e)});t.on(ae,function(e){var t=e.data;r.writeToScreen(t);Ae=t.callId;r.onChangeState(ae,e);if(r.popScreen[0]){r.popScreen.map(function(e){e(t)})}});t.on(fe,function(e){r.onChangeState(fe,e)});t.on(ue,function(e){r.onChangeState(ue,e)});t.on(ce,function(e){r.onChangeState(ce,e)});t.on(ne,function(e){r.onChangeState(ne,e)});t.on(se,function(e){r.onChangeState(se,e)});t.on(oe,function(e){r.onChangeState(oe,e)});t.on(le,function(e){r.onChangeState(le,e)});t.on(he,function(e){r.onChangeState(he,e)});t.on(de,function(){r.discountCallback();r.onChangeState(de,null)});t.on(pe,function(e){var t=e.data;be=t.consultUuid;r.onChangeState(pe,e)});t.on(ve,function(e){be="";r.onChangeState(ve,e)});t.on(ge,function(e){be="";r.onChangeState(ge,e)})}}]);return i}();r.d(t,"SipEvent",function(){return Le});r.d(t,"init",function(){return qe});r.d(t,"destroy",function(){return Me});r.d(t,"login",function(){return Fe});r.d(t,"logout",function(){return Be});r.d(t,"ready",function(){return je});r.d(t,"busy",function(){return Ge});r.d(t,"rest",function(){return We});r.d(t,"progress",function(){return Ke});r.d(t,"makecall",function(){return Ve});r.d(t,"hold",function(){return Ye});r.d(t,"unhold",function(){return ze});r.d(t,"dtmf",function(){return $e});r.d(t,"hangup",function(){return Je});r.d(t,"satisfy",function(){return Xe});r.d(t,"transfer",function(){return Qe});r.d(t,"threeWay",function(){return Ze});r.d(t,"listenCall",function(){return et});r.d(t,"bargeinCall",function(){return tt});r.d(t,"whisperCall",function(){return rt});r.d(t,"threewayCall",function(){return it});r.d(t,"restoreCall",function(){return nt});r.d(t,"webRTCAnswer",function(){return st});r.d(t,"setWebRTCAutoAnswer",function(){return ot});r.d(t,"getAlreadyBind",function(){return at});r.d(t,"getAvailableTypes",function(){return ft});r.d(t,"getCallInMobileState",function(){return ut});r.d(t,"setCallInMobileState",function(){return ct});r.d(t,"getAgentInfo",function(){return lt});r.d(t,"getQueueInfo",function(){return ht});r.d(t,"isAnswer",function(){return dt});r.d(t,"forceChange",function(){return pt});var Ee,Re,_e,Ie,Oe,Ne,De,xe,ke,Ue,Pe,He;var Le=o;function qe(t,r,e){Re=t.baseUrl;Oe=t.username;Ne=t.password;if(t.webRTCAutoAnswer){Ue=t.webRTCAutoAnswer}else{Ue=false}if(t.iceCheckTimeout){He=t.iceCheckTimeout}else{He=500}xe="true"===t.enableWebRTC;if(e){Pe=[].concat(e)}else{Pe=[]}var i=t.token;var n=t.orgi;if(i&&n){Ie=i;_e=n;return vt(t,r)}else{return T.a.post(Re+"/callInfo/sipInfo/auth",{username:Oe,password:Ne}).then(function(e){Ie=e.data.data.token;_e=e.data.data.orgi;return vt(t,r)})}}function Me(){Ee.logout();Ee.destroy();mt()}function Fe(e){De=e;if(true===xe){if(true===ke){yt()}else{Tt("WebRTC模式不允许,回落至硬件话机模式!!!")}}Ee.login(Ie,e)}function Be(){Ee.logout(1);mt()}function je(){Ee.ready()}function Ge(){Ee.busy()}function We(e){Ee.rest(e)}function Ke(){Ee.progress()}function Ve(e){Ee.makecall(e)}function Ye(){Ee.hold()}function ze(){Ee.unhold()}function $e(e){Ee.dtmf(e)}function Je(){Ee.hangup()}function Xe(){Ee.satisfy()}function Qe(e,t,r,i,n){Ee.transfer(e,t,r,i,n)}function Ze(e,t){Ee.threeWay(e,t)}function et(e,t){Ee.listenCall(e,t)}function tt(){Ee.bargeinCall()}function rt(){Ee.whisperCall()}function it(){Ee.threewayCall()}function nt(){Ee.restoreCall()}function st(){l()}function ot(e){g(e);Ue=e}function at(){return T.a.get(Re+"/callInfo/sipInfo/alreadyBind?token="+Ie).then(function(e){return e.data.data})}function ft(){return T.a.get(Re+"/callInfo/sipInfo/types?token="+Ie).then(function(e){var t=e.data.data;return t})}function ut(){return T()({method:"get",url:Re+"/callInfo/agents/checkTransferMob",headers:{token:Ie}}).then(function(e){if(e.data.code===200){return e.data.data}else{return false}})}function ct(e){var t=false;if(true===e){t=true}return T()({url:Re+"/callInfo/agents/transferMob",method:"post",headers:{token:Ie},data:{open:t+""}}).then(function(e){if(e.data.code===200){return true}else if(e.data.code===400){return false}})}function lt(){return T.a.get(Re+"/callInfo/agents/"+_e).then(function(e){if(e.data.code===200){return e.data.data}else{return[]}})}function ht(e,t){return T.a.get(Re+"/callInfo/queues/"+_e+"/"+e+"/"+t).then(function(e){if(e.data.code===200){return{data:e.data.data.records,total:e.data.data.total}}else{return{data:[],total:0}}})}function dt(){return T()({url:Re+"/callInfo/agents/isAnswer",method:"get",headers:{token:Ie}}).then(function(e){return e.data.data.isAnswer})}function pt(e,t){return T.a.post(Re+"/callInfo/sipInfo/force/"+e+"/"+t,{token:Ie}).then(function(e){return e})}function vt(r,i){return T.a.get(Re+"/callInfo/sipInfo/types?token="+Ie).then(function(e){var t=e.data.data;if(t.indexOf("webrtc")>-1||t.indexOf("hard")>-1){if(t.indexOf("webrtc")>-1){ke=true}if(true===xe){if(true!==ke){Tt("WebRTC模式不允许,回落至硬件话机模式");return{code:500,msg:"WebRTC模式不允许,回落至硬件话机模式！"}}else{navigator.mediaDevices.getUserMedia({video:false,audio:true}).then(function(e){e.getTracks().forEach(function(e){e.stop()});Pe.map(function(e,t){e.handle("check",true)})}).catch(function(e){Tt("麦克风校验失败,销毁");Me();Pe.map(function(e,t){e.handle("check",false)})})}}Ee=new we(r,i,gt)}else{Tt("无可用模式,请联系管理员");return{code:500,msg:"无可用模式,请联系管理员！"}}return{code:200,msg:"ok",data:t}})}function gt(){mt()}function mt(){d()}function yt(){if(true===ke){return T.a.get(Re+"/callInfo/sipInfo/"+De+"?token="+Ie).then(function(r){if(r.data.code===200){navigator.mediaDevices.getUserMedia({video:false,audio:true}).then(function(e){e.getTracks().forEach(function(e){e.stop()});Pe.map(function(e,t){e.handle("check",true)});var t=r.data.data;u({sip_account:De,sip_domain:t.domain,sip_password:t.password,sip_autoAnswer:Ue,wss_proto:t.proto,wss_address:t.address,wss_port:t.port,ice_checkTimeout:He,debug:t.debug,sip_callbacks:Pe});return{code:200,msg:"ok"}}).catch(function(e){Tt("麦克风校验失败,销毁");Me();Pe.map(function(e,t){e.handle("check",false)})})}else{Tt("WebRTC信息获取失败,自动退出");Me();return{code:500,msg:"WebRTC信息获取失败,自动退出！"}}})}else{Tt("WebRTC模式无法使用,请联系管理员");return{code:500,msg:"WebRTC模式无法使用,请联系管理员！"}}}function Tt(e){console.log("tky sdk msg:"+e)}}]);