<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="_header_include::frag(~{::title},~{},~{})">
    <title>标记异常客户</title>

</head>
<body>

<div id="queryForm"  class="mainPadding">

    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>业务设置</el-breadcrumb-item>
        <el-breadcrumb-item><a href="JavaScript:void(0)" data-url="b.html">标记异常客户</a></el-breadcrumb-item>
    </el-breadcrumb>

    <el-row type="flex" class="row-bg" justify="start">
        <el-button @click="openAddDialog()">添加异常客户</el-button>
        <el-button @click="openUpdateDialog()">删除</el-button>
    </el-row>

    <el-row type="flex" class="row-bg" justify="end">
        <el-form :inline="true" :model="queryForm" class="demo-form-inline" ref="queryForm" >

            <el-form-item label="">
                <el-select v-model="queryForm.status" placeholder="状态搜索" width="100">
                    <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value"></el-option>
                </el-select>
            </el-form-item>

            <el-form-item label="">
                <el-select v-model="queryForm.type" placeholder="异常类型" width="100">
                    <el-option v-for="item in options" :key="item.value" :label="item.label" :value="item.value"></el-option>
                </el-select>
            </el-form-item>

            <el-form-item label="创建时间">
                <el-date-picker v-model="queryForm.time1" type="datetime" placeholder="选择日期时间"></el-date-picker>
                <span>到</span>
                <el-date-picker v-model="queryForm.time2" type="datetime" placeholder="选择日期时间"></el-date-picker>
            </el-form-item>

            <el-form-item label="" prop="name">
                <el-input v-model="queryForm.phone" placeholder="客户电话"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="onSubmit">搜索</el-button>
            </el-form-item>
        </el-form>
    </el-row>
</div>

<div id="pagination">
    <template>
        <el-table :data="tableData3" height="650" style="width: 100%" tooltip-effect="dark"  ref="multipleTable"  @select="selectRow"
                  @row-dblclick="rowDblClick()"
                  @selection-change="handleSelectionChange" >
            <el-table-column type="selection" width="55" prop="id"> </el-table-column>
            <el-table-column prop="phone" label="客户电话" width="180" align="center"></el-table-column>
            <el-table-column prop="type" label="异常类型" width="180" align="center"></el-table-column>
            <el-table-column prop="createTime" label="创建时间" width="300" align="center"></el-table-column>
            <el-table-column prop="createUser" label="创建人" width="300" align="center"></el-table-column>
            <el-table-column  prop="status" label="状态" align="center">
                正常标记
            </el-table-column>
        </el-table>
    </template>

    <template>
        <div class="block">
            <el-pagination @size-change="handleSizeChange"
                           @current-change="handleCurrentChange" :current-page="currentPage"
                           :page-sizes="[20, 50, 100]" :page-size="pageSize"
                           layout="total, sizes, prev, pager, next, jumper" :total="total">
            </el-pagination>
        </div>
    </template>


</div>



<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>

<script>

    // 查询 模块
    var queryFormVM = new Vue({
        el: '#queryForm',
        data: {
            queryForm: {
                type:"",
                status:"",
                time1:"",
                time2:"",
                phone:""
            },
            options: [{
                value: '1',
                label: '正常标记'
            }, {
                value: '2',
                label: '标记已删除'
            }],

        },
        methods: {
            openAddDialog:function(){
                addDialogVm.dialogFormVisible = true
                addDialogVm.resetForm('add');
            },
            openUpdateDialog:function(){
                if(paginationVm.multipleSelection.length!=1){
                    queryFormVM.$message.error('请选择一条数据进行编辑');
                    return false;
                }
                updateDialogVm.resetForm('add');
                updateDialogVm.updateDialogFormVisible = true;
                var row = paginationVm.multipleSelection[0];
                updateDialogVm.initUpdateData(row.id);
            },
            deleteDic:function(){

            },
            onSubmit() {
                var param = queryFormVM.queryForm;
                param.pageSize = paginationVm.pageSize;
                param.pageNum = paginationVm.pageNum;
                console.log(param)

            },
            resetForm(formName) {
                queryFormVM.$refs[formName].resetFields();
                this.$refs[formName].resetFields();
            }
        }


    });

    //带分页的table
    var paginationVm = new Vue({
        el: '#pagination',
        data: {
            tableData3: [],
            multipleSelection:[],
            currentPage: 1,
            total: 0,
            pageNum: 1,
            pageSize: 20
        },
        methods: {
            inDicItemPage(row){
                var dicId = row.id;
                //这里的跳转方法需要在实际合并到系统中的时候进行详尽的修改。
                window.location.href = '/dictionary/DictionaryItem/itemListPage?dicid='+dicId;
            },
            rowDblClick(row, event){
                // alert("行双击事件")
            },
            selectRow(row){
            },
            handleSelectionChange(val) {
                console.info(val);
                this.multipleSelection = val;
            },
            handleSizeChange(val) {
                //下拉框  每页 10,20条切换 调用
                console.log(`每页 ${val} 条`);
                this.pageSize = val;
                paginationVm.initTableData(1);
            },
            handleCurrentChange(val) {
                console.log(`当前页: ${val}`);
                paginationVm.pageNum = val;
                paginationVm.initTableData(val);
            },
            initTableData(v_pageNum) {
                var param = queryFormVM.queryForm;
                param.pageSize = this.pageSize;
                param.pageNum = v_pageNum;
            }
        },
        created() {
            this.initTableData(1);

        },
        mounted() {
            console.info("mounted method");
        }

    });

</script>
<style>
    .el-button--primary {
        background-color: #6f7180;
        border: #6f7180;
    }

    .el-table th {
        font-weight: bolder;
    }
</style>
</body>
</html>