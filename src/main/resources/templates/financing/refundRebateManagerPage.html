<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:replace="_header_include::frag(~{::title},~{::style},~{})">
    <title>后台管理系统</title>
    <style>
        .el-upload-list{width: 200px;}
        .el-tag{margin-right: 10px;}
    </style>
</head>
<body>
<div id="clueManage" class="clueManage mainPadding" style="display: none;">  
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>财务管理</el-breadcrumb-item>
        <el-breadcrumb-item>餐饮公司退返款（客户签约单）</el-breadcrumb-item>
    </el-breadcrumb>
    
    <el-row class="marginB20">
    		<shiro:hasPermission name="financing:refundRebateManager:applyRefund">
		        <el-button type="primary" @click="toAllocationClue('allocationForm')">申请退款</el-button>
		    </shiro:hasPermission>
    		<shiro:hasPermission name="financing:refundRebateManager:applyRebate">
		        <el-button type="success" @click="toTransferClue('transferForm')">申请返款</el-button>
		    </shiro:hasPermission>
	  </el-row>
    <div class="mainSearchBg">        
        <div class="mainSearchFormBox">
    	      <el-form :inline="true" :model="searchForm" class="demo-form-inline mainSearchForm" ref="searchForm"> 
                <el-form-item label="商务大区:"  prop="busAreaId">
                  <el-select v-model="searchForm.busAreaId" clearable  placeholder="商务大区">
                    <el-option
                      v-for="item in busAreaOptions"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id">
                  </el-option>
                  </el-select>
                </el-form-item>
                <el-form-item label="签单商务组:"  prop="busGroupId">
                  <el-select v-model="searchForm.busGroupId" clearable placeholder="签单商务组">
                    <el-option
                      v-for="item in busGroupOptions"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id">
                  </el-option>
                  </el-select>
                </el-form-item>
                <el-form-item label="签单商务经理:"  prop="busSaleId">
                  <el-select v-model="searchForm.busSaleId" clearable placeholder="签单商务经理">
                    <el-option
                      v-for="item in busSaleOptions"
                      :key="item.id"
                      :label="item.name"
                      :value="item.id">
                  </el-option>
                  </el-select>
                </el-form-item>
                <el-form-item label="签约时间:">
                    <el-date-picker  v-model="searchForm.startTime" format="yyyy-MM-dd HH:mm" type="datetime" placeholder="选择日期"></el-date-picker>
                </el-form-item>
                <el-form-item label="—" class="widthauto">
                    <el-date-picker  v-model="searchForm.endTime" format="yyyy-MM-dd HH:mm" type="datetime" placeholder="选择日期"></el-date-picker>
                </el-form-item>
                <el-row v-show="isShow">
                    <el-form-item label="签约店型:"  prop="signShopType">
                      <el-select v-model="searchForm.signShopType" clearable placeholder="签约店型">
                        <el-option
                          v-for="item in signShopTypeOptions"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="签约类型:"  prop="signType">
                      <el-select v-model="searchForm.signType" clearable  placeholder="签约类型">
                        <el-option
                          v-for="item in signTypeOptions"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                      </el-select>
                    </el-form-item>                
                    <el-form-item label="客户姓名:" prop="cusName">
                    <el-input v-model="searchForm.cusName" placeholder="客户姓名"></el-input>
                    </el-form-item>
                    <el-form-item label="电销事业部:"  prop="teleDeptId">
                      <el-select v-model="searchForm.teleDeptId" clearable  placeholder="电销事业部">
                        <el-option
                          v-for="item in teleDeptOptions"
                          :key="item.id"
                          :label="item.name"
                          :value="item.id">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="电销组:"  prop="teleGorupId">
                      <el-select v-model="searchForm.teleGorupId" clearable  placeholder="电销组">
                        <el-option
                          v-for="item in teleGorupOptions"
                          :key="item.id"
                          :label="item.name"
                          :value="item.id">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="创业顾问:"  prop="teleSaleId">
                      <el-select v-model="searchForm.teleSaleId" clearable placeholder="创业顾问">
                        <el-option
                          v-for="item in teleSaleOptions"
                          :key="item.id"
                          :label="item.name"
                          :value="item.id">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="签约省份:"  prop="signProvince">
                      <el-select v-model="searchForm.signProvince" clearable  placeholder="签约省份">
                        <el-option
                          v-for="item in provinceOptions"
                          :key="item.name"
                          :label="item.name"
                          :value="item.name">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="签约单状态:"  prop="signStatus">
                      <el-select v-model="searchForm.signStatus" clearable placeholder="签约单状态">
                        <el-option
                          v-for="item in signStatusOptions"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                      </el-select>
                    </el-form-item>
                    <el-form-item label="客户手机号:" prop="phone">
                        <el-input v-model="searchForm.phone" placeholder="客户手机号"></el-input>
                    </el-form-item>
                    <el-form-item label="签约单编号:" prop="signNo">
                        <el-input v-model="searchForm.signNO" placeholder="签约单编号"></el-input>
                    </el-form-item>
                </el-row>
                <div class="mainSearchBtnBox">
          		      <el-button type="primary" @click="searchTable()" class="searchBtn">搜索</el-button>
                    <el-button type="info" class="searchBtn">取消</el-button>
                    <span style="color: #5c6be8;cursor: pointer;margin:0 10px;" @click="toogleClick">更多搜索<i class="el-icon-arrow-down greycolor paddingL6"></i>
                </div>
      	    </el-form>
        </div>
        <el-row>
            <el-table  ref="multipleTable" tooltip-effect="dark" border  @selection-change="handleSelectionChange"
                style="width: 100%"  :data="dataTable" >
               <el-table-column align="center" type="selection" label="全选" width="55"></el-table-column>
               <el-table-column align="center" type="index" label="序号" width="55"></el-table-column>
               <el-table-column align="center" prop="signNo" label="签约单编号"  width="170"></el-table-column>
               <el-table-column align="center" prop="projectName" label="签约项目" width="170"></el-table-column>
               <el-table-column align="center" prop="signStatus" label="签约单状态" :formatter="transformSignStatus"></el-table-column>
               <el-table-column align="center" prop="signType" label="签约类型" :formatter="transformSignType"></el-table-column>
               <el-table-column align="center" prop="signTime" label="签约时间"></el-table-column>
               <el-table-column align="center" label="付款明细">
               		 <template slot-scope="scope">
                            <el-button type="text" size="small" @click="recordClick(scope.row)">查看明细
                            </el-button>
                    </template>
               </el-table-column>
               <el-table-column align="center" prop="signShopType" label="签约店型" :formatter="transformSignShopType"></el-table-column>
               <el-table-column align="center" prop="amountReceivable" label="应收金额"></el-table-column>
               <el-table-column align="center" prop="firstToll" label="路费"></el-table-column>
               <el-table-column align="center" prop="preferentialAmount" label="优惠金额"></el-table-column>
               <el-table-column align="center" prop="giveAmount" label="赠送金额"></el-table-column>
               <el-table-column align="center" prop="cusName" label="客户姓名" ></el-table-column>
               <el-table-column align="center" prop="idCard" label="客户身份证号"></el-table-column>
               <el-table-column align="center" prop="phone" label="手机号"></el-table-column>
               <el-table-column align="center" prop="signProvince" label="签约省份" ></el-table-column>
               <el-table-column align="center" prop="signCity" label="签约城市" ></el-table-column>
               <el-table-column align="center" prop="signDistrict" label="签约区／县" width="120"></el-table-column>
               <el-table-column align="center" prop="busAreaName" label="商务大区"></el-table-column>
               <el-table-column align="center" prop="busGroupName" label="商务小组"></el-table-column>
               <el-table-column align="center" prop="busSaleName" label="商务经理"></el-table-column>
               <el-table-column align="center" prop="teleCompanyName" label="电销分公司"></el-table-column>
               <el-table-column align="center" prop="teleDeptName" label="电销事业部"></el-table-column>
               <el-table-column align="center" prop="teleGorupName" label="电销组"></el-table-column>
               <el-table-column align="center" prop="teleSaleName" label="创业顾问"></el-table-column>
               <el-table-column align="center" prop="isRemoteSign" label="是否远程签约" :formatter="transformSex"></el-table-column>
            </el-table>
            <table-pagination :pager="pager" @change="searchTable"></table-pagination>
        </el-row>
    </div>
    <!-- dialog -->
    <el-dialog  :title="refundTitle"  :visible.sync="allocationVisible" width="870px">
        <template>
            <el-form :model="allocationForm" ref="allocationForm" :rules="allocationFormRules"> 
              <el-form-item label="退款客户金额：" :label-width="formLabelWidth" prop="cusAmount">
                  <el-input v-model="allocationForm.cusAmount" placeholder="" style="width:50%"></el-input>
              </el-form-item>
             <el-form-item label="" v-show="isSettle==1" :label-width="formLabelWidth" class="redcolor">
                  <span style="color:red;">当前项目为给品牌商结算</span>
              </el-form-item>
              <el-form-item label="退款时间：" :label-width="formLabelWidth" prop="refundTime">
                  <el-date-picker
                      style="width: 50%;"
                      v-model="allocationForm.refundTime"
                      type="datetime"
                      placeholder="选择日期时间">
                  </el-date-picker>
              </el-form-item>
              <el-form-item label="上传图片：" :label-width="formLabelWidth" prop="fileList">
              </el-form-item>
                        <a id="selectfiles" href="javascript:void(0);" class='btn'>选择文件</a> 
                        <a id="postfiles" href="javascript:void(0);" onclick="clueUploadFile()"
                            class='btn'>开始上传</a>
                    <div id="ossfile"></div>
                   <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过500kb</div>
              <el-form-item label="退款原因：" :label-width="formLabelWidth" prop="reason">
                  <el-input
                      type="textarea"
                      :rows="3"
                      placeholder=""
                      maxLength="100"
                      v-model="allocationForm.reason" 
                      style="width: 80%;">
                  </el-input>
              </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button type="primary" @click="allocationClue('allocationForm')">提 交</el-button>
                <el-button  @click="allocationClueCancel('allocationForm')">取 消</el-button>
            </div>
        </template>
    </el-dialog>
    <!-- dialog -->
    <el-dialog  :title="rebateTitle"  :visible.sync="transferVisible">
        <template>
            <el-form :model="transferForm" ref="transferForm" :rules="transferFormRules">
              <el-form-item label="" :label-width="formLabelWidth" prop="">
                <el-tag
                  :key="tag"
                  v-for="tag in dynamicTags"
                  closable
                  :disable-transitions="false"
                  @close="handleClose(tag)">
                  {{tag}}
                </el-tag>
              </el-form-item>
              <el-form-item label="关联签约单：" :label-width="formLabelWidth" prop="dynamicTags">
                <el-button type="primary" @click="chooseRelevance">选择关联签约单</el-button>
              </el-form-item>
            	<el-form-item label="返款客户金额：" :label-width="formLabelWidth" prop="cusAmount">
                <el-input v-model="transferForm.cusAmount" placeholder="" style="width:50%"></el-input>
              </el-form-item>
              <el-form-item label="" v-show="isSettle==1" :label-width="formLabelWidth" class="redcolor">
                  <span style="color:red;">当前项目为给品牌商结算</span>
              </el-form-item>
              <el-form-item label="返款时间：" :label-width="formLabelWidth" prop="refundTime">
                  <el-date-picker
                      style="width: 50%;"
                      v-model="transferForm.refundTime"
                      type="datetime"
                      placeholder="选择日期时间">
                  </el-date-picker>
              </el-form-item>
              <el-form-item label="上传图片：" :label-width="formLabelWidth" prop="fileList">
                  <el-upload
                      class="upload-demo"
                      action="https://jsonplaceholder.typicode.com/posts/"
                      multiple
                      :file-list="transferForm.fileList"
                      >
                      <el-button size="small" type="primary">点击上传</el-button>
                      <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过500kb</div>
                  </el-upload>
              </el-form-item>
              <el-form-item label="返款原因：" :label-width="formLabelWidth" prop="reason">
                  <el-input
                      type="textarea"
                      :rows="3"
                      placeholder=""
                      maxLength="100"
                      v-model="transferForm.reason" 
                      style="width: 80%;">
                  </el-input>
              </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button type="primary" @click="transferClue('transferForm')">提 交</el-button>
                <el-button  @click="transferClueCancel('transferForm')">取 消</el-button>
            </div>
        </template>
    </el-dialog>
    <!-- dialog -->
    <!-- 付款明细 -->
    <el-dialog title="付款明细" :visible.sync="recordDialog">
        <el-table
            ref="recordTable" 
            tooltip-effect="dark"
            style="width: 100%;margin-bottom: 20px;"
            border
            :data="recordTable" 
            >
            <el-table-column align="center" prop="payType" label="付款类型" :formatter="transformPayType"></el-table-column>
            <el-table-column align="center" prop="statementNo" label="结算单编号" width="200"></el-table-column>
            <el-table-column align="center" prop="payMode" label="付款方式" :formatter="getPayModeText"></el-table-column>
            <el-table-column align="center" prop="payTime" label="付款时间" :formatter="getTimeText"></el-table-column>
            <el-table-column align="center" prop="amountReceived" label="实收金额"></el-table-column>
            <el-table-column align="center" prop="amountPerformance" label="业绩金额"></el-table-column>
            <el-table-column align="center" prop="accountStatus" label="结算状态" :formatter="transformStatus"></el-table-column>
            <el-table-column align="center" prop="money" label="结算金额"></el-table-column>
            <el-table-column align="center" prop="commissionMoney" label="佣金"></el-table-column>
            <el-table-column align="center" prop="remarks" label="备注"></el-table-column>
        </el-table>
    </el-dialog>
    <!-- 关联签约单 -->
    <!-- dialog -->
    <el-dialog title="选择关联签约单" :visible.sync="dialogFormChooseVisible">      
      <el-row class="marginB10 greybg padding20" style="padding-bottom: 0;">
        <el-form :inline="true" :model="dialogFormChoose" ref="dialogFormChoose">
          <el-form-item class="formItem" label="签约时间：">
              <el-date-picker  v-model="dialogFormChoose.startTime" format="yyyy-MM-dd HH:mm" type="datetime" placeholder="选择日期"></el-date-picker>
          </el-form-item>
          <el-form-item class="formItem" label="—">
              <el-date-picker  v-model="dialogFormChoose.endTime" format="yyyy-MM-dd HH:mm" type="datetime" placeholder="选择日期"></el-date-picker>
          </el-form-item>
          <el-form-item label=""  prop="">
            <el-input v-model="dialogFormChoose.signNo" placeholder="签约单编号"></el-input>
          </el-form-item>
          <el-form-item label=""  prop="">
            <el-input v-model="dialogFormChoose.cusName" placeholder="客户姓名"></el-input>
          </el-form-item>
          <el-form-item label=""  prop="">
            <el-button type="primary" size="medium" @click="chooseRelevance()" icon="el-icon-search">搜索</el-button>
          </el-form-item>
        </el-form>  
      </el-row>
      <el-table 
          tooltip-effect="dark"
          style="width: 100%"
          border
          :row-key="getRowKey"
          :data="dataTableChoose" 
           @selection-change="signSelectionChange"
          class="marginB10">
          <el-table-column align="center" :reserve-selection="true"  prop="" type="selection" name="type" width="55"></el-table-column>
          <el-table-column align="center" prop="" label="序号" type="index" name="type" width="55"></el-table-column>
          <el-table-column align="center" prop="signNo" label="签约单编号"></el-table-column>
          <el-table-column align="center" prop="signTime" label="签约时间"></el-table-column>
          <el-table-column align="center" prop="cusName" label="客户姓名"></el-table-column>
          <el-table-column align="center" prop="phone" label="客户手机号"></el-table-column>
          <el-table-column align="center" prop="amountReceivable" label="应收金额"></el-table-column>
      </el-table>
      <div slot="footer" class="dialog-footer">
          <el-button type="primary" @click="submitSign('dialogFormChoose')">提交</el-button>
          <el-button @click="dialogFormChooseVisible = false">取消</el-button>
      </div>
    </el-dialog>
</div>
<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>

</body>
<script type="text/javascript"
        th:src="@{'/js/custom/file_upload/lib/crypto1/crypto/crypto.js'}"></script>
<script type="text/javascript"
        th:src="@{'/js/custom/file_upload/lib/crypto1/hmac/hmac.js'}"></script>
<script type="text/javascript"
        th:src="@{'/js/custom/file_upload/lib/crypto1/sha1/sha1.js'}"></script>
<script type="text/javascript"
        th:src="@{'/js/custom/file_upload/lib/base64.js'}"></script>
<script type="text/javascript"
        th:src="@{'/js/custom/file_upload/plupload.full.min.js'}"></script>
<script type="text/javascript"
        th:src="@{'/js/custom/financing/file_upload.js'}"></script>
<script th:inline="javascript">
var busAreaList=[[${busAreaList}]];//商务大区
var busGroupList=[[${busGroupList}]];//商务组
var busSaleList=[[${busSaleList}]];//商务经理
var teleDeptList=[[${teleDeptList}]];//电销事业部
var teleGroupList=[[${teleGroupList}]];//电销组
var teleSaleList=[[${teleSaleList}]];//创业顾问
var provinceList=[[${provinceList}]];//省份
var vistitStoreTypeList=[[${vistitStoreTypeList}]];//签约店型
var clueVM = new Vue({
        el: '#clueManage',
        data: {
          isShow:false,
      		searchForm: {
	       		busAreaId: '',
	       		busGroupId: '',
	       		busSaleId: '',
	       		signType: '',
	       		signShopType: '',
	       		startTime: '',
	       		endTime: '',
	       		cusName: '',
	       		teleDeptId: '',
	       		teleGorupId: '',
	       		teleSaleId: '',
	       		signProvince: '',
	       		signStatus: '',
	       		phone: '',
	       		signNo: ''
          },
          allocationForm: {
        	  
        	signId:'',
          	reason:'',
            refundTime:'',
            cusAmount:'',
            fileList: [],
          },
          transferForm: {
        	  signId:'',
              reason:'',
              refundTime:'',
              cusAmount:'',
              signProjectId:'',
              signProvince:'',
              fileList: [],
          },
          dataTable:[],
          recordDialog:false,
          recordTable:[],
          busAreaOptions:busAreaList,
          busGroupOptions:busGroupList,
          busSaleOptions:busSaleList,
          teleDeptOptions:teleDeptList,
          teleGorupOptions:teleGroupList,
          teleSaleOptions:teleSaleList,
          provinceOptions:provinceList,
          signShopTypeOptions:vistitStoreTypeList,
          signTypeOptions:[{
          	value:1,
          	name:"一次性全款"
          },{
          	value:2,
          	name:"先交订金"
          }],
          signStatusOptions:[{
          	value:1,
          	name:"正常"
          },{
          	value:2,
          	name:"退款确认中"
          },{
          	value:3,
          	name:"返款确认中"
          },{
          	value:4,
          	name:"退款成功"
          },{
          	value:5,
          	name:"返款成功"
          }],
          allocationVisible: false,
          transferVisible: false,
          isSettle:0,
          refundTitle:'',
          rebateTitle:'',
          pager:{
              total: 0,
              currentPage: 1,
              pageSize: 20,
          },
          allocationFormRules: {
          	reason : [
                { required: true, message: '请输入退款原因', trigger: 'blur' }
            ],
            refundTime : [
                { required: true, message: '请选择退款时间', trigger: 'blur' }
            ],
            cusAmount: [
                { required: true, message: '请输入退款客户金额', trigger: 'blur' }
            ],
           /*  fileList: [
                { required: true, message: '请上传图片', trigger: 'blur' }
            ], */
          },
          transferFormRules: {
        	reason : [
                { required: true, message: '请输入返款原因', trigger: 'blur' }
            ],
            refundTime : [
                { required: true, message: '请选择退款时间', trigger: 'blur' }
            ],
            cusAmount: [
                { required: true, message: '请输入返款客户金额', trigger: 'blur' }
            ],
            /* fileList: [
                { required: true, message: '请上传图片', trigger: 'blur' }
            ], */
          },
          multipleSelection:[],
          signSelection:[],
          formLabelWidth: '150px',
          formLabelWidth1: '120px',     
          dialogFormChooseVisible:false, //关联弹窗
          dialogFormChoose:{
        	  startTime:'',
        	  endTime:'',
        	  cusName:'',
        	  signNo:'',
        	  startPeojectId:'',
        	  startProvince:''
        	  
          },   
          dataTableChoose:[],   
          dynamicTags: [],
        },
        methods: {
          handleClose(tag) {
            this.dynamicTags.splice(this.dynamicTags.indexOf(tag), 1);
          },
          chooseRelevance(){
        	  var param ={};
              var startTime = this.dialogFormChoose.startTime;
              var endTime = this.dialogFormChoose.endTime;
              if(startTime&&endTime&&startTime> endTime){
              	this.$message({
                      message: '开始时间不能大于结束时间',
                      type: 'warning'
                    });
                  return;
              }
              param.startTime = startTime;
              param.endTime = endTime;
              param.cusName = this.dialogFormChoose.cusName;
              param.signProvince = this.dialogFormChoose.signProvince;
              param.signProject = this.dialogFormChoose.signProject;
              param.signNo = this.dialogFormChoose.signNo;
              
              console.info(param);
              axios.post('/financing/refundRebate/rebatesignList', param)
              .then(function (response) {
                    var result =  response.data;
                    clueVM.dataTableChoose= result.data;
              })
              .catch(function (error) {
                   console.log(error);
              });
            this.dialogFormChooseVisible=true;
          },
        	searchTable() {
                var param ={};
                var startTime = this.searchForm.startTime;
                var endTime = this.searchForm.endTime;
            	var vilad=false;
                if(startTime&&endTime&&startTime> endTime){
                	vilad=true;
                }
                if(vilad){
                	this.$message({
                        message: '开始时间不能大于结束时间',
                        type: 'warning'
                      });
                    return;
                }
                param.startTime = startTime;
                param.endTime = endTime;
                param.pageSize = this.pager.pageSize;
                param.pageNum = this.pager.currentPage;
                param.busAreaId = this.searchForm.busAreaId;
                param.busGroupId = this.searchForm.busGroupId;
                param.busSaleId = this.searchForm.busSaleId;
                param.signType = this.searchForm.signType;
                param.signShopType = this.searchForm.signShopType;
                param.cusName = this.searchForm.cusName;
                param.teleDeptId = this.searchForm.teleDeptId;
                param.teleGorupId = this.searchForm.teleGorupId;
                param.teleSaleId = this.searchForm.teleSaleId;
                param.signProvince = this.searchForm.signProvince;
                param.signStatus = this.searchForm.signStatus;
                param.phone = this.searchForm.phone;
                param.signNo = this.searchForm.signNo;
                
                //列表只查询正常数据，取消删除数据不查询
                //param.delFalg = this.searchForm.delFalg;
                console.info(param);
                axios.post('/financing/refundRebate/list', param)
                .then(function (response) {
                      var result =  response.data;
                      console.info(result);
                      var table=result.data;
                      clueVM.dataTable= table.data;
                      clueVM.pager.total =  table.total;
                      clueVM.pager.currentPage = table.currentPage;
                })
                .catch(function (error) {
                     console.log(error);
                });
                
              },
              //选择行
              handleSelectionChange(val) {
                  this.multipleSelection = val;
              },
              signSelectionChange(val) {
                  this.signSelection = val;
              },
              handleSizeChange(val) {
                  //下拉框  每页 10,20条切换 调用
                     console.log(`每页 ${val} 条`);
                  this.pageSize = val;
                  this.initTableData(1);
               },
               handleCurrentChange(val) {
                   //点击 页码
                 console.log(`当前页: ${val}`);
                 this.initTableData(val);
               },
               //是否转换方法
               transformSex(row, column, cellValue, index) {
                 var text="";
                 if(cellValue=="1"){
                   text="是"
                 }else if(cellValue=="0"){
                   text="否"
                 }
                 return text;
               },
               //签约类型转换方法
               transformSignType(row, column, cellValue, index) {
                 var text="";
                 if(cellValue=="1"){
                   text="一次性全款"
                 }else if(cellValue=="2"){
                   text="先交订金"
                 }
                 return text;
               },
               //邀约状态转换方法
               transformSignStatus(row, column, cellValue, index) {
                 var text="";
                 if(cellValue=="2"){
                   text="退款确认中";
                 }else if(cellValue=="3"){
                   text="返款确认中";
                 }else if(cellValue=="4"){
                   text="退款成功";
                 }else if(cellValue=="5"){
                   text="返款成功";
                 }else{
                   text="正常";
                 }
                 return text;
               },
               //合伙人转换方法
               transformSignShopType(row, column, cellValue, index) {
             	  var text="";
             	  if(vistitStoreTypeList){
 	                  for(var i=0;i<vistitStoreTypeList.length;i++){
 	                		if(cellValue==vistitStoreTypeList[i].value){
 	                			text=vistitStoreTypeList[i].name;
 	                		}
 	                	}
             	  }
                   return text;
               },
              
               //关联签约单确定
               submitSign() {
           	       var rows = this.signSelection;
            	   if(rows.length==0){
                       this.$message({
                          message: '请至少选择一条数据进行关联',
                          type: 'warning'
                        });
                       return;
                   }
            	   var signList=[];
            	   for(var i=0;i<rows.length;i++){
               			signList.push(rows[i].signNo);
                   }
            	   this.dynamicTags =signList;
            	   this.dialogFormChooseVisible=false;
               },
               //打开申请退款
               toAllocationClue(formName) {
            	   if(this.$refs[formName]){
	            	   this.$refs[formName].resetFields();
            	   }
           	       var rows = this.multipleSelection;
            	   if(rows.length!=1){
                       this.$message({
                          message: '请选择一条数据进行退款申请',
                          type: 'warning'
                        });
                       return;
                   }
            	   if(rows[0].signStatus!=1){
            		   this.$message({
                           message: '只允许操作签约状态为正常的数据',
                           type: 'warning'
                         });
                        return;
            	   }
            	   this.allocationForm.signId=rows[0].signId;
            	   this.isSettle=rows[0].isSettle;
            	   this.refundTitle="（"+rows[0].signId+"）签约单申请退款";
                   this.allocationVisible = true;
               },
               allocationClueCancel(formName){//申请退款取消
            	   this.$refs[formName].resetFields();
            	   this.allocationVisible = false;
               },
               allocationClue(formName){//申请退款
            	   
            	   this.$refs[formName].validate((valid) => {
            	          if (valid) {
           	            	  var param  = {};
           	            	  param.signId=this.allocationForm.signId;
           	            	  param.reason=this.allocationForm.reason;
           	            	  param.refundTime=this.allocationForm.refundTime;
           	            	  param.cusAmount=this.allocationForm.cusAmount;
           	            	  param.imgUrlList=[];
	                          axios.post('/financing/refundRebate/applyRefund',param)
	                              .then(function (response) {
	                                  var data =  response.data;
	                                  if(data.code=='0'){
	                                  	clueVM.$message({message:'申请成功',type:'success',duration:1000,onClose:function(){
	                                  		clueVM.allocationVisible = false;
	                                  		clueVM.searchTable();
	                              	    }});
	                                  }else{
	                                  	clueVM.$message({
	                                          message: "接口调用失败",
	                                          type: 'error'
	                                        }); 
	                                  }
	                              })
	                              .catch(function (error) {
	                                console.log(error);
	                              })
	                              .then(function () {
	                              	
	                              });
            	            //end
            	          } else {
            	            console.log('error submit!!');
            	            return false;
            	          }
            	    });
                 },// method end
               //打开返款申请
               toTransferClue(formName) {
                   if(this.$refs[formName]){
  	            	   this.$refs[formName].resetFields();
              	   }
                   this.dynamicTags =[];
           	       var rows = this.multipleSelection;
            	   if(rows.length!=1){
                       this.$message({
                          message: '请选择一条数据进行返款申请',
                          type: 'warning'
                        });
                       return;
                   }
            	   if(rows[0].signStatus!=1){
            		   this.$message({
                           message: '只允许操作签约状态为正常的数据',
                           type: 'warning'
                         });
                        return;
            	   }
                   this.transferForm.signId = rows[0].signId;
                   this.dialogFormChoose.signProjectId = rows[0].signProject;
                   this.dialogFormChoose.signProvince = rows[0].signProvince;
                   this.isSettle=rows[0].isSettle;
                   this.rebateTitle="（"+rows[0].signId+"）签约单申请返款";
                   this.transferVisible = true;
               },
               transferClueCancel(formName){//外调经理取消
            	   this.$refs[formName].resetFields();
            	   this.transferVisible = false;
               },
               transferClue(formName){//外调经理
            	   this.$refs[formName].validate((valid) => {
            	          if (valid) {
                           	  //外调
                           	  var param  = {};
                           	  param.signId=this.transferForm.signId;
         	            	  param.reason=this.transferForm.reason;
         	            	  param.refundTime=this.transferForm.refundTime;
         	            	  param.cusAmount=this.transferForm.cusAmount;
         	            	  param.signNoList=this.dynamicTags;
         	            	  param.imgUrlList=[];
	                          axios.post('/financing/refundRebate/applyRebate',param)
                               .then(function (response) {
                                   var data =  response.data;
                                   if(data.code=='0'){
                                   	clueVM.$message({message:'申请成功',type:'success',duration:1000,onClose:function(){
                                   		clueVM.transferVisible = false;
                                   		clueVM.searchTable();
                               	    }});
                                   }else{
                                   	clueVM.$message({
                                           message: "接口调用失败",
                                           type: 'error'
                                         }); 
                                   }
                               })
                               .catch(function (error) {
                                 console.log(error);
                               })
                               .then(function () {
                               	
                               });
            	            //end
            	          } else {
            	            console.log('error submit!!');
            	            return false;
            	          }
            	  });
            	   
                 },// method end
                 recordClick(row) {//查看明细
                     // row.signNo;
                     var param = {};
                     param.idList = [row.signId];
                     axios.post('/sign/signRecord/listPayDetail', param)
                     .then(function (response) {
                         var resData = response.data;
                         console.log(resData.data)
                         if(resData.code=='0'){
                         	clueVM.recordTable= resData.data;
                         }else{
                             clueVM.$message({message:resData.msg,type:'error'});
                             console.error(resData);
                         }
                         clueVM.recordDialog=true;
                     })
                     .catch(function (error) {
                          console.log(error);
                     }).then(function(){
                     });
                    
                 },
                 getTimeText(row, column, value, index){
                     var valText="";
                     if(value){
                         valText =  moment(value).format("YYYY-MM-DD HH:mm:ss");
                     }
                     return valText;
                 },
                 getSignShopTypeText(row, column, value, index){
                 	var valText="";
                     if(value==1){
                         valText="创业店";
                     }else if(value==2){
                         valText="标准店";
                     }else if(value==3){
                         valText="白金店";
                     }else if(value==4){
                         valText="旗舰店";
                     }else if(value==5){
                         valText="区域代理";
                     }
                     return valText;
                 },
                 getPayModeText(row, column, value, index){
                 	var valText="";
                     if(value==1){
                         valText="现金";
                     }else if(value==2){
                         valText="POS";
                     }else if(value==3){
                         valText="转账";
                     }
                     return valText;
                 },
                 getStatusText(row, column, value, index){
                 	   var valText="";
                 	   if(value==0){
                 		   valText="驳回";
                 	   }
                 	   else if(value==1){
                            valText="审核中";
                        }else if(value==2){
                            valText="有效";
                        }
                        return valText;
                 },
               //付款类型转换方法
                 transformPayType(row, column, cellValue, index) {
                   var text="";
                   if(cellValue=="1"){
                     text="全款"
                   }else if(cellValue=="2"){
                     text="订金"
                   }else if(cellValue=="2"){
                     text="追加定金"
                   }else if(cellValue=="2"){
                     text="尾款"
                   }
                   return text;
                 },
               //处理状态转换方法
                 transformStatus(row, column, cellValue, index) {
                   var text="";
                   if(cellValue=="0"){
                     text="待处理";
                   }else if(cellValue=="1"){
                     text="驳回";
                   }else if(cellValue=="2"){
                     text="提交对账";
                   }else if(cellValue=="3"){
                     text="已对账";
                   }else if(cellValue=="4"){
                     text="已结算";
                   }
                   return text;
                 },
                 getRowKey(row) {
                   return row.signNo;
                 },
                toogleClick(){
                    if(this.isShow){
                        this.isShow=false
                    }else{
                        this.isShow=true
                    }          
                },
        },
        created(){
            console.info("create method");
            this.searchTable();
           
        },
        mounted(){
           console.info("mounted method");
           document.getElementById('clueManage').style.display = 'block';
        }
    })
    
</script>
</html>