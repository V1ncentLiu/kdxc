<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head th:replace="_header_include::frag(~{::title},~{::style},~{})">
  <title>后台管理系统</title>
  <style>
    .tableBox a {
      color: #5c6be8
    }

    .apply-box {
      overflow: hidden;
      zoom: 1;
    }

    .apply-box .apply-text {
      font-size: 12px;
      color: #606266;
      text-align: center;
      padding: 30px 0;
    }

    .statusNo {
      color: #fd5621;
    }

    .status-no {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
    }

    .status-no span {
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <div id="clueManage" class="clueManage mainPadding" style="display: none;">
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
      <el-breadcrumb-item>Home</el-breadcrumb-item>
      <el-breadcrumb-item>财务管理</el-breadcrumb-item>
      <el-breadcrumb-item>超成本确认</el-breadcrumb-item>
    </el-breadcrumb>

    <el-row class="marginB20 ">
      <shiro:hasPermission name="financing:overCostConfirm:confirm">
        <el-button type="warning" @click="settlementConfirmButton"> 超成本确认</el-button>
      </shiro:hasPermission>
      <shiro:hasPermission name="financing:overCostConfirm:reject">
        <el-button type="danger" @click="rejectback">驳回申请</el-button>
      </shiro:hasPermission>
      <!-- <shiro:hasPermission name="financing:balanceaccountManager:settlementConfirm">
        <el-button type="warning" @click="settlementConfirmButton"> 超成本确认</el-button>
      </shiro:hasPermission>
      <shiro:hasPermission name="financing:balanceaccountManager:rejectApply">
        <el-button type="danger" @click="rejectback">驳回申请</el-button>
      </shiro:hasPermission> -->

    </el-row>
    <div class="mainSearchBg">
      <div class="mainSearchFormBox">
        <el-form :inline="true" :model="searchForm" class="demo-form-inline mainSearchForm" ref="searchForm">
          <el-form-item label="客户姓名:" prop="cusName">
            <el-input v-model="searchForm.cusName" placeholder="客户姓名"></el-input>
          </el-form-item>
          <el-form-item label="签约公司:" prop="companyId">
            <el-select v-model="searchForm.companyId" clearable filterable placeholder="签单餐饮公司"
              @clear="clearBusGroupList">
              <el-option v-for="item in companyArr" :key="item.id" :label="item.companyName" :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="签约省份:" prop="signProvince">
            <el-select v-model="searchForm.signProvince" clearable filterable placeholder="签约省份">
              <el-option v-for="item in provinceOptions" :key="item.name" :label="item.name" :value="item.name">
              </el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="付款时间：">
            <el-date-picker v-model="searchForm.payStartTime"  format="yyyy-MM-dd "
              type="date" placeholder="选择日期">
            </el-date-picker>
          </el-form-item>
          <el-form-item label="—" class="widthauto">
            <el-date-picker v-model="searchForm.payEndTime"  format="yyyy-MM-dd"
              type="date" placeholder="选择日期">
            </el-date-picker>
          </el-form-item>

          <el-row v-show="isShow">
            <el-form-item label="商务经理:" prop="busSaleId">
              <el-select v-model="searchForm.busSaleId" clearable filterable placeholder="商务经理">
                <el-option v-for="item in busSaleOptions" :key="item.id" :label="item.name" :value="item.id">
                </el-option>
              </el-select>
            </el-form-item>
            <el-form-item label="电销顾问:" prop="teleSaleId">
              <el-select v-model="searchForm.teleSaleId" clearable filterable placeholder="电销顾问">
                <el-option v-for="item in teleSaleOptions" :key="item.id" :label="item.name" :value="item.id">
                </el-option>
              </el-select>
            </el-form-item>
            <el-form-item label="签约店型:" prop="signShopType">
              <el-select v-model="searchForm.signShopType" clearable filterable placeholder="签约店型"
                @clear="clearBusAreaList">
                <el-option v-for="item in signShopType" :key="item.id" :label="item.name" :value="item.value">
                </el-option>
              </el-select>
            </el-form-item>
            <el-form-item label="签约项目:" prop="signProjectId">
              <el-select v-model="searchForm.signProjectId" clearable filterable placeholder="签约项目">
                <el-option v-for="item in projectOptions" :key="item.id" :label="item.projectName" :value="item.id">
                </el-option>
              </el-select>
            </el-form-item>
            <el-form-item label="处理状态:" prop="status">
              <el-select v-model="searchForm.status" clearable placeholder="处理状态">
                <el-option v-for="item in statusOptions" :key="item.id" :label="item.name" :value="item.value">
                </el-option>
              </el-select>
            </el-form-item>
          </el-row>

          <div class="mainSearchBtnBox">
            <el-button icon="el-icon-search" type="primary" @click="searchTable()" class="searchBtn">搜索</el-button>
            <span style="color: #5c6be8;cursor: pointer;margin:0 10px;" @click="toogleClick"><span
                v-if="isShow">收起</span><span v-else>展开更多</span><i
                :class="{'greycolor paddingL6 el-icon-arrow-up':isShow,'greycolor paddingL6 el-icon-arrow-down':!isShow}"></i></span>
          </div>
        </el-form>
      </div>
      <!-- 表格 -->
      <el-row>
        <el-table ref="tableData" tooltip-effect="dark" border :data="dataTable"
          @selection-change="handleSelectionChange">
          <el-table-column align="center" type="selection"></el-table-column>
          <el-table-column align="center" type="index" label="序号" width="55"></el-table-column>
          <el-table-column align="center" prop="statementNo" label="结算单编号">
          </el-table-column>
          <el-table-column align="center" prop="payTime" label="付款时间"></el-table-column>
          <el-table-column align="center" prop="customerName" label="客户姓名"></el-table-column>
          <el-table-column align="center" prop="visitCity" label="到访城市">
          </el-table-column>
          <el-table-column align="center" prop="signCompanyName" label="签约公司"></el-table-column>
          <el-table-column align="center" prop="teleSaleName" label="电销顾问"></el-table-column>
          <el-table-column align="center" prop="busSaleName" label="商务经理"></el-table-column>
          <el-table-column align="center" prop="signProvince" label="签约省份"></el-table-column>
          <el-table-column align="center" prop="signProjectName" label="签约项目"></el-table-column>
          <el-table-column align="center" prop="signShopType" label="签约店型"></el-table-column>
          <el-table-column align="center" prop="amountReceivable" label="合同金额"></el-table-column>
          <el-table-column align="center" prop="amountReceived" label="实收金额"></el-table-column>
          <el-table-column align="center" prop="amountEquipment" label="设备成本"></el-table-column>
          <el-table-column align="center" prop="giveAmount" label="活动赠送成本"></el-table-column>
          <el-table-column align="center" prop="totalCost" label="成本总计"></el-table-column>
          <el-table-column align="center" prop="costRatio" label="成本占比">
            <template slot-scope="scope">
              <div>{{scope.row.costRatio}}</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="overCost" label="超成本红线">
            <template slot-scope="scope">
              <div>{{scope.row.overCost}}%</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="teleSaleRatio" label="电销业绩比例">
            <template slot-scope="scope">
              <div>{{scope.row.teleSaleRatio}}%</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="busSaleRatio" label="商务业绩比例">
            <template slot-scope="scope">
              <div>{{scope.row.busSaleRatio}}%</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="deTeleSale" label="应扣电销业绩"></el-table-column>
          <el-table-column align="center" prop="deBusSale" label="应扣商务业绩"></el-table-column>
          <el-table-column align="center" prop="overCostRatio" label="超成本比例">
            <template slot-scope="scope">
              <div>{{scope.row.overCostRatio}}%</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="commissionRatio" label="佣金比例">
            <template slot-scope="scope">
              <div>{{scope.row.commissionRatio}}%</div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="commission" label="应退佣金"></el-table-column>
          <el-table-column align="center" prop="picUrls" label="申请附件">
            <template slot-scope="scope">
              <div v-if="scope.row.picUrls">
                <el-button @click="openPicUrlDialog(scope.row.picUrls)" type="text" size="small"> 查看附件 </el-button>
              </div>
            </template>
          </el-table-column>
          <el-table-column align="center" prop="status" label="处理状态">
            <template slot-scope="scope">
              <div v-if="scope.row.status==='已驳回'" class="status-no">
                <span class="statusNo">已驳回</span>
                <el-button @click="openRejectReasonDialog(scope.row)" type="text" size="small">驳回原因</el-button>
              </div>
              <div v-else>
                <span>{{scope.row.status}}</span>
              </div>
            </template>
          </el-table-column>
        </el-table>
        <table-pagination :pager="pager" @change="searchTable"></table-pagination>
      </el-row>

    </div>
    <!--驳回-->
    <el-dialog title="提示" :visible.sync="rejectVisible" width="540px" @close="closeRejectDialog" v-dialog-drag>
      <template>
        <el-form :model="rejectform" ref="rejectform" :rules="notVisitFlagRules">
          <el-form-item label="确定要将此 ">
            <!--<el-button type="text" disabled style="color: #1e2746; width:100px; word-wrap:break-word; word-break:normal;">{{notVisitFlag.str}}</el-button>-->
            <span style=" display: block; color: #1e2746; ">{{backQuery}}</span>
          </el-form-item>
          <el-form-item label="驳回原因:" label-width="70px" prop="remark">
            <el-input type="textarea" v-model="rejectform.remark" maxlength="500" :rows="3" placeholder="请输入内容(限制500字)">
            </el-input>
          </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer" style="text-align:center;">
          <el-button type="primary" :disabled="btnDisabled" @click="reconciliationConfirm('rejectform')">确定</el-button>
          <el-button @click="cancelReconciliationFrom('rejectform')">取消</el-button>
        </div>
      </template>
    </el-dialog>

    <!--驳回原因-->
    <el-dialog :title="rejectCustomerName" :visible.sync="rejectReasonVisible" width="540px"
      @close="closeRejectReasonDialog" v-dialog-drag>
      <template>
        <el-form>
          <el-form-item label="驳回人员:">
            <span style=" display: block; color: #1e2746; ">{{rejectReasonObj.rejectUserName}}</span>
          </el-form-item>
          <el-form-item label="驳回时间:">
            <span style=" display: block; color: #1e2746; ">{{rejectReasonObj.rejectTime}}</span>
          </el-form-item>
          <el-form-item label="驳回原因:">
            <span class="statusNo">{{rejectReasonObj.rejectReason}}</span>
            </el-input>
          </el-form-item>
        </el-form>
      </template>
    </el-dialog>
    <!-- 下载图片 dialog 开始 -->
    <el-dialog title="下载附件" :visible.sync="picUrlsVisible" width="440px" @close="closePicUrlsDialog" v-dialog-drag>
      <template>
        <div class="picUrlsBox">
          <div v-for="(item,index) in imgList" style="margin-bottom:8px">
            <a :href="'/financing/refund/downloadOssImg?url='+item.url" :download="item.name"
              style="color:blue; text-decoration:underline">{{item.name}}</a>
          </div>
        </div>
      </template>
    </el-dialog>



    <!-- dialog -->
    <el-dialog title="确认通过" :visible.sync="submitApplyVisible" width="440px" @close="closeSubmitApplyDialog"
      v-dialog-drag>
      <template>
        <div class="apply-box">
          <div class="apply-text">确认通过此超成本申请?</div>
        </div>
        <div slot="footer" style="text-align: center" class="dialog-footer">
          <el-button type="primary" :disabled="btnDisabled" @click="settlementConfirm">提交</el-button>
          <el-button @click="cancelSubmitApplyFrom">取消</el-button>
        </div>
      </template>
    </el-dialog>
  </div>
  <!-- import common js-->
  <div th:include="_footer_include :: #jsLib"></div>
  <script th:src="@{/js/custom/callrecord/download.js?v=1.0.0}"></script>
</body>
<script th:inline="javascript">
  var busAreaList = [[${ busAreaList }]];//商务大区
  var busGroupList = [[${ busGroupList }]];//商务组
  var teleDeptList = [[${ teleDeptList }]];//电销事业部
  var teleGroupList = [[${ teleGroupList }]];//电销组
  var teleSaleList = [[${ teleSaleList }]];//电销顾问
  var provinceList = [[${ provinceList }]];//省份
  var projectList = [[${ projectList }]];//项目
  var fieldList = [[${ fieldList }]];//自定义字段
  var userFieldList = [[${ userFieldList }]];//用户自定义字段
  var vistitStoreTypeList = [[${ vistitStoreTypeList }]];//签约店型
  var payModeItem = [[${ payModeItem }]];
  var giveTypeList = [[${ giveTypeList }]];
  var businessLine = [[${ businessLine }]];
  var clueVM = new Vue({
    el: '#clueManage',
    data: {
      isShow: false,
      lowestCommissionShow: false,
      btnDisabled: false,
      picUrlsVisible: false,
      signShopType: vistitStoreTypeList,
      companyArr: [],
      imgList: [],
      rejectCustomerName: '',
      rejectReasonObj: {},
      idList: [],
      searchForm: {
        cusName: '',
        busGroupId: '',
        signProvince: '',
        payStartTime: '',
        payEndTime: '',
        busSaleId: '',
        teleSaleId: '',
        signShopType: '',
        signProjectId: '',
        status: 2,
      },
      businessLine: businessLine,
      confirmCommission: "",
      doubtRemarkShow: false,
      backVisable: false,
      submitApplyVisible: false,
      rejectReasonVisible: false,
      ratio: "",
      viewDoubtForm: {
        doubtRemark: ''
      },
      rejectform: {
        remark: ""
      },
      backQuery: "",
      rejectVisible: false,
      count: 0,
      dxBusinessList: [],
      dataTable: [],
      allTableColums: [],
      tableColums: [],
      dialogFormVisible: false,
      apply: {
        money: "",
        isDoubt: "0",
        doubtRemark: ""
      },
      form: {
        type: [],
      },
      busAreaOptions: busAreaList,
      busGroupOptions: busGroupList,
      busSaleOptions: [],
      teleGorupOptions: teleGroupList,
      teleSaleOptions: teleSaleList,
      provinceOptions: provinceList,
      projectOptions: [],
      statusOptions: [{
        id: 0,
        value: 2,
        name: "待处理"
      }, {
        id: 1,
        value: 3,
        name: "已确认"
      }, {
        id: 2,
        value: 4,
        name: "已驳回"
      }, {
        id: 3,
        value: 5,
        name: "已结算"
      }],
      payTypeOptions: [{
        value: 1,
        name: "全款"
      }, {
        value: 2,
        name: "定金"
      }, {
        value: 3,
        name: "追加定金"
      }, {
        value: 4,
        name: "尾款"
      }],
      pager: {
        total: 0,
        currentPage: 1,
        pageSize: 20,
      },
      allocationFormRules: {
        saleId: [
          { required: true, message: '请选择商务经理', trigger: 'change' }
        ]
      },
      transferFormRules: {
        saleId: [
          { required: true, message: '请选择商务经理', trigger: 'change' }
        ]
      },
      notVisitFlagRules: {
        remark: [
          { required: true, min: 1, max: 500, message: '请输入驳回原因', trigger: 'blur' }
        ],
      },
      allpyrules: {
        money: [
          {
            validator: function (rule, value, callback) {
              if (value == 0 || value == "0") {
                callback();
              } else {
                var reg = /^[1-9]\d*$/;
                if (value == null || value == "null" || value == "") {
                  callback(new Error("请输入结算金额"));
                  clueVM.apply.money = null;

                } else if (value != null && value != "null" && value != "" && !reg.test(value)) {
                  callback(new Error("请输入正整数"));
                  clueVM.apply.money = null;
                } else {
                  callback();
                }

              }

            }, required: true, trigger: 'change'
          }
        ],
        isDoubt: [
          { required: true, message: '请选择是否有疑意', trigger: 'change' }
        ],
        doubtRemark: [
          {
            validator: function (rule, value, callback) {
              if (clueVM.apply.isDoubt == 0) {
                callback();
              } else {
                var reg = /^[1-9]\d*$/;
                if (value == null || value == "null" || value == "") {
                  callback(new Error("请输入疑意内容"));
                  clueVM.apply.doubtRemark = null;

                } else {
                  callback();
                }
              }

            }, required: true, trigger: 'change'
          }
        ]
      },
      multipleSelection: [],
      viewDoubtVisable: false,
      formLabelWidth: '150px',
      formLabelWidth1: '130px',
      storeForm: {
        busAreaId: '',
        busGroupId: '',
        busSaleId: '',
        status: '',
        signProjectId: '',
        cusName: '',
        teleDeptId: '',
        teleGorupId: '',
        teleSaleId: '',
        signProvince: '',
        payType: '',
        phone: '',
        startTime: '',
        endTime: '',
        payStartTime: '',
        payEndTime: '',
        statementNo: '',
        signNo: ''
      },
      storeId: '',
      scrollTop: 0,
    },
    methods: {
      isdoubtbutton() {
        if (clueVM.apply.isDoubt == 1) {
          this.doubtRemarkShow = true;
        } else {
          this.doubtRemarkShow = false;
        }

      },
      //签约项目
      projectChangeSelect() {
        var param = {};
        param.isNotSign = 0;
        axios.post('/aggregation/projectManager/listNoPage', param).then(function (response) {
          clueVM.projectOptions = response.data.data;
        });
      },
      searchTable() {
        var param = {};
        param = Object.assign({}, this.searchForm);
        var payStartTime = this.searchForm.payStartTime;
         //var payEndTime = this.searchForm.payEndTime ;
         if(this.searchForm.payEndTime){
          var payEndTime = new Date(this.searchForm.payEndTime);
          payEndTime = new Date(payEndTime.valueOf() + 24 * 60 * 60 * 1000)
          }
        var vilad = false;
        if (payStartTime && payEndTime && payStartTime > payEndTime) {
          vilad = true;
        }
        if (vilad) {
          this.$message({
            message: '开始时间不能大于结束时间',
            type: 'warning'
          });
          return;
        }
        param.payStartTime = payStartTime;
        param.payEndTime = payEndTime;
        param.pageSize = this.pager.pageSize;
        param.pageNum = this.pager.currentPage;
        //列表只查询正常数据，取消删除数据不查询
        //param.delFalg = this.searchForm.delFalg;
        console.info(param);
        axios.post('/financing/overCost/overCostConfirmList', param)
          .then(function (response) {
            var result = response.data;
            //             var result = {
            //     "code": "0",
            //     "data": {
            //         "data": [
            //         {
            // 			"id": "1245523071151194112",
            // 			"status": 4,
            // 			"commission": 400.00,
            // 			"picUrls": "[{\"id\":\"1245526290342428672\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/sXK5ENCH6s.jpg\",\"randomName\":\"aggregation/sXK5ENCH6s.jpg\",\"uid\":1585791583133,\"status\":\"success\"}]",
            // 			"rejectTime": "2020-04-02 10:37:21",
            // 			"rejectReason": "佣金不对",
            // 			"rejectUser": "1236134288441942016",
            // 			"statementNo": "25b95lqahv",
            // 			"customerName": "月利率",
            // 			"signCompanyId": "1212992527012294656",
            // 			"signCompanyName": "tz商家主账户2",
            // 			"teleSaleId": "1236133097821642752",
            // 			"teleSaleName": "广州汐电销顾问",
            // 			"busSaleId": "1236133883133763584",
            // 			"busSaleName": "广州汐商务经理",
            // 			"amountReceivable": 100000.00,
            // 			"signProvince": "广西",
            // 			"signProjectId": "1206476822620192768",
            // 			"signProjectName": "LX内部商家非优化项目",
            // 			"signShopType": "标准店",
            // 			"amountReceived": 60000.00,
            // 			"amountEquipment": 0.00,
            // 			"giveAmount": 0.00,
            // 			"totalCost": 0.00,
            // 			"costRatio": 0.00,
            // 			"overCost": 15,
            // 			"teleSaleRatio": 100,
            // 			"busSaleRatio": 100,
            // 			"overCostRatio": -15.00,
            // 			"commissionRatio": 60,
            // 			"payType": 4,
            // 			"rejectUserName": "广州汐渠道速建财务",
            // 			"payTime": "2020-04-02"
            // 		}, 
            //             {
            //                 "id": "1245182185930280960",
            //                 "status": 2,
            //                 "commission": 99.87,
            //                 "picUrls": "[{\"id\":\"1245228617316012032\",\"name\":\"重单列表.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/TCMFeiSGEt.jpg\",\"randomName\":\"aggregation/TCMFeiSGEt.jpg\",\"uid\":1585720612294,\"status\":\"success\"},{\"id\":\"1245228714384789504\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/PxAZwy7CbS.jpg\",\"randomName\":\"aggregation/PxAZwy7CbS.jpg\",\"uid\":1585720635439,\"status\":\"success\"},{\"id\":\"1245228754146791424\",\"name\":\"待跟进客户.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/BTBMJZ8Q6G.jpg\",\"randomName\":\"aggregation/BTBMJZ8Q6G.jpg\",\"uid\":1585720645005,\"status\":\"success\"},{\"id\":\"1245228771175665664\",\"name\":\"工作台电销顾问-无数据.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/44XDk5Wyz5.jpg\",\"randomName\":\"aggregation/44XDk5Wyz5.jpg\",\"uid\":1585720648987,\"status\":\"success\"},{\"id\":\"1245228812158210048\",\"name\":\"客户详情-01基本信息0603.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/BZMFbpkYBJ.jpg\",\"randomName\":\"aggregation/BZMFbpkYBJ.jpg\",\"uid\":1585720658770,\"status\":\"success\"}]",
            //                 "statementNo": "t319juwg0w",
            //                 "customerName": "小图尾款",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1214723081780936704",
            //                 "signCompanyName": "李婆婆羊蝎子2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 80000,
            //                 "signProvince": "广东",
            //                 "signProjectId": "1207195784500842496",
            //                 "signProjectName": "一点点36",
            //                 "signShopType": "市代理",
            //                 "amountReceived": 20000,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 10000,
            //                 "totalCost": 10000,
            //                 "costRatio": 50,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": 35,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1245182059891445760",
            //                 "payType": 2,
            //                 "payTime": "2020-04-01"
            //             },
            //             {
            //                 "id": "1245179875208515584",
            //                 "status": 2,
            //                 "commission": -6000,
            //                 "picUrls": "[{\"id\":\"1245233983592435712\",\"name\":\"重单列表.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/wWcsfWnWBE.jpg\",\"randomName\":\"aggregation/wWcsfWnWBE.jpg\",\"uid\":1585721891714,\"status\":\"success\"}]",
            //                 "statementNo": "amltrbnlyx",
            //                 "customerName": "小图全款",
            //                 "visitCity": "上海",
            //                 "signCompanyId": "1214723081780936704",
            //                 "signCompanyName": "李婆婆羊蝎子2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 90000,
            //                 "signProvince": "广东",
            //                 "signProjectId": "1207195784500842496",
            //                 "signProjectName": "一点点36",
            //                 "signShopType": "市代理",
            //                 "amountReceived": 80000,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 0,
            //                 "totalCost": 0,
            //                 "costRatio": 0,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -15,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1245179506013294592",
            //                 "payType": 1,
            //                 "payTime": "2020-04-01"
            //             },
            //             {
            //                 "id": "1244599696593596416",
            //                 "status": 2,
            //                 "commission": 2000,
            //                 "picUrls": "[{\"id\":\"1245230617252433920\",\"name\":\"客户详情-01基本信息0603.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/bBdbYW5aff.jpg\",\"randomName\":\"aggregation/bBdbYW5aff.jpg\",\"uid\":1585721089135,\"status\":\"success\"},{\"id\":\"1245230638484000768\",\"name\":\"01待分配.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/j6PNdQjmc6.jpg\",\"randomName\":\"aggregation/j6PNdQjmc6.jpg\",\"uid\":1585721094193,\"status\":\"success\"},{\"id\":\"1245230656968298496\",\"name\":\"客户详情-01基本信息0603.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/TQmwbKex6d.jpg\",\"randomName\":\"aggregation/TQmwbKex6d.jpg\",\"uid\":1585721098615,\"status\":\"success\"},{\"id\":\"1245230683002343424\",\"name\":\"通话记录.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/daZEFQcK4Q.jpg\",\"randomName\":\"aggregation/daZEFQcK4Q.jpg\",\"uid\":1585721104801,\"status\":\"success\"},{\"id\":\"1245230707052482560\",\"name\":\"测试图片 (1).jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/Cf5HjWhDTx.jpg\",\"randomName\":\"aggregation/Cf5HjWhDTx.jpg\",\"uid\":1585721110545,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-30 21:21:55",
            //                 "rejectReason": "测试驳回1",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "5yabwwecya",
            //                 "customerName": "电销的数据",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1214723081780936704",
            //                 "signCompanyName": "李婆婆羊蝎子2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 50000,
            //                 "signProvince": "贵州",
            //                 "signProjectId": "1207195898380390400",
            //                 "signProjectName": "半夜虾叫34",
            //                 "signShopType": "市代理",
            //                 "amountReceived": 40000,
            //                 "amountEquipment": 5000,
            //                 "giveAmount": 5000,
            //                 "totalCost": 10000,
            //                 "costRatio": 25,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": 10,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244599611730243584",
            //                 "payType": 1,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244599135982923776",
            //                 "status": 2,
            //                 "commission": 66,
            //                 "picUrls": "[{\"id\":\"1245268088073871360\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/PRYwexfZZE.jpg\",\"randomName\":\"aggregation/PRYwexfZZE.jpg\",\"uid\":1585730022891,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-14 12:38:35",
            //                 "statementNo": "o94znda2wy",
            //                 "customerName": "红烧鸡块",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1214723081780936704",
            //                 "signCompanyName": "李婆婆羊蝎子2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 5555555,
            //                 "signProvince": "广西",
            //                 "signProjectId": "1207195784500842496",
            //                 "signProjectName": "一点点36",
            //                 "signShopType": "省代理",
            //                 "amountReceived": 444444,
            //                 "amountEquipment": 10000,
            //                 "giveAmount": 222,
            //                 "totalCost": 10222,
            //                 "costRatio": 2.3,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -12.7,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244598711901040640",
            //                 "payType": 1,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244588790925045760",
            //                 "status": 2,
            //                 "commission": 123.12,
            //                 "picUrls": "[{\"id\":\"1244879731493781504\",\"name\":\"重单列表.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/TxkJMnpFxe.jpg\",\"randomName\":\"aggregation/TxkJMnpFxe.jpg\",\"uid\":1585637430077,\"status\":\"success\"},{\"id\":\"1244879778331574272\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/aHX3rNhDbP.jpg\",\"randomName\":\"aggregation/aHX3rNhDbP.jpg\",\"uid\":1585637441237,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 14:51:17",
            //                 "rejectReason": "广大广东省个",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "qi1i3y780i",
            //                 "customerName": "昆德拉",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1214723209296166912",
            //                 "signCompanyName": "李婆婆羊蝎子3",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 40000,
            //                 "signProvince": "安徽",
            //                 "signProjectId": "1206391655377444864",
            //                 "signProjectName": "LX外部商家项目",
            //                 "signShopType": "省代理",
            //                 "amountReceived": 30000,
            //                 "amountEquipment": 10000,
            //                 "giveAmount": 4500,
            //                 "totalCost": 14500,
            //                 "costRatio": 48.33,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": 33.33,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244519633751724032",
            //                 "payType": 2,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244564702315704320",
            //                 "status": 2,
            //                 "commission": 10000000,
            //                 "picUrls": "[{\"id\":\"1244565659447500800\",\"name\":\"ssss.png\",\"url\":\"https://huiju-dev.oss-cn-beijing.aliyuncs.com/aggregation/Pa7MmXtd4h.png\",\"randomName\":\"aggregation/Pa7MmXtd4h.png\",\"uid\":1585562554340,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 12:38:02",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "rhnut1juep",
            //                 "customerName": "闹闹",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1212992527012294656",
            //                 "signCompanyName": "tz商家主账户2",
            //                 "teleSaleId": "1244559257861599232",
            //                 "teleSaleName": "汐广州电销顾问2",
            //                 "busSaleId": "1244558567823093760",
            //                 "busSaleName": "广州商务经理2",
            //                 "amountReceivable": 50000,
            //                 "signProvince": "广东",
            //                 "signProjectId": "1207195784500842496",
            //                 "signProjectName": "一点点36",
            //                 "signShopType": "省代理",
            //                 "amountReceived": 40000,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 0,
            //                 "totalCost": 0,
            //                 "costRatio": 0,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -15,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244560427598508032",
            //                 "payType": 1,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244556064243085312",
            //                 "status": 2,
            //                 "commission": 30,
            //                 "picUrls": "[{\"id\":\"1244561409589944320\",\"name\":\"ssss.png\",\"url\":\"https://huiju-dev.oss-cn-beijing.aliyuncs.com/aggregation/68fXrhREpG.png\",\"randomName\":\"aggregation/68fXrhREpG.png\",\"uid\":1585561541092,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 12:37:57",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "6ydh269roi",
            //                 "customerName": "刘小花",
            //                 "visitCity": "福州",
            //                 "signCompanyId": "1211944342105882624",
            //                 "signCompanyName": "测试2",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 60000,
            //                 "signProvince": "北京",
            //                 "signProjectId": "1189832679273910272",
            //                 "signProjectName": "肉夹馍",
            //                 "signShopType": "市代理",
            //                 "amountReceived": 40000,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 200,
            //                 "totalCost": 200,
            //                 "costRatio": 0.5,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -14.5,
            //                 "commissionRatio": 70,
            //                 "visitRecordId": "1244555851063390208",
            //                 "payType": 2,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244520228789243904",
            //                 "status": 2,
            //                 "commission": 4324.33,
            //                 "picUrls": "[{\"id\":\"1244542147529895936\",\"name\":\"工作台电销顾问-无数据.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/yaCABEb6KS.jpg\",\"randomName\":\"aggregation/yaCABEb6KS.jpg\",\"uid\":1585556944822,\"status\":\"success\"},{\"id\":\"1244596155476946944\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/3KaTm75fca.jpg\",\"randomName\":\"aggregation/3KaTm75fca.jpg\",\"uid\":1585569821055,\"status\":\"success\"},{\"id\":\"1244596213131849728\",\"name\":\"待跟进客户.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/6pGt8sPXs5.jpg\",\"randomName\":\"aggregation/6pGt8sPXs5.jpg\",\"uid\":1585569834933,\"status\":\"success\"},{\"id\":\"1244596253602689024\",\"name\":\"待跟进客户.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/ixc2THXX8R.jpg\",\"randomName\":\"aggregation/ixc2THXX8R.jpg\",\"uid\":1585569844449,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 17:58:46",
            //                 "rejectReason": "的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大尚给大哥的是的撒干撒广东省归属感砂锅但是噶是勾搭都是高大",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "gezspdb8ey",
            //                 "customerName": "昆德拉",
            //                 "visitCity": "南京",
            //                 "signCompanyId": "1214723209296166912",
            //                 "signCompanyName": "李婆婆羊蝎子3",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 5000,
            //                 "signProvince": "安徽",
            //                 "signProjectId": "1206391655377444864",
            //                 "signProjectName": "LX外部商家项目",
            //                 "signShopType": "省代理",
            //                 "amountReceived": 5000,
            //                 "amountEquipment": 2,
            //                 "giveAmount": 2,
            //                 "totalCost": 4,
            //                 "costRatio": 0.08,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -14.92,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244519633751724032",
            //                 "payType": 1,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244520181217447936",
            //                 "status": 2,
            //                 "picUrls": "[{\"id\":\"1244547267311202304\",\"name\":\"重单列表.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/FHr2JGfFhb.jpg\",\"randomName\":\"aggregation/FHr2JGfFhb.jpg\",\"uid\":1585558165469,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 12:39:52",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "306omwootb",
            //                 "customerName": "王老板",
            //                 "visitCity": "上海",
            //                 "signCompanyId": "1212992527012294656",
            //                 "signCompanyName": "tz商家主账户2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 7999,
            //                 "signProvince": "广西",
            //                 "signProjectId": "1207195495374884864",
            //                 "signProjectName": "都可41",
            //                 "signShopType": "市代理",
            //                 "amountReceived": 4000,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 0,
            //                 "totalCost": 0,
            //                 "costRatio": 0,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -15,
            //                 "commissionRatio": 50,
            //                 "visitRecordId": "1244520003785805824",
            //                 "payType": 2,
            //                 "payTime": "2020-03-30"
            //             },
            //             {
            //                 "id": "1244509559482241024",
            //                 "status": 2,
            //                 "commission": 55555555,
            //                 "picUrls": "[{\"id\":\"1244517400037380096\",\"name\":\"测试图片.jpg\",\"url\":\"https://huiju-test.oss-cn-beijing.aliyuncs.com/aggregation/624eXr4MYA.jpg\",\"randomName\":\"aggregation/624eXr4MYA.jpg\",\"uid\":1585551044574,\"status\":\"success\"}]",
            //                 "rejectTime": "2020-03-31 12:36:55",
            //                 "rejectReason": "范德萨",
            //                 "rejectUser": "1236134288441942016",
            //                 "statementNo": "g8ysnpa940",
            //                 "customerName": "花花01",
            //                 "signCompanyId": "1214723081780936704",
            //                 "signCompanyName": "李婆婆羊蝎子2",
            //                 "teleSaleId": "1236133097821642752",
            //                 "teleSaleName": "广州汐电销顾问",
            //                 "busSaleId": "1236133883133763584",
            //                 "busSaleName": "广州汐商务经理",
            //                 "amountReceivable": 11111,
            //                 "signProvince": "贵州",
            //                 "signProjectId": "1207195898380390400",
            //                 "signProjectName": "半夜虾叫34",
            //                 "signShopType": "区/县代理",
            //                 "amountReceived": 111111,
            //                 "amountEquipment": 0,
            //                 "giveAmount": 1,
            //                 "totalCost": 1,
            //                 "costRatio": 0,
            //                 "overCost": 15,
            //                 "teleSaleRatio": 100,
            //                 "busSaleRatio": 100,
            //                 "overCostRatio": -15,
            //                 "commissionRatio": 50,
            //                 "payType": 1,
            //                 "payTime": "2020-03-30"
            //             }
            //         ],
            //         "currentPage": 1,
            //         "total": 11,
            //         "pageSize": 20,
            //         "pageSizes": 1
            //     }
            // }
            console.info(result);
            var table = result.data;
            clueVM.pager.total = table.total;
            clueVM.pager.currentPage = table.currentPage;
            var data = table.data;
            if (data && data.length > 0) {
              for (var i = 0; i < data.length; i++) {
                data[i].status = clueVM.transformStatus(data[i].status);
                // data[i].signShopType = clueVM.transformSignShopType(vistitStoreTypeList, data[i].signShopType);
                data[i]['costRatio'] = clueVM.transformCostRatio(data[i].totalCost, data[i].amountReceived);
                data[i]['deTeleSale'] = clueVM.transformSale(data[i].amountReceived, data[i].teleSaleRatio, data[i].overCostRatio);
                data[i]['deBusSale'] = clueVM.transformSale(data[i].amountReceived, data[i].busSaleRatio, data[i].overCostRatio);

              }
              clueVM.dataTable = data;
            } else {
              clueVM.dataTable = [];
            }
          })

          .catch(function (error) {
            console.log(error);
          });

      },
      toggleSelection(rows) { // table select 默认选中fn
        if (rows) {
          rows.forEach(row => {
            this.$refs.multipleTable.toggleRowSelection(row, true);
          });
        } else {
          this.$refs.multipleTable.clearSelection();
        }
      },
      //选择行
      handleSelectionChange(val) {
        this.multipleSelection = val;
      },
      handleSizeChange(val) {
        //下拉框  每页 10,20条切换 调用
        this.pageSize = val;
        this.initTableData(1);
      },
      handleCurrentChange(val) {
        //点击 页码
        this.initTableData(val);
      },
      //处理状态转换方法
      transformStatus(cellValue) {
        var text = "";
        if (cellValue == "2") {
          text = "待处理";
        } else if (cellValue == "3") {
          text = "已确认";
        } else if (cellValue == "4") {
          text = "已驳回";
        } else if (cellValue == "5") {
          text = "已结算";
        }
        return text;
      },
      //店型转换方法
      transformSignShopType(arr, cellValue) {
        if (arr) {
          for (var i = 0; i < arr.length; i++) {
            var text = "";
            if (cellValue === arr[i].value) {
              text = arr[i].name;
            }
          }
        }
        return text;
      },
      //应扣商务/电销业绩
      transformSale(val1, val2, val3) {
        var val = val1 * val2 * 0.01 * val3 * 0.01;
        return val;
      },
      //成本占比计算
      transformCostRatio(val1, val2) {
        var val = val1 / val2;
        return this.transformFormat(val);
      },
      //四舍五入+%
      transformFormat(cellValue) {
        var text = cellValue * 100 + "";
        var floatText = "";
        if (text.indexOf(".") > -1) {
          floatText = text.substring(text.indexOf("."));
          if (floatText.length >= 2) {
            text = (text * 1).toFixed(2) + "%";
          } else {
            text = text + "%"
          }
        }
        return text;
      },



      //查看附件
      openPicUrlDialog(urls) {
        this.picUrlsVisible = true;
        this.imgList = JSON.parse(urls);
      },
      closePicUrlsDialog() {
        this.picUrlsVisible = false;
      },

      //查看驳回原因
      openRejectReasonDialog(row) {
        this.rejectReasonVisible = true;
        this.rejectCustomerName = `驳回（${row.customerName}）客户超成本申请信息`;
        this.rejectReasonObj = Object.assign({}, row);
      },
      closeRejectReasonDialog() {
        this.rejectReasonVisible = false;
      },

      //驳回
      rejectback() {
        var rows = this.multipleSelection;
        if (rows.length == 0) {
          this.$message({
            message: '请选择数据',
            type: 'warning'
          });
          return;
        } else if (rows.length != 1) {
          this.$message({
            message: '请选择一条数据进行驳回',
            type: 'warning'
          });
          return;
        }
        var status = rows[0].status;
        var customerName = rows[0].customerName;
        var msg = "只有待处理的申请允许驳回！";
        if (status != "待处理") {
          this.$message({
            message: msg,
            type: 'warning'
          });
          return;
        }
        this.rejectVisible = true;
        this.backQuery = "【" + customerName + "】超成本申请驳回吗?";
        // 存储选中信息--start
        // var clueId = rows[0].accountId;
        // setSessionStore("balanceAccountStoreForm", this.storeForm);
        // var otherVal = {
        //   "currentPage": this.pager.currentPage,
        //   "clueId": clueId,
        //   "scrollTop": this.$el.querySelector('.el-table__body-wrapper').scrollTop
        // }
        // setSessionStore("balanceAccountOtherVal", otherVal);
        // 存储选中信息--end
      },
      //驳回
      reconciliationConfirm(formName) {
        this.$refs[formName].validate((valid) => {
          if (valid) {
            var rows = this.multipleSelection;
            //对账确认
            var param = {};
            param.id = rows[0].id;
            param.rejectReason = this.rejectform.remark;
            this.btnDisabled = true;
            axios.post('/financing/overCost/reject', param)
              .then(function (response) {
                var data = response.data;
                if (response.status == 200) {
                  clueVM.$message({
                    message: '驳回成功', type: 'success', duration: 1000, onClose: function () {
                      clueVM.btnDisabled = false;
                      clueVM.rejectVisible = false;
                      clueVM.searchTable();
                      //		window.location.href="/financing/balanceaccount/balanceAccountPage";
                    }
                  });
                } else {
                  clueVM.$message({
                    message: "接口调用失败",
                    type: 'error'
                  });
                  clueVM.btnDisabled = false;
                }
              })
              .catch(function (error) {
                console.log(error);
                clueVM.$message({
                  message: "驳回失败",
                  type: 'error'
                });
                clueVM.btnDisabled = false;
              })
              .then(function () {

              });
          }
        })


      },
      settlementConfirmButton() {
        var rows = this.multipleSelection;
        if (rows.length == 0) {
          this.$message({
            message: '请选择数据',
            type: 'warning'
          });
          return;
        }
        var isPass = true;
        // var idList = new Array();
        this.idList = [];
        for (var i = 0; i < rows.length; i++) {
          var curRow = rows[i];
          if (curRow.status != "待处理") {
            this.$message({ message: '只允许选择待处理数据', type: 'warning' });
            isPass = false;
            break;
          }
          this.idList.push(curRow.id);
        }

        if (!isPass) {
          return;
        }


        clueVM.submitApplyVisible = true;

      },
      //结算确认
      settlementConfirm() {
        var rows = this.multipleSelection;
        var param = {};
        param.idList = this.idList;
        axios.post('/financing/overCost/confirm', param)
          .then(function (response) {
            var data = response.data;
            if (response.status == 200) {
              clueVM.$message({
                message: '提交成功', type: 'success', duration: 1000, onClose: function () {
                  clueVM.btnDisabled = false;
                  clueVM.submitApplyVisible = false;
                  clueVM.searchTable();
                  // window.location.href="/financing/balanceaccount/balanceAccountPage";
                }
              });
            } else {
              clueVM.$message({
                message: "接口调用失败",
                type: 'error'
              });
              clueVM.btnDisabled = false;
            }
          })
          .catch(function (error) {
            console.log(error);
            clueVM.btnDisabled = false;
          });
      },
      toogleClick() {
        if (this.isShow) {
          this.isShow = false
        } else {
          this.isShow = true
        }
      },
      closeSubmitApplyDialog() {//关闭提交对账确认
        clueVM.submitApplyVisible = false;
        // 点击关闭 数据重置
      },
      cancelSubmitApplyFrom() {//提交确认取消
        this.submitApplyVisible = false;
      },
      closeRejectDialog() {//关闭驳回
        // 点击关闭 数据重置
        this.$refs['rejectform'].resetFields();
      },
      cancelReconciliationFrom(formName) {//取消驳回
        this.rejectVisible = false;
        // 点击取消 数据重置
        this.$refs[formName].resetFields();
      },
      clearTeleCompanyList() {
        this.searchForm.teleDeptId = '';
        this.clearTeleDeptList();

      },
      clearTeleDeptList() {
        this.teleGorupOptions = [];
        this.searchForm.teleGorupId = '';
        this.clearTeleGroupList();

      },
      clearTeleGroupList() {
        this.teleSaleOptions = [];
        this.searchForm.teleSaleId = '';
      },
      clearBusAreaList() {
        this.searchForm.signShopType = '';
        this.clearBusGroupList();

      },
      clearBusGroupList() {
        this.searchForm.companyId = '';
      },
      getBusAndTel() {
        var param = {};
        axios.post('/financing/balanceaccount/getBusAndTel', param)
          .then(function (response) {
            var result = response.data;
            // //查询所有的商务经理
            clueVM.busSaleOptions = result.busSaleList;
            //查询所有商务组
            clueVM.busGroupOptions = result.busGroupList;
            // 查询所有电销顾问
            clueVM.teleSaleOptions = result.teleSaleList;
            // 查询所有电销组
            clueVM.teleGorupOptions = result.teleGroupList;
            // 查询所有电销公司
            clueVM.dxBusinessList = result.teleCompanyList;
          })
          .catch(function (error) {
            console.log(error);
          });

      },
      //签约公司
      getCompanyArr() {
        var param = {};
        axios.post('/aggregation/companyManager/listNoPage', param).then(function (response) {
          clueVM.companyArr = response.data.data;
        })
          .catch(function (error) {
            console.log(error);
          });
      }
    },
    created() {
      this.getBusAndTel();
      this.getCompanyArr();
      // 签约项目
      this.projectChangeSelect();
      // 进入页面判断有是否有存储值
      // 取页数存储
      var localVal = localStorage.getItem('allChangePageSize') ? parseInt(localStorage.getItem('allChangePageSize')) : '';
      if (localVal) { this.pager.pageSize = localVal; }
      this.searchTable();

      // this.getIntentionalCategory();
    },
    mounted() {
      console.info("mounted method");
      document.getElementById('clueManage').style.display = 'block';
    }
  })

</script>

</html>