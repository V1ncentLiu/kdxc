<!DOCTYPE html>
<html>
<head th:include="_header_include::frag(~{::title},~{},~{})" >
<title>我的客户</title>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="css/element-ui.css">
    <link rel="stylesheet" href="css/base.css">
    <style>
        button a{color:#fff!important;}
    </style>
</head>
<body>
<div id="myCustom" class="myCustom mainPadding" style="display: none;">  
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>电销中心</el-breadcrumb-item>
        <el-breadcrumb-item>我的客户</el-breadcrumb-item>
    </el-breadcrumb>
    <el-row class="marginB10">
         <shiro:hasPermission name="myCustomerInfo:apply">
          <el-button type="success" @click="openFormInfo">重单申请</el-button>
        </shiro:hasPermission>
        <shiro:hasPermission name="myCustomerInfo:releaseClue">
           <el-button type="danger" @click="openeleaseForm">释放资源</el-button>
         </shiro:hasPermission>
         <!--  <el-button type="warning">查询重复</el-button> --> 
        <shiro:hasPermission name="myCustomerInfo:add">
              <el-button type="primary" @click="createClueData" >新建客户资源</a></el-button>
         </shiro:hasPermission>
    </el-row>
    <el-row class="marginB10 greybg padding20" style="padding-bottom: 0">        
        <el-form :inline="true" :model="form" ref="form">
            <el-form-item label="">
                <el-select v-model="form.isTransfer" placeholder="全部资源" style="width: 100%;">
                    <el-option
                        v-for="item in isTransfer"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item> 
            <el-form-item label="">  
                <el-select v-model="form.cluesta" placeholder="资源有效性" style="width: 100%;">
                    <el-option
                        v-for="item in clueStatus"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="">
                <el-input v-model="form.customerPhone" placeholder="客户手机号"></el-input>
            </el-form-item>
            <el-form-item label="">
                <el-input v-model="form.customerName" placeholder="客户姓名"></el-input>
            </el-form-item>
            <el-form-item label="">
                <el-select v-model="form.cusStatus" placeholder="客户状态" style="width: 100%;">
                    <el-option
                        v-for="item in cusStatusArr"
                        :key="item.value"
                        :label="item.name"
                        :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="">
                <el-select v-model="form.cusLeve" placeholder="客户级别" style="width: 100%;">
                    <el-option
                        v-for="item in cusLevelArr"
                        :key="item.value"
                        :label="item.name"
                        :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="编辑时间:">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.updateTimeStart"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="——">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.updateTimeEnd"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="创建时间:">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.createTimeStart"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="——">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.createTimeEnd"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="分配时间:">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.assignTimeStart"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="——">
                <el-date-picker
                    style="width: 100%;"
                    v-model="form.assignTimeEnd"
                    type="datetime"
                    placeholder="选择日期时间">
                </el-date-picker>
            </el-form-item>
            <el-button type="primary" @click="initTableData">搜索</el-button>
            <span style="color: rgb(0, 114, 255);text-decoration: underline;cursor: pointer;" @click="toogleClick">更多搜索</span>
            <el-row v-show="isShow">
                <el-form-item label="">
                    <el-select v-model="form.dayTel" placeholder="今日是否拨打" style="width: 100%;">
                        <el-option
                            v-for="item in callTel"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item> 
                <el-form-item label="">  
                    <el-select v-model="form.hasInvite" placeholder="是否邀约" style="width: 100%;">
                        <el-option
                            v-for="item in hasInvite"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="">
                    <el-select v-model="form.repeatStatus" placeholder="是否重单" style="width: 100%;">
                        <el-option
                            v-for="item in clueRepeatStatus"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item> 
                <el-form-item label="">  
                    <el-select v-model="form.province" placeholder="预签约省份" style="width: 100%;">
                        <el-option
                            v-for="item in provinceArr"
                            :key="item.name"
                            :label="item.name"
                            :value="item.name">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="">  
                    <el-select v-model="form.category" placeholder="资源类别" style="width: 100%;">
                        <el-option
                            v-for="item in categoryArr"
                            :key="item.value"
                            :label="item.name"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="">
                    <el-input v-model="form.searchWord" placeholder="搜索词"></el-input>
                </el-form-item>
                <el-form-item label="">
                    <el-input v-model="form.address" placeholder="地址"></el-input>
                </el-form-item>
                <el-form-item label="">  
                    <el-select v-model="form.trackingDay" placeholder="当日是否跟访" style="width: 100%;">
                        <el-option
                            v-for="item in hastracking"
                            :key="item.value"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-row>                
        </el-form>       
    </el-row>
    <el-row>
        <el-table 
            ref="multipleTable"
            tooltip-effect="dark"
            style="width: 100%"
            border
            :data="dataTable" 
            @selection-change="handleSelectionChange"
            @row-dblclick="showClueDetailInfo"
            >
            <el-table-column align="center" type="selection"  prop="clueId"  @selection-change="handleSelectionChange" width="55"></el-table-column>
            <el-table-column align="center" prop="cusLevelName" label="客户级别"></el-table-column>
            <el-table-column align="center" prop="cusName" label="客户姓名"></el-table-column>
            <el-table-column align="center" prop="phone" label="手机号" width="250">
                <template slot-scope="scope">
                    {{scope.row.phone}}
                    <input type='hidden'>
                    
                    <i class="el-icon-phone-outline"  @click="customerEidt(scope.row.clueId)"  style="margin:0 10px;font-size: 16px;cursor: pointer;"></i>  
                  <!--<i class="el-icon-phone-outline"   onclick="callPhone(1,121221);"  style="margin:0 10px;font-size: 16px;cursor: pointer;"></i>    --> 
        
                    <el-tag v-if="scope.row.tag">{{scope.row.tag}}</el-tag>
                </template>
            </el-table-column>
                <el-table-column prop="" label="跟进记录"  align="center" show-overflow-tooltip>
                <template slot-scope="scope">
                    <el-button @click="openTrackingDialog(scope.row.clueId)" type="text" size="small">
                                                                    点击查看
                    </el-button>
                </template>
            </el-table-column>
            <el-table-column align="center" prop="customerStatusName" label="客户状态"></el-table-column>
            <el-table-column align="center" prop="telCount" label="拨打次数"></el-table-column>
            <el-table-column align="center" prop="assignTime" label="分配时间"></el-table-column>
            <el-table-column align="center" prop="updateTime" label="最后编辑时间"></el-table-column>
            <el-table-column align="center" prop="repeatPhones" label="重复手机号资源">
                <template slot-scope="scope">
                    <el-button @click="repeatPhonesClick(scope.row)" type="text" size="small"></el-button>
                </template>
            </el-table-column>
            <el-table-column align="center" prop="focusPoint" label="客户关注点"></el-table-column>
            <el-table-column align="center" prop="messagePoint" label="留言重点"></el-table-column>
            <el-table-column align="center" prop="messageTime" label="留言时间"></el-table-column>
            <el-table-column align="center" prop="createTime" label="创建日期（资源创建日期）"></el-table-column>
            <el-table-column align="center" prop="clueName" label="资源专员"></el-table-column>
            <el-table-column align="center" prop="searchWord" label="搜索词"></el-table-column>
            <el-table-column align="center" prop="categoryName" label="资源类别"></el-table-column>     
            <el-table-column align="center" prop="typeName" label="资源类型"></el-table-column>
            <el-table-column align="center" prop="phone2" label="手机2"></el-table-column>
            <el-table-column align="center" prop="phone3" label="手机3"></el-table-column>
            <el-table-column align="center" prop="wechat" label="微信"></el-table-column>     
            <el-table-column align="center" prop="qq" label="QQ"></el-table-column>
            <el-table-column align="center" prop="email" label="邮箱"></el-table-column>
            <el-table-column align="center" prop="address" label="地址"></el-table-column>
            <el-table-column align="center" prop="telLastTime" label="最后拨打时间"></el-table-column>
            <el-table-column align="center" prop="advanceAmountValue" label="投资金额"></el-table-column>
            <el-table-column align="center" prop="areaValue" label="店面大小"></el-table-column>     
            <el-table-column align="center" prop="purTypeName" label="意向品类"></el-table-column>
            <el-table-column align="center" prop="projectName" label="意向品牌"></el-table-column>
            <el-table-column align="center" prop="storeArea" label="开店区域（省市显区）"></el-table-column>
            <el-table-column align="center" prop="hasAddressName" label="选址情况"></el-table-column>     
            <el-table-column align="center" prop="age" label="客户年龄"></el-table-column>
            <el-table-column align="center" prop="sex" label="客户性别">
             <template slot-scope="scope">
	                      <div v-if="scope.row.sex === 1">
	                                                                             男
	                      </div>
	                       <div v-else-if="scope.row.sex ===2">
	                                                                             女                                         
	                       </div>
	                     </template>
            
            </el-table-column>
            <el-table-column align="center" prop="professionValue" label="客户职业"></el-table-column>
            <el-table-column align="center" prop="hasExperienceName" label="餐饮经验"></el-table-column>
            <el-table-column align="center" prop="partnerTypeName" label="合伙人"></el-table-column>
            <el-table-column align="center" prop="urgentDate" label="开店紧迫性"></el-table-column>
        </el-table>
          <table-pagination :pager="pager" @change="initTableData"></table-pagination> 
    </el-row>
    <!-- dialog -->
    <el-dialog title="重单申请" :visible.sync="dialogFormVisible">
        <el-form :model="repeatApplyForm" ref="repeatApplyForm" :rules="repeatRules">
            <el-row>
                <el-form-item label="手机号：" :label-width="formLabelWidth" prop="phone">
                    <el-input v-model="repeatApplyForm.phone" placeholder="输入手机号" style="width: 60%;" @keyup.native="repeatApplyNumber" maxLength="11"></el-input>
                    <el-button type="primary" @click="searchClue" :disabled="searchClueDisable">查询线索</el-button>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item label="匹配线索：" :label-width="formLabelWidth" prop="clue">
                    <el-select v-model="repeatApplyForm.clue" placeholder="请选择" style="width: 60%;">
                           <el-option
                            v-for="item in repeatClueArr"
                            :key="item.clueId"
                            :label="item.showReapet"
                            :value="item.clueId">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item label="重单员工：" :label-width="formLabelWidth" prop="employee">
                    <el-select v-model="repeatApplyForm.employee" placeholder="请选择" style="width: 60%;">
                        <el-option
                            v-for="item in telePerArr"
                            :key="item.id"
                            :label="item.name"
                            :value="item.id">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item label="重单手机号：" :label-width="formLabelWidth" prop="repeatPhone">
                    <el-input v-model="repeatApplyForm.repeatPhone" placeholder="输入重单手机号" style="width: 60%;" @keyup.native="repeatApplyRepeatNumber" maxLength="11"></el-input>
                    <el-button type="primary" @click="searchRepeatClue" :disabled="searchRepeatClueDisable">查询线索</el-button>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item label="重单线索：" :label-width="formLabelWidth" prop="repeatClue">
                    <el-select v-model="repeatApplyForm.repeatClue" placeholder="请选择" style="width: 60%;">
                        <el-option
                            v-for="item in repeatCurClueArr"
                            :key="item.clueId"
                            :label="item.showReapet"
                            :value="item.clueId">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-row>
            <el-row>
                <el-form-item label="备注：" :label-width="formLabelWidth" prop="textarea">
                    <el-input
                        style="width: 60%;"
                        type="textarea"
                        :rows="4"
                        placeholder=""
                        maxLength="500"
                        v-model="repeatApplyForm.textarea">
                    </el-input>
                </el-form-item>
            </el-row>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button type="primary" @click="submitForm('repeatApplyForm')">确 定</el-button>
            <el-button @click="dialogFormVisible = false" >取 消</el-button>
        </div>
    </el-dialog>
    <!-- 释放资源 -->
    <el-dialog title="选择释放原因" :visible.sync="releaseFormVisible">
        <el-form :model="releaseForm" ref="releaseForm" :rules="releaseRules">
            <el-row>
                <el-form-item label="释放原因：" :label-width="formLabelWidth" prop="reason">
                    <el-select v-model="releaseForm.reason" placeholder="请选择" style="width: 60%;">
                        <el-option
                            v-for="item in reasonArr"
                            :key="item.value"
                            :label="item.name"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
            </el-row>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button type="primary" @click="submitreleaseForm('releaseForm')">提 交</el-button>
            <el-button @click="releaseFormVisible = false" >取 消</el-button>
        </div>
    </el-dialog>
    <!-- 跟进记录 -->
    <el-dialog title="跟进记录" :visible.sync="recordDialog">
        <el-table
            ref="singleTable" 
            tooltip-effect="dark"
            style="width: 100%"
            border
            :data="recordTable" 
            >
            <el-table-column align="center" type="index" width="55" label="序号"></el-table-column>
            <el-table-column align="center" prop="callTime" label="拨打时间"></el-table-column>
            <el-table-column align="center" prop="status" label="客户状态"></el-table-column>
            <el-table-column align="center" prop="isConnect" label="是否接通"></el-table-column>
            <el-table-column align="center" prop="isNeedResource" label="资源有效性"></el-table-column>
            <el-table-column align="center" prop="isInvite" label="是否邀约"></el-table-column>
            <el-table-column align="center" prop="customerFocus" label="客户关注点"></el-table-column>  
            <el-table-column align="center" prop="isReturnVisit" label="是否继续回访"></el-table-column>  
            <el-table-column align="center" prop="nextTimeVisit" label="下次回访时间"></el-table-column>  
            <el-table-column align="center" prop="createPerson" label="创建人"></el-table-column>  
        </el-table>
    </el-dialog>
    <!-- 跟进记录 -->
    <el-dialog title="手机号1233133332重复资源信息" :visible.sync="repeatPhonesDialog">
        <el-table
            ref="singleTable" 
            tooltip-effect="dark"
            style="width: 100%"
            border
            :data="repeatPhonesTable" 
            >
            <el-table-column align="center" type="index" width="55" label="序号"></el-table-column>
            <el-table-column align="center" prop="resourceCreateTime" label="资源创建时间"></el-table-column>
            <el-table-column align="center" prop="contactCreateTime" label="联系方式创建时间"></el-table-column>
            <el-table-column align="center" prop="majordomo" label="电销总监"></el-table-column>
            <el-table-column align="center" prop="adviser" label="创业顾问"></el-table-column>
            <el-table-column align="center" prop="majordomoTeam" label="电销组"></el-table-column>
            <el-table-column align="center" prop="resourceCreatePersonRole" label="资源创建人角色"></el-table-column>  
            <el-table-column align="center" prop="resourceCreatePerson" label="资源创建人"></el-table-column> 
        </el-table>
    </el-dialog>
    <dialog-tracking :param="trackingParam"></dialog-tracking>
</div>
</body>
<!-- import Vue before Element -->
<div th:include="_footer_include :: #jsLib"></div>
 <script type="text/javascript" th:src="@{'/js/custom/call/rtCall.js'}"></script>
 <script type="text/javascript" th:src="@{'/js/custom/callrecord/simpleAudio.js'}"></script>

<script>
  var mycustomVM=   new Vue({
        el: '#myCustom',
        data: function() {
            return {
                searchClueDisable:true,//查询线索默认不可点击
                searchRepeatClueDisable:true,//查询线索默认不可点击
                isShow:false,
                dialogFormVisible: false,
                releaseFormVisible:false,
                recordDialog:false,
                repeatPhonesDialog:false,
                form: {
                	isTransfer:'',
                	cluesta:'',
                	customerPhone:'',
                	customerName:'',
                	cusStatus:'',
                	cusLeve:'',
                	updateTimeStart:'',
                	updateTimeEnd:'',
                	createTimeStart:'',
                	createTimeEnd:'',
                	assignTimeStart:'',
                	assignTimeEnd:'',
                	dayTel:'',
                	hasInvite:'',
                	repeatStatus:'',
                	province:'',
                	category:'',
                	category:'',
                	searchWord:'',
                	address:'',
                	trackingDay:'',
                	
                	
                },
                repeatApplyForm: {
                    phone:'',
                    clue:'',
                    employee:'',
                    repeatPhone:'',
                    repeatClue:'',
                    textarea:''
                },
                releaseForm:{
                    reason:''
                },
               
                multseleSelection:[],
                pager:{ 
                    total: 0,
                    currentPage: 1,
                    pageSize: 20,
                },
                formLabelWidth: '150px',
                dataTable: [],
                reasonArr:[],
                telePerArr:[],
                repeatCurClueArr:[],
                cusLevelArr:[],
                categoryArr:[],
                repeatClueArr:[],
                provinceArr:[],
                trackingParam:{
                    trackingDialogVisible:false,
                    tableData:[]
                },
                isTransfer:[
                  {
                     value: '0',
                     label: '新资源' },
                    {
                     value: '1',
                     label: '转来资源'
                      }     
                    ],
                    clueStatus:[
                     {
                       value: '1',
                       label: '有效'
                      },
                       {
                          value: '0',
                          label: '无效'
                        }     
                      ],
                      callTel:[
                      {
                       value: '1',
                       label: '是'
                       },
                        {
                          value: '0',
                          label: '否'
                        }     
                      ], 
                      hasInvite:[
                       {
                         value: '0',
                          label: '未邀约'
                        },
                        {
                          value: '1',
                          label: '邀约'
                        }     
                     ],
                     clueRepeatStatus:[
                         {
                          value: '0',
                          label: '不重单'
                          },
                          {
                            value: '1',
                            label: '重单'
                           }     
                       ],
                       hastracking:[
                         {
                            value: '0',
                             label: '未跟访'
                          },
                          {
                            value: '1',
                            label: '跟访'
                            }     
                      ],    
                    
                 options: [{
                    value: '选项1',
                    label: '黄金糕'
                }, {
                    value: '选项2',
                    label: '双皮奶'
                }, {
                    value: '选项3',
                    label: '蚵仔煎'
                }, {
                    value: '选项4',
                    label: '龙须面'
                }, {
                    value: '选项5',
                    label: '北京烤鸭'
                }],
                value: '',//下拉选项默认值
                recordTable:[
                    {
                        callTime:'',
                        status:'',
                        isConnect:'是',
                        isNeedResource:'是',
                        isInvite:'是',
                        customerFocus:'',
                        isReturnVisit:'是',
                        nextTimeVisit:'',
                        createPerson:'张三',
                    },
                    {
                        callTime:'',
                        status:'',
                        isConnect:'否',
                        isNeedResource:'否',
                        isInvite:'否',
                        customerFocus:'',
                        isReturnVisit:'否',
                        nextTimeVisit:'',
                        createPerson:'李四',
                    }
                ],
                repeatPhonesTable:[
                    {
                        resourceCreateTime:'',
                        contactCreateTime:'',
                        majordomo:'',
                        adviser:'',
                        majordomoTeam:'',
                        resourceCreatePersonRole:'',
                        resourceCreatePerson:'张三',
                    },
                    {
                        resourceCreateTime:'',
                        contactCreateTime:'',
                        majordomo:'',
                        adviser:'',
                        majordomoTeam:'',
                        resourceCreatePersonRole:'',
                        resourceCreatePerson:'王五',
                    }
                ],
                cusStatusArr:[],
                repeatRules:{
                    phone:[
                        { required: true, message: '请输入手机号', trigger: 'blur' },
                        { validator:function(rule,value,callback){                 
                            if(/^[0-9]*$/.test(value) == false){
                               callback(new Error("请输入数字"));
                            }else{
                               callback();
                            } 
                            callback();
                        }, trigger: 'blur'}
                    ],
                    clue: [
                        { required: true, message: '请选择匹配线索', trigger: 'blur' }
                    ],
                    employee: [
                        { required: true, message: '请选择重单员工', trigger: 'blur' },
                    ],
                    repeatPhone: [
                        { required: true, message: '请输入重单手机号', trigger: 'blur' },
                        { validator:function(rule,value,callback){                 
                            if(/^[0-9]*$/.test(value) == false){
                               callback(new Error("请输入数字"));
                            }else{
                               callback();
                            } 
                            callback();
                        }, trigger: 'blur'}
                    ],
                    repeatClue: [
                        { required: true, message: '请选择重单线索', trigger: 'blur' }
                    ]
                },
                releaseRules:{
                    reason: [
                        { required: true, message: '请选择释放原因', trigger: 'blur' }
                    ]
                }
            }        	  
        },
        methods: {
         	 initTableData(){
                 var param = {};
                 var pageSize = this.pager.pageSize;
                 var pageNum = this.pager.currentPage;
                 param.pageNum=pageNum;
                 param.pageSize=pageSize;
                 param.isTransfer=this.form.isTransfer;
                 param. status=this.form.cluesta; 
                 param.phone=this.form.customerPhone ;
                 param.cusName=this.form.customerName;
                 param.customerStatus=this.form.cusStatus;
                 param.cusLevel=this.form.cusLeve;
                 param.updateTimeStart=this.form.updateTimeStart;
                 param.updateTimeEnd=this.form.updateTimeEnd;
                 param.createTimeStart=this.form.createTimeStart;
                 param.createTimeEnd=this.form.createTimeEnd;
                 param.assignTimeStart=this.form.assignTimeStart;
                 param.assignTimeEnd=this.form.assignTimeEnd;
                 param.dayTel=this.form.dayTel;
                 param.hasInvite=this.form.hasInvite;
                 param.repeatStatus=this.form.repeatStatus;
                 param.province= this.form.province;
                 param.category= this.form.category;
                 param.address= this.form.address;
                 param.searchWord= this.form.searchWord;
                 param.trackingDay= this.form.trackingDay;
     		    axios.post('/tele/clueMyCustomerInfo/findTeleClueInfo',param).then(function (response) {
     				var resobj= response.data;
     		    	var pageData=resobj.data;
     				mycustomVM.pager.total=pageData.total;
     				mycustomVM.pager.currentPage = pageData.currentPage;
     				mycustomVM.pager.pageSize = pageData.pageSize;
     				mycustomVM.dataTable =pageData.data; 	
     			})
         	
         	},
         	//展现详情
         	showClueDetailInfo (row, column) {
         	  window.location.href='/tele/clueMyCustomerInfo/customerInfoReadOnly?clueId='+row.clueId;
            },
         	createClueData(){
         	  window.location.href='/tele/clueMyCustomerInfo/createClue';
         	},
            toogleClick(){
                if(this.isShow){
                    this.isShow=false
                }else{
                    this.isShow=true
                }          
            },
            openFormInfo(){
            	this.dialogFormVisible = true;
            	if(this.$refs['repeatApplyForm']) {
                    this.$refs['repeatApplyForm'].resetFields();
              }
            },
            openeleaseForm(){
            	this.releaseFormVisible=true;
            	if(this.$refs['releaseForm']) {
                    this.$refs['releaseForm'].resetFields();
              }
            },
            searchClue(){//重单申请查询线索
                if(this.repeatApplyForm.phone==""){
                    this.$message({
                      message: '请输入手机号',
                      type: 'warning'
                    });
                  }
                  var phone= this.repeatApplyForm.phone;
                  var param={};
                   param.phone=phone;
        		   axios.post('/tele/clueMyCustomerInfo/queryRepeatClue',param).then(function (response) {
        		      mycustomVM.repeatClueArr=response.data.data;
         		  })
            },
            openTrackingDialog(cid){
                var param = {};
                param.clueId = cid;
                axios.post('/aggregation/tracking/queryList', param)
                    .then(function (response) {
                        console.log(response.data)
                        if (response.data.code == 0) {
                        	mycustomVM.trackingParam.tableData = response.data.data
                        	mycustomVM.trackingParam.trackingDialogVisible = true;
                        } else {
                        	mycustomVM.$message.error(response.data.msg);
                        }
                    }).catch(function (error) {
                    console.log(error);
                });

            },
            searchRepeatClue(){
            	//重单申请查询线索
                if(this.repeatApplyForm.repeatPhone==""){
                    this.$message({
                      message: '请输入重单手机号',
                      type: 'warning'
                    }); 
                 }
                   var repeatPhone= this.repeatApplyForm.repeatPhone;
                   var employee= this.repeatApplyForm.employee;
                   var param={};
                   param.telemarketingId=employee
                   param.phone=repeatPhone;
         		   axios.post('/tele/clueMyCustomerInfo/queryRepeatCurClue',param).then(function (response) {
         		      mycustomVM.repeatCurClueArr=response.data.data;
          		  })
               
            },
            handleSelectionChange(val) {
                this.multseleSelection = val;
            },
            customerEidt(clueId,phone){
             //客户维护界面	
            // callPhone(clueId,phone);
             window.location.href="/tele/clueMyCustomerInfo/customerEditInfo?clueId="+clueId; 
            },
            submitForm(formName) {
            	//重单提交
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                    	
                    	var repeatPhone=this.repeatApplyForm.repeatPhone;
                    	
                    	var  phone=this.repeatApplyForm.phone;
                    	
                        var employee= this.repeatApplyForm.employee;
                        
                        var clue=this.repeatApplyForm.clue;
                        
                        var repeatClue=this.repeatApplyForm.repeatClue;
                        
                        var textarea= this.repeatApplyForm.textarea;
                        
                        var  param={};
                        
                        param.clueId=clue;
                        
                        param.phone=phone;
                        
                        param.repeatClueId=repeatClue;
                        
                        param.repeatUserId=employee;
                        
                        param.repeatPhone=repeatPhone;
                        
                        param.remark=textarea;
                     	this.dialogFormVisible = false;
                        axios.post('/tele/clueMyCustomerInfo/saveRepeatClue', param)
                        .then(function (response) {
                           mycustomVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
                        	   mycustomVM.initTableData();  
            		         }});
                        }).catch(function (error) {
                            console.log(error);
                        });
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            submitreleaseForm(formName) {
             //提交资源释放            
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                      var rows = this.multseleSelection;
                        if(rows.length <1){
                            this.$message({
                               message: '请选择释放资源',
                               type: 'warning'
                             });
                          return;
                      }
                       var  releId=[];
                   	  if(null!=rows&&rows.length>0){
                      	   for(var i=0;i<rows.length;i++){
                      		 releId.push(rows[i].clueId);
                      	    }
                        }
                     	  var  reason= this.releaseForm.reason;
                     	  var  param={};
                     	  param.releaseClueId=releId;
                     	 param.releaReason=reason;
                     	this.releaseFormVisible=false;
                         axios.post('/tele/clueMyCustomerInfo/releaseClue', param)
                         .then(function (response) {
                        	 mycustomVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
                        	 mycustomVM.initTableData();  
        		        	}});
                         }).catch(function (error) {
                             console.log(error);
                         });
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            recordClick(row) {
                console.log(row);
                this.recordDialog=true;
            },
            repeatPhonesClick(row) {
                console.log(row);
                this.repeatPhonesDialog=true;
            },
            repeatApplyNumber(){//输入手机号才显示查询线索按钮
    　　　      this.repeatApplyForm.phone=this.repeatApplyForm.phone.replace(/[^\.\d]/g,'');
                this.repeatApplyForm.phone=this.repeatApplyForm.phone.replace('.','');
                if(this.repeatApplyForm.phone.length==11){
                    this.searchClueDisable=false;
                }else{
                    this.searchClueDisable=true;
                }
        　  },
            repeatApplyRepeatNumber(){
    　　　      this.repeatApplyForm.repeatPhone=this.repeatApplyForm.repeatPhone.replace(/[^\.\d]/g,'');
                this.repeatApplyForm.repeatPhone=this.repeatApplyForm.repeatPhone.replace('.','');
                if(this.repeatApplyForm.repeatPhone.length==11){
                    this.searchRepeatClueDisable=false;
                }else{
                    this.searchRepeatClueDisable=true;
                }
        　  },

        },
        mounted(){
            document.getElementById('myCustom').style.display = 'block';
            // 初始化释放原因
            param={};
            param.groupCode="releaseReason";
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {
                console.log(response.data.data)
                mycustomVM.reasonArr=response.data.data;
            });
            
            // 初始化电销人员
            param={};
            param.groupCode="releaseReason";
            axios.post('/tele/clueMyCustomerInfo/listByOrgAndRole').then(function (response) {
                console.log(response.data.data)
                mycustomVM.telePerArr=response.data.data;
            });
            
        },
        created(){
    		//初始化数据列表
    		this.initTableData();
    		//客户状态
           var param={};
            param.groupCode="customerStatus"; 
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
            	mycustomVM.cusStatusArr=response.data.data;
             });
            param={};
            param.groupCode="customerLevel"; 
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
            	mycustomVM.cusLevelArr=response.data.data;
             });
            //初始资源类别数据
            param={};
          	param.groupCode="clueCategory";
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
            	mycustomVM.categoryArr=response.data.data;
            });
            param={};
          	param.type="0";
            axios.post('/area/sysregion/querySysRegionByParam',param).then(function (response) {  
            	mycustomVM.provinceArr=response.data.data.data;
            });
    	}
    })
  function  callPhone(clueId ,phone){
	   outboundCallPhone(clueId ,phone,rebackCallphone);
  }
  
  function   rebackCallphone(){
	   
  }
</script>

 <script type="text/javascript">

 
 </script>
</html>