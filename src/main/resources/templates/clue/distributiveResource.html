<!DOCTYPE html>
<html>
<head th:include="_header_include::frag(~{::title},~{},~{})">
<title>已分发资源</title>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="css/element-ui.css">
    <link rel="stylesheet" href="css/base.css">
    <style>
        .dialogForm .el-form-item{margin-bottom: 5px;}
        .el-checkbox{margin-right: 30px!important;}
        .el-checkbox+.el-checkbox{margin-left: 0;}
    </style>
</head>
<body>
<div id="optimizeClueManagement" class="optimizeClueManagement mainPadding" style="display: none;">
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>线索管理</el-breadcrumb-item>
        <el-breadcrumb-item>已分发资源</el-breadcrumb-item>
    </el-breadcrumb>
    <el-row class="marginB20">
        <el-button type="primary" @click="dialogChooseList = true"><i class="el-icon-menu"></i>选择列</el-button>
        
        <shiro:hasPermission name="DistributiveResource:recall">
	        	<el-button type="success" @click="toRecall">撤回</el-button>
        </shiro:hasPermission>
        <!--<shiro:hasPermission name=" aggregation:truckingOrder:export">-->
            <el-button icon="el-icon-upload2" type="primary" @click="exportFun(1)">导出资源沟通记录</el-button>
        <!--</shiro:hasPermission>-->
        <!--<shiro:hasPermission name=" aggregation:truckingOrder:export">-->
        <el-button icon="el-icon-upload2" type="primary" @click="exportFun(2)">导出资源情况</el-button>
        <!--</shiro:hasPermission>-->
    </el-row>
    <div class="mainSearchBg">        
        <div class="mainSearchFormBox">    
            <el-form :inline="true" class="demo-form-inline mainSearchForm" :model="form" ref="form">
                <el-form-item label="手机号:">
                    <el-input v-model="form.phone" placeholder="手机号" maxLength="11" @keyup.native="number"></el-input>
                </el-form-item>
                <el-form-item label="电销分公司:">
                    <el-select v-model="form.telemarketingBranch" placeholder="电销分公司" @change="showTele(7)" clearable filterable>
                        <el-option
                            v-for="item in dxBusinessList"
                            :key="item.id"
                            :label="item.name"
                            :value="item.id">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="事业部:">
                    <el-select v-model="form.businessUnit" placeholder="事业部"  @change="showTele(1)" clearable filterable>
                        <el-option
                            v-for="item in dxCauseBList"
                            :key="item.id"
                            :label="item.name"
                            :value="item.id">
                        </el-option>
                    </el-select>
                </el-form-item>                
                <el-form-item label="创建时间:">
                    <el-date-picker
                        v-model="form.starTime"
                        type="datetime"
                        placeholder="选择日期时间">
                    </el-date-picker>
                </el-form-item>
                <el-form-item label="—" class="widthauto">
                    <el-date-picker
                        v-model="form.endTime"
                        type="datetime"
                        placeholder="选择日期时间">
                    </el-date-picker>
                </el-form-item>
                <el-row v-show="isShow">
                    <el-form-item label="电销组:">
                        <el-select v-model="form.telemarketingItem" placeholder="电销组" clearable filterable>
                            <el-option
                                v-for="item in dxList"
                                :key="item.id"
                                :label="item.name"
                                :value="item.id">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="资源项目:">
                        <el-select v-model="form.resourceProject" placeholder="资源项目" clearable >
                            <el-option
                                v-for="item in proSelectArr"
                                :key="item.id"
                                :label="item.projectName"
                                :value="item.id">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="媒介:">
                        <el-select v-model="form.medium" placeholder="媒介" clearable >
                            <el-option
                                v-for="item in mediumArry"
                                :key="item.value"
                                :label="item.name"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="分发时间:">
                        <el-date-picker
                            v-model="form.assignTimeStart"
                            type="datetime"
                            placeholder="选择日期时间">
                        </el-date-picker>
                    </el-form-item>
                    <el-form-item label="—" class="widthauto">
                        <el-date-picker
                            v-model="form.assignTimeEnd"
                            type="datetime"
                            placeholder="选择日期时间">
                        </el-date-picker>
                    </el-form-item>                     
                    <el-form-item label="资源类别:">
                        <el-select v-model="form.resourceType" placeholder="资源类别" clearable >
                            <el-option
                                v-for="item in categoryArr"
                                :key="item.value"
                                :label="item.name"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="行业类别:">
                        <el-select v-model="form.tradeType" placeholder="行业类别" clearable>
                            <el-option
                                v-for="item in industryCategoryArr"
                                :key="item.value"
                                :label="item.name"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="资源阶段:">
                        <el-select v-model="form.resourceStage" placeholder="资源阶段" clearable >
                            <el-option
                                v-for="item in phaseArr"
                                :key="item.value"
                                :label="item.name"
                                :value="item.value">
                            </el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="资源专员:">
                        <el-select v-model="form.resourcePerson" placeholder="资源专员" clearable   filterable >
                            <el-option
                                v-for="item in userArr"
                                :key="item.id"
                                :label="item.name"
                                :value="item.id">
                            </el-option>
                        </el-select>
                    </el-form-item>

                  <el-form-item label="首次是否接通:">
                    <el-select v-model="form.firstCall" placeholder="首次是否接通" clearable >
                      <el-option
                          v-for="item in comArr"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                    </el-select>
                  </el-form-item>
                  <el-form-item label="资源是否有效:">
                    <el-select v-model="form.status" placeholder="资源是否有效" clearable >
                      <el-option
                          v-for="item in comArr"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                    </el-select>
                  </el-form-item>
                  <el-form-item label="是否接通:">
                    <el-select v-model="form.isCall" placeholder="是否接通" clearable >
                      <el-option
                          v-for="item in comArr"
                          :key="item.value"
                          :label="item.name"
                          :value="item.value">
                      </el-option>
                    </el-select>
                  </el-form-item>
                  <el-form-item label="资源ID:">
                    <el-input v-model="form.clueId" placeholder="资源ID"  @keyup.native="number"></el-input>
                  </el-form-item>
                </el-row>
                <div class="mainSearchBtnBox">
                    <el-button icon="el-icon-search" type="primary" @click="initTableData" class="searchBtn">搜索</el-button>
                    <!-- <el-button type="info" class="searchBtn">取消</el-button> -->
                    <span style="color: #5c6be8;cursor: pointer;margin:0 10px;" @click="toogleClick"><span v-if="isShow">收起</span><span v-else>展开更多</span><i :class="{'greycolor paddingL6 el-icon-arrow-up':isShow,'greycolor paddingL6 el-icon-arrow-down':!isShow}"></i></span>
                </div>
            </el-form>
        </div>
        <el-row>
            <el-table
                ref="tableData"
                tooltip-effect="dark"
                style="width: 100%"
                border
                :data="tableData"
                @row-dblclick="rowDblClick"
                @selection-change="handleSelectionChange"
                >
                <el-table-column align="center" prop="clueId" type="selection" width="55"></el-table-column> 
                <el-table-column align="center" type="index" label="序号" width="55"></el-table-column>
                <el-table-column align="center" :key="item.fieldCode" :prop="item.fieldCode" :label="item.displayName" :width="item.width" v-for="(item,key,index) in tableColums"  v-if="item.fieldCode == 'isTrack'">
                    <template slot-scope="scope">
                        <div v-if="scope.row.isTrack ==1">
                            <el-button @click="openTrackingDialog(scope.row.clueId)" type="text" size="small">点击查看</el-button>
                        </div>
                        <div v-else></div>
                    </template>
                </el-table-column>
                <el-table-column align="center" :key="item.fieldCode" :prop="item.fieldCode" :label="item.displayName" :width="item.width" v-else-if="item.fieldCode == 'status'">
                    <template slot-scope="scope">
                        <div v-if="scope.row.status == 0">否</div>
                        <div v-else-if="scope.row.status ==1">是</div>
                    </template>
                </el-table-column>
                <el-table-column align="center" :key="item.fieldCode" :prop="item.fieldCode" :label="item.displayName" :width="item.width" v-else-if="item.fieldCode == 'firstCall'">
                    <template slot-scope="scope">
                        <div v-if="scope.row.firstCall == 0">否</div>
                        <div v-else-if="scope.row.firstCall ==1">是</div>
                    </template>
                </el-table-column>
                <el-table-column align="center" :key="item.fieldCode" :prop="item.fieldCode" :label="item.displayName" :width="item.width" v-else-if="item.fieldCode == 'isCall'">
                    <template slot-scope="scope">
                        <div v-if="scope.row.isCall == 0">否</div>
                        <div v-else-if="scope.row.isCall ==1">是</div>
                    </template>
                </el-table-column>
                <el-table-column align="center" :key="item.fieldCode" :prop="item.fieldCode" :label="item.displayName" :width="item.width" v-else></el-table-column>
            </el-table>
            <table-pagination :pager="pager" @change="initTableData"></table-pagination>
        </el-row>
    </div>
    <!-- dialog -->
    <el-dialog title="线索详细信息" :visible.sync="dialogFormVisible">
        <el-form :model="dialogForm" ref="dialogForm" class="marginB20 dialogForm">
            <div class="fs16 redcolor marginB20">线索ID：{{basic.id}}</div>
            <div class="borderbox padding20">
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="客户姓名：" :label-width="formLabelWidth">
                      {{customer.cusName}}
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="手机号：" :label-width="formLabelWidth">
                           {{customer.phone}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="微信：" :label-width="formLabelWidth">
                          {{customer.wechat}}<span v-show="customer.wechat">/二维码</span>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="邮箱：" :label-width="formLabelWidth">
                          {{customer.email}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="QQ：" :label-width="formLabelWidth">
                         {{customer.qq}}
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="资源类型：" :label-width="formLabelWidth">
                     {{basic.typeName}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="资源项目：" :label-width="formLabelWidth">
                         {{basic.projectName}}
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="资源类别：" :label-width="formLabelWidth">
                       {{basic.categoryName}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="媒介：" :label-width="formLabelWidth">
                        {{basic.sourceName}}
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="搜索词：" :label-width="formLabelWidth">
                          {{basic.searchWord}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="12">
                        <el-form-item label="行业类别：" :label-width="formLabelWidth">
                       {{basic.industryCategoryName}}
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="留言时间：" :label-width="formLabelWidth">
                            {{basic.messageTime}}
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="24">
                        <el-form-item label="留言重点：" :label-width="formLabelWidth">
                       {{basic.messagePoint}}
                        </el-form-item>
                    </el-col>
                </el-row>
            </div>
        </el-form>
    </el-dialog>
    <dialog-tracking :param="trackingParam"></dialog-tracking>
    <!-- 选择列 -->
    <el-dialog title="自定义列" :visible.sync="dialogChooseList" class="elCheckboxGroup">
	  <el-form :model="fieldFrom">	    
		  <el-form-item label="" prop="type">
		    <el-checkbox-group v-model="fieldFrom.type">
		      <el-checkbox :label="item.sortNum+'_'+item.fieldCode+'_'+item.displayName+'_'+item.id"  name="type" :key="item.fieldCode"  v-for="(item,index) in  allTableColums ">
		          {{item.displayName}}
		      </el-checkbox>
		     </el-checkbox-group>
		  </el-form-item>	    
	  </el-form>	  
	  <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="confirmColumn">确 定</el-button>
	    <el-button @click="dialogChooseList = false">取 消</el-button>	    
	  </div>
	</el-dialog>
</div>
</body>
<!-- import Vue before Element -->
 <div th:include="_footer_include :: #jsLib"></div>
<script th:inline="javascript" >
var proSelect=[[${proSelect}]];
var userList=[[${userList}]];
var fieldList=[[${fieldList}]];//自定义字段
var userFieldList=[[${userFieldList}]];//用户自定义字段
    var ocmVM = new Vue({
        el: '#optimizeClueManagement',
        data: function() {
            return {
                isShow:false,
                dialogFormVisible: false,
                dialogChooseList: false,
                multipleSelection: [],//选择行
                allTableColums:[],//自定义列
                tableColums:[],
                fieldFrom: {
 	               type: []
 	             },
                form: {
                    starTime:'',
                    endTime:'',
                    starTime1:'',
                    endTime1:'',
                    telemarketingBranch:'',
                    businessUnit:'',
                    telemarketingItem:'',
                    resourceProject:'',
                    medium:'',
                    resourceType:'',
                    tradeType:'',
                    resourceStage:'',
                    resourcePerson:'',
                    phone:'',
                    clueId:'',
                    isCall:"",
                    status:"",
                    firstCall:"",
                },
                pager:{
                    total: 0,
                    currentPage: 1,
                    pageSize: 20,
                },
                trackingParam:{
                    trackingDialogVisible:false,
                    tableData:[]
                },
                dialogForm:{},
                formLabelWidth: '120px',
                dxBusinessList:[],
                industryCategoryArr:[],
                categoryArr:[],
                mediumArry:[],
                phaseArr:[],
                dxList:[],
                dxCauseBList:[],
                proSelectArr:proSelect,
                dxBusinessList:[],
                userArr:userList,
                comArr:[
                  {value:"",name:"全部"},
                  {value:"1",name:"是"},
                  {value:"0",name:"否"}
                ],
                tableData:[],
                customer:'',
                basic:'',

            }
        },
        methods: {
            handleSelectionChange(val) {//选择节点的事件
                console.log(val)
                this.multipleSelection = val;
            },
            submitForm(formName){//表格搜索
                var starTime=this.form.starTime;
                var endTime=this.form.endTime;
                if(endTime){
                    if(starTime>endTime){
                        this.$message({
                            message: '开始时间不能大于结束时间',
                            type: 'warning'
                        });
                        return;
                    }
                }
            },
            openTrackingDialog(cid){
                var param = {};
                param.clueId = cid;
                axios.post('/aggregation/tracking/queryList', param)
                .then(function (response) {
                    console.log(response.data)
                    if (response.data.code == 0) {
                        ocmVM.trackingParam.tableData = response.data.data
                        ocmVM.trackingParam.trackingDialogVisible = true;
                    } else {
                        ocmVM.$message.error(response.data.msg);
                    }
                }).catch(function (error) {
                    console.log(error);
                });
            },
       	      initTableData(){
                var param = {};
                var pageSize = this.pager.pageSize;
                var pageNum = this.pager.currentPage;
                param.pageNum=pageNum;
                param.pageSize=pageSize;
                param.createTimeStart=this.form.starTime;
                param.createTimeEnd=this.form.endTime;
                param.spreadAssignTimeStart=this.form.assignTimeStart;
                param.spreadAssignTimeEnd=this.form.assignTimeEnd;
                param.teleCompanyId=this.form.telemarketingBranch;
                param.teleDeptId=this.form.businessUnit;
                param.teleGorupId=this.form.telemarketingItem;
                param.teleGorupId=this.form.telemarketingItem;
                param.projectId=this.form.resourceProject;
                param.operationId=this.form.resourcePerson;
                param.phase=this.form.resourceStage;
                param.source=this.form.medium;
                param.phone=this.form.phone;
                param.category=this.form.resourceType;
                param.industryCategory=this.form.tradeType;
                param.status = this.form.status;
                param.clueId = this.form.clueId;
                param.isCall = this.form.isCall;
                param.firstCall = this.form.firstCall;
                var starTime=this.form.starTime;
                var endTime=this.form.endTime;
                if(endTime){
                    if(starTime>endTime){
                        this.$message({
                            message: '创建开始时间不能大于结束时间',
                            type: 'warning'
                        });
                        return;
                    }
                }
                var start=this.form.assignTimeStart;
                var end=this.form.assignTimeEnd;
                if(end){
                    if(start>end){
                        this.$message({
                            message: '分发开始时间不能大于结束时间',
                            type: 'warning'
                        });
                        return;
                    }
                }

    		    axios.post('/exetend/distributionedTaskManager/queryPageDistributionedTask',param).then(function (response) {
    				if(!response){
    					ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
    				var resobj= response.data;
					if(!resobj){
						ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
					if(resobj.code!='0'){
						ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
    		    	var pageData=resobj.data;
    		    	ocmVM.pager.total=pageData.total;
    		    	ocmVM.pager.currentPage = pageData.currentPage;
    		    	ocmVM.pager.pageSize = pageData.pageSize;
    		    	ocmVM.tableData =pageData.data;
    			})
        	},


            rowDblClick(row, column, event){
        	  //双击查看详情
        	  var  param={};
              param.clueId=row.clueId;
     		  axios.post('/exetend/agendaTaskManager/customerInfoView',param).then(function (response) {
     				if(!response){
     					ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
     				var resobj= response.data;
					if(!resobj){
						ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
					if(resobj.code!='0'){
						ocmVM.$message({
	                        message: "接口调用失败",
	                        type: 'error'
	                      });
						return ;
					}
					 var customer=response.data.data.clueCustomer;
					  var phone = '';
					  if(customer.phone){
						  phone+=customer.phone;
					  }
					  if(customer.phone2){
						  if(phone){
							  phone+=",";
						  }
						  phone+=customer.phone2;
					  }
					  if(customer.phone3){
						  if(phone){
							  phone+=",";
						  }
						  phone+=customer.phone3;
					  }
					  customer.phone=phone;
					  ocmVM.customer=customer;
				  var messageTime= response.data.data.clueBasic.messageTime;
				  if(null!=messageTime){
					  response.data.data.clueBasic.messageTime=crtTimeFtt1(messageTime);
				  }
				  ocmVM.basic=response.data.data.clueBasic;
     			})







                this.dialogFormVisible = true
            },
            number(){
    　　　                             this.form.phone=this.form.phone.replace(/[^\.\d]/g,'');
              this.form.phone=this.form.phone.replace('.','');
        　                              　},
            //级联查询机构
            showTele(type){
         	   var param={};
 	           if(type==1){
 	        	   param.orgType="1";
 	        	   param.parentId = this.form.businessUnit;
 	           }else if(type ==7){
 	        	   param.orgType="7";
 	        	   param.parentId = this.form.telemarketingBranch;
 	           }else if(type ==0){
 	        	   param.orgType="8";
 	           }
                axios.post('/organization/organization/queryOrgByType',param).then(function (response) {
             	   console.log(response);
             	   if(type==1){
             		  ocmVM.dxList = response.data.data;
     	           }else if(type ==7){
     	        	  ocmVM.dxCauseBList = response.data.data;
     	           }else{
     	        	  ocmVM.dxBusinessList = response.data.data;
     	           }
                 }).catch(function (error) {
                     console.log(error);
                 })
                 .then(function () {
                   // always executed
                 });
           },
           confirmColumn(){
           	this.dialogChooseList = false;
           	//处理用户选择的列
           	console.info(this.fieldFrom.type);
           	if(this.fieldFrom.type.length==0){
           		this.$message({
                       message: "请至少保留一列",
                       type: 'error'
                     }); 
           		return;
           	}
           	var customerShowColun = [];
           	var customerColumn = this.fieldFrom.type;
           	customerColumn.sort(this.sortNumber);//对选择的列排序
           	var idList=[];
           	for(var i=0;i<customerColumn.length;i++){
           		var curItem = customerColumn[i];
           		var itemArr = curItem.split("_");
           		var obj = {};
           		obj.fieldCode=itemArr[1];
           		obj.displayName=itemArr[2];
           		customerShowColun.push(obj);
           		idList.push(itemArr[3])
           	}
           	this.tableColums = customerShowColun;
           	var param ={};
             param.fieldIdList = idList;
             param.menuCode = "DistributiveResource";
             console.info(param);
             if(idList.length!=0){
                 axios.post('/customfield/customField/saveUserField', param)
                 .then(function (response) {
                 	
                 })
                 .catch(function (error) {
                      console.log(error);
                 });
             }
           },
           initColumn(){
           	//初始化table 列 和 用户自定义列
           	this.allTableColums = fieldList;
           	if(userFieldList.length!=0){
           		var type=[];
               	for(var i=0;i<userFieldList.length;i++){
               		type.push(userFieldList[i].sortNum+'_'+userFieldList[i].fieldCode+'_'+userFieldList[i].displayName+'_'+userFieldList[i].fieldId)
                }
              	this.fieldFrom.type = type;
              	this.confirmColumn();
           	}else{
           		var type=[];
                 	for(var i=0;i<fieldList.length;i++){
                 		type.push(fieldList[i].sortNum+'_'+fieldList[i].fieldCode+'_'+fieldList[i].displayName+'_'+fieldList[i].id)
                	}
	              	this.fieldFrom.type = type;
	              	this.confirmColumn();
           	}
           	
           },
            sortNumber(a,b) {
               //对数组中元素，按照数字 从小到大 排序
               return a.split("_")[0] - b.split("_")[0];
            },
            toogleClick(){
                if(this.isShow){
                    this.isShow=false
                }else{
                    this.isShow=true
                }          
            },
            exportFun(falg){ // 导出
                var param = this.form;
                var methodStr;
                if(falg==1){ // 沟通情况
                    methodStr = 'findCommunicateRecords';
                }else{ // 资源记录
                    methodStr = 'findClues';
                }
                axios.post('/exetend/distributionedTaskManager/'+methodStr,param,{responseType:'blob'})
                .then(function (response) {
                    var data =  response.data;
                    var fileName = response.headers.filename;
                    saveAs(data,decodeURI(fileName));
                }).catch(function (error) {
                    console.log(error);
                }).then(function(){
                    signRecordVM.loading=false;
                });
            },

            toRecall() {
                var rows = this.multipleSelection;
                if(rows.length!=1){
                    this.$message({
                        message: '请选择一条数据进行撤回',
                        type: 'warning'
                    });
                    return;
                }else{
                	if(rows[0].phase>3){
                		this.$message({
                            message: '已分配电销经理，不可撤回',
                            type: 'warning'
                        });
                        return;
                	}
                    this.$confirm('撤回线索后分配人员不可见，同时该线索转移至待分发资源中，确定将线索撤回?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                    	var param={};
                        var rows = this.multipleSelection;
                        param.id=rows[0].clueId;
               		 	axios.post('/exetend/agendaTaskManager/recallClue',param).then(function (response) {
           			 		if(!response||!response.data||response.data.code!='0'){
	           					ocmVM.$message({
	      	                        message: "接口调用失败",
	      	                        type: 'error'
	      	                      }); 
	      						return ;
      						}
           					var resobj= response.data;
      				 		ocmVM.$message({message:'撤回成功',type:'success',duration:2000,onClose:function(){
      							ocmVM.initTableData();
   		        			}});
           		  		});
                    }).catch(() => {
                        this.$message({
                            type: 'info',
                            message: '已取消操作'
                        });          
                    });
                }                
            },
        },
        mounted(){

        	document.getElementById('optimizeClueManagement').style.display = 'block';
        	this.initColumn();
         	this.initTableData();
            var  param={};
       	   param.groupCode="medium";
             axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {
            	 ocmVM.mediumArry=response.data.data;
            });

             //初始资源类别数据
              param={};
            	param.groupCode="clueCategory";
              axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {
            	  ocmVM.categoryArr=response.data.data;
              });
              //初始行业类别
              param={};
              param.groupCode="industryCategory";
               axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {
            	   ocmVM.industryCategoryArr=response.data.data;
               });

               //初始化线索阶段
               param={};
               param.groupCode="phase";
                axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {
             	   ocmVM.phaseArr=response.data.data;
               });

               //初始化电销分公司
               this.showTele(0);

        }
    })

    function crtTimeFtt1(val, row) {
        if (val != null) {
            var date = new Date(val);

            var month = (date.getMonth() + 1);
            if(month<10){
                month = "0"+month;
            }
            var day = date.getDate();
            if(day<10){
                day = "0"+day;
            }
            var hour = date.getHours();
            if(hour<10){
                hour = "0"+hour;
            }
            var minu = date.getMinutes();
            if(minu<10){
                minu = "0"+minu;
            }
            var mill = date.getSeconds();
            if(mill<10){
                mill = "0"+mill;
            }
            return date.getFullYear()+''+(month) + ''+day+' '+hour+":"+minu+":"+mill;
        }
    }
</script>
</html>