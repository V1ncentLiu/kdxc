<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="_header_include::frag(~{::title},~{::style},~{})">
    <title>我的客户</title>
    <style>
        button a{color:#fff!important;}
        .el-input{
            width: 90%;
        }
        .borderboxInfo .el-row{font-size: 14px;}
        .borderboxInfo .el-row .el-col{margin-bottom: 10px;width: 357px;}
        .borderboxInfo .el-row .el-col span:first-child{width:110px;text-align: right;float: left;}
    </style>
</head>
<body>
<div id="editSignAndFile" class="editSignAndFile mainPadding" style="display: none;">
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>电销管理</el-breadcrumb-item>
        <el-breadcrumb-item v-if="type ==2">客户管理</el-breadcrumb-item>
        <el-breadcrumb-item v-else>我的客户</el-breadcrumb-item>
    </el-breadcrumb>
    <div class="mainSearchBg">
        <div class="fs14 marginB10">维护签约单基本信息</div>
        <div class="borderbox padding20 marginB20 borderboxInfo">
            <el-row>
                <el-col>
                    <span>签约单编号：</span><span>{{signOrderBaseInfo[0].signNo}}</span>
                </el-col>
                <el-col>
                    <span>客户姓名：</span><span>{{signOrderBaseInfo[0].customerName}}</span>
                </el-col>
                <el-col>
                    <span>客户身份证号：</span><span>{{signOrderBaseInfo[0].idCard}}</span>
                </el-col>
                <el-col>
                    <span>客户联系电话：</span><span>{{signOrderBaseInfo[0].phone}}</span>
                </el-col>
                <el-col>
                    <span>签约餐饮公司：</span><span>{{signOrderBaseInfo[0].signCompanyName}}</span>
                </el-col>
                <el-col>
                    <span>签约项目：</span><span>{{signOrderBaseInfo[0].signProjectName}}</span>
                </el-col>
                <el-col>
                    <span>签约省份：</span><span>{{signOrderBaseInfo[0].signProvince}}</span>
                </el-col>
                <el-col>
                    <span>签约城市：</span><span>{{signOrderBaseInfo[0].signCity}}</span>
                </el-col>
                <el-col>
                    <span>签约区／县：</span><span>{{signOrderBaseInfo[0].signDictrict}}</span>
                </el-col>
                <el-col>
                    <span>签约店型：</span><span>{{signOrderBaseInfo[0].signShopTypeName}}</span>
                </el-col>
                <el-col>
                    <span>合同应收金额：</span><span>{{signOrderBaseInfo[0].amountReceivable}}</span>
                </el-col>
                <el-col>
                    <span>签约类型：</span>
                    <span>{{this.formatTypeFn(signOrderBaseInfo[0].signType)}}</span>
                </el-col>
                <el-col>
                    <span>是否远程签约：</span>
                    <span>{{this.formatRemoteFn(signOrderBaseInfo[0].isRemoteSign)}}</span>
                </el-col>
            </el-row>
        </div>
        <el-form :model="signAddressForm"  ref="signAddressForm" >
            <el-form-item label="签约地址："  prop="signAddress">
                <el-input type="textarea"  maxlength="1000" v-model="signAddressForm.signAddress"  class="marginB20" style="width:80%;"></el-input>
            </el-form-item>
        </el-form>
        <div class="marginB20 fs16 paddingT20">上传资料</div>
        <el-row class="marginB10">
            <el-col :span="8">
                <el-button size="small" type="danger" @click="deteleClueFile">删除</el-button>
                <el-button type="text" disabled>只允许上传图片／音频文件，支持格式：jpg,png,jpeg,gif,bmp,mp3,mp4,wav,wma,3gpp,m4a,ape,midi,amr。不允许超过500MB。</el-button>
            </el-col>
            <el-col :span="4" class="f-fr">
                <form name=theform v-show="false">
                    <input type="radio" name="myradio" value="local_name" checked=true/>上传文件名字保持本地文件名字 <input
                        type="radio" name="myradio" value="random_name"/>上传文件名字是随机文件名 <br/>上传到指定目录:<input
                        type="text" id='dirname' placeholder="如果不填，默认是上传到根目录" size=50>
                </form>
                <div id="container" style="text-align:right;">
                    <a id="selectfiles" href="javascript:void(0);" class='btn'>选择文件</a>
                    <a id="postfiles" href="javascript:void(0);" onclick="clueUploadFile()" class='btn'>开始上传</a>
                </div>
                <div id="ossfile">你的浏览器不支持flash,Silverlight或者HTML5！</div>
                <span v-show="false">上传到指定目录:<input type="text" id='dirname' placeholder="如果不填，默认是上传到根目录" size=50><pre
                        id="console"></pre></span>
            </el-col>
        </el-row>
        <el-row>
            <el-table ref="multipleTable" :data="tableDataC1"
                      tooltip-effect="dark" style="width: 100%"
                      border
                      @selection-change="handleFileSelectionChange">
                <el-table-column type="selection" prop="id" width="55" @selection-change="handleFileSelectionChange"
                                 align="center">
                </el-table-column>
                <el-table-column prop="uploadUserName" label="上传人姓名" align="center">
                </el-table-column>
                <el-table-column prop="uploadTime" label="上传时间" align="center">
                </el-table-column>
                <el-table-column prop="fileName" label="文件名称" align="center">
                </el-table-column>
                <el-table-column label="操作" align="center">
                    <template slot-scope="scope">
                        <el-button size="mini" type="text" @click="handleOperateFn(scope.$index, scope.row)">
                            {{scope.row.fileType !=="jpg" && scope.row.fileType !=="png" && scope.row.fileType !=="jpeg" && scope.row.fileType !=="gif" && scope.row.fileType !=="bmp"? '下载录音':'查看图片'}}
                        </el-button>
                    </template>
                </el-table-column>
                <el-table-column prop="delStatus" label="删除状态" align="center">
                    <template slot-scope="scope">
                        <div v-if="scope.row.delStatus === 0">未删除</div>
                        <div v-else-if="scope.row.delStatus ===1" class="redcolor">已删除</div>
                    </template>
                </el-table-column>
            </el-table>
        </el-row>


    </div>
    <div  class="padding20 f-tac">
        <el-button type="primary" :disabled="saveDisabled" @click="submitForm('signAddressForm')">保存资料</el-button>
        <el-button type="primary" @click="goback()">取消</el-button>
    </div>
</div>

<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>
<script src="/js/common/download.js"></script>
<script th:src="@{/js/custom/callrecord/download.js?v=1.0.0}"></script>
<script th:inline="javascript">
    var type = [[${type}]];
    var clueId = [[${clueId}]];
    var signId = [[${signId}]];
    var signData = [[${signData}]];
    var clueFileList = [[${clueFileList}]];//上传文件
    var ossUrl = [[${ossUrl}]];//上传文件地
    // 查询 模块
    var mainDivVM = new Vue({
        el: '#editSignAndFile',
        data: {
            signOrderBaseInfo: signData,//签约单基本信息
            tableDataC1: clueFileList,//文件记录
            type: type,
            saveDisabled: false,
            signAddressForm: {
                signAddress: ''
            }
        },
        methods: {
            formatTypeFn(value) {//
                if (value == "1") {
                    value = "一次性全款"
                } else if (value == "2") {
                    value = "先交定金"
                }
                return value;
            },
            formatRemoteFn(value) {//
                if (value == "0") {
                    value = "否"
                } else if (value == "1") {
                    value = "是"
                }
                return value;
            },
            submitForm(form) {
                var param = {};
                param.signId = signId;
                param.signAddress = mainDivVM.signAddressForm.signAddress;
                debugger;
                axios.post('/businesssign/updateSignAddress', param)
                    .then(function (response) {
                        var result = response.data;
                        if (result.code == "0") {
                            mainDivVM.$message({
                                message: '操作成功', type: 'success', duration: 2000, onClose: function () {
                                    window.location.href = '/businesssign/myCustomSignRecordPage?clueId=' + clueId + "&signId=" + signId + "&readyOnly=1&createUser=null&type=2";
                                }
                            });
                        } else {
                            this.saveDisabled = false;
                        }
                    });
            },
            deteleClueFile() {
                //删除上传文件
                var rows = this.multipleFileSelection;
                if (rows.length < 1) {
                    if (rows.length != 1) {
                        this.$message({message: '请选择删除数据', type: 'warning'});
                        return;
                    }
                }
                for (var i = 0; i < rows.length; i++) {
                    if (rows[i].uploadUser != this.loginUserId) {
                        this.$message({message: '选中数据存在他人数据，不能进行编辑操作', type: 'warning'});
                        return;
                    }
                }

                this.$confirm('确定要删除上传文件？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    var ids = [];
                    for (var i = 0; i < rows.length; i++) {
                        ids.push(rows[i].id);
                    }
                    var param = {};
                    param.delIds = ids;
                    param.clueId = clueId;
                    axios.post('/tele/clueMyCustomerInfo/deleteClueFile', param)
                        .then(function (response) {
                            mainDivVM.$message({
                                message: '操作成功', type: 'success', duration: 2000, onClose: function () {
                                    axios.post('/tele/clueMyCustomerInfo/findClueFile', param)
                                        .then(function (response) {
                                            mainDivVM.tableDataC1 = response.data.data;
                                        });

                                }
                            });
                        });
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });

            },
            handleFileSelectionChange(val) {
                //上传资料
                this.multipleFileSelection = val;
            },
            goback(){window.history.go(-1);},
        },
        created() {
            //初始化签约单地址
            var signAddress = signData[0].signAddress;
            this.signAddressForm.signAddress =  signAddress;
        },
        mounted() {
            document.getElementById('editSignAndFile').style.display = 'block';
        }
    });
</script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/crypto/crypto.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/hmac/hmac.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/sha1/sha1.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/base64.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/plupload.full.min.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/file_upload.js'}"></script>
<script type="text/javascript" src="//agent-gateway-2.cticloud.cn/js/agent/v10/cti-link.js"></script>
<script th:src="@{/js/custom/call/md5.js?v=1.0.0}"></script>
<script th:src="@{/js/custom/call/toolbar.js?v=1.0.1}"></script>
<script th:src="@{/js/custom/call/toolbarIframe.js?v=1.0.1}"></script>
<script th:src="@{/js/custom/call/timer.js?v=1.0.1}"></script>
<script th:src="@{/js/custom/call/rtCall.js?v=1.0.0}"></script>
<!-- 播放錄音 js -->
<script th:src="@{/js/custom/callrecord/simpleAudio02.js?v=1.0.0}"></script>
<script th:src="@{/js/custom/callrecord/download.js?v=1.0.0}"></script>
<script type="text/javascript">
    var result=null;
    function clueUploadFile() {
        result = uploadFile();
        if (result == null) {
            // alert("请选择上传文件");
            mainDivVM.$message({message: '请选择上传文件', type: 'warning'});
            return;
        }
    }
    function fileUploadCallback(){
        var param = {};
        param.clueId = clueId;
        param.filePath = result;
        axios.post('/tele/clueMyCustomerInfo/uploadClueFile', param).then(function (response) {
            mainDivVM.$message({
                message: '操作成功', type: 'success', duration: 2000, onClose: function () {
                    axios.post('/tele/clueMyCustomerInfo/findClueFile', param)
                        .then(function (response) {
                            mainDivVM.tableDataC1 = response.data.data;
                            var ossfile = document.getElementById("ossfile");
                            ossfile.innerHTML = "";
                        });
                }
            });
        });
    }

</script>
<link rel="stylesheet" href="/css/common/uploadStyle.css">
<style type="text/css">
    #ossfile {
        text-align: right;
    }
</style>
</body>
</html>