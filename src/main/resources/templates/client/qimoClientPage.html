<!DOCTYPE html>
<html>
<head th:include="_header_include::frag(~{::title},~{},~{})">
    <title>七陌坐席管理</title>
     <style>
        .trClientManage .leftBox{/*width: 200px;*/height: auto;border:1px solid #ebeef5;min-height: 480px;}
        .trClientManage .leftTitle{background:#ebeef5;text-indent: 20px;height: 40px;line-height: 40px;}
        .trClientManage .leftTree{padding:10px;}
        .trClientManage .rightTitle{background:#ebeef5;text-indent: 20px;height: 40px;line-height: 40px;}
    </style>
</head>
<body>
<div id="trClientManage" class="trClientManage mainPadding" style="display:none">  
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>系统管理</el-breadcrumb-item>
        <el-breadcrumb-item><a href="JavaScript:void(0)" data-url="c.html">七陌坐席管理</a></el-breadcrumb-item>
    </el-breadcrumb>
    <el-row class="marginB10">
        <shiro:hasPermission name="aggregation:qimoClient:add">
           <el-button type="primary" @click="addClientDialog"><i class="el-icon-plus"></i> 添加坐席</el-button>
        </shiro:hasPermission>
        <shiro:hasPermission name="aggregation:qimoClient:edit">
            <el-button type="primary" @click="modifyClientDialog">修改坐席</el-button>
        </shiro:hasPermission>
        <shiro:hasPermission name="aggregation:qimoClient:import">
            <el-button type="primary" @click="addBatchClient">导入坐席</el-button>
        </shiro:hasPermission>
        <shiro:hasPermission name="aggregation:qimoClient:delete">
             <el-button type="primary" @click="deleteClientDialog">删除坐席</el-button>
        </shiro:hasPermission>
    </el-row>
    <el-row class="marginB10 greybg padding20">
        
         <el-row :gutter="20">
                <el-col :span="4">
                         <el-input placeholder="请输入坐席号"  v-model="searchForm.clientNo">
                </el-col> 
                 <el-col :span="4">
                        <el-select v-model="searchForm.orgId" placeholder="请选择所在组织" value-key="value" clearable>
                                <el-option
                                    v-for="item in orgList"
                                    :key="item.id"
                                    :label="item.name"
                                    :value="item.id">
                                </el-option>
                            </el-select>
                </el-col> 
                <el-col :span="4">
                     <el-input placeholder="关联用户名"  v-model="searchForm.userName">
                </el-col>
                <el-col :span="4">
                     <el-input placeholder="登录名称"  v-model="searchForm.loginClient">
                </el-col>
                
                <el-col :span="3">
                         <el-button   icon="el-icon-search" type="primary" @click="initClientData" plain>搜索</el-button>
                    </el-form-item>
                </el-col>
            </el-row>
        
    </el-row>
    <el-row>
        <el-table 
            ref="multipleTable"
            tooltip-effect="dark"
            style="width: 100%"
            border
             @selection-change="handleSelectionChange"
            :data="clientData" 
            >
            <el-table-column align="center" type="selection" width="55"></el-table-column>
            <el-table-column align="center" prop="loginClient" label="坐席账号"></el-table-column>
            <el-table-column align="center" prop="clientNo" label="坐席编号"></el-table-column>
            <el-table-column align="center" prop="accountNo" label="账户编号"></el-table-column>
            <el-table-column align="center" prop="secretKey" label="秘钥"></el-table-column>
            <el-table-column align="center" prop="proxyurl" label="PROXTURL"></el-table-column>
            <el-table-column align="center" prop="name" label="CRM系统用户名"></el-table-column>
            <el-table-column align="center" prop="isUserStatus" label="状态" :formatter="getIsUserStatusText"></el-table-column>
            <el-table-column align="center" prop="createTime" label="创建时间" :formatter="getFormatDateText"></el-table-column>
            
        </el-table>
        <table-pagination :pager="pager" @change="initClientData"></table-pagination>
    </el-row>
    
    <el-dialog :title="addOrModifyDialogTitle" :visible.sync="dialogFormVisible" @close="closeAddClientDialog">
        <el-form :model="form" ref="clientForm" :rules="rules">
            <el-form-item label="登录坐席：" :label-width="formLabelWidth" prop="loginClient">
                <el-input v-model="form.loginClient" autocomplete="off"  maxlength="50"></el-input>
            </el-form-item>
            <el-form-item label="坐席编号：" :label-width="formLabelWidth" prop="clientNo">
                <el-input v-model="form.clientNo" autocomplete="off"  maxlength="50"></el-input>
            </el-form-item>
            <el-form-item label="账户编号：" :label-width="formLabelWidth" prop="accountNo">
                <el-input v-model="form.accountNo" autocomplete="off"  maxlength="50"></el-input>
            </el-form-item>
            <el-form-item label="秘钥：" :label-width="formLabelWidth" prop="secretKey">
                <el-input v-model="form.secretKey" autocomplete="secretKey"  maxlength="100"></el-input>
            </el-form-item>
            <el-form-item label="手机号1：" :label-width="formLabelWidth" prop="phone1">
                <el-input v-model="form.phone1" autocomplete="off"  maxlength="11"></el-input>
            </el-form-item>
              <el-form-item label="手机号2：" :label-width="formLabelWidth" prop="phone2">
                <el-input v-model="form.phone2" autocomplete="off"  maxlength="11"></el-input>
            </el-form-item>
            <el-form-item label="PROXYURL：" :label-width="formLabelWidth" prop="proxyurl">
                <el-input v-model="form.proxyurl" autocomplete="off"  maxlength="100"></el-input>
            </el-form-item>
             <el-form-item label="七陌用户状态：" :label-width="formLabelWidth" prop="isUserStatus">
                   <el-select v-model="form.isUserStatus"  value-key="value">
                       <el-option
                           v-for="item in options"
                           :key="item.value"
                           :label="item.label"
                           :value="item.value">
                       </el-option>
                   </el-select>
               </el-form-item>
               
                <el-form-item label="关联用户：" :label-width="formLabelWidth" prop="userId">
                   <el-select v-model="form.userId"  value-key="value">
                       <el-option
                           v-for="item in userList"
                           :key="item.id"
                           :label="item.name"
                           :value="item.id">
                       </el-option>
                   </el-select>
               </el-form-item>
               
               
  
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button type="primary" @click="saveClient('clientForm')" :disabled="confirmBtnDisabled">提交</el-button>
            <el-button @click="cancelForm('clientForm')">取 消</el-button>
        </div>
    </el-dialog>
    
    <el-dialog
	  title="选择组织"
	  :visible.sync="orgDialogVisible"
	  width="30%">
	  
        <el-tree
             :data="orgTreeData"              
             node-key="id"
             show-checkbox
             default-expand-all
             highlight-current
             check-strictly
             @check="selecedNode"
             class="leftTree">
         </el-tree>

	  
	</el-dialog>

     <!-- 批量添加 自定义字段弹窗 start -->
            <el-dialog title="批量添加" :visible.sync="dialogBatchVisible" @close="closeUploadFileDialog">
               <el-row class="marginB20">
                                 <!-- 下载批量上传模版: <a href="" download="页面自定义字段导入模板">页面自定义字段模板</a> -->
                                 下载批量上传模版：<a href="/excel-templates/qimo-client-template.xlsx" download="七陌坐席导入模板"><span style="color:#409EFF">七陌坐席导入模板</span></a>
               
               </el-row>
               <el-row>
                  <el-upload
                      class="upload-demo"
                      ref="upload"
                      :multiple="false"
                      accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                      action="/client/client/uploadQimoClient"
                      :file-list="fileList"
                      :on-change="handleChange"
                      :before-upload="beforeUpload"
                      :on-success="uploadSuccess"
                     :on-error="uploadError"
                      :auto-upload="false">
                      <el-button slot="trigger" size="small" type="primary" style="margin-right: 10px;">上传文件</el-button>
                      <span slot="tip" class="el-upload__tip">只能上传xlsx文件</span>
                    </el-upload>
               
               
               </el-row>
              <div slot="footer" class="dialog-footer">
                <el-button type="primary" @click="submitUpload">确 定</el-button>
                <el-button @click="dialogBatchVisible = false">取 消</el-button>
              </div>
            </el-dialog>
      
            <!-- 批量添加 自定义字段弹窗 end -->

      <el-dialog title="预览数据" :visible.sync="uploadPreDialogVisible">
          预览数据 共{{uploadNum}}条资源    
           <el-table
		    :data="uploadClientData"
		    height="250"
		    border
		    style="width: 100%">
		    
		  <el-table-column
              prop="name"
              label="关联用户">
            </el-table-column>
		    <el-table-column
		      prop="loginClient"
		      label="登录坐席"
		      width="120">
		    </el-table-column>
		    <el-table-column
		      prop="clientNo"
		      label="坐席编号"
		      width="120">
		    </el-table-column>
		    <el-table-column
		      prop="accountNo"
		      label="账户编号">
		    </el-table-column>
               <el-table-column
              prop="secretKey"
              label="秘钥">
            </el-table-column>
               <el-table-column
              prop="phone1"
              label="手机号1">
            </el-table-column>
               <el-table-column
              prop="phone2"
              label="手机号2">
            </el-table-column>
               <el-table-column
              prop="proxyurl"
              label="PROXYURL">
            </el-table-column>
		  </el-table>
           
            <span slot="footer" class="dialog-footer">
			    <el-button type="primary" @click="submitUploadClient" :disabled="uploadBtnDisabled">{{uploadBtnText}}</el-button>
			  </span>  
     </el-dialog>

      <el-dialog title="部分导入失败" :visible.sync="uploadErrorDialogVisible" :show-close=false>
           以下内容导入失败，请重新导入    
           <el-table
            :data="uploadErrorData"
            height="250"
            border
            
            style="width: 100%">
              <el-table-column
			      type="index"
			      label="序号"
			      width="50">
			    </el-table-column>
            <el-table-column
              prop="clientNo"
              label="坐席号"
              width="180">
            </el-table-column>
            <el-table-column
              prop="bindPhone"
              label="TELA(绑定电话)"
              width="180">
            </el-table-column>
            <el-table-column
              prop="displayPhone"
              label="TELX(回显号)">
            </el-table-column>
              <el-table-column
              prop="callbackPhone"
              label="回呼号码">
            </el-table-column>
          </el-table>
          
          <span slot="footer" class="dialog-footer">
                <el-button type="primary" @click="clickMeKown">知道了</el-button>
              </span>  
     </el-dialog>

</div>
</body>
<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>
<script th:inline="javascript">
    var orgList = [[${orgList}]];
</script>

<!-- 当前页面的js -->
<script th:src="@{/js/custom/client/qimo_client.js?v=1.0.0}"></script>
</html>