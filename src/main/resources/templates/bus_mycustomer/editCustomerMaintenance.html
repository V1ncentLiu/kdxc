<!DOCTYPE html>
<html>
<head th:include="_header_include::frag(~{::title},~{::style},~{})" >
    <title>维护客户</title>
    <meta charset="UTF-8">
    <style type="text/css">
        .input70 .el-input{width: 70%;}
        .input100 .el-input--suffix{width: 100%;}
    </style>
</head>
<body>
<div id="addCustomer" class="addCustomer mainPadding" style="display: none;"> 
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>商务管理</el-breadcrumb-item>
        <el-breadcrumb-item>维护客户</el-breadcrumb-item>
    </el-breadcrumb> 
    
    <el-row class="borderbox input70">
        <!--<div class="inforTitle">维护客户</div> -->
        <el-form :model="form" :rules="rules" ref="form" class="padding20">
            <div class="marginB20 fs16">资源信息 <span style="padding-left: 20px; color: red;">资源ID{{clueId}}</span></div>
            <div class="borderbox padding20">
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="资源类型：" :label-width="formLabelWidth">
                            <span>{{clueBase.typeName}}</span>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="资源类别：" :label-width="formLabelWidth">
                            <span>{{clueBase.categoryName}}</span>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="留言时间：" :label-width="formLabelWidth">
                            <span>{{this.formatTimeFn(clueBase.messageTime)}}</span>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="留言重点：" :label-width="formLabelWidth">
                            <span class="breakWord">{{clueBase.messagePoint}}</span>
                        </el-form-item>
                    </el-col>                
                    <el-col :span="8">
                        <el-form-item label="搜索词：" :label-width="formLabelWidth">
                            <span>{{clueBase.searchWord}}</span>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                      <el-form-item label="地域信息：" :label-width="formLabelWidth">
                        <span>{{intention.address}}</span>
                      </el-form-item>
                    </el-col>
                </el-row>
                <el-row>                
                    <el-col :span="24">
                      <el-form-item label="备注：" :label-width="formLabelWidth">
                        <span class="breakWord">{{clueBase.remark}}</span>
                      </el-form-item>
                    </el-col>
                </el-row>
            </div>

            <div class="marginB20 fs16 paddingT20">基本信息</div>
            <div class="borderbox padding20">
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="客户姓名：" prop="customerName" :label-width="formLabelWidth">
                           <el-input v-model="form.customerName" autocomplete="off" maxLength="10"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="客户级别：" :label-width="formLabelWidth">
                            <el-select v-model="form.customerLevel" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                        v-for="item in customerLevelArr"
                                        :key="item.value"
                                        :label="item.name"
                                        :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="客户联系电话：" prop="customerPhone" :label-width="formLabelWidth">
                            <el-input v-model="form.customerPhone" autocomplete="off" maxLength="11"></el-input>
                        </el-form-item>
                    </el-col>                
                </el-row>
               <!-- <el-row>
                    <el-col :span="8">
                      <el-form-item label="微信：" prop="wechat" :label-width="formLabelWidth">
                        <el-input v-model="form.wechat" autocomplete="off" maxLength="20"></el-input>
                        <span v-if="form.wechat2 || form.wechatUrl">
                                <span @click="openWechat" style="padding-left: 5px; color: rgb(0, 114, 255); cursor: pointer;">查看多个微信/二维码</span>
                            </span>
                        <span v-else="">
	                           <el-button type="primary" size="mini" @click="openWechat"><i class="el-icon-plus"></i>微信/二维码</el-button>
                            </span>
                      </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="QQ：" :label-width="formLabelWidth">
                            <el-input v-model="form.qq" autocomplete="off" maxLength="20" @keyup.native="qqnumber"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="邮箱：" prop="customerEmail" :label-width="formLabelWidth">
                           <el-input v-model="form.customerEmail" autocomplete="off" maxLength="30"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>-->
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="性别：" :label-width="formLabelWidth">
                           <el-select v-model="form.customerSex" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in optsex"
                                    :key="item.value"
                                    :label="item.label"
                                    :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="年龄：" :label-width="formLabelWidth">
                            <el-input v-model="form.customerAge" autocomplete="off" maxLength="3" @keyup.native="agenumber" ></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="职业：" :label-width="formLabelWidth">
                           <el-select v-model="form.customerJob" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in occupationArr"
                                    :key="item.value"
                                    :label="item.name"
                                    :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>                
                </el-row>
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="餐饮经验：" :label-width="formLabelWidth">
                            <el-select v-model="form.experience" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                        v-for="item in CateringExperienceArr"
                                        :key="item.value"
                                        :label="item.name"
                                        :value="item.value">
                                </el-option>
                            </el-select>
                            <el-input
                                    v-model="form.cateringType"
                                    v-show="form.experience!=''&&form.experience!='0'"
                                    autocomplete="off"
                                    maxLength="50"
                                    placeholder="请输入曾从事餐饮类型"
                                    style="margin-top:10px;"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="选址情况：" :label-width="formLabelWidth">
                            <el-select v-model="form.address" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                        v-for="item in optionAddressArr"
                                        :key="item.value"
                                        :label="item.name"
                                        :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="合伙人：" :label-width="formLabelWidth">
                            <el-select v-model="form.customerPartner" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                        v-for="item in partnerArr"
                                        :key="item.value"
                                        :label="item.name"
                                        :value="item.value">
                                </el-option>
                            </el-select>
                            <el-input
                                    v-model="form.customerPartnerDetail"
                                    v-show="form.customerPartner!=''&&form.customerPartner!='1'"
                                    autocomplete="off"
                                    maxLength="30"
                                    placeholder="请输入合伙人姓名以及联系方式"
                                    style="margin-top:10px;"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="决策人：" :label-width="formLabelWidth">
                            <el-radio-group v-model="form.decisionMaker">
                                <el-radio label="1">自己本人</el-radio>
                                <el-radio label="2">他人</el-radio>
                            </el-radio-group>
                           <el-input 
                            v-model="form.decisionMakerOther" 
                            v-show="form.decisionMaker!=''&&form.decisionMaker!='1'"
                            autocomplete="off" 
                            maxLength="30" 
                            placeholder="姓名+联系方式"
                            style="margin-top:10px;"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="出资人：" :label-width="formLabelWidth">
                            <el-radio-group v-model="form.sponsor">
                                <el-radio label="1">自己本人</el-radio>
                                <el-radio label="2">他人</el-radio>
                            </el-radio-group>
                            <el-input
                                    v-model="form.sponsorOther"
                                    v-show="form.sponsor!=''&&form.sponsor!='1'"
                                    autocomplete="off"
                                    maxLength="30"
                                    placeholder="姓名+联系方式"
                                    style="margin-top:10px;"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
            </div>
            <div class="marginB20 fs16 paddingT20">投资意向信息</div>
            <div class="borderbox padding20">
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="投资金额：" :label-width="formLabelWidth">
                           <el-select v-model="form.money" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in ussmArr"
                                    :key="item.value"
                                    :label="item.name"
                                    :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="店面大小：" :label-width="formLabelWidth">
                           <el-select v-model="form.area" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in StorefrontAreaArr"
                                    :key="item.value"
                                    :label="item.name"
                                    :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="意向品类：" :label-width="formLabelWidth">
                           <el-select v-model="form.intentionCategory" filterable placeholder="请选择" @change="projectChangeSelect1" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in IntentionalCategoryArr" :key="item.value" :label="item.name" :value="item.value">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>                
                </el-row>
                <el-row>
                    <el-col :span="8">
                        <el-form-item label="意向项目：" :label-width="formLabelWidth">
                            <!--<el-radio v-model="form.radioProject" label="1" @change="projectChange" style="margin-right: 10px;">内部项目</el-radio>-->
                            <el-select v-model="form.insideProject" filterable v-show="insideProjectShow" placeholder="请选择" style="width: 100%;" clearable>
                                <el-option
                                    v-for="item in proSelect" :key="item.id" :label="item.projectName"  :value="item.id">
                                </el-option>
                            </el-select>
                           <!-- <el-radio v-model="form.radioProject" label="2" @change="projectChange" style="margin-right: 10px;">外部项目</el-radio>
                            <el-input v-model="form.outsideProject" v-show="outsideProjectShow" autocomplete="off" style="width: 25%;" maxLength="20"></el-input>-->
                        </el-form-item>
                    </el-col>
                    <el-col :span="8">
                        <el-form-item label="开店紧迫性：" :label-width="formLabelWidth">
                            <!-- <el-input v-model="form.urgency" autocomplete="off" style='width: 60%;'> -->
                            <el-date-picker
                                    style='width: 60%;'
                                    v-model="form.urgency"
                                    type="month"
                                    placeholder="选择月">
                            </el-date-picker>
                            </el-input><span style="padding-left: 5px;">之前启动</span>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="16" class="input100">
                        <el-form-item label="开店区域：" :label-width="formLabelWidth" style="float: left;">
                           <el-select v-model="form.province" placeholder="省" style="width: 180px;margin-right: 10px;"  @change="changeProvince" clearable>
                                <el-option
                                    v-for="item in provinceArr"
                                    :key="item.name"
                                    :label="item.name"
                                    :value="item.name">
                                </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="" style="float: left;">
                           <el-select v-model="form.city" placeholder="市" style="width: 180px;margin-right: 10px;" @change="changeCity" clearable>
                                <el-option
                                    v-for="item in cityArr"
                                    :key="item.name"
                                    :label="item.name"
                                    :value="item.name">
                                </el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="" style="float: left;">
                           <el-select v-model="form.district" placeholder="区/县" style="width: 180px;" clearable>
                                <el-option
                                    v-for="item in districtArr"
                                    :key="item.name"
                                    :label="item.name"
                                    :value="item.name">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="24">
                        <el-form-item label="是否在考虑同行业：" :label-width="formLabelWidth" style="width: 270px;float: left;">
                            <el-radio v-model="form.radioSelect" label="0" @change="professionChange">否</el-radio>
                            <el-radio v-model="form.radioSelect" label="1" @change="professionChange">是</el-radio>
                        </el-form-item>
                          <span v-if="domainShow">
                            <el-form-item
                                style="width: 270px;float: left;margin-right: 10px;" v-for="(domain, index) in form.domains" :key="domain.key" :prop="'domains.' + index + '.value'" :rules='rules.domainsValue'
                                  >
                                <el-input v-model="domain.value" placeholder="输入品牌名称" maxLength="15" style="width: 210px;float: left;"></el-input><el-button @click.prevent="removeDomain(domain)" type="danger">删除</el-button>
                            </el-form-item>
                            <el-button type="primary" @click="addDomain" style="margin-top: 5px;"><i class="el-icon-plus"></i></el-button></el-input>
                        </span>
                    </el-col>
                </el-row>
            </div>
            <div class="marginB20 fs16 paddingT20">上传资料</div>
     <!--        <el-row class="marginB10">
                <el-col :span="16" >
                    <el-button size="small" type="danger" @click="deteleClueFile">删除</el-button>
                    <el-button type="text" disabled>只允许上传图片／音频文件。</el-button>
                </el-col>
    			<div id="container" class="f-fr">
    				<a id="selectfiles" href="javascript:void(0);" class='btn'>选择文件</a>
    				<a id="postfiles" href="javascript:void(0);" onclick="clueUploadFile()" class='btn'>开始上传</a>
    			</div>
		        <div id="ossfile">你的浏览器不支持flash,Silverlight或者HTML5！</div>
		        <span v-show="false">上传到指定目录:<input type="text" id='dirname' placeholder="如果不填，默认是上传到根目录" size=50></span>
		        <pre id="console"></pre>
		    </el-row> -->
            <el-row>
                <el-table
                    ref="multipleTable"
                    :data="tableDataC1"
                    tooltip-effect="dark"
                    style="width: 100%"
                    border
                    @selection-change="handleFileSelectionChange"
                 >
                    <el-table-column
                      type="selection"
                       prop="id"
                      width="55"
                      @selection-change="handleFileSelectionChange"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="uploadUserName"
                      label="上传人姓名"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="uploadTime"
                      label="上传时间"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="fileName"
                      label="文件名称"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      label="操作"
                      align="center">
                      <template slot-scope="scope">
                        <!-- <el-button
                            size="mini"
                            type="text"
                            @click="handleOperateFn(scope.$index, scope.row)">
                            {{ scope.row.operate }}
                        </el-button> -->
                        <el-button size="mini" type="text" @click="handleOperateFn(scope.$index, scope.row)">
                            <!-- {{scope.row.fileType=="mp3"? '下载录音':'查看图片'}}  -->
                            {{scope.row.fileType !=="jpg" && scope.row.fileType !=="png" && scope.row.fileType !=="jpeg" && scope.row.fileType !=="gif" && scope.row.fileType !=="bmp"? '下载录音':'查看图片'}}
                        </el-button>
                      </template>
                    </el-table-column>
                    <el-table-column
                      prop="delStatus"
                      label="删除状态"
                      align="center">
                   <template slot-scope="scope">
                      <div v-if="scope.row.delStatus === 0">
                                                                               未删除
                      </div>
                       <div v-else-if="scope.row.delStatus ===1">
                                                                               已删除
                       </div>
                     </template>
                    </el-table-column>
                </el-table>
            </el-row>

            <div class="marginB20 fs16 paddingT20">跟进记录</div>
            <!--  
            <el-row>
                <el-col :span="16" class="paddingTB">
                    <el-button size="small" type="danger" @click="deteleTracking">删除</el-button>
                    <el-button size="small" type="info" @click="editRecord">编辑</el-button>
                </el-col>
                <el-col :span="4" :offset="4" class="f-tar">
                    <el-button size="small" type="primary" @click="lineFormShow=true">添加</el-button>
                </el-col>
            </el-row>
            -->
            <el-row>
                <el-table
                    ref="multipleTable"
                    :data="tableDataC2"
                    tooltip-effect="dark"
                    style="width: 100%"
                    border
                    @selection-change="handleTrackingSelection"
                 >
                    <el-table-column
                            type="index" label="序号"
                            header-align="center" align="center" width="100">
                    </el-table-column>
                    <el-table-column
                      prop="callTime"
                      label="拨打时间"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="customerStatusName"
                      label="客户状态"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="isCall"
                      label="是否接通"
                      align="center">
                     <template slot-scope="scope">
                      <div v-if="scope.row.isCall === 0">
                                                                                未接通
                      </div>
                       <div v-else-if="scope.row.isCall ===1">
                                                                                已接通
                       </div>
                     </template>
                    </el-table-column>
                    <el-table-column
                      prop="focusPoint"
                      label="客户关注点"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="nextVisitTime"
                      label="下次回访时间"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="createUserName"
                      label="创建人"
                      align="center">
                    </el-table-column>
                    <div slot="append" v-show="lineFormShow">
                      <el-form :inline="true" :model="formInline" class="demo-form-inline">
                        <el-row class="paddingL55">
                              <el-date-picker
                                v-model="formInline.callTime"
                                type="datetime"
                                size="mini"
                                placeholder="选择日期时间">
                              </el-date-picker>
                              <el-form-item label="" size="mini">
                                <el-select v-model="formInline.customerStatus" placeholder="客户状态">
                                 <el-option
			                        v-for="item in cusStatusArr"
			                        :key="item.value"
			                        :label="item.name"
			                        :value="item.value">
			                    </el-option>
                                </el-select>
                              </el-form-item>
                              <el-form-item label="" size="mini">
                                <el-select v-model="formInline.isCall" placeholder="是否接通">
                                  <el-option label="是" value="1"></el-option>
                                  <el-option label="否" value="0"></el-option>
                                </el-select>
                              </el-form-item>
                              <el-form-item label="" size="mini">
                                <el-select v-model="formInline.resourceStatus" placeholder="无效资源">
                                  <el-option label="无效资源" value="0"></el-option>
                                  <el-option label="有效资源" value="1"></el-option>
                                </el-select>
                              </el-form-item>
                              <el-form-item label="" size="mini">
                                <el-input v-model="formInline.focusPoint" size="mini" placeholder="客户关注点" maxlength="1000"></el-input>
                              </el-form-item>
                              <el-date-picker
                                v-model="formInline.nextVisitTime"
                                type="datetime"
                                format="yyyy-MM-dd HH:mm"
                                size="mini"
                                placeholder="选择日期时间">
                              </el-date-picker>
                                  <el-form-item  class="lineInherit">
                                <el-button type="primary" size="mini" @click="onConfirmAdd">确认添加</el-button>
                              </el-form-item>
                        </el-row>
                      </el-form>
                    </div>
                </el-table>
            </el-row>
            <div class="marginB20 fs16 paddingT20 callLogBox">
                通话记录
                <!-- 播放器 -->
                <audio id="audio" src="" controls="controls" autoplay="autoplay" controlsList="nodownload" oncontextmenu="return false" v-show="audioShow"></audio>
            </div>
            <el-table ref="multipleTable" :data="tableDataC3" tooltip-effect="dark" style="width: 100%" border @selection-change="handleSelectionChange">
                <el-table-column type="index" width="55" label="序号" align="center"></el-table-column>
                <el-table-column prop="accountName" label="姓名" align="center"></el-table-column>
                <el-table-column prop="roleName" label="角色" align="center"></el-table-column>
                <el-table-column prop="callType" label="通话类型" align="center"></el-table-column>
                <el-table-column prop="startTime" label="拨打时间" :formatter="getStartTimeText"  align="center"></el-table-column>
                <el-table-column prop="callStatus" label="接通情况" align="center"></el-table-column>
                <el-table-column prop="talkTime" label="接通时长"  :formatter="getTalkTimeText"  align="center"></el-table-column>
                <el-table-column label="操作" align="center">
                    <template slot-scope="scope" v-if="scope.row.talkTime >0 ">
                        <a :id="scope.row.id" class="sound-trigger sound-trigger--type-default sound-trigger--type-click cursorP" @click="switchSoundBtn(scope.row.id,scope.row.recordFile,scope.row.callSource)">
                            <span class="sound-trigger__inner"><i class="fa fa-play-1 fa-lg"></i></span>
                        </a>

                        <a  class="download_img cursorP" v-if="scope.row.accountId==loginUserId" @click="downloadAudio(scope.row.id,scope.row.recordFile,scope.row.callSource)"></a>
                    </template>
                </el-table-column>
            </el-table>
            <div class="marginB20 fs16 paddingT20">流转人员</div>
            <el-row>
                <el-table
                    ref="multipleTable"
                    :data="tableDataC4"
                    tooltip-effect="dark"
                    style="width: 100%"
                    border
                    @selection-change="handleSelectionChange"
                 >
                    <el-table-column
                      type="index"
                      width="55"
                      label="序号"
                      align="center">
                    </el-table-column>
                    <el-table-column
                      prop="roleName"
                      label="角色"
                      align="center">
                    </el-table-column>
                    <el-table-column
                            prop="orgName"
                            label="所属组(组名)"
                            align="center">
                    </el-table-column>
                    <!--<el-table-column-->
                      <!--prop="userName"-->
                      <!--label="服务人员姓名"-->
                      <!--align="center">-->
                    <!--</el-table-column>-->
                    <!--<el-table-column-->
                      <!--prop="telRuleValue"-->
                      <!--label="分配规则（名称）"-->
                      <!--align="center">-->
                    <!--</el-table-column>-->
                    <el-table-column
                      prop="createTime"
                      label="开始服务时间"
                      align="center">
                    </el-table-column>
                </el-table>
            </el-row>
            <div class="padding20 f-tac">            
                <el-button type="primary" :disabled="btnDisabled" @click="submitForm('form')">提交资料</el-button>
               
                <el-button @click="rebackClue">取 消</el-button>
            </div> 
        </el-form> 
    </el-row>

    <!-- dialog -->
    <el-dialog title="添加手机号" :visible.sync="dialogFormVisible">
        <el-form :model="dialogForm" :rules="dialogRules" ref="dialogForm">
            <el-form-item label="手机号2：" :label-width="formLabelWidth">
                <span>15111111111</span>
                <span><i class="el-icon-phone-outline" style="font-size: 20px;color: rgb(0, 114, 255);cursor: pointer;"></i></span>
            </el-form-item>
            <el-form-item label="手机号3：" prop="phoneNum" :label-width="formLabelWidth">
                <el-input v-model="dialogForm.phoneNum" autocomplete="off" style="width: 60%;"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="f-tac">            
            <el-button type="primary" @click="submitDialogForm('dialogForm')">提 交</el-button>
            <el-button @click="dialogFormVisible = false">取 消</el-button>
        </div>
    </el-dialog> 
    <!-- dialog -->
  <el-dialog title="添加微信" :visible.sync="wechatVisible" width="540px">
    <template>
      <el-form :model="wechatForm" ref="wechatForm" >
        <el-form-item label="微信2：" :label-width="formLabelWidth1" >
          <el-input v-model="wechatForm.wechat2" placeholder="" maxLength="20" style="width: 290px;"></el-input>
        </el-form-item>
        <el-form-item label="添加微信二维码：" :label-width="formLabelWidth1" prop="fileList">
          <el-upload
              class="upload-demo"
              :action="uploadOssHost"
              ref="refundApplyImgUpload"
              :on-preview="handlePreview"
              :on-remove="handleRemove"
              :on-success="handleSuccess"
              :on-error="handleError"
              :before-upload="handleBefore"
              accept=".jpg,.png"
              multiple
              :data="uploadParamData"
              :limit='1'
              :on-change="selectFile"
              :on-exceed="handleExceed"
              :auto-upload="false"
              :file-list="fileList">
            <el-button slot="trigger" size="small" type="primary">选择图片</el-button>
            <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传</el-button>
            <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过2MB</div>
          </el-upload>
        </el-form-item>
        <el-form-item label="" :label-width="formLabelWidth1" >
          <img v-show="wechatForm.wechatUrl!=''" :src="wechatForm.wechatUrl" width="290px" style="border-radius:6px;">
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="wechatSumbit()">提 交</el-button>
        <el-button  @click="wechatVisible=false">取 消</el-button>
      </div>
    </template>
  </el-dialog>
    <!-- 上传资源dialog -->
    <el-dialog title="查看图片" :visible.sync="dialogFormUploadImg">
    <div class="padding20" style="text-align: center;">
        <img :src="dialogFormUploadImgSrc" alt=""
            style="width: 250px; height: 250px;">
    </div>
    </el-dialog>    
</div>
<link rel="stylesheet" href="/css/common/uploadStyle.css">
<style type="text/css">
		.lineFeed { width: 230px; word-break:break-all; word-wrap: break-word; color: #c0c4cc; cursor:not-allowed; }
		.lineFeed2 { width: 530px; }
        .paddingTB { padding: 4px 0px; }
        .paddingL55 { padding-left: 55px; }
        .el-form-item.lineInherit .el-form-item__content{ line-height: inherit!important; }
        @media screen and (width:1920px) {
            .paddingL55 .el-date-editor.el-input { width: 218px; }
            /*.paddingL55 div.el-form-item:nth-of-type(2) { width: 100px; }*/
            .paddingL55 div.el-form-item, .paddingL55 .el-input--mini .el-input__inner { width: 202px; }
            .paddingL55 div.el-form-item:last-child { width: 186px; text-align: center; }
        }
        @media screen and (width: 1190px) {
            .paddingL55 { line-height: 28px; }
            .paddingL55 .el-date-editor.el-input { width: 122px; }
            /*.paddingL55 div.el-form-item:nth-of-type(2) { width: 100px; }*/
            .paddingL55 div.el-form-item, .paddingL55 .el-input--mini .el-input__inner { width: 120px; }
            .el-form--inline .el-form-item { margin-right: 0!important; }
            .paddingL55 div.el-form-item:last-child { width: 106px; text-align: center; }
        }
		@media screen and (width: 1744px) {
            .paddingL55 { line-height: 28px; }
            .paddingL55 .el-date-editor.el-input { width: 184px; }
            /*.paddingL55 div.el-form-item:nth-of-type(2) { width: 100px; }*/
            .paddingL55 div.el-form-item, .paddingL55 .el-input--mini .el-input__inner { width: 202px; }
            .el-form--inline .el-form-item { margin-right: 0!important; }
            .paddingL55 .el-input--mini .el-input { top: -3px; }
            .paddingL55 div.el-form-item:last-child { width: 146px; text-align: center; }
        }
        .fa-play-1 {
            width: 34px;
            height: 34px;
            display: inline-block;
            background-image: url(/images/icon_play.png);
            background-repeat: no-repeat;
        }
        .fa-stop-1 {
            width: 34px;
            height: 34px;
            display: inline-block;
            background-image: url(/images/icon_stop.png);
            background-repeat: no-repeat;
        }
        .download_img {
            width: 34px;
            height: 34px;
            display: inline-block;
            background-image: url(/images/icon_download.png);
            background-repeat: no-repeat;
        }
    </style>
</body>
<div th:include="_footer_include :: #jsLib"></div>
<script src="/js/common/download.js"></script>
<script th:src="@{/js/custom/callrecord/download.js?v=1.0.0}"></script>
<script th:inline="javascript" >
var clueId=[[${clueId}]];//资源ID
var customer=[[${customer}]];//客户信息
var base=[[${base}]];//资源基本信息
var intention=[[${intention}]];//资源投资意向信息
var proSelect=[[${proSelect}]];//项目
var circulationList=[[${circulationList}]];//资源流转记录
var trackingList=[[${trackingList}]];//跟访记录
var isEdit=false;
var clueFileList=[[${clueFileList}]];//上传文件
var ossUrl = [[${ossUrl}]];//上传文件地址
var callRecord=[[${callRecord}]];//上传文件
var loginUserId=[[${loginUserId}]];

// var vphone="";
// var vphone2="";
// var vphone3="";
// var vphone4="";
// var vphone5="";
// if(customer.phone){
//   vphone = customer.phone;
// }
// if(customer.phone2){
//   vphone = customer.phone2;
// }
// if(customer.phone3){
//   vphone = customer.phone3;
// }
// if(customer.phone4){
//   vphone = customer.phone4;
// }
// if(customer.phone5){
//   vphone = customer.phone5;
// }

 var addCustomerVM=   new Vue({
        el: '#addCustomer',
        data: function() {
            return {
                audioShow:false,//播放器默认不显示
                btnDisabled: false,    
                clueId:clueId,
                loginUserId:loginUserId,
                wechatVisible: false,//新增微信号
                dialogFormUploadImg: false, //上传资源图片弹框
                dialogFormUploadImgSrc: '', //上传资源图片弹框
                domainShow:false,//默认不显示输入同行品牌名称    
                insideProjectShow:true,//内部项目默认显示
                outsideProjectShow:false,//外部项目默认不显示
                dialogFormVisible: false,
                dialogFormImg:false,
//                showwchatcode:'',
//                showWxCodeFalg:false,
                form: {
                    domains: [],
                    radioSelect:'0',//是否考虑同行业
                    radioProject:'1', //意向项目单选默认选项                    
                    customerName:'',
                    customerPhone:'',
                    phone:"",
                    phone2:"",
                    phone3:"",
                    phone4:"",
                    phone5:"",
                    customerEmail:'', //邮箱
                    cateringType: '',//曾经从事餐饮类型
                    sponsor:'1', //出资人
                    sponsorOther:'',//其它出资人的姓名及联系方式
                    decisionMaker: '1',//决策人
                    decisionMakerOther: '',//其它决策人的姓名及联系方式
                    customerPartnerDetail: '',//合伙人姓名及联系方式
                    customerSex:'',
                    wechat:'',
                    wechat2:'',
                    wechatUrl:'',
                    experience:'',
                    customerAge:'',
                    customerJob:'',
                    customerPartner:'',
                    address:'',
                    urgency:'',
                    customerLevel:'',
                    qq:'',
                    money:'',
                    area:'',
                    intentionCategory:'',
                    insideProject:'',
                    outsideProject:'',
                    province:'',
                    city:'',
                    district:''                   
                },
              wechatForm: {
                wechat2:'',
                wechatUrl:'',
                fileList:[]
              },
                clueBase:base,
                intention:intention,
                categoryArr:[],
                typeArr:[],
                mediumArry:[],
                adsenseArr:[],
                CateringExperienceArr:[],
                occupationArr:[],
                partnerArr:[],
                optionAddressArr:[],
                customerLevelArr:[],
                IntentionalCategoryArr:[],
                ussmArr:[],
                StorefrontAreaArr:[],
                provinceArr:[],
                cityArr:[],
                districtArr:[],
                proSelect:proSelect,
                formLabelWidth: '120px',
              formLabelWidth1: '140px',
                rules:{
                    // customerName: [
                    //     { required: true, message: '客户姓名不能为空', trigger: 'blur' }
                    // ],
                    customerPhone: [
                        /* { required: true, message: '手机号不能为空', trigger: 'blur' }, */
                        { validator:function(rule,value,callback){ 
                            if(value){
                                if(/^[0-9]*$/.test(value) == false){
                                   callback(new Error("请输入数字"));
                                }else{
                                   callback();
                                } 
                            }                            
                            callback();
                        }, trigger: 'blur'}
                    ],
                    customerEmail: {
                        validator:function(rule,value,callback){                 
                            if(value&&(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(value) == false) ){
                               callback(new Error("请输入正确的邮箱格式"));
                            }else{
                               callback();
                            } 
                            callback();
                        }, trigger: 'blur'
                    },
                },
                statusOptions: [{
                    value: '0',
                    label: '推广列表'
                }, {
                    value: '1',
                    label: '电销列表'
                }],
                optsex: [{
                    value: '1',
                    label: '男'
                }, {
                    value: '2',
                    label: '女'
                }],
                options1: [{
                    value: '0',
                    label: '电销组'
                }, {
                    value: '1',
                    label: '媒介'
                }],
                dialogForm: {
                    phoneNum:''
                },
                dialogRules:{
                    phoneNum: [
                        { required: true, message: '请输入手机号码', trigger: 'blur' }
                    ]
                },
                multipleSelection:[],//上传资料
                multipleTrackingSelection:[],
                multipleFileSelection:[],
                fileList: [],
                cusStatusArr:[],
                tableDataC1: clueFileList,//文件记录
                dialingTime:'',//跟进记录
                lineFormShow: false,
                formInline: { 
                	id:'',
                	callTime: '',
                	customerStatus: '未建立联系',
                	isCall:'',
                	resourceStatus:'',
                	focusPoint:'',
                	visitStatus:'是',
                	nextVisitTime:'',
                },
              uploadOssHost:'',
              uploadParamData: {
                key:'22',
                policy:'',
                OSSAccessKeyId:'',
                success_action_status : '200', //让服务端返回200,不然，默认会返回204
                signature:'',
                'x:params':'',
                'realName':''
              },
              ossUrl:ossUrl,
              limit:1,
                tableDataC2: trackingList,//跟进记录
                tableDataC3: callRecord,  //通话记录
                tableDataC4:circulationList//流转记录
            }             
        },
        methods: {
          getUploadParam(){
            var signUrl = this.ossUrl+"?serviceType=aggregation";
            var param={};

            axios.get(signUrl, param)
            .then(function (response) {
              // console.info(response);
              var respData= response.data;
              var host = respData.host;
              var params={};
              var new_multipart_params = {
                dir:respData.dir,
                'policy': respData.policy,
                'OSSAccessKeyId': respData.accessid,
                'success_action_status' : '200', //让服务端返回200,不然，默认会返回204
                'signature': respData.signature,
                'x:params':params,//自定义编码，basse64编码后的字符串,
                'realName':''
              };
              addCustomerVM.uploadParamData= new_multipart_params;
              addCustomerVM.uploadOssHost = host;
            })
            .catch(function (error) {
              console.log(error);
            });
          },
          selectFile(file, fileList){
            addCustomerVM.uploadParamData.key= addCustomerVM.uploadParamData.dir+addCustomerVM.random_string(10)+addCustomerVM.get_suffix(file.name),
                addCustomerVM.uploadParamData.realName= file.name
          },
        	formatTimeFn(date) {
        	    if(date){
                    var dateNew = new Date( date );
                    var year = dateNew.getFullYear()
                    var month = dateNew.getMonth() + 1
                    var day = dateNew.getDate()
                    var hour = dateNew.getHours()
                    var minute = dateNew.getMinutes()
                    var second = dateNew.getSeconds()
                    return year+"-"+this.formatNumberFn(month)+"-"+this.formatNumberFn(day)+" "+this.formatNumberFn(hour)+":"+this.formatNumberFn(minute)+":"+this.formatNumberFn(second);
                }
       		},
        	formatNumberFn(n) {
       		  n = n.toString()
       		  return n[1] ? n : '0' + n
       		},

            projectChangeSelect1(selVal) {
                addCustomerVM.form.insideProject = '';
               this.projectChangeSelect(selVal);
            },

            projectChangeSelect(selVal) {
                var param = {};
                param.category = selVal;
                axios.post('/aggregation/projectManager/listNoPage', param).then(function (response) {
                    addCustomerVM.proSelect = response.data.data;
                });
            },

            switchSoundBtn(id,url,callSource){
                // 播放器显示
                // this.audioShow=true;
                if(callSource=='2'){
                    // switchSound(id,url);
                    window.parent.open(url)
                    return;
                }
                var newWindow = window.open();
                var param = {};
                param.id=id;
                axios.post('/call/callRecord/getRecordFile',param)
                    .then(function (response) {
                        var data =  response.data
                        if(data.code=='0'){
                            var url = data.data;
                            // switchSound(id,url);
                            newWindow.location.href = url;
                        }else{
                            console.error(data);
                            addCustomerVM.$message({message:data.msg,type:'error'});
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    }).then(function(){
                });
            },
            getTalkTimeText(row, column, value, index){
                var valText="";
                if(value){
                    valText =  this.formatSeconds(value);
                }
                return valText;
            },
            formatSeconds(s){
                var t="";
                var hour = Math.floor(s/3600);
                var min = Math.floor(s/60) % 60;
                var sec = s % 60;
                if(hour<10){
                	t+="0";
                }
                t+=hour+":";
                if(min < 10){
                    t += "0";
                }
                t += min + ":";
                if(sec < 10){
                    t += "0";
                }
                t+=sec;
                // t += sec.toFixed(2);
                return t;
            },
            downloadAudio(id,url,callSource){
                var param = {};
                param.id=id;
                axios.post('/call/callRecord/getRecordFile', param)
                    .then(function (response) {
                        var data = response.data;
                        if (data.code == '0') {
                            var url = data.data;
                            if (url) {
                                var fileName = url.split('?')[0];
                                var fileNameArr = fileName.split("/");
//                                download(url, fileNameArr[fileNameArr.length - 1]);
                                var x=new XMLHttpRequest();
                                x.open("GET", url, true);
                                x.responseType = 'blob';
                                x.onload=function(e){download(x.response, fileNameArr[fileNameArr.length-1], 'audio/\\*' ); }
                                x.send();
                            }

                        }else{
                            console.error(data);
                            addCustomerVM.$message({message:data.msg,type:'error'});
                        }

                    })
                    .catch(function (error) {
                        console.log(error);
                    }).then(function(){
                });

            },
            getStartTimeText(row, column, value, index){
                var valText="";
                if(value){
                  valText =  moment.unix(Number(value)).format("YYYY-MM-DD HH:mm:ss");
                }
                return valText;
            },
            submitForm(form) {
                this.$refs[form].validate((valid) => {
                    if (valid) {
                       //----客户基本信息---//
                      var clueCustomer={};
                 	    if(customer){
                        clueCustomer = customer;
                      }
                      	 //客户姓名
                    	var  customerName=this.form.customerName;
                    	clueCustomer.cusName=customerName;
                   	    //手机号
                    	var  customerPhone=this.form.customerPhone;
                    	clueCustomer.linkPhone=customerPhone;
                    	clueCustomer.phoneCreateUser=null;
                    	clueCustomer.phoneCreateTime=null;
                    	clueCustomer.phone2CreateUser=null;
                    	clueCustomer.phone2CreateTime=null;
                    	clueCustomer.phone3CreateUser=null;
                    	clueCustomer.phone3CreateTime=null;
                    	clueCustomer.phone4CreateUser=null;
                    	clueCustomer.phone4CreateTime=null;
                    	clueCustomer.phone5CreateUser=null;
                    	clueCustomer.phone5CreateTime=null;

                        clueCustomer.wechatCreateUser=null;
                        clueCustomer.wechatCreateTime=null;
                        clueCustomer.wechatUpdateUser=null;
                        clueCustomer.wechatUpdateTime=null;
                        clueCustomer.wechat2UpdateUser=null;
                        clueCustomer.wechat2UpdateTime=null;
                        clueCustomer.wechat2CreateUser=null;
                        clueCustomer.wechat2CreateTime=null;
                        clueCustomer.qqCreateUser=null;
                        clueCustomer.qqCreateTime=null;
                        clueCustomer.qqUpdateUser=null;
                        clueCustomer.qqUpdateTime=null;
                        clueCustomer.emailCreateUser=null;
                        clueCustomer.emailCreateTime=null;
                        clueCustomer.emailUpdateUser=null;
                        clueCustomer.emailUpdateTime=null;
                        clueCustomer.wechatCodeCreateUser=null;
                        clueCustomer.wechatCodeCreateTime=null;
                        clueCustomer.wechatCodeUpdateUser=null;
                        clueCustomer.wechatCodeUpdateTime=null;
                   	    //性别
                    	var customerSex=this.form.customerSex;
                    	clueCustomer.sex=customerSex;
                      //微信
                      var wechat = this.form.wechat;
                      clueCustomer.wechat = wechat;
                      //微信2
                      var wechat2 = this.form.wechat2;
                      clueCustomer.wechat2 = wechat2;
                      //微信二维码
                      var wechatUrl = this.form.wechatUrl;
                      clueCustomer.wechatCode = wechatUrl;
                	    //餐饮经验
                    	var experience=this.form.experience;
                    	clueCustomer.hasExperience=experience;
                	    //年龄
                    	var customerAge=this.form.customerAge;
                    	clueCustomer.age=customerAge;
                	    //职业
                    	var customerJob=this.form.customerJob;
                    	clueCustomer.profession=customerJob;
                	    //合伙人
                    	var customerPartner=this.form.customerPartner;
                    	clueCustomer.partnerType=customerPartner;
                	    //选址情况
                    	var address=this.form.address;
                    	clueCustomer.hasAddress=address;
                	    //开店紧迫性
                	    var urgency =this.form.urgency;
                	    clueCustomer.urgentDate=urgency;
                	    //客户级别
                	    var customerLevel=this.form.customerLevel;
                	    clueCustomer.cusLevel=customerLevel;
                	    //QQ
                	    var qq=this.form.qq;
                	    clueCustomer.qq=qq;
                	  //email
                	    var email=this.form.customerEmail;
                	    clueCustomer.email=email;
                	    //餐饮经验
                	    var experience=this.form.cateringType;
                	    clueCustomer.experience=experience;
                	    //合伙人姓名电话
                	    var partnerNamePhone=this.form.customerPartnerDetail;
                	    clueCustomer.partnerNamePhone=partnerNamePhone;
                	    //出资人
                	    var investors=this.form.sponsor;
                	    clueCustomer.investors=investors;
                	    //出资人姓名电话
                	    var investorsNamePhone=this.form.sponsorOther;
                	    clueCustomer.investorsNamePhone=investorsNamePhone;
                	    //决策人
                	    var decide=this.form.decisionMaker;
                	    clueCustomer.decide=decide;
                	    //决策人姓名电话
                	    var decideNamePhone=this.form.decisionMakerOther;
                	    clueCustomer.decideNamePhone=decideNamePhone;
                	    //----投资意向---//
                	    var  clueIntention={};
                	    //投资金额
                	    var  money=this.form.money; 
                	    clueIntention.advanceAmount=money;
                	    //店面大小
                	   var  area= this.form.area;
                	   clueIntention.area=area;
                	    //意向品类
                	   var intentionCategory=this.form.intentionCategory;
                	   clueIntention.purType=intentionCategory;
                	    //意向项目
                	    var radioProject= this.form.radioProject;
                	    clueIntention.purProjectType=radioProject;
                	    //意向内部项目
                	    var  insideProject=this.form.insideProject;
                	    clueIntention.purInProject=insideProject;
                	    //意向外部项目
                	    var  outsideProject= this.form.outsideProject;
                	    clueIntention.purOutProject=outsideProject;
                	    //省
                	    var province= this.form.province;
                	    clueIntention.province=province;
                	    //市
                	    var city=this.form.city;
                        //区县
                        var district= this.form.district;
                        if(province){
                            clueIntention.city=city
                            if(city){
                                clueIntention.district=district;
                            }else{
                                clueIntention.district="";
                            }                            
                        }else{
                            clueIntention.city = ""
                            clueIntention.district=""
                        }
                        //是否考虑同行
                        var radioSelect= this.form.radioSelect;
                        clueIntention.istrade=radioSelect;
                        var  tradeProject;
                        if (radioSelect == 1) {
                            //同行业项目
                            var domains = this.form.domains;
                            var ary = [];
                            for (var i = 0; i < domains.length; i++) {
                                // 判断输入框里4个值是否重复(判断对象数组的value是否有重复值)
                                if (domains[i].value != "") {
                                    ary.push(domains[i].value);//把输入的手机号放入一个数组
                                    var s = ary.join(",") + ",";
                                    // console.log(ary)
                                    for (var j = 0; j < ary.length; j++) {
                                        console.log(ary[j])
                                        if (ary[j] != "") {
                                            if (s.replace(ary[j] + ",", "").indexOf(ary[j] + ",") > -1) {
                                                this.$message({
                                                    message: '请不要输入相同品牌',
                                                    type: 'warning'
                                                });
                                                addCustomerVM.btnDisabled = false;
                                                return;
                                            }
                                        }
                                    }
                                }
                            }
                            tradeProject = ary.join(',');
                            clueIntention.tradeProject = tradeProject;
                        }
                        if (radioSelect == 1 && tradeProject == "") {
                            this.$message({
                                message: '请输入考虑同行业的品牌名称',
                                type: 'warning'
                            });
                            //保存按钮可点击
                            addCustomerVM.btnDisabled = false;
                            return;
                        }
                        var clue={};
              	        clue.clueId=clueId;
                        clue.clueCustomer=clueCustomer;
                        clue.clueIntention=clueIntention;
                        addCustomerVM.btnDisabled = true;
                        axios.post('/tele/clueMyCustomerInfo/updateCustomerClue',clue)
                        .then(function (response) {
                     	  addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
                              addCustomerVM.btnDisabled = false;
                    		  window.location.href="/aggregation/businessMyCustomer/listPage"; 
    		        	}});
                      });
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
             rebackClue(){
            	 window.location.href="/aggregation/businessMyCustomer/listPage";
            },
            submitDialogForm(dialogForm) {
                this.$refs[dialogForm].validate((valid) => {
                    if (valid) {
                        console.log('submit!!');
                        // 关闭弹窗
                        this.dialogFormVisible = false; 
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            number(){
    　　　     this.form.customerPhone=this.form.customerPhone.replace(/[^\.\d]/g,'');
               this.form.customerPhone=this.form.customerPhone.replace('.','');
            },
            qqnumber(){
    　　　     this.form.qq=this.form.qq.replace(/[^\.\d]/g,'');
               this.form.qq=this.form.qq.replace('.','');
    　　　  },
            agenumber(){
    　　　     this.form.customerAge=this.form.customerAge.replace(/[^\.\d]/g,'');
               this.form.customerAge=this.form.customerAge.replace('.','');
    　　　  },
            // 单选切换
            projectChange(){
                if(this.form.radioProject=="1"){//内部项目
                    this.insideProjectShow=true;
                    this.outsideProjectShow=false;
                }else if(this.form.radioProject=="2"){//外部项目
                    this.insideProjectShow=false;
                    this.outsideProjectShow=true;
                }
            },
            // 是否同行业
            professionChange(){
                if(this.form.radioSelect=="0"){//否
                    this.domainShow=false
                }else if(this.form.radioSelect=="1"){//是
                    this.domainShow=true
                }
            },
            addDomain() {
                if(this.form.domains.length>2){
                    this.$message({
                        message: '最多输入三个品牌',
                        type: 'warning'
                    });
                }else{
                    this.form.domains.push({
                        value: '',
                        key: Date.now()
                    });
                }                
            },
            removeDomain(item) {//移除
                var index = this.form.domains.indexOf(item)
                if (index !== -1) {
                  this.form.domains.splice(index, 1)
                }
            },
            handleSelectionChange(val) {  
                this.multipleSelection = val;
            },
            handleFileSelectionChange(val){
            	//上传资料
            	  this.multipleFileSelection = val;
            },
            handleTrackingSelection(val){
               this.multipleTrackingSelection=val;
            },
  /*           handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
              console.log(file);
            },
            handleExceed(files, fileList) {
              this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
            },
            beforeRemove(file, fileList) {
              return this.$confirm(`确定移除 ${ file.name }？`);
            },
            beforeFormUpload(file) { //上传格式大小的限制
                const isJPG = file.type === 'image/jpeg';
                const isPNG = file.type === 'image/png';
                const isMP3 = file.type === 'audio/mp3';
                const isLt200 = file.size / 1024 < 200; //200k;
                if( !isJPG || !isPNG || !isMP3 ){
                    this.$message.error('上传文件只能是 JPG/PNG/mp3 格式!');
                }
                return (isJPG || isPNG || isMP3) && isLt200;           
            }, */
 
            editRecord() {
              var rows=this.multipleTrackingSelection;
              if(rows.length!=1){
            	  if(rows.length!=1){
                      this.$message({
                         message: '请选择一条数据进行编辑',
                         type: 'warning'
                       });
                      return;
                  }
              }
                this.lineFormShow = true;
                this.formInline.id=rows[0].id;
                this.formInline.callTime=rows[0].callTime;
                this.formInline.customerStatus=rows[0].customerStatus;;
                this.formInline.isCall=rows[0].isCall+"";
                this.formInline.resourceStatus=rows[0].resourceStatus+"";
                this.formInline.focusPoint=rows[0].focusPoint;
                this.formInline.visitStatus=rows[0].visitStatus+"";
                this.formInline.nextVisitTime=rows[0].nextVisitTime;
                isEdit=true;
            },
            onConfirmAdd(index ,row) { 
             //跟进记录保存
             var param={};
             param.clueId=clueId;
             var callTime=this.formInline.callTime;
             if(typeof(callTime)=='string'){
            	  param.callTime=new Date(Date.parse(callTime.replace(/-/g, "/")));
             }else{
                 param.callTime=this.formInline.callTime; 
             }
       
             param.customerStatus=this.formInline.customerStatus;
             param.isCall=this.formInline.isCall;
             param.resourceStatus=this.formInline.resourceStatus;
             param.focusPoint=this.formInline.focusPoint;
             param.visitStatus=this.formInline.visitStatus;
             var nextVisitTime=this.formInline.nextVisitTime;
             var callTime=this.formInline.callTime;
             if(typeof(nextVisitTime)=='string'){
              	  param.nextVisitTime=new Date(Date.parse(nextVisitTime.replace(/-/g, "/")));
             }else{
                 param.nextVisitTime=this.formInline.nextVisitTime; 
             }
             //如果是编辑跟进记录
             if( isEdit){
                 param.id=this.formInline.id;
            	 axios.post('/tele/clueMyCustomerInfo/updateClueTracking',param)
                 .then(function (response) {
               	  addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
               	    axios.post('/tele/clueMyCustomerInfo/findClueTracking',param)
                    .then(function (response) {
                    	addCustomerVM.tableDataC2=response.data.data;
                     }); 
    	          }}); 	 
                 });
             }else{
                 axios.post('/tele/clueMyCustomerInfo/saveClueTracking',param)
                 .then(function (response) {
               	  addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
               	    axios.post('/tele/clueMyCustomerInfo/findClueTracking',param)
                    .then(function (response) {
                    	 addCustomerVM.tableDataC2=response.data.data;
                     }); 
    	          }}); 
               }); 
             }
            },
             //上传文件
            introPicClick() {

                if($("#ossfile").find("div").length > 0){
                }else {
                    layer.msg("请选择所需上传图片");
                    return;
                }

                var src = uploadFile();
                if (src){
                    layer.msg("上传成功");
                    var div = $("#ossfile").children("div");
                    $(div).remove();
                    $("#picMsg").css("display","none");
                }
                $("#introPic").val(src);

                setTimeout(function () {
                    $("#introPicSrc").attr("src", src);
                }, 1000);
            },
        	getTalkTimeText(row, column, value, index){
        		var valText="";
        		if(value){
        			valText =  this.formatSeconds(value);
        		}
        		return valText;
        	},
            formatSeconds(s){
        		var t="";
        		var hour = Math.floor(s/3600);
                var min = Math.floor(s/60) % 60;
                var sec = s % 60;
                if(hour<10){
                	t+="0";
                }
                t+=hour+":";
               if(min < 10){
                	t += "0";
                }
                t += min + ":";
               if(sec < 10){
                	t += "0";
               }
                t+=sec;
               // t += sec.toFixed(2);
    		  return t;
        	},
            //删除上传文件
            deteleClueFile(){
             	//删除提示弹框
           	 var rows=this.multipleFileSelection;
                if(rows.length<1){
              	  if(rows.length!=1){
                        this.$message({message: '请选择删除数据', type: 'warning'});
                        return;
                    }
                }
                for(var i = 0 ; i < rows.length ;i ++){
                    if(rows[i].uploadUser!=this.loginUserId){
                        this.$message({message: '选中数据存在他人数据，不能进行编辑操作', type: 'warning'});
                        return;
                    }
                }
               this.$confirm('确定要删除上传文件？', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
               	 var ids=[];
                   for(var i=0;i<rows.length;i++) {
                   	ids.push(rows[i].id);
                   }
                   var param={};
                   param.delIds=ids;
                   param.clueId=clueId;
                   axios.post('/tele/clueMyCustomerInfo/deleteClueFile',param)
                   .then(function (response) {
                 	  addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
                	     axios.post('/tele/clueMyCustomerInfo/findClueFile',param)
                        .then(function (response) {
                      	  addCustomerVM.tableDataC1=response.data.data;
                        }); 
                        
      	              }}); 
                   }); 
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });          
                });
            	
            },
            deteleTracking() {
            	//删除提示弹框
            	 var rows=this.multipleTrackingSelection;
                 if(rows.length<1){
               	  if(rows.length!=1){
                         this.$message({
                            message: '请选择删除数据',
                            type: 'warning'
                          });
                         return;
                     }
                 }
                 this.$confirm('确定要删除跟进记录？', '提示', {
                     confirmButtonText: '确定',
                     cancelButtonText: '取消',
                     type: 'warning'
                 }).then(() => {
                	 var ids=[];
                    for(var i=0;i<rows.length;i++) {
                    	ids.push(rows[i].id);
                    }
                    var param={};
                    param.idList=ids;
                    param.clueId=clueId;
                    axios.post('/tele/clueMyCustomerInfo/deleteClueTracking',param)
                    .then(function (response) {
                  	  addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
                 	     axios.post('/tele/clueMyCustomerInfo/findClueTracking',param)
                         .then(function (response) {
                       	  addCustomerVM.tableDataC2=response.data.data;
                         }); 
                         
       	              }}); 
                    }); 
                 }).catch(() => {
                     this.$message({
                         type: 'info',
                         message: '已取消删除'
                     });          
                 });
            },

            changeProvince(selVal){
                addCustomerVM.form.city='';
                addCustomerVM.form. district='';
                addCustomerVM.cityArr=[];
                addCustomerVM.districtArr=[];
                this.currentProvince(selVal)
            },
            currentProvince(selVal){
               var  param={};
                param.type="1";
                param.name=selVal;
                axios.post('/area/sysregion/querySysRegionByParam',param).then(function (response) {  
                  addCustomerVM.cityArr=response.data.data.data;
                });  	
             },
            changeCity(selVal){
                addCustomerVM.form.district='';
                addCustomerVM.districtArr=[];
                this.currentCity(selVal)
            },
             currentCity(selVal){
            	 var param={};
                 param.type="2";
                 param.name=selVal;
                 axios.post('/area/sysregion/querySysRegionByParam',param).then(function (response) {  
                   addCustomerVM.districtArr=response.data.data.data;
                 });  	
              },
            //邀约来访
            inviteCustomer(){
            	 window.location.href="/tele/clueMyCustomerInfo/inviteCustomer?clueId="+clueId; 
            	
            },
            handleOperateFn(index, row) { //上传资源"查看图片、下载录音"
                console.log(index, row);
                // if( row.fileType == 'mp3' ){
                if (row.fileType == 'mp3'|| row.fileType == 'mp4' || row.fileType == 'wav' || row.fileType == 'wma'|| row.fileType == '3gpp' || row.fileType == 'm4a' ||row.fileType == 'ape'|| row.fileType == 'midi' || row.fileType == 'amr'|| row.fileType == 'MP3'|| row.fileType == 'MP4' ||row.fileType == 'WAV' || row.fileType == 'WMA'|| row.fileType == '3GPP' || row.fileType == 'M4A' ||row.fileType == 'APE'|| row.fileType == 'MIDI' || row.fileType == 'AMR') {
                    /* axios.get(row.filePath).then(function(response){
                        console.log(response);
                        //this.download1( response.data, row.fileName, 'auido/mp3' );
                    }).catch(function(error){
                        console.log(error);
                    }); */
                    var x=new XMLHttpRequest();
                    x.open("GET", row.filePath, true);
                    x.responseType = 'blob';
                    x.onload=function(e){
                        download(x.response, row.fileName, "auido/mp3" );
                    };
                    x.send();
                    //this.download1( row.filePath, row.fileName, 'auido/mp3' );
                }else{
                    this.dialogFormUploadImgSrc = row.filePath;
                    this.dialogFormUploadImg =  true;
                }
            },
            addRecord() { //添加记录
                this.tableDataC2.push({
                    dialingTime:`<el-form-item label="" size="mini">
                                    <el-select v-model="formInline.region" placeholder="客户状态">
                                      <el-option label="区域一" value="shanghai"></el-option>
                                      <el-option label="区域二" value="beijing"></el-option>
                                    </el-select>
                                  </el-form-item>`,
                    customerStatus: '',
                    dialing:'',
                    resourceAvailability:'',
                    customerfocus:'',
                    visited:'',
                    visitedNextTime:'',
                    creater:''
                });
            },
            handlePlay(index, row) { //通话记录播放btn
            	$("audio").hide();
                console.log(index, row);
                var show = $(".el-icon-pause-svg:eq("+index+")").css("display");
                if( $(".el-icon-pause-svg:eq("+index+")").css("display") == 'none' ){
                    $("button.playBtn:eq("+index+") i").remove();
                    $(".el-icon-pause-svg:eq("+index+")").css("display","block");
                    $("audio").get(index).play();
                }else{
                    $("button.playBtn:eq("+index+")").append('<i class="el-icon-caret-right"></i>');
                    $(".el-icon-pause-svg:eq("+index+")").css("display","none");
                    $("audio").get(index).pause();
                }
            },
            handleDownload(index, row) { //通话记录下载btn
                console.log(index, row);
                $(".downloadMp3:eq("+index+") a").prop("download","true");
                $(".downloadMp3:eq("+index+") a>p").trigger("click");
            },
          openWechat() {
            this.wechatVisible = true
            this.wechatForm.wechat2=this.form.wechat2;
            this.wechatForm.wechatUrl=this.form.wechatUrl;
          },
          wechatSumbit() {
            this.form.wechat2=this.wechatForm.wechat2;
            this.form.wechatUrl=this.wechatForm.wechatUrl;
            addCustomerVM.$message({ message: "提交成功", type: 'success' });
            this.wechatVisible = false;
          },
          submitUpload(){
            //this.customUpload();
            this.$refs.refundApplyImgUpload.submit();
          },
          handlePreview(file){

          },
          handleRemove(file,fileList){
            this.fileList=[];
            this.wechatForm.fileList=[];
          },
          handleExceed(files, fileList) {
            //this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
          },
          handleSuccess(response, file, fileList){
            console.info(fileList);
            console.info(addCustomerVM.fileList);
            var realName = file.name;
            var randomName = addCustomerVM.uploadParamData.key;
            var imgUrl =  addCustomerVM.uploadOssHost+"/"+randomName;
            this.wechatForm.wechatUrl=imgUrl;
            this.wechatForm.fileList.push(realName);
            this.fileList=[];
            this.wechatForm.fileList=[];
          },
          handleError(err, file, fileList){
            console.info(err);
          },
          random_string(len) {
            len = len || 32;
            var chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
            var maxPos = chars.length;
            var pwd = '';
            for (i = 0; i < len; i++) {
              pwd += chars.charAt(Math.floor(Math.random() * maxPos));
            }
            return pwd;
          },
          get_suffix(filename) {
            var pos = filename.lastIndexOf('.')
            suffix = ''
            if (pos != -1) {
              suffix = filename.substring(pos);
            }
            return suffix;
          },
          handleBefore(file){
            var isTextComputer = file.type === 'image/png' || file.type==='image/jpeg';
            if(!isTextComputer){
              this.fileList=[];
              this.$message.error('文件格式错误');
              return false;
            }
            if(file.size>2*1024*1024){
              this.fileList=[];
              this.$message.error('图片最大为2MB');
              return false;
            }
          },
        },
        mounted(){
            document.getElementById('addCustomer').style.display = 'block';
           if(customer){
        	   this.form.customerName=customer.cusName; 
        	   this.form.customerPhone=customer.linkPhone;
        	   this.form.customerSex=customer.sex==null?"":customer.sex+"";
             this.form.wechat = customer.wechat;
             this.form.wechat2 = customer.wechat2;
             this.form.wechatUrl = customer.wechatCode;
        	   this.form.experience=customer.hasExperience==null?"":customer.hasExperience+"";
        	   this.form.customerAge=customer.age;
        	   this.form.customerJob=customer.profession==null?"":customer.profession;
        	   this.form.customerPartner=customer.partnerType==null?"":customer.partnerType+"";
        	   this.form.address=customer.hasAddress==null?"":customer.hasAddress+"";
        	   this.form.urgency=customer.urgentDate;
        	   this.form.customerLevel=customer.cusLevel==null?"":customer.cusLevel+"";
        	   this.form.qq=customer.qq;
        	   this.form.customerEmail=customer.email;
        	   this.form.cateringType=customer.experience==null?"":customer.experience;
        	   this.form.customerPartnerDetail=customer.partnerNamePhone==null?"":customer.partnerNamePhone;
        	   this.form.sponsor=customer.investors==null?"":customer.investors+"";
        	   this.form.sponsorOther=customer.investorsNamePhone==null?"":customer.investorsNamePhone;
        	   this.form.decisionMaker=customer.decide==null?"":customer.decide+"";
        	   this.form.decisionMakerOther=customer.decideNamePhone==null?"":customer.decideNamePhone;
               // if(customer.phone ==null || customer.phone=='' ||  phoneArr.length<1){
               //     this.isshowPhone = true;
               // }
//               if(customer.wechatCode !=null && customer.wechatCode!=''){
//                   this.showwchatcode = customer.wechatCode;
//                   this.showWxCodeFalg = true;
//               }else{
//                   this.showwchatcode = "/images/errorIcon.jpg";
//                   this.showWxCodeFalg = false;
//               }
           }
           if(intention){
        	   this.form.money=intention.advanceAmount==null?"":intention.advanceAmount+"";
        	   this.form.area=intention.area==null?"":intention.area+"";
        	   this.form.intentionCategory=intention.purType==null?"":intention.purType+"";

        	   this.form.radioProject=intention.purProjectType+"";
        	   this.form.insideProject=intention.purInProject==null?"":intention.purInProject+"";
        	   this.form.outsideProject=intention.purOutProject;
        	   this.form.province=intention.province;
        	   this.form.city=intention.city;
        	   this.form.district=intention.district;

        	   if(this.form.province){
        	     this.currentProvince(this.form.province)
               }
        	   if(this.form.city){
                   this.currentCity(this.form.city)
               }
               //是否考虑同行业
               if (intention.istrade == null && intention.purProjectType == 2) {
                   this.form.radioSelect = 1+"";
                   if(intention.purOutProject != null){
                       this.domainShow = true;
                       this.form.domains.push({value:intention.purOutProject});
                   }

               }else{
                   this.form.radioSelect = intention.istrade == null ? "" : intention.istrade + "";
                   //同行业项目
                   if (intention.tradeProject != null  && intention.tradeProject != "") {
                       this.domainShow = true;
                       var tradeProjectArr = intention.tradeProject.split(",");
                       for(var i=0;i<tradeProjectArr.length;i++){
                           this.form.domains.push({
                               value: tradeProjectArr[i],
                           });
                       }
                   }else{
                       //同行业品牌占位
                       this.form.domains.push({
                           value: ''
                       });
                   }
               }
        	   if(this.form.intentionCategory){
                   this.projectChangeSelect(this.form.intentionCategory)
               }else{
        	       this.proSelect = proSelect;
               }
           }
        },
        created(){
            //初始资源类别数据
          this.getUploadParam();
          	var  param={};
          	param.groupCode="clueCategory";
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
           	 addCustomerVM.categoryArr=response.data.data;
            });
          	 //初始化资源类型数据
       	   param={};
       	   param.groupCode="clueType";
           axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
             addCustomerVM.typeArr=response.data.data;
            });
           
          //初始化资源类型数据
      	   param={};
      	   param.groupCode="clueType";
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
            addCustomerVM.typeArr=response.data.data;
           });
          //初始化媒介
    	   param={};
    	   param.groupCode="medium";
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
           addCustomerVM.mediumArry=response.data.data;
         });
          //广告位
          param={};
          param.groupCode="adsense"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.adsenseArr=response.data.data;
           });
          
          //餐饮经验
          param={};
          param.groupCode="CateringExperience"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.CateringExperienceArr=response.data.data;
           });
          //职业
          param={};
          param.groupCode="occupation"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.occupationArr=response.data.data;
           });
          
          //合伙人
          param={};
          param.groupCode="partner"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.partnerArr=response.data.data;
           });
          
          //选址情况
          param={};
          param.groupCode="optionAddress"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.optionAddressArr=response.data.data;
           });
          //客户级别
          param={};
          param.groupCode="customerLevel"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.customerLevelArr=response.data.data;
           });
            //意向品类
            param = {};
            param.groupCode = "project_category";
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode', param).then(function (response) {
                addCustomerVM.IntentionalCategoryArr = response.data.data;
            });
        //投资金额
          param={};
          param.groupCode="investmentAmount";
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.ussmArr=response.data.data;
           });
          //店面大小
          param={};
          param.groupCode="StorefrontArea"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
              addCustomerVM.StorefrontAreaArr=response.data.data;
           });
         //客户状态 
          param={};
          param.groupCode="customerStatus"; 
          axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
        	  addCustomerVM.cusStatusArr=response.data.data;
           });
         //获取省
          param={};
          param.type="0";
          axios.post('/area/sysregion/querySysRegionByParam',param).then(function (response) {  
       	   addCustomerVM.provinceArr=response.data.data.data;
          });
    	}
    })
</script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/crypto/crypto.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/hmac/hmac.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/crypto1/sha1/sha1.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/lib/base64.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/plupload.full.min.js'}"></script>
<script type="text/javascript" th:src="@{'/js/custom/file_upload/file_upload.js'}"></script>
 <script type="text/javascript">
 
 function clueUploadFile(){
         var result= uploadFile();
         if(result ==null){
             // alert("请选择上传文件");
             addCustomerVM.$message({message: '请选择上传文件', type: 'warning'});
             return ;
         }
    	var  param={};
     	param.clueId=clueId;
        param.filePath=result;
	   	axios.post('/tele/clueMyCustomerInfo/uploadClueFile',param).then(function (response) { 
      	 addCustomerVM.$message({message:'操作成功',type:'success',duration:2000,onClose:function(){
      	     axios.post('/tele/clueMyCustomerInfo/findClueFile',param)
              .then(function (response) {
            	  addCustomerVM.tableDataC1=response.data.data;
            	  ossfile.innerHTML="";
                }); 
             }}); 
        });
 }
 
 </script>
<script th:src="@{/js/custom/callrecord/simpleAudio02.js?v=1.0.0}"></script>
<script th:src="@{/js/custom/callrecord/download.js?v=1.0.0}"></script>
<style>
    .el-button.is-disabled, .el-button.is-disabled:focus, .el-button.is-disabled:hover{
        color: #6f7180;
    }
</style>
</html>