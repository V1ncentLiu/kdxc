<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://www.thymeleaf.org">
<head th:replace="_header_include::frag(~{::title},~{},~{})">
    <title>后台管理系统</title>
    <style>
        button a{color:#fff!important;}
    </style>
</head>
<body>
<div id="userManage" class="userManage mainPadding">  
    <el-breadcrumb separator="/" class="elBreadcrumb marginB20">
        <el-breadcrumb-item>Home</el-breadcrumb-item>
        <el-breadcrumb-item>系统管理</el-breadcrumb-item>
        <el-breadcrumb-item><a href="JavaScript:void(0)" data-url="a.html">用户管理</a></el-breadcrumb-item>
    </el-breadcrumb>
    
    
    <el-form :inline="true" :model="userSearchForm" class="demo-form-inline" ref="userSearchForm"> 
	    <el-row class="marginB10">
		    <el-form-item>
		        <el-button type="primary"><a href="addUserPage.html"><i class="el-icon-plus"></i>添加用户</a></el-button>
		        <el-button type="primary"><a href="editUserPage.html">编辑用户</a></el-button>
		        <el-button type="primary" class="f-fr" @click="dialogFormVisible = true">密码安全设置</el-button>
	    	</el-form-item>
	    </el-row>
	    <el-row class="marginB10 greybg padding20">
	        <el-row :gutter="20">
	            <el-col :span="4">
		            <el-form-item  prop="orgId">
		                <el-select v-model="userSearchForm.orgId"  placeholder="选择所属组织">
		                    <el-option v-for="item in searchTypeOptions"
				                        :key="item.value"
				                        :label="item.label"
				                        :value="item.value">
		                    </el-option>
		                </el-select>
		            </el-form-item>
	            </el-col>
	            <el-col :span="4">
	            	<el-form-item  prop="roleId">
		                <el-select v-model="userSearchForm.roleId" placeholder="角色选择">
		                    <el-option
		                        v-for="item in searchTypeOptions"
		                        :key="item.value"
		                        :label="item.label"
		                        :value="item.value">
		                    </el-option>
		                </el-select>
	                </el-form-item>
	            </el-col>
	            <el-col :span="4">
	            	<el-form-item  prop="status">
		                <el-select v-model="userSearchForm.status" placeholder="全部状态">
		                    <el-option
		                        v-for="item in statusOptions"
		                        :key="item.value"
		                        :label="item.label"
		                        :value="item.value">
		                    </el-option>
		                </el-select>
	                </el-form-item>
	            </el-col>
	            <el-col :span="4">
	            	<el-form-item  prop="searchType">
		                <el-select v-model="userSearchForm.searchType" >
		                    <el-option
		                        v-for="item in searchTypeOptions"
		                        :key="item.value"
		                        :label="item.label"
		                        :value="item.value">
		                    </el-option>
		                </el-select>
	                </el-form-item>
	            </el-col>
	            <el-col :span="5">
	            	<el-form-item  prop="searchText">
		                <el-input v-model="userSearchForm.searchText" placeholder="输入查询内容" class="input-with-select">
		                	<el-button slot="append" icon="el-icon-search" type="primary" @click="searchTable()"></el-button>
		                </el-input>
	                </el-form-item>
	            </el-col>
	        </el-row>
	    </el-row>
  	</el-form>
    
    
    <el-row>
        <el-table  ref="multipleTable" tooltip-effect="dark"
            style="width: 100%"  :data="dataTable" >
            <el-table-column align="center" type="selection" width="55"></el-table-column>
            <!-- <el-table-column prop="date" label="全选" width="180"></el-table-column> -->
            <el-table-column align="center" prop="username" label="登录用户名"></el-table-column>
            <el-table-column align="center" prop="phone" label="手机号"></el-table-column>
            <el-table-column align="center" prop="name" label="姓名"></el-table-column>
            <el-table-column align="center" prop="orgId" label="所在组织"></el-table-column>
            <el-table-column align="center" prop="role" label="角色"></el-table-column>
            <el-table-column align="center" prop="createTime" label="创建时间"></el-table-column>
            <el-table-column align="center" prop="duration" label="密码使用时长（天）"></el-table-column>
            <el-table-column align="center" prop="status" label="状态" :formatter="transformStatus"></el-table-column>
            <el-table-column align="center" prop="handle" label="操作"></el-table-column>
        </el-table>
        <table-pagination :pager="pager" @change="searchTable"></table-pagination>
    </el-row>
    <!-- dialog -->
    <el-dialog title="密码安全设置" :visible.sync="dialogFormVisible">
        <el-form :model="form">
            <el-row :gutter="20">
                <el-col :span="12">
                    <el-form-item label="密码最长使用期限：" :label-width="formLabelWidth">
                        <el-input v-model="form.name" autocomplete="off"></el-input>
                    </el-form-item>
                </el-col>
                <el-col :span="4">
                    <el-form-item>天</el-form-item>
                </el-col>
            </el-row>
            <el-form-item label="到期提醒通知设置：" :label-width="formLabelWidth">
                <el-button type="primary" size="medium" class="marginB10">添加</el-button>
                <el-row :gutter="20" class="marginB10">
                    <el-col :span="8">
                        <el-input v-model="form.name" autocomplete="off"></el-input>
                    </el-col>
                    <el-col :span="2">
                        <el-form-item>天</el-form-item>
                    </el-col>
                    <el-col :span="4">
                        <el-form-item><el-button type="primary" size="mini">删除</el-button></el-form-item>
                    </el-col>
                </el-row>
                <el-row :gutter="20" class="marginB10">
                    <el-col :span="8">
                        <el-input v-model="form.name" autocomplete="off"></el-input>
                    </el-col>
                    <el-col :span="2">
                        <el-form-item>天</el-form-item>
                    </el-col>
                    <el-col :span="4">
                        <el-form-item><el-button type="primary" size="mini">删除</el-button></el-form-item>
                    </el-col>
                </el-row>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button type="primary" @click="dialogFormVisible = false">确 定</el-button>
        </div>
    </el-dialog>
</div>
<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>
</body>
<script>
var userVM = new Vue({
        el: '#userManage',
        data: {
	        	userSearchForm: {
	                orgId: '',
	                roleId: '',
	                status: '',
	                searchType: '',
	                searchText: ''
	            },
	            dataTable:[],
	            pager:{
	                total: 0,
	                currentPage: 1,
	                pageSize: 20,
	            },
                radio:'',
                dialogFormVisible: false,
                dialogFormAdd: false,
                dialogFormChooseRole: false,
                dialogFormChooseOrg: false,
                form: {
                    name: '',
                    delivery: false,
                    type: []
                },
                formLabelWidth: '150px',
                formLabelWidth1: '120px',
                statusOptions: [{
                    value: '',
                    label: '全部'
                }, {
                    value: '1',
                    label: '启用'
                }, {
                    value: '2',
                    label: '禁用'
                }, {
                    value: '3',
                    label: '锁定'
                }],
                searchTypeOptions: [{
                    value: '1',
                    label: '登录名'
                }, {
                    value: '2',
                    label: '姓名'
                }, {
                    value: '手机号',
                    label: '禁用'
                }],
                value: '2'//下拉选项默认值
        },
        methods: {
        	searchTable() {
                var param ={};
                
                param.orgId = this.userSearchForm.orgId;
                param.roleId = this.userSearchForm.roleId;
                param.status = this.userSearchForm.status;
                if(this.userSearchForm.searchType=="1"){
	                param.username = this.userSearchForm.searchText;
                }else if(this.userSearchForm.searchType=="2"){
	                param.name = this.userSearchForm.searchText;
                }else if(this.userSearchForm.searchType=="3"){
	                param.phone = this.userSearchForm.searchText;
                }
                param.pageSize = this.pager.pageSize;
                param.pageNum = this.pager.currentPage;
                console.info(param);
                axios.post('/user/userManager/list', param)
                .then(function (response) {
                      var result =  response.data;
                      console.info(result);
                      var table=result.data;
                      userVM.dataTable= table.data;
                      userVM.pager.total =  table.total;
                      userVM.pager.currentPage = table.currentPage;
                })
                .catch(function (error) {
                     console.log(error);
                });
                
              },
              resetForm(formName) {
                  console.info(this.$refs[formName]);
                  this.$refs[formName].resetFields();
                  this.$refs[formName].resetFields();
              },
              //状态转换方法
              transformStatus(row, column, cellValue, index) {
                  console.info(row);
                  console.info(column);
                  console.info(cellValue);
                  console.info(index);
                  return cellValue;
              },
            //日期数据格式化方法
  	        dateFormat:function(row, column) {
  	           var date = row[column.property];
  	           if (date == undefined) {
  	               return "";
  	           }
  	           return moment(date).format("YYYY-MM-DD HH:mm:ss");
  	         },
              handleSizeChange(val) {
                  //下拉框  每页 10,20条切换 调用
                     console.log(`每页 ${val} 条`);
                  this.pageSize = val;
                  this.initTableData(1);
               },
               handleCurrentChange(val) {
                   //点击 页码
                 console.log(`当前页: ${val}`);
                 this.initTableData(val);
               }
        },
        created(){
            console.info("create method");
            this.searchTable();
           
        },
        mounted(){
           console.info("mounted method");
        }
    })
    
</script>
</html>