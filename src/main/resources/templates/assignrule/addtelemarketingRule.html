<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:replace="_header_include::frag(~{::title},~{::style},~{})">
    <title>后台管理系统</title>
    <style>
        .addModule{width: 80%;}
    </style>
</head>
<body>
<div id="addModule" class="addModule mainPadding">  
    <div class="fs16 marginB20"><div class="titleBorderL">新建分配规则</div></div>
    <el-form :model="form" :rules="rules" ref="form">
        <div class="marginB20 fs16"><em class="redcolor">*</em>必填项</div>
        <div class="borderbox paddingL20 paddingR20 paddingT10">
            <el-row>
                <el-col :span="12">
                    <el-form-item label="规则名称：" prop="assignName" :label-width="formLabelWidth">
                        <el-col :span="17">
                            <el-input v-model="form.assignName" autocomplete="off"  style="width: 100%;" maxlength="50"></el-input>
                        </el-col>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="12">
                    <el-form-item label="规则有效开始时间：" prop="startTime" :label-width="formLabelWidth">
                        <el-col :span="17">
                            <el-date-picker type="datetime" placeholder="选择日期时间" v-model="form.startTime" style="width: 100%;"></el-date-picker>
                        </el-col>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="规则有效结束时间：" prop="endTime" :label-width="formLabelWidth">
                        <el-col :span="17">
                            <el-date-picker type="datetime" placeholder="选择日期时间" v-model="form.endTime" style="width: 100%;"></el-date-picker>
                        </el-col>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="12">
                    <el-form-item label="资源类别：" prop="category" :label-width="formLabelWidth">
                        <el-checkbox-group v-model="form.category">
                            <el-checkbox v-for="item in categoryArr" :label="item.value" :key="item.value">{{item.name}}</el-checkbox>
                        </el-checkbox-group>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="资源类型：" prop="type" :label-width="formLabelWidth">
                        <el-checkbox-group v-model="form.type">
                            <el-checkbox v-for="item in typeArr" :label="item.value" :key="item.value">{{item.name}}</el-checkbox>
                        </el-checkbox-group>
                    </el-form-item>
                </el-col>
            </el-row>
        </div>
        <div class="marginB20 fs16 paddingT20">选填项</div>
        <div class="borderbox padding20">
            <el-row>
                <el-col :span="12">
                    <el-form-item label="" :label-width="formLabelWidth">
                        <el-tag
                            v-for="tag in tags"
                            :key="tag"
                            closable
                            @close="handleClose(tag)"
                            style="margin-right: 10px;">
                            {{tag}}
                        </el-tag>
                    </el-form-item>
                </el-col>
                <el-col :span="12">
                    <el-form-item label="" :label-width="formLabelWidth">
                        <el-tag
                            v-for="tag in areaTags"
                            :key="tag"
                            closable
                            @close="handleCloseArea(tag)"
                            style="margin-right: 10px;">
                            {{tag}}
                        </el-tag>
                    </el-form-item>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="12">
                    <el-col :span="11">
                        <el-form-item label="包含搜索词：" :label-width="formLabelWidth">
                            <el-input v-model="form.searchWord" autocomplete="off"  maxlength="50"></el-input>                            
                        </el-form-item>
                    </el-col>
                    <el-col :span="1">&nbsp;</el-col>
                    <el-col :span="3">
                        <el-form-item>
                            <el-button type="primary" @click="handleInputConfirm">添加</el-button>                        
                        </el-form-item>
                    </el-col>
                </el-col>
                <el-col :span="12">
                    <el-col :span="11">
                        <el-form-item label="地区：" :label-width="formLabelWidth">
                            <el-input v-model="form.area" autocomplete="off"  maxlength="50"></el-input>                            
                        </el-form-item>
                    </el-col>
                    <el-col :span="1">&nbsp;</el-col>
                    <el-col :span="3">
                        <el-form-item>
                            <el-button type="primary" @click="handleInputConfirmArea">添加</el-button>                        
                        </el-form-item>
                    </el-col>
                </el-col>
            </el-row>
            <el-form-item label="是否启用：" prop="status" :label-width="formLabelWidth">
                <el-select v-model="form.status" placeholder="请选择">
                    <el-option
                        v-for="item in options"
                        :key="item.value"
                        :label="item.label"
                        :value="item.value">
                    </el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="设定组内人员：" prop="choosePerson" :label-width="formLabelWidth">
                <el-button type="primary" @click="addDomain">添加人员</el-button>
            </el-form-item>
            <el-table :data="tableData" style="width: 100%" border>
                <el-table-column align="center" prop="id" label="序号" width="55"></el-table-column>
                <el-table-column align="center" prop="name" label="姓名">
                    <template slot-scope="scope">
                        <el-form-item prop="person">
                            <el-select v-model="form.person" placeholder="请选择">
                                <el-option
                                    v-for="item in personOptions"
                                    :key="item.id"
                                    :label="item.name"
                                    :value="item.id">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </template>
                </el-table-column>
                <el-table-column align="center" prop="num" label="资源条数">
                    <template slot-scope="scope">
                        <el-form-item prop="num" style="width: 200px;margin:0 auto;height: 57px;">
                            <el-input v-model="form.num"></el-input>
                        </el-form-item>
                    </template>
                </el-table-column>
                <el-table-column align="center" label="操作" width="120">
                    <template slot-scope="scope">
                        <el-button @click.native.prevent="deleteRow(scope.$index, tableData)" type="text" size="small">移除</el-button>
                    </template>
            </el-table-column>
          </el-table>
        </div>
        <div class="padding20 f-tac">            
            <el-button type="primary" @click="submitForm('form')">确认</el-button>
            <el-button>取 消</el-button>
        </div> 
    </el-form>  
</div>
<!-- import common js-->
<div th:include="_footer_include :: #jsLib"></div>
</body>
<script th:inline="javascript" >
    var itemsVal = ['联展', '竞价', '信息流', '官网','行业','其他'];
    var categoryItemsVal = ['留言', '在线', '免电'];
    //下拉列表电销顾问数据
    var orgUserList=[[${orgUserList}]];
   var  AddRuleVM= new Vue({
        el: '#addModule',
        data: function() {
            return {
            	categoryArr:[],
            	typeArr:[],
                form: {
                	assignName:'',
                    startTime:'',
                    endTime:'',
                    type:[],
                    category:[],
                    status:'1',//默认value值，启用
                    person:'',
                   searchWord:'',
                   status:'',
                   area:''
                    
                },
                formLabelWidth: '150px',
                rules:{
                    ruleName: [
                        { required: true, message: '请输入规则名称', trigger: 'blur' }
                    ],
                    dateStart: [
                        { required: true, message: '请输入规则有效开始时间', trigger: 'blur' }
                    ],
                    dateEnd: [
                        { required: true, message: '请输入规则有效结束时间', trigger: 'blur' }
                    ],
                    type: [
                        { type: 'array', required: true, message: '请至少选择一个资源类别', trigger: 'change' }
                    ],
                    category: [
                        { type: 'array', required: true, message: '请至少选择一个资源类型', trigger: 'change' }
                    ],
                    isUse: [
                        { required: true, required: true, message: '请选择是否启用', trigger: 'change' }
                    ],
                    num: [
                        { required: true, required: true, message: '请添加资源条数', trigger: 'change' }
                    ],
                    person: [
                        { required: true, required: true, message: '请选择组内人员', trigger: 'change' }
                    ]
                },
                options: [{
                    value: '1',
                    label: '启用'
                }, {
                    value: '0',
                    label: '禁用'
                }],
                tableData: [{
                    rank: '1'
                }],
                personOptions:orgUserList,
                tags: [],
                areaTags:[]
            }        	  
        },
        methods: {
            submitForm(form) {
                this.$refs[form].validate((valid) => {
                    if (valid) {
                    //规则成员数据	
                    debugger;
                    var memberArry=this.tableData ;
                    	
                    var assignName=this.form.assignName ;
                    	
                    var startTime=this.form.startTime ;	
                   
                    var endTime=this.form.endTime ;	
                    
                    var category=this.form.category ;	
                    	
                    var status=this.form.status ;	
                    
                    var searchWord=this.form.searchWord ;	
                    
                    var area=this.form.area ;	
        	
                    	
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            deleteRow(index, rows) {//删除一行表格
                rows.splice(index, 1);
            },
            handleInputConfirm() {//添加搜索词
                let searchWord = this.form.searchWord;
                if (searchWord) {
                    this.tags.push(searchWord);
                }
                this.form.searchWord = '';
                console.log(searchWord)
                console.log(this.tags)
            },
            handleClose(tag) {//删除搜索词
                this.tags.splice(this.tags.indexOf(tag), 1);
            },
            handleInputConfirmArea() {//添加地区
                let area = this.form.area;
                if (area) {
                    this.areaTags.push(area);
                }
                this.form.area = '';
                console.log(area)
                console.log(this.areaTags)
            },
            handleCloseArea(tag) {//删除地区
                this.areaTags.splice(this.areaTags.indexOf(tag), 1);
            },
            addDomain() {
                this.tableData.push({
                  rank: '',
                  key: Date.now()
                });
            }

        },
        created(){
           //初始资源类别数据
          	var  param={};
          	param.groupCode="clueCategory";
            axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
            	AddRuleVM.categoryArr=response.data.data;
            });
          	 //初始化资源类型数据
       	    param={};
       	   param.groupCode="clueType";
           axios.post('/dictionary/DictionaryItem/dicItemsByGroupCode',param).then(function (response) {  
         	AddRuleVM.typeArr=response.data.data;
            });
          }
    })
</script>
</html>